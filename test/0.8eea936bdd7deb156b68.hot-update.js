webpackHotUpdate(0,{

/***/ "./app/actions/items.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("Object.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__models_rdf__ = __webpack_require__(\"./app/models/rdf.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__services_sparql_item_service__ = __webpack_require__(\"./app/services/sparql-item-service.ts\");\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CREATE_TYPE\", function() { return CREATE_TYPE; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CREATE_ITEMS\", function() { return CREATE_ITEMS; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CREATE_DISPLAY_ITEMS\", function() { return CREATE_DISPLAY_ITEMS; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DELETE_ITEMS\", function() { return DELETE_ITEMS; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CLEAR_TYPES\", function() { return CLEAR_TYPES; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DISPLAY_ITEMS\", function() { return DISPLAY_ITEMS; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"HIDE_ITEM\", function() { return HIDE_ITEM; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CREATE_LOCAL_ITEM\", function() { return CREATE_LOCAL_ITEM; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ITEM_PROPERTIES\", function() { return ITEM_PROPERTIES; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SET_ORDERED_TYPES\", function() { return SET_ORDERED_TYPES; });\n/* harmony export (immutable) */ __webpack_exports__[\"displayItem\"] = displayItem;\n/* harmony export (immutable) */ __webpack_exports__[\"displayItems\"] = displayItems;\n/* harmony export (immutable) */ __webpack_exports__[\"itemProperty\"] = itemProperty;\n/* harmony export (immutable) */ __webpack_exports__[\"itemPropertyUpdated\"] = itemPropertyUpdated;\n/* harmony export (immutable) */ __webpack_exports__[\"createDisplayItem\"] = createDisplayItem;\n/* harmony export (immutable) */ __webpack_exports__[\"createDisplayItems\"] = createDisplayItems;\n\n\nvar CREATE_TYPE = 'CREATE_TYPE';\nvar CREATE_ITEMS = 'CREATE_ITEMS';\nvar CREATE_DISPLAY_ITEMS = 'CREATE_DISPLAY_ITEMS';\nvar DELETE_ITEMS = 'DELETE_ITEMS';\nvar CLEAR_TYPES = 'CLEAR_TYPES';\nvar DISPLAY_ITEMS = 'DISPLAY_ITEMS';\nvar HIDE_ITEM = 'HIDE_ITEM';\nvar CREATE_LOCAL_ITEM = 'CREATE_LOCAL_ITEM';\nvar ITEM_PROPERTIES = 'ITEM_PROPERTIES';\nvar SET_ORDERED_TYPES = 'SET_ORDERED_TYPES';\nfunction displayItem(item, coordinates) {\n    return {\n        type: DISPLAY_ITEMS,\n        payload: {\n            items: [item],\n            coordinates: [coordinates]\n        }\n    };\n}\nfunction displayItems(items, coordinates) {\n    return {\n        type: DISPLAY_ITEMS,\n        payload: {\n            items: items,\n            coordinates: coordinates\n        }\n    };\n}\nfunction itemProperty(sparqlItemService, item, propertiesToAdd, propertiesToRemove) {\n    return function (dispatch) {\n        return sparqlItemService.alterItem(item, propertiesToAdd, propertiesToRemove).then(function (str) {\n            dispatch(itemPropertyUpdated());\n        });\n    };\n}\nfunction itemPropertyUpdated() {\n    return {\n        type: ITEM_PROPERTIES,\n        payload: {}\n    };\n}\nfunction createDisplayItem($q, sparqlItemService, item, typ) {\n    return function (dispatch) {\n        return createItemsInternal($q, sparqlItemService, [item], typ).then(function () {\n            dispatch(displayItems([item]));\n        });\n    };\n}\nfunction createDisplayItems($q, sparqlItemService, items, typ) {\n    return function (dispatch) {\n        return createItemsInternal($q, sparqlItemService, items, typ).then(function () {\n            dispatch(displayItems(items));\n        });\n    };\n}\nfunction createItemsInternal($q, sparqlItemService, items, type) {\n    var typeNode = type ? __WEBPACK_IMPORTED_MODULE_0__models_rdf__[\"b\" /* DataFactory */].instance.namedNode(type) : __WEBPACK_IMPORTED_MODULE_0__models_rdf__[\"d\" /* OWL */].Thing;\n    if (items[0]) {\n        var proms = items.map(function (node) {\n            if (node.value) {\n                return sparqlItemService.createNewItem([new __WEBPACK_IMPORTED_MODULE_1__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_0__models_rdf__[\"a\" /* SKOS */].prefLabel, __WEBPACK_IMPORTED_MODULE_0__models_rdf__[\"b\" /* DataFactory */].instance.literal(node.value)), new __WEBPACK_IMPORTED_MODULE_1__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_0__models_rdf__[\"c\" /* RDF */].type, typeNode)]);\n            } else {\n                return sparqlItemService.createNewItem([new __WEBPACK_IMPORTED_MODULE_1__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_0__models_rdf__[\"c\" /* RDF */].type, typeNode)]);\n            }\n        });\n        return this.$q.all(proms);\n    } else {\n        return sparqlItemService.createNewItem([new __WEBPACK_IMPORTED_MODULE_1__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_0__models_rdf__[\"c\" /* RDF */].type, typeNode), new __WEBPACK_IMPORTED_MODULE_1__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_0__models_rdf__[\"a\" /* SKOS */].prefLabel, __WEBPACK_IMPORTED_MODULE_0__models_rdf__[\"b\" /* DataFactory */].instance.literal(''))]).then(function (node) {\n            return [node];\n        });\n    }\n}//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvYWN0aW9ucy9pdGVtcy50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hcHAvYWN0aW9ucy9pdGVtcy50cz84ZDYzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERhdGFGYWN0b3J5LCBPV0wsIFNLT1MsIFJERiB9IGZyb20gJy4uL21vZGVscy9yZGYnO1xuaW1wb3J0IHsgUHJvcGVydHlBbmRWYWx1ZSB9IGZyb20gJy4uL3NlcnZpY2VzL3NwYXJxbC1pdGVtLXNlcnZpY2UnO1xuZXhwb3J0IHZhciBDUkVBVEVfVFlQRSA9ICdDUkVBVEVfVFlQRSc7XG5leHBvcnQgdmFyIENSRUFURV9JVEVNUyA9ICdDUkVBVEVfSVRFTVMnO1xuZXhwb3J0IHZhciBDUkVBVEVfRElTUExBWV9JVEVNUyA9ICdDUkVBVEVfRElTUExBWV9JVEVNUyc7XG5leHBvcnQgdmFyIERFTEVURV9JVEVNUyA9ICdERUxFVEVfSVRFTVMnO1xuZXhwb3J0IHZhciBDTEVBUl9UWVBFUyA9ICdDTEVBUl9UWVBFUyc7XG5leHBvcnQgdmFyIERJU1BMQVlfSVRFTVMgPSAnRElTUExBWV9JVEVNUyc7XG5leHBvcnQgdmFyIEhJREVfSVRFTSA9ICdISURFX0lURU0nO1xuZXhwb3J0IHZhciBDUkVBVEVfTE9DQUxfSVRFTSA9ICdDUkVBVEVfTE9DQUxfSVRFTSc7XG5leHBvcnQgdmFyIElURU1fUFJPUEVSVElFUyA9ICdJVEVNX1BST1BFUlRJRVMnO1xuZXhwb3J0IHZhciBTRVRfT1JERVJFRF9UWVBFUyA9ICdTRVRfT1JERVJFRF9UWVBFUyc7XG5leHBvcnQgZnVuY3Rpb24gZGlzcGxheUl0ZW0oaXRlbSwgY29vcmRpbmF0ZXMpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBESVNQTEFZX0lURU1TLFxuICAgICAgICBwYXlsb2FkOiB7XG4gICAgICAgICAgICBpdGVtczogW2l0ZW1dLFxuICAgICAgICAgICAgY29vcmRpbmF0ZXM6IFtjb29yZGluYXRlc11cbiAgICAgICAgfVxuICAgIH07XG59XG5leHBvcnQgZnVuY3Rpb24gZGlzcGxheUl0ZW1zKGl0ZW1zLCBjb29yZGluYXRlcykge1xuICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IERJU1BMQVlfSVRFTVMsXG4gICAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgICAgIGl0ZW1zOiBpdGVtcyxcbiAgICAgICAgICAgIGNvb3JkaW5hdGVzOiBjb29yZGluYXRlc1xuICAgICAgICB9XG4gICAgfTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpdGVtUHJvcGVydHkoc3BhcnFsSXRlbVNlcnZpY2UsIGl0ZW0sIHByb3BlcnRpZXNUb0FkZCwgcHJvcGVydGllc1RvUmVtb3ZlKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkaXNwYXRjaCkge1xuICAgICAgICByZXR1cm4gc3BhcnFsSXRlbVNlcnZpY2UuYWx0ZXJJdGVtKGl0ZW0sIHByb3BlcnRpZXNUb0FkZCwgcHJvcGVydGllc1RvUmVtb3ZlKS50aGVuKGZ1bmN0aW9uIChzdHIpIHtcbiAgICAgICAgICAgIGRpc3BhdGNoKGl0ZW1Qcm9wZXJ0eVVwZGF0ZWQoKSk7XG4gICAgICAgIH0pO1xuICAgIH07XG59XG5leHBvcnQgZnVuY3Rpb24gaXRlbVByb3BlcnR5VXBkYXRlZCgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBJVEVNX1BST1BFUlRJRVMsXG4gICAgICAgIHBheWxvYWQ6IHt9XG4gICAgfTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEaXNwbGF5SXRlbSgkcSwgc3BhcnFsSXRlbVNlcnZpY2UsIGl0ZW0sIHR5cCkge1xuICAgIHJldHVybiBmdW5jdGlvbiAoZGlzcGF0Y2gpIHtcbiAgICAgICAgcmV0dXJuIGNyZWF0ZUl0ZW1zSW50ZXJuYWwoJHEsIHNwYXJxbEl0ZW1TZXJ2aWNlLCBbaXRlbV0sIHR5cCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBkaXNwYXRjaChkaXNwbGF5SXRlbXMoW2l0ZW1dKSk7XG4gICAgICAgIH0pO1xuICAgIH07XG59XG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGlzcGxheUl0ZW1zKCRxLCBzcGFycWxJdGVtU2VydmljZSwgaXRlbXMsIHR5cCkge1xuICAgIHJldHVybiBmdW5jdGlvbiAoZGlzcGF0Y2gpIHtcbiAgICAgICAgcmV0dXJuIGNyZWF0ZUl0ZW1zSW50ZXJuYWwoJHEsIHNwYXJxbEl0ZW1TZXJ2aWNlLCBpdGVtcywgdHlwKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGRpc3BhdGNoKGRpc3BsYXlJdGVtcyhpdGVtcykpO1xuICAgICAgICB9KTtcbiAgICB9O1xufVxuZnVuY3Rpb24gY3JlYXRlSXRlbXNJbnRlcm5hbCgkcSwgc3BhcnFsSXRlbVNlcnZpY2UsIGl0ZW1zLCB0eXBlKSB7XG4gICAgdmFyIHR5cGVOb2RlID0gdHlwZSA/IERhdGFGYWN0b3J5Lmluc3RhbmNlLm5hbWVkTm9kZSh0eXBlKSA6IE9XTC5UaGluZztcbiAgICBpZiAoaXRlbXNbMF0pIHtcbiAgICAgICAgdmFyIHByb21zID0gaXRlbXMubWFwKGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICBpZiAobm9kZS52YWx1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzcGFycWxJdGVtU2VydmljZS5jcmVhdGVOZXdJdGVtKFtuZXcgUHJvcGVydHlBbmRWYWx1ZShTS09TLnByZWZMYWJlbCwgRGF0YUZhY3RvcnkuaW5zdGFuY2UubGl0ZXJhbChub2RlLnZhbHVlKSksIG5ldyBQcm9wZXJ0eUFuZFZhbHVlKFJERi50eXBlLCB0eXBlTm9kZSldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBzcGFycWxJdGVtU2VydmljZS5jcmVhdGVOZXdJdGVtKFtuZXcgUHJvcGVydHlBbmRWYWx1ZShSREYudHlwZSwgdHlwZU5vZGUpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdGhpcy4kcS5hbGwocHJvbXMpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHNwYXJxbEl0ZW1TZXJ2aWNlLmNyZWF0ZU5ld0l0ZW0oW25ldyBQcm9wZXJ0eUFuZFZhbHVlKFJERi50eXBlLCB0eXBlTm9kZSksIG5ldyBQcm9wZXJ0eUFuZFZhbHVlKFNLT1MucHJlZkxhYmVsLCBEYXRhRmFjdG9yeS5pbnN0YW5jZS5saXRlcmFsKCcnKSldKS50aGVuKGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICByZXR1cm4gW25vZGVdO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL2FjdGlvbnMvaXRlbXMudHMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFGQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFGQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),

/***/ "./app/components/construct-view/construct-view-component.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__services_sparql_tree_service__ = __webpack_require__(\"./app/services/sparql-tree-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__actions_types__ = __webpack_require__(\"./app/actions/types.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__actions_items__ = __webpack_require__(\"./app/actions/items.ts\");\n/* unused harmony export ConstructViewComponentController */\n/* unused harmony export ConstructViewComponent */\n\n\n\n\n\n\n// class TreeViewConfiguration {\n//   constructor(public endpoint: string, public queryTemplate: string) {}\n// }\nvar ConstructViewComponentController = function () {\n    function ConstructViewComponentController(sparqlTreeService, projectService, fibraService, $ngRedux, $q) {\n        var _this = this;\n        this.sparqlTreeService = sparqlTreeService;\n        this.projectService = projectService;\n        this.fibraService = fibraService;\n        this.$ngRedux = $ngRedux;\n        this.$q = $q;\n        this.paletteDisplay = false;\n        this.limitFilter = '';\n        var unsub1 = $ngRedux.connect(this.mapTypesToThis, __WEBPACK_IMPORTED_MODULE_2__actions_types__)(this);\n        var unsub2 = $ngRedux.connect(this.mapItemsToThis, __WEBPACK_IMPORTED_MODULE_3__actions_items__)(this);\n        this.unsubscribe = function () {\n            unsub1();\n            unsub2();\n        };\n        var currentProject = projectService.getCurrentProject();\n        this.currentProjectSource = projectService.getProjectSources().find(function (ps) {\n            return ps.sparqlEndpoint === currentProject.source.sparqlEndpoint && ps.graph === currentProject.source.graph;\n        });\n        fibraService.on('change', function () {\n            var chosenTypes = fibraService.getState().construct.displayTypes;\n            _this.limitFilter = '';\n            chosenTypes.forEach(function (t) {\n                if (t) _this.limitFilter += '<' + t.id + '>' + ',';\n            });\n            if (_this.limitFilter.length !== 0) _this.limitFilter = 'FILTER (?groupId IN (' + _this.limitFilter.substring(0, _this.limitFilter.length - 1) + '))';\n            return _this.$q.resolve('ok');\n        });\n        this.classTreePromise = sparqlTreeService.getTree(this.fibraService.getState().project.endpoint, this.fibraService.getState().project.treeQuery);\n        this.classTreePromise.then(function (c) {\n            _this.classTree = c;\n            _this.clearTypes();\n            _this.traverseClassTree(c, function (n) {\n                return _this.types.types.indexOf(n) === -1 && n.children.length === 0;\n            }, function (n) {\n                return _this.addType(n);\n            });\n        });\n        this.fibraService.on('change', function () {\n            _this.classTreePromise = sparqlTreeService.getTree(_this.fibraService.getState().project.endpoint, __WEBPACK_IMPORTED_MODULE_0__services_sparql_tree_service__[\"a\" /* SparqlTreeService */].getClassTreeQuery);\n            return _this.classTreePromise.then(function (c) {\n                _this.classTree = c;\n                return 'ok';\n            });\n        });\n        this.fibraService.on('action', function () {\n            _this.state = fibraService.getState();\n            return _this.$q.resolve('ok');\n        });\n        this.state = fibraService.getState();\n    }\n    ConstructViewComponentController.prototype.createItem = function (item) {\n        // Is there a type on this item? If so, and it is not already in chosenTypes,\n        // add it.\n        var itemTypeKey = item.additionalInformation['type'][0] ? item.additionalInformation['type'][0].value : \"\";\n        var itemType = this.types.types.filter(function (t) {\n            return t.id === itemTypeKey;\n        })[0];\n        var chosenTypes = this.fibraService.getState().construct.displayTypes;\n        if (!chosenTypes[0] && itemType) {\n            this.setOrderedTypes([itemType]);\n        } else if (!chosenTypes[1] && itemType && chosenTypes[0] !== itemType) {\n            var newTypes = chosenTypes.concat([]);\n            newTypes.push(itemType);\n            this.setOrderedTypes(newTypes);\n        }\n        return this.fibraService.dispatchAction(this.displayItem(item.ids[0]));\n    };\n    ConstructViewComponentController.prototype.downloadRDF = function () {\n        var currentConfig = this.fibraService.getState().project.graph;\n        var downloadlink = \"http://ldf.fi/fibra/sparql?graph=\" + currentConfig; // + \"&force-accept=application/rdf+xml\"\n        var request = new XMLHttpRequest();\n        request.open(\"GET\", downloadlink, true);\n        request.onload = function (e) {\n            if (request.readyState === 4) {\n                if (request.status === 200) {\n                    var data = request.responseText;\n                    var download = document.createElement(\"a\");\n                    download.href = \"data:application/rdf+xml;charset=utf-8,\" + data;\n                    download.download = \"fibra.ttl\";\n                    document.body.appendChild(download);\n                    download.click();\n                    document.body.removeChild(download);\n                } else {\n                    console.error(request.statusText);\n                }\n            }\n        };\n        request.send(null);\n    };\n    ConstructViewComponentController.prototype.$onDestroy = function () {\n        this.unsubscribe();\n    };\n    ConstructViewComponentController.prototype.mapTypesToThis = function (state) {\n        return {\n            types: state.types\n        };\n    };\n    ConstructViewComponentController.prototype.mapItemsToThis = function (state) {\n        return {\n            items: state.items\n        };\n    };\n    ConstructViewComponentController.prototype.traverseClassTree = function (nodes, test, onSuccess) {\n        var traverse = function (node) {\n            if (test(node)) {\n                onSuccess(node);\n                node.children.forEach(traverse);\n            }\n        };\n        nodes.forEach(traverse);\n    };\n    return ConstructViewComponentController;\n}();\n\nvar ConstructViewComponent = function () {\n    function ConstructViewComponent() {\n        this.controller = ConstructViewComponentController; // (new (...args: any[]) => angular.IController) = ConstructViewComponentController\n        this.template = __webpack_require__(\"./app/components/construct-view/construct-view.pug\")();\n    }\n    return ConstructViewComponent;\n}();\n\n__WEBPACK_IMPORTED_MODULE_1_angular__[\"module\"]('fibra.components.construct-view', ['fibra.services']).component('constructView', new ConstructViewComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9jb25zdHJ1Y3Qtdmlldy1jb21wb25lbnQudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL2NvbXBvbmVudHMvY29uc3RydWN0LXZpZXcvY29uc3RydWN0LXZpZXctY29tcG9uZW50LnRzPzZmODMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuaW1wb3J0IHsgU3BhcnFsVHJlZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9zcGFycWwtdHJlZS1zZXJ2aWNlJztcbmltcG9ydCAqIGFzIGFuZ3VsYXIgZnJvbSAnYW5ndWxhcic7XG5pbXBvcnQgKiBhcyBUeXBlQWN0aW9ucyBmcm9tICcuLi8uLi9hY3Rpb25zL3R5cGVzJztcbmltcG9ydCAqIGFzIEl0ZW1BY3Rpb25zIGZyb20gJy4uLy4uL2FjdGlvbnMvaXRlbXMnO1xuLy8gY2xhc3MgVHJlZVZpZXdDb25maWd1cmF0aW9uIHtcbi8vICAgY29uc3RydWN0b3IocHVibGljIGVuZHBvaW50OiBzdHJpbmcsIHB1YmxpYyBxdWVyeVRlbXBsYXRlOiBzdHJpbmcpIHt9XG4vLyB9XG52YXIgQ29uc3RydWN0Vmlld0NvbXBvbmVudENvbnRyb2xsZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIENvbnN0cnVjdFZpZXdDb21wb25lbnRDb250cm9sbGVyKHNwYXJxbFRyZWVTZXJ2aWNlLCBwcm9qZWN0U2VydmljZSwgZmlicmFTZXJ2aWNlLCAkbmdSZWR1eCwgJHEpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5zcGFycWxUcmVlU2VydmljZSA9IHNwYXJxbFRyZWVTZXJ2aWNlO1xuICAgICAgICB0aGlzLnByb2plY3RTZXJ2aWNlID0gcHJvamVjdFNlcnZpY2U7XG4gICAgICAgIHRoaXMuZmlicmFTZXJ2aWNlID0gZmlicmFTZXJ2aWNlO1xuICAgICAgICB0aGlzLiRuZ1JlZHV4ID0gJG5nUmVkdXg7XG4gICAgICAgIHRoaXMuJHEgPSAkcTtcbiAgICAgICAgdGhpcy5wYWxldHRlRGlzcGxheSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmxpbWl0RmlsdGVyID0gJyc7XG4gICAgICAgIHZhciB1bnN1YjEgPSAkbmdSZWR1eC5jb25uZWN0KHRoaXMubWFwVHlwZXNUb1RoaXMsIFR5cGVBY3Rpb25zKSh0aGlzKTtcbiAgICAgICAgdmFyIHVuc3ViMiA9ICRuZ1JlZHV4LmNvbm5lY3QodGhpcy5tYXBJdGVtc1RvVGhpcywgSXRlbUFjdGlvbnMpKHRoaXMpO1xuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdW5zdWIxKCk7XG4gICAgICAgICAgICB1bnN1YjIoKTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGN1cnJlbnRQcm9qZWN0ID0gcHJvamVjdFNlcnZpY2UuZ2V0Q3VycmVudFByb2plY3QoKTtcbiAgICAgICAgdGhpcy5jdXJyZW50UHJvamVjdFNvdXJjZSA9IHByb2plY3RTZXJ2aWNlLmdldFByb2plY3RTb3VyY2VzKCkuZmluZChmdW5jdGlvbiAocHMpIHsgcmV0dXJuIHBzLnNwYXJxbEVuZHBvaW50ID09PSBjdXJyZW50UHJvamVjdC5zb3VyY2Uuc3BhcnFsRW5kcG9pbnQgJiYgcHMuZ3JhcGggPT09IGN1cnJlbnRQcm9qZWN0LnNvdXJjZS5ncmFwaDsgfSk7XG4gICAgICAgIGZpYnJhU2VydmljZS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGNob3NlblR5cGVzID0gZmlicmFTZXJ2aWNlLmdldFN0YXRlKCkuY29uc3RydWN0LmRpc3BsYXlUeXBlcztcbiAgICAgICAgICAgIF90aGlzLmxpbWl0RmlsdGVyID0gJyc7XG4gICAgICAgICAgICBjaG9zZW5UeXBlcy5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7IGlmICh0KVxuICAgICAgICAgICAgICAgIF90aGlzLmxpbWl0RmlsdGVyICs9ICc8JyArIHQuaWQgKyAnPicgKyAnLCc7IH0pO1xuICAgICAgICAgICAgaWYgKF90aGlzLmxpbWl0RmlsdGVyLmxlbmd0aCAhPT0gMClcbiAgICAgICAgICAgICAgICBfdGhpcy5saW1pdEZpbHRlciA9ICdGSUxURVIgKD9ncm91cElkIElOICgnICsgX3RoaXMubGltaXRGaWx0ZXIuc3Vic3RyaW5nKDAsIF90aGlzLmxpbWl0RmlsdGVyLmxlbmd0aCAtIDEpICsgJykpJztcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy4kcS5yZXNvbHZlKCdvaycpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5jbGFzc1RyZWVQcm9taXNlID0gc3BhcnFsVHJlZVNlcnZpY2UuZ2V0VHJlZSh0aGlzLmZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLnByb2plY3QuZW5kcG9pbnQsIHRoaXMuZmlicmFTZXJ2aWNlLmdldFN0YXRlKCkucHJvamVjdC50cmVlUXVlcnkpO1xuICAgICAgICB0aGlzLmNsYXNzVHJlZVByb21pc2UudGhlbihmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgX3RoaXMuY2xhc3NUcmVlID0gYztcbiAgICAgICAgICAgIF90aGlzLmNsZWFyVHlwZXMoKTtcbiAgICAgICAgICAgIF90aGlzLnRyYXZlcnNlQ2xhc3NUcmVlKGMsIGZ1bmN0aW9uIChuKSB7IHJldHVybiBfdGhpcy50eXBlcy50eXBlcy5pbmRleE9mKG4pID09PSAtMSAmJiBuLmNoaWxkcmVuLmxlbmd0aCA9PT0gMDsgfSwgZnVuY3Rpb24gKG4pIHsgcmV0dXJuIF90aGlzLmFkZFR5cGUobik7IH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5maWJyYVNlcnZpY2Uub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF90aGlzLmNsYXNzVHJlZVByb21pc2UgPSBzcGFycWxUcmVlU2VydmljZS5nZXRUcmVlKF90aGlzLmZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLnByb2plY3QuZW5kcG9pbnQsIFNwYXJxbFRyZWVTZXJ2aWNlLmdldENsYXNzVHJlZVF1ZXJ5KTtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5jbGFzc1RyZWVQcm9taXNlLnRoZW4oZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5jbGFzc1RyZWUgPSBjO1xuICAgICAgICAgICAgICAgIHJldHVybiAnb2snO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZS5vbignYWN0aW9uJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX3RoaXMuc3RhdGUgPSBmaWJyYVNlcnZpY2UuZ2V0U3RhdGUoKTtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy4kcS5yZXNvbHZlKCdvaycpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IGZpYnJhU2VydmljZS5nZXRTdGF0ZSgpO1xuICAgIH1cbiAgICBDb25zdHJ1Y3RWaWV3Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuY3JlYXRlSXRlbSA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIC8vIElzIHRoZXJlIGEgdHlwZSBvbiB0aGlzIGl0ZW0/IElmIHNvLCBhbmQgaXQgaXMgbm90IGFscmVhZHkgaW4gY2hvc2VuVHlwZXMsXG4gICAgICAgIC8vIGFkZCBpdC5cbiAgICAgICAgdmFyIGl0ZW1UeXBlS2V5ID0gaXRlbS5hZGRpdGlvbmFsSW5mb3JtYXRpb25bJ3R5cGUnXVswXSA/IGl0ZW0uYWRkaXRpb25hbEluZm9ybWF0aW9uWyd0eXBlJ11bMF0udmFsdWUgOiBcIlwiO1xuICAgICAgICB2YXIgaXRlbVR5cGUgPSB0aGlzLnR5cGVzLnR5cGVzLmZpbHRlcihmdW5jdGlvbiAodCkgeyByZXR1cm4gdC5pZCA9PT0gaXRlbVR5cGVLZXk7IH0pWzBdO1xuICAgICAgICB2YXIgY2hvc2VuVHlwZXMgPSB0aGlzLmZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLmNvbnN0cnVjdC5kaXNwbGF5VHlwZXM7XG4gICAgICAgIGlmICghY2hvc2VuVHlwZXNbMF0gJiYgaXRlbVR5cGUpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0T3JkZXJlZFR5cGVzKFtpdGVtVHlwZV0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCFjaG9zZW5UeXBlc1sxXSAmJiBpdGVtVHlwZSAmJiAoY2hvc2VuVHlwZXNbMF0gIT09IGl0ZW1UeXBlKSkge1xuICAgICAgICAgICAgdmFyIG5ld1R5cGVzID0gY2hvc2VuVHlwZXMuY29uY2F0KFtdKTtcbiAgICAgICAgICAgIG5ld1R5cGVzLnB1c2goaXRlbVR5cGUpO1xuICAgICAgICAgICAgdGhpcy5zZXRPcmRlcmVkVHlwZXMobmV3VHlwZXMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmZpYnJhU2VydmljZS5kaXNwYXRjaEFjdGlvbih0aGlzLmRpc3BsYXlJdGVtKGl0ZW0uaWRzWzBdKSk7XG4gICAgfTtcbiAgICBDb25zdHJ1Y3RWaWV3Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuZG93bmxvYWRSREYgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjdXJyZW50Q29uZmlnID0gdGhpcy5maWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5wcm9qZWN0LmdyYXBoO1xuICAgICAgICB2YXIgZG93bmxvYWRsaW5rID0gXCJodHRwOi8vbGRmLmZpL2ZpYnJhL3NwYXJxbD9ncmFwaD1cIiArIGN1cnJlbnRDb25maWc7IC8vICsgXCImZm9yY2UtYWNjZXB0PWFwcGxpY2F0aW9uL3JkZit4bWxcIlxuICAgICAgICB2YXIgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICByZXF1ZXN0Lm9wZW4oXCJHRVRcIiwgZG93bmxvYWRsaW5rLCB0cnVlKTtcbiAgICAgICAgcmVxdWVzdC5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgaWYgKHJlcXVlc3QucmVhZHlTdGF0ZSA9PT0gNCkge1xuICAgICAgICAgICAgICAgIGlmIChyZXF1ZXN0LnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0gcmVxdWVzdC5yZXNwb25zZVRleHQ7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkb3dubG9hZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xuICAgICAgICAgICAgICAgICAgICBkb3dubG9hZC5ocmVmID0gXCJkYXRhOmFwcGxpY2F0aW9uL3JkZit4bWw7Y2hhcnNldD11dGYtOCxcIiArIGRhdGE7XG4gICAgICAgICAgICAgICAgICAgIGRvd25sb2FkLmRvd25sb2FkID0gXCJmaWJyYS50dGxcIjtcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChkb3dubG9hZCk7XG4gICAgICAgICAgICAgICAgICAgIGRvd25sb2FkLmNsaWNrKCk7XG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZG93bmxvYWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihyZXF1ZXN0LnN0YXR1c1RleHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmVxdWVzdC5zZW5kKG51bGwpO1xuICAgIH07XG4gICAgQ29uc3RydWN0Vmlld0NvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLiRvbkRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudW5zdWJzY3JpYmUoKTtcbiAgICB9O1xuICAgIENvbnN0cnVjdFZpZXdDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5tYXBUeXBlc1RvVGhpcyA9IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZXM6IHN0YXRlLnR5cGVzXG4gICAgICAgIH07XG4gICAgfTtcbiAgICBDb25zdHJ1Y3RWaWV3Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUubWFwSXRlbXNUb1RoaXMgPSBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGl0ZW1zOiBzdGF0ZS5pdGVtc1xuICAgICAgICB9O1xuICAgIH07XG4gICAgQ29uc3RydWN0Vmlld0NvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLnRyYXZlcnNlQ2xhc3NUcmVlID0gZnVuY3Rpb24gKG5vZGVzLCB0ZXN0LCBvblN1Y2Nlc3MpIHtcbiAgICAgICAgdmFyIHRyYXZlcnNlID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgIGlmICh0ZXN0KG5vZGUpKSB7XG4gICAgICAgICAgICAgICAgb25TdWNjZXNzKG5vZGUpO1xuICAgICAgICAgICAgICAgIG5vZGUuY2hpbGRyZW4uZm9yRWFjaCh0cmF2ZXJzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIG5vZGVzLmZvckVhY2godHJhdmVyc2UpO1xuICAgIH07XG4gICAgcmV0dXJuIENvbnN0cnVjdFZpZXdDb21wb25lbnRDb250cm9sbGVyO1xufSgpKTtcbmV4cG9ydCB7IENvbnN0cnVjdFZpZXdDb21wb25lbnRDb250cm9sbGVyIH07XG52YXIgQ29uc3RydWN0Vmlld0NvbXBvbmVudCA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQ29uc3RydWN0Vmlld0NvbXBvbmVudCgpIHtcbiAgICAgICAgdGhpcy5jb250cm9sbGVyID0gQ29uc3RydWN0Vmlld0NvbXBvbmVudENvbnRyb2xsZXI7IC8vIChuZXcgKC4uLmFyZ3M6IGFueVtdKSA9PiBhbmd1bGFyLklDb250cm9sbGVyKSA9IENvbnN0cnVjdFZpZXdDb21wb25lbnRDb250cm9sbGVyXG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSByZXF1aXJlKCcuL2NvbnN0cnVjdC12aWV3LnB1ZycpKCk7XG4gICAgfVxuICAgIHJldHVybiBDb25zdHJ1Y3RWaWV3Q29tcG9uZW50O1xufSgpKTtcbmV4cG9ydCB7IENvbnN0cnVjdFZpZXdDb21wb25lbnQgfTtcbmFuZ3VsYXIubW9kdWxlKCdmaWJyYS5jb21wb25lbnRzLmNvbnN0cnVjdC12aWV3JywgWydmaWJyYS5zZXJ2aWNlcyddKVxuICAgIC5jb21wb25lbnQoJ2NvbnN0cnVjdFZpZXcnLCBuZXcgQ29uc3RydWN0Vmlld0NvbXBvbmVudCgpKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBhcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9jb25zdHJ1Y3Qtdmlldy1jb21wb25lbnQudHMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),

/***/ "./app/components/construct-view/explore-component.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__services_sparql_item_service__ = __webpack_require__(\"./app/services/sparql-item-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__sunburst__ = __webpack_require__(\"./app/components/construct-view/sunburst.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__property_popover__ = __webpack_require__(\"./app/components/construct-view/property-popover.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_d3__ = __webpack_require__(\"./app/bower_components/d3/d3.js\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_d3___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_d3__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__models_rdf__ = __webpack_require__(\"./app/models/rdf.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_5_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__actions_verify__ = __webpack_require__(\"./app/actions/verify.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__actions_types__ = __webpack_require__(\"./app/actions/types.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__actions_items__ = __webpack_require__(\"./app/actions/items.ts\");\n/* unused harmony export ExploreComponent */\n\n\n\n\n\n\n\n\n\n\n\nvar ExploreComponentController = function () {\n    function ExploreComponentController($element, $compile, $window, $scope, $timeout, sparqlItemService, fibraService, $ngRedux, $q) {\n        var _this = this;\n        this.$element = $element;\n        this.$compile = $compile;\n        this.$window = $window;\n        this.$scope = $scope;\n        this.$timeout = $timeout;\n        this.sparqlItemService = sparqlItemService;\n        this.fibraService = fibraService;\n        this.$ngRedux = $ngRedux;\n        this.$q = $q;\n        this.primaryItems = [];\n        this.secondaryItems = [];\n        this.tertiaryItems = [];\n        this.untypedItems = [];\n        this.removedUntypedItems = [];\n        this.allItems = [];\n        this.radiusInitial = 1;\n        this.radius = 8;\n        this.radiusBounce = 15;\n        this.gridOffset = 50; // Should be even\n        this.chargeForce = __WEBPACK_IMPORTED_MODULE_3_d3__[\"forceCollide\"](this.gridOffset / 1.5);\n        this.chargeForce2 = __WEBPACK_IMPORTED_MODULE_3_d3__[\"forceCollide\"](this.gridOffset / 1.5);\n        this.svgBackgroundColor = '#EEE';\n        this.lastClickX = 0;\n        this.lastClickY = 0;\n        var unsub1 = $ngRedux.connect(this.mapVerifyToThis, __WEBPACK_IMPORTED_MODULE_6__actions_verify__)(this);\n        var unsub2 = $ngRedux.connect(this.mapTypesToThis, __WEBPACK_IMPORTED_MODULE_7__actions_types__)(this);\n        var unsub3 = $ngRedux.connect(this.mapItemsToThis, __WEBPACK_IMPORTED_MODULE_8__actions_items__)(this);\n        this.unsubscribe = function () {\n            unsub1();\n            unsub2();\n            unsub3();\n        };\n        this.sunburst = new __WEBPACK_IMPORTED_MODULE_1__sunburst__[\"a\" /* Sunburst */]($element, $compile, $scope, sparqlItemService, fibraService);\n        this.propertyPopover = new __WEBPACK_IMPORTED_MODULE_2__property_popover__[\"a\" /* PropertyPopover */]($element, $scope, fibraService, $compile);\n        this.fibraService.on('change', function () {\n            // this.verifyItem = this.fibraService.getState().construct.verifyItem\n            return _this.queryAndBuild();\n        });\n        this.itemService = sparqlItemService;\n        this.links = [];\n        this.$scope.layout = {\n            'choice': 'force',\n            'links': 'hide'\n        };\n        this.$scope.$watch('layout.choice', this.updateExplore.bind(this, false));\n        this.$scope.$watch('layout.links', this.updateExplore.bind(this, false));\n    }\n    ExploreComponentController.prototype.$onChanges = function (chngsObj) {\n        if (this.svgSel) {\n            this.updateExplore(false, false);\n        }\n    };\n    ExploreComponentController.prototype.$postLink = function () {\n        var _this = this;\n        this.svgSel = __WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"](this.$element[0]).select('svg');\n        this.svgSel.append('rect').classed('background', true).style('fill', this.svgBackgroundColor).on('click', function () {\n            _this.lastClickX = __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].offsetX;\n            _this.lastClickY = __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].offsetY;\n            _this.fibraService.dispatchAction(_this.createDisplayItem());\n        });\n        // Create link g\n        this.svgSel.append('g').attr('class', 'links');\n        this.sunburst.addSunburstGroup(this.svgSel);\n        this.radius = 8;\n        this.tooltip = __WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"]('body').append('div').style('position', 'absolute').style('z-index', '20').style('background-color', 'gray').style('color', 'white').style('padding', '3px').style('border-radius', '2px').style('visibility', 'hidden');\n        this.edittip = __WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"]('body').append('div').attr('id', 'edittip').style('position', 'absolute').style('z-index', '40').style('background-color', 'white').style('color', 'gray').style('border', '1px solid gray').style('padding', '3px').style('border-radius', '2px').style('visibility', 'hidden');\n        this.updateSizing();\n        this.queryAndBuild();\n    };\n    // currently broken on deleting a link\n    ExploreComponentController.prototype.highlightLinks = function (d, i) {\n        __WEBPACK_IMPORTED_MODULE_3_d3__[\"selectAll\"]('line').classed('relevant', false);\n        for (var j = 0; j < this.links.length; j++) {\n            var linksource = this.links[j].source;\n            var linktarget = this.links[j].target;\n            if (linksource.index === i || linktarget.index === i) __WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"]('#link-' + j).classed('relevant', true);\n        }\n    };\n    ExploreComponentController.prototype.$onDestroy = function () {\n        this.unsubscribe();\n    };\n    ExploreComponentController.prototype.queryAndBuild = function () {\n        var _this = this;\n        var prom = this.sparqlItemService.getItems(this.fibraService.getState().construct.items, false).then(function (items) {\n            // If we are showing property popovers, hide 'em.\n            _this.propertyPopover.hidePopover();\n            // Lock previous items\n            _this.lockExisting(_this.primaryItems);\n            _this.lockExisting(_this.secondaryItems);\n            _this.lockExisting(_this.tertiaryItems);\n            var displayTypes = _this.types.displayTypes;\n            var currentUntyped = _this.filterItemsByType(items, __WEBPACK_IMPORTED_MODULE_4__models_rdf__[\"d\" /* OWL */].Thing.value);\n            _this.removedUntypedItems = _this.untypedItems.filter(function (it) {\n                return currentUntyped.indexOf(it) === -1;\n            });\n            _this.untypedItems = _this.mergeNodes(_this.untypedItems, _this.filterItemsByType(items, __WEBPACK_IMPORTED_MODULE_4__models_rdf__[\"d\" /* OWL */].Thing.value));\n            if (displayTypes[0]) _this.primaryItems = _this.mergeNodes(_this.primaryItems, _this.filterItemsByType(items, displayTypes[0].id));\n            if (displayTypes[1]) _this.secondaryItems = _this.mergeNodes(_this.secondaryItems, _this.filterItemsByType(items, displayTypes[1].id));\n            if (displayTypes[2]) _this.tertiaryItems = _this.mergeNodes(_this.tertiaryItems, _this.filterItemsByType(items, displayTypes[2].id));\n            _this.allItems = _this.primaryItems.concat(_this.secondaryItems).concat(_this.tertiaryItems).concat(_this.untypedItems);\n            _this.properties = [];\n            if (_this.primaryItems[0] && _this.primaryItems[0].localProperties) {\n                for (var _i = 0, _a = _this.primaryItems[0].localProperties; _i < _a.length; _i++) {\n                    var p = _a[_i];\n                    _this.properties.push({ key: p.toCanonical(), value: p.label });\n                }\n            }\n            _this.links = _this.mergeLinks(_this.links);\n            return 'ok';\n        }).then(function () {\n            return _this.updateExplore();\n        });\n        this.fibraService.dispatchAction(this.fibraService.placeHolderAction(prom));\n        return prom;\n    };\n    ExploreComponentController.prototype.lockExisting = function (nodes) {\n        nodes.forEach(function (node) {\n            node.fx = node.gx;\n            node.fy = node.gy;\n        });\n    };\n    ExploreComponentController.prototype.filterItemsByType = function (items, type) {\n        return items.filter(function (it) {\n            var typeProp = it.localProperties.concat(it.remoteProperties).filter(function (pr) {\n                return pr.value === 'http://www.w3.org/1999/02/22-rdf-syntax-ns#type';\n            });\n            if (typeProp[0]) {\n                return typeProp[0].values.map(function (v) {\n                    return v.value.value;\n                }).indexOf(type) !== -1;\n            } else {\n                return false;\n            }\n        });\n    };\n    ExploreComponentController.prototype.updateSizing = function () {\n        // allow item_info_tip to expand somehow\n        // add delete and alter ability to sparql-item.pug\n        // fix how links sit on top of nodes\n        var viewport_width = window.innerWidth;\n        var viewport_height = window.innerHeight;\n        this.exploreWidth = viewport_width;\n        this.exploreHeight = viewport_height - 36;\n        __WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"](this.$element[0]).select('#explorecontainer').style('height', this.exploreHeight + 'px');\n        // move table down so top is at bottom of viewport\n        __WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"](this.$element[0]).select('#exploretable').style('height', viewport_height - 50 + 'px');\n        this.svgSel.style('width', viewport_width + 'px').style('height', viewport_height - 36 + 'px');\n        this.svgSel.select('rect.background').style('width', viewport_width + 'px').style('height', viewport_height - 36 + 'px');\n        var svg_width = +this.svgSel.style('width').replace('px', '');\n        var svg_height = +this.svgSel.style('height').replace('px', '');\n    };\n    ExploreComponentController.prototype.appendNodes = function (enterSelection, className) {\n        var _this = this;\n        var appendSelection = enterSelection.append('g').attr('id', function (d, i) {\n            return 'node-' + i + '-' + className;\n        }).attr('class', 'node').classed(className, true).append('circle').classed('node-circle', true).classed(className, true).attr('id', function (d, i) {\n            return 'node-circle-' + i + '-' + className;\n        }).attr('r', this.radiusInitial + 'px').call(__WEBPACK_IMPORTED_MODULE_3_d3__[\"drag\"]().on('start', function (d, i) {\n            if (!_this.linkMode) {\n                d.fx = d.x;\n                d.fy = d.y;\n            } else {\n                _this.dragline = _this.svgSel.append('line').attr('class', 'dragLine');\n            }\n        }).on('drag', function (d, i, group) {\n            if (!_this.linkMode) {\n                __WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"](group[i]).classed('fixed', true);\n                d.x = __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].x;\n                d.y = __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].y;\n            } else {\n                _this.dragline.attr('x1', d.x).attr('y1', d.y).attr('x2', __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].x).attr('y2', __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].y);\n            }\n            _this.updateExplore(false, false);\n        }).on('end', function (d, i, group) {\n            if (!_this.linkMode) {\n                if (!__WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"](group[i]).classed('fixed')) {\n                    d.fx = undefined;\n                    d.fy = undefined;\n                }\n            } else {\n                var lineX_1 = +_this.dragline.attr('x2');\n                var lineY_1 = +_this.dragline.attr('y2');\n                var nodeDrop_1 = false;\n                __WEBPACK_IMPORTED_MODULE_3_d3__[\"selectAll\"]('.node').each(function (f, j) {\n                    if (Math.abs(lineX_1 - f.x) < _this.radius && Math.abs(lineY_1 - f.y) < _this.radius) {\n                        nodeDrop_1 = true;\n                        _this.fibraService.dispatchAction(_this.itemProperty(f, [new __WEBPACK_IMPORTED_MODULE_0__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_4__models_rdf__[\"a\" /* SKOS */].related, __WEBPACK_IMPORTED_MODULE_4__models_rdf__[\"b\" /* DataFactory */].instance.nodeFromNode(d))], [])).then(function (state) {\n                            _this.dragline.remove();\n                            _this.queryAndBuild();\n                            return state;\n                        });\n                    }\n                });\n                if (!nodeDrop_1) {\n                    _this.dragline.remove();\n                }\n            }\n        })).on('mouseover', function (d, i) {\n            _this.highlightLinks(d, i);\n            _this.tooltip.style('top', __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].pageY - 10 + 'px').style('left', __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].pageX + 10 + 'px').style('visibility', 'visible').text(d.label);\n        }).on('mouseout', function (d, i) {\n            _this.svgSel.selectAll('line').classed('relevant', false);\n            _this.tooltip.style('visibility', 'hidden');\n        }).on('click', function (d, i, group) {\n            var localSelected = d.selected;\n            // Unselect everything\n            _this.svgSel.selectAll('.node').each(function (n) {\n                n.selected = false;\n            });\n            // Flip this one\n            d.selected = !localSelected;\n            _this.updateExplore(false);\n            if (d.selected) {\n                _this.svgSel.select('g.sunburst-overlay').datum(d).each(_this.sunburst.buildSunburst.bind(_this)).style('display', 'block');\n            } else {\n                _this.svgSel.select('.sunburst-overlay').style('display', 'none');\n            }\n            _this.highlightLinks(d, i);\n        });\n        appendSelection.transition().attr('r', this.radius + this.radiusBounce + 'px').transition().attr('r', this.radius + 'px');\n        return appendSelection;\n    };\n    ExploreComponentController.prototype.snapToGrid = function (x, y, primary) {\n        if (primary === void 0) {\n            primary = true;\n        }\n        var sx, sy;\n        // Snap to gridOffset with further offset for multiples\n        if (primary) {\n            sx = Math.round(x / this.gridOffset) * this.gridOffset;\n            sy = Math.round(y / this.gridOffset) * this.gridOffset;\n        } else {\n            sx = Math.round(x / this.gridOffset) * this.gridOffset - this.gridOffset / 2;\n            sy = Math.round(y / this.gridOffset) * this.gridOffset - this.gridOffset / 2;\n        }\n        return [sx, sy];\n    };\n    ExploreComponentController.prototype.tickTransformNodes = function (sel, primary) {\n        var _this = this;\n        if (primary === void 0) {\n            primary = true;\n        }\n        sel.attr('transform', function (d, i) {\n            var x = d.x,\n                y = d.y;\n            if (d.x < _this.radius) x = _this.radius;\n            if (d.y < _this.radius) y = _this.radius;\n            var _a = [x, y],\n                gx = _a[0],\n                gy = _a[1];\n            if (_this.$scope.layout.choice === 'forcegrid') {\n                _b = _this.snapToGrid(x, y, primary), gx = _b[0], gy = _b[1];\n            }\n            d.gx = gx;\n            d.gy = gy;\n            return 'translate(' + gx + ', ' + gy + ')';\n            var _b;\n        });\n        if (sel.filter(function (d) {\n            return d.selected;\n        }).node()) {\n            var sbFunc_1 = this.sunburst.buildSunburst;\n            var svgSel_1 = this.svgSel;\n            var tickSunburst = function (d, i, g) {\n                svgSel_1.select('g.sunburst-overlay').datum(d).each(sbFunc_1.bind(this));\n            };\n            sel.filter(function (d) {\n                return d.selected;\n            }).each(tickSunburst.bind(this));\n        }\n    };\n    ExploreComponentController.prototype.genericTick = function (primaryNodes, secondaryNodes, untypedNodes, linkLines, transition) {\n        if (transition === void 0) {\n            transition = false;\n        }\n        var lPrimaryNodes = primaryNodes;\n        var lSecondaryNodes = secondaryNodes;\n        var lUntypedNodes = untypedNodes;\n        var lLinkLines = linkLines;\n        if (transition) {\n            lPrimaryNodes = lPrimaryNodes.transition();\n            lSecondaryNodes = lSecondaryNodes.transition();\n            lUntypedNodes = lUntypedNodes.transition();\n            lLinkLines = lLinkLines.transition();\n        }\n        this.tickTransformNodes(lPrimaryNodes, true);\n        this.tickTransformNodes(lSecondaryNodes, false);\n        this.tickTransformNodes(lUntypedNodes, false);\n        this.svgSel.selectAll('.node-circle').classed('selected-circle', function (d) {\n            return d.selected;\n        }).style('cursor', this.linkMode ? 'crosshair' : 'initial');\n        this.svgSel.selectAll('.node-circle').classed('labeled', function (d) {\n            return d.label ? true : false;\n        }).classed('verified', function (d) {\n            return d.localProperties.filter(function (p) {\n                return p.value === 'http://www.w3.org/2002/07/owl#sameAs';\n            }).length > 0;\n        });\n        lLinkLines.attr('x1', function (d) {\n            return d.source.gx;\n        }).attr('y1', function (d) {\n            return d.source.gy;\n        }).attr('x2', function (d) {\n            return d.target.gx;\n        }).attr('y2', function (d) {\n            return d.target.gy;\n        });\n    };\n    ExploreComponentController.prototype.updateExplore = function (runSim, transition) {\n        var _this = this;\n        if (runSim === void 0) {\n            runSim = true;\n        }\n        if (transition === void 0) {\n            transition = false;\n        }\n        var untypedNodes = this.svgSel.selectAll('circle.untyped').data(this.untypedItems, function (d) {\n            return d.value;\n        });\n        var primaryNodes = this.svgSel.selectAll('circle.primary').data(this.primaryItems, function (d) {\n            return d.value;\n        });\n        var secondaryNodes = this.svgSel.selectAll('circle.secondary').data(this.secondaryItems, function (d) {\n            return d.value;\n        });\n        primaryNodes.exit().remove();\n        secondaryNodes.exit().remove();\n        untypedNodes.exit().remove();\n        // Untyped nodes should come in one at a time based on a user's click event. For these\n        // we also want append the user interface for setting type and label.\n        untypedNodes.enter().each(function (datum, i, g) {\n            datum.x = _this.lastClickX;\n            datum.y = _this.lastClickY;\n            datum.fx = _this.lastClickX;\n            datum.fy = _this.lastClickY;\n            datum.gx = _this.lastClickX;\n            datum.gy = _this.lastClickY;\n        }).each(this.propertyPopover.addPopover.bind(this, this.$scope, this.svgSel));\n        // If a node went from being untyped to being primary or secondary, bring along its position\n        // Also handle position getting set from a drop (pull position from state)\n        var applyOldPosition = function (datum) {\n            // Get position from state if it was set there.\n            datum.x = _this.fibraService.getState().construct.itemIndex[datum.value].x;\n            datum.y = _this.fibraService.getState().construct.itemIndex[datum.value].y;\n            datum.fx = _this.fibraService.getState().construct.itemIndex[datum.value].x;\n            datum.fy = _this.fibraService.getState().construct.itemIndex[datum.value].y;\n            datum.gx = _this.fibraService.getState().construct.itemIndex[datum.value].x;\n            datum.gx = _this.fibraService.getState().construct.itemIndex[datum.value].y;\n            // Or if node was already here, get position from old node\n            var oldNode = _this.removedUntypedItems.filter(function (it) {\n                return it.value === datum.value;\n            })[0];\n            if (oldNode) {\n                datum.x = oldNode.x;\n                datum.y = oldNode.y;\n                datum.fx = oldNode.fx;\n                datum.fy = oldNode.fy;\n                datum.gx = oldNode.gx;\n                datum.gy = oldNode.gy;\n            }\n        };\n        primaryNodes.enter().each(applyOldPosition);\n        secondaryNodes.enter().each(applyOldPosition);\n        primaryNodes = primaryNodes.merge(this.appendNodes(primaryNodes.enter(), 'primary'));\n        secondaryNodes = secondaryNodes.merge(this.appendNodes(secondaryNodes.enter(), 'secondary'));\n        untypedNodes = untypedNodes.merge(this.appendNodes(untypedNodes.enter(), 'untyped'));\n        var linkLines = this.svgSel.select('g.links').selectAll('line').data(this.links);\n        linkLines.exit().remove();\n        linkLines = linkLines.enter().append('line').attr('id', function (d, i) {\n            return 'link-' + i;\n        }).on('mouseover', function (d, i) {\n            _this.tooltip.style('top', __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].pageY - 10 + 'px').style('left', __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].pageX + 10 + 'px').style('visibility', 'visible').text(d.property.label);\n        }).on('mouseout', function (d, i) {\n            _this.tooltip.style('visibility', 'hidden');\n        }).merge(linkLines).style('visibility', this.$scope.layout.links === 'show' ? 'visible' : 'hidden');\n        // Add sunburst again so it stays on top\n        this.sunburst.addSunburstGroup(this.svgSel);\n        this.genericTick(primaryNodes, secondaryNodes, untypedNodes, linkLines, transition);\n        return this.$q.resolve('ok');\n    };\n    ExploreComponentController.prototype.mapVerifyToThis = function (state) {\n        return {\n            verify: state.verify\n        };\n    };\n    ExploreComponentController.prototype.mapTypesToThis = function (state) {\n        return {\n            types: state.types\n        };\n    };\n    ExploreComponentController.prototype.mapItemsToThis = function (state) {\n        return {\n            items: state.items\n        };\n    };\n    ExploreComponentController.prototype.mergeNodes = function (oldNodes, nodes) {\n        var newNodes = [];\n        // Check if old nodes are still in the mix\n        for (var i = 0; i < oldNodes.length; i++) {\n            for (var j = 0; j < nodes.length; j++) {\n                if (oldNodes[i].toCanonical() === nodes[j].toCanonical()) {\n                    newNodes.push(oldNodes[i]);\n                    // We need to grab new node information like labels and props in case it's changed\n                    oldNodes[i].label = nodes[j].label;\n                    oldNodes[i].localProperties = nodes[j].localProperties;\n                }\n            }\n        }\n        // Add the new nodes\n        for (var i = 0; i < nodes.length; i++) {\n            var check = false;\n            for (var j = 0; j < newNodes.length; j++) {\n                if (newNodes[j].toCanonical() === nodes[i].toCanonical()) check = true;\n            }\n            if (!check) {\n                newNodes.push(nodes[i]);\n            }\n        }\n        return newNodes;\n    };\n    ExploreComponentController.prototype.mergeLinks = function (oldLinks) {\n        var newLinks = [];\n        var items = this.primaryItems.concat(this.secondaryItems);\n        var sameAs = new __WEBPACK_IMPORTED_MODULE_4__models_rdf__[\"e\" /* ENodeMap */]();\n        for (var _i = 0, items_1 = items; _i < items_1.length; _i++) {\n            var item = items_1[_i];\n            sameAs.set(item, item);\n            var sameAsProp = item.localProperties.filter(function (p) {\n                return __WEBPACK_IMPORTED_MODULE_4__models_rdf__[\"d\" /* OWL */].sameAs.equals(p);\n            })[0];\n            if (sameAsProp && sameAsProp.values) for (var _a = 0, _b = sameAsProp.values; _a < _b.length; _a++) {\n                var n = _b[_a];\n                sameAs.set(n.value, item);\n            }\n        }\n        // Iterate over item property values to see if they match the id of any\n        // of the items displayed. Also check if they match sameAs values...\n        for (var _c = 0, items_2 = items; _c < items_2.length; _c++) {\n            var item = items_2[_c];\n            for (var _d = 0, _e = item.localProperties; _d < _e.length; _d++) {\n                var p = _e[_d];\n                for (var _f = 0, _g = p.values; _f < _g.length; _f++) {\n                    var v = _g[_f];\n                    if (sameAs.has(v.value) && item !== sameAs.get(v.value) && items.indexOf(sameAs.get(v.value)) !== -1) {\n                        newLinks.push({\n                            source: item,\n                            target: sameAs.get(v.value),\n                            property: p\n                        });\n                    }\n                }\n            }\n        }\n        return newLinks;\n    };\n    return ExploreComponentController;\n}();\nvar ExploreComponent = function () {\n    function ExploreComponent() {\n        this.bindings = {\n            linkMode: '<'\n        };\n        this.controller = ExploreComponentController; // (new (...args: any[]) => angular.IController) = ExploreComponentController\n        this.template = __webpack_require__(\"./app/components/construct-view/explore.pug\")();\n    }\n    return ExploreComponent;\n}();\n\n__WEBPACK_IMPORTED_MODULE_5_angular__[\"module\"]('fibra.components.explore', ['fibra.services']).component('explore', new ExploreComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9leHBsb3JlLWNvbXBvbmVudC50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9leHBsb3JlLWNvbXBvbmVudC50cz85OTJjIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmltcG9ydCB7IFByb3BlcnR5QW5kVmFsdWUgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9zcGFycWwtaXRlbS1zZXJ2aWNlJztcbmltcG9ydCB7IFN1bmJ1cnN0IH0gZnJvbSAnLi9zdW5idXJzdCc7XG5pbXBvcnQgeyBQcm9wZXJ0eVBvcG92ZXIgfSBmcm9tICcuL3Byb3BlcnR5LXBvcG92ZXInO1xuaW1wb3J0ICogYXMgZDMgZnJvbSAnZDMnO1xuaW1wb3J0IHsgT1dMLCBTS09TLCBEYXRhRmFjdG9yeSwgRU5vZGVNYXAgfSBmcm9tICcuLi8uLi9tb2RlbHMvcmRmJztcbmltcG9ydCAqIGFzIGFuZ3VsYXIgZnJvbSAnYW5ndWxhcic7XG5pbXBvcnQgKiBhcyBWZXJpZnlBY3Rpb25zIGZyb20gJy4uLy4uL2FjdGlvbnMvdmVyaWZ5JztcbmltcG9ydCAqIGFzIFR5cGVBY3Rpb25zIGZyb20gJy4uLy4uL2FjdGlvbnMvdHlwZXMnO1xuaW1wb3J0ICogYXMgSXRlbUFjdGlvbnMgZnJvbSAnLi4vLi4vYWN0aW9ucy9pdGVtcyc7XG52YXIgRXhwbG9yZUNvbXBvbmVudENvbnRyb2xsZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyKCRlbGVtZW50LCAkY29tcGlsZSwgJHdpbmRvdywgJHNjb3BlLCAkdGltZW91dCwgc3BhcnFsSXRlbVNlcnZpY2UsIGZpYnJhU2VydmljZSwgJG5nUmVkdXgsICRxKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuJGVsZW1lbnQgPSAkZWxlbWVudDtcbiAgICAgICAgdGhpcy4kY29tcGlsZSA9ICRjb21waWxlO1xuICAgICAgICB0aGlzLiR3aW5kb3cgPSAkd2luZG93O1xuICAgICAgICB0aGlzLiRzY29wZSA9ICRzY29wZTtcbiAgICAgICAgdGhpcy4kdGltZW91dCA9ICR0aW1lb3V0O1xuICAgICAgICB0aGlzLnNwYXJxbEl0ZW1TZXJ2aWNlID0gc3BhcnFsSXRlbVNlcnZpY2U7XG4gICAgICAgIHRoaXMuZmlicmFTZXJ2aWNlID0gZmlicmFTZXJ2aWNlO1xuICAgICAgICB0aGlzLiRuZ1JlZHV4ID0gJG5nUmVkdXg7XG4gICAgICAgIHRoaXMuJHEgPSAkcTtcbiAgICAgICAgdGhpcy5wcmltYXJ5SXRlbXMgPSBbXTtcbiAgICAgICAgdGhpcy5zZWNvbmRhcnlJdGVtcyA9IFtdO1xuICAgICAgICB0aGlzLnRlcnRpYXJ5SXRlbXMgPSBbXTtcbiAgICAgICAgdGhpcy51bnR5cGVkSXRlbXMgPSBbXTtcbiAgICAgICAgdGhpcy5yZW1vdmVkVW50eXBlZEl0ZW1zID0gW107XG4gICAgICAgIHRoaXMuYWxsSXRlbXMgPSBbXTtcbiAgICAgICAgdGhpcy5yYWRpdXNJbml0aWFsID0gMTtcbiAgICAgICAgdGhpcy5yYWRpdXMgPSA4O1xuICAgICAgICB0aGlzLnJhZGl1c0JvdW5jZSA9IDE1O1xuICAgICAgICB0aGlzLmdyaWRPZmZzZXQgPSA1MDsgLy8gU2hvdWxkIGJlIGV2ZW5cbiAgICAgICAgdGhpcy5jaGFyZ2VGb3JjZSA9IGQzLmZvcmNlQ29sbGlkZSh0aGlzLmdyaWRPZmZzZXQgLyAxLjUpO1xuICAgICAgICB0aGlzLmNoYXJnZUZvcmNlMiA9IGQzLmZvcmNlQ29sbGlkZSh0aGlzLmdyaWRPZmZzZXQgLyAxLjUpO1xuICAgICAgICB0aGlzLnN2Z0JhY2tncm91bmRDb2xvciA9ICcjRUVFJztcbiAgICAgICAgdGhpcy5sYXN0Q2xpY2tYID0gMDtcbiAgICAgICAgdGhpcy5sYXN0Q2xpY2tZID0gMDtcbiAgICAgICAgdmFyIHVuc3ViMSA9ICRuZ1JlZHV4LmNvbm5lY3QodGhpcy5tYXBWZXJpZnlUb1RoaXMsIFZlcmlmeUFjdGlvbnMpKHRoaXMpO1xuICAgICAgICB2YXIgdW5zdWIyID0gJG5nUmVkdXguY29ubmVjdCh0aGlzLm1hcFR5cGVzVG9UaGlzLCBUeXBlQWN0aW9ucykodGhpcyk7XG4gICAgICAgIHZhciB1bnN1YjMgPSAkbmdSZWR1eC5jb25uZWN0KHRoaXMubWFwSXRlbXNUb1RoaXMsIEl0ZW1BY3Rpb25zKSh0aGlzKTtcbiAgICAgICAgdGhpcy51bnN1YnNjcmliZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHVuc3ViMSgpO1xuICAgICAgICAgICAgdW5zdWIyKCk7XG4gICAgICAgICAgICB1bnN1YjMoKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zdW5idXJzdCA9IG5ldyBTdW5idXJzdCgkZWxlbWVudCwgJGNvbXBpbGUsICRzY29wZSwgc3BhcnFsSXRlbVNlcnZpY2UsIGZpYnJhU2VydmljZSk7XG4gICAgICAgIHRoaXMucHJvcGVydHlQb3BvdmVyID0gbmV3IFByb3BlcnR5UG9wb3ZlcigkZWxlbWVudCwgJHNjb3BlLCBmaWJyYVNlcnZpY2UsICRjb21waWxlKTtcbiAgICAgICAgdGhpcy5maWJyYVNlcnZpY2Uub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIHRoaXMudmVyaWZ5SXRlbSA9IHRoaXMuZmlicmFTZXJ2aWNlLmdldFN0YXRlKCkuY29uc3RydWN0LnZlcmlmeUl0ZW1cbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5xdWVyeUFuZEJ1aWxkKCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLml0ZW1TZXJ2aWNlID0gc3BhcnFsSXRlbVNlcnZpY2U7XG4gICAgICAgIHRoaXMubGlua3MgPSBbXTtcbiAgICAgICAgdGhpcy4kc2NvcGUubGF5b3V0ID0ge1xuICAgICAgICAgICAgJ2Nob2ljZSc6ICdmb3JjZScsXG4gICAgICAgICAgICAnbGlua3MnOiAnaGlkZSdcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy4kc2NvcGUuJHdhdGNoKCdsYXlvdXQuY2hvaWNlJywgdGhpcy51cGRhdGVFeHBsb3JlLmJpbmQodGhpcywgZmFsc2UpKTtcbiAgICAgICAgdGhpcy4kc2NvcGUuJHdhdGNoKCdsYXlvdXQubGlua3MnLCB0aGlzLnVwZGF0ZUV4cGxvcmUuYmluZCh0aGlzLCBmYWxzZSkpO1xuICAgIH1cbiAgICBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuJG9uQ2hhbmdlcyA9IGZ1bmN0aW9uIChjaG5nc09iaikge1xuICAgICAgICBpZiAodGhpcy5zdmdTZWwpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlRXhwbG9yZShmYWxzZSwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuJHBvc3RMaW5rID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLnN2Z1NlbCA9IGQzLnNlbGVjdCh0aGlzLiRlbGVtZW50WzBdKS5zZWxlY3QoJ3N2ZycpO1xuICAgICAgICB0aGlzLnN2Z1NlbC5hcHBlbmQoJ3JlY3QnKVxuICAgICAgICAgICAgLmNsYXNzZWQoJ2JhY2tncm91bmQnLCB0cnVlKVxuICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgdGhpcy5zdmdCYWNrZ3JvdW5kQ29sb3IpXG4gICAgICAgICAgICAub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX3RoaXMubGFzdENsaWNrWCA9IGQzLmV2ZW50Lm9mZnNldFg7XG4gICAgICAgICAgICBfdGhpcy5sYXN0Q2xpY2tZID0gZDMuZXZlbnQub2Zmc2V0WTtcbiAgICAgICAgICAgIF90aGlzLmZpYnJhU2VydmljZS5kaXNwYXRjaEFjdGlvbihfdGhpcy5jcmVhdGVEaXNwbGF5SXRlbSgpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIENyZWF0ZSBsaW5rIGdcbiAgICAgICAgdGhpcy5zdmdTZWwuYXBwZW5kKCdnJykuYXR0cignY2xhc3MnLCAnbGlua3MnKTtcbiAgICAgICAgdGhpcy5zdW5idXJzdC5hZGRTdW5idXJzdEdyb3VwKHRoaXMuc3ZnU2VsKTtcbiAgICAgICAgdGhpcy5yYWRpdXMgPSA4O1xuICAgICAgICB0aGlzLnRvb2x0aXAgPSBkMy5zZWxlY3QoJ2JvZHknKS5hcHBlbmQoJ2RpdicpXG4gICAgICAgICAgICAuc3R5bGUoJ3Bvc2l0aW9uJywgJ2Fic29sdXRlJylcbiAgICAgICAgICAgIC5zdHlsZSgnei1pbmRleCcsICcyMCcpXG4gICAgICAgICAgICAuc3R5bGUoJ2JhY2tncm91bmQtY29sb3InLCAnZ3JheScpXG4gICAgICAgICAgICAuc3R5bGUoJ2NvbG9yJywgJ3doaXRlJylcbiAgICAgICAgICAgIC5zdHlsZSgncGFkZGluZycsICczcHgnKVxuICAgICAgICAgICAgLnN0eWxlKCdib3JkZXItcmFkaXVzJywgJzJweCcpXG4gICAgICAgICAgICAuc3R5bGUoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgICAgIHRoaXMuZWRpdHRpcCA9IGQzLnNlbGVjdCgnYm9keScpLmFwcGVuZCgnZGl2JylcbiAgICAgICAgICAgIC5hdHRyKCdpZCcsICdlZGl0dGlwJylcbiAgICAgICAgICAgIC5zdHlsZSgncG9zaXRpb24nLCAnYWJzb2x1dGUnKVxuICAgICAgICAgICAgLnN0eWxlKCd6LWluZGV4JywgJzQwJylcbiAgICAgICAgICAgIC5zdHlsZSgnYmFja2dyb3VuZC1jb2xvcicsICd3aGl0ZScpXG4gICAgICAgICAgICAuc3R5bGUoJ2NvbG9yJywgJ2dyYXknKVxuICAgICAgICAgICAgLnN0eWxlKCdib3JkZXInLCAnMXB4IHNvbGlkIGdyYXknKVxuICAgICAgICAgICAgLnN0eWxlKCdwYWRkaW5nJywgJzNweCcpXG4gICAgICAgICAgICAuc3R5bGUoJ2JvcmRlci1yYWRpdXMnLCAnMnB4JylcbiAgICAgICAgICAgIC5zdHlsZSgndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICAgICAgdGhpcy51cGRhdGVTaXppbmcoKTtcbiAgICAgICAgdGhpcy5xdWVyeUFuZEJ1aWxkKCk7XG4gICAgfTtcbiAgICAvLyBjdXJyZW50bHkgYnJva2VuIG9uIGRlbGV0aW5nIGEgbGlua1xuICAgIEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5oaWdobGlnaHRMaW5rcyA9IGZ1bmN0aW9uIChkLCBpKSB7XG4gICAgICAgIGQzLnNlbGVjdEFsbCgnbGluZScpLmNsYXNzZWQoJ3JlbGV2YW50JywgZmFsc2UpO1xuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMubGlua3MubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIHZhciBsaW5rc291cmNlID0gdGhpcy5saW5rc1tqXS5zb3VyY2U7XG4gICAgICAgICAgICB2YXIgbGlua3RhcmdldCA9IHRoaXMubGlua3Nbal0udGFyZ2V0O1xuICAgICAgICAgICAgaWYgKGxpbmtzb3VyY2UuaW5kZXggPT09IGkgfHwgbGlua3RhcmdldC5pbmRleCA9PT0gaSlcbiAgICAgICAgICAgICAgICBkMy5zZWxlY3QoJyNsaW5rLScgKyBqKS5jbGFzc2VkKCdyZWxldmFudCcsIHRydWUpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuJG9uRGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy51bnN1YnNjcmliZSgpO1xuICAgIH07XG4gICAgRXhwbG9yZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLnF1ZXJ5QW5kQnVpbGQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBwcm9tID0gdGhpcy5zcGFycWxJdGVtU2VydmljZS5nZXRJdGVtcyh0aGlzLmZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLmNvbnN0cnVjdC5pdGVtcywgZmFsc2UpLnRoZW4oZnVuY3Rpb24gKGl0ZW1zKSB7XG4gICAgICAgICAgICAvLyBJZiB3ZSBhcmUgc2hvd2luZyBwcm9wZXJ0eSBwb3BvdmVycywgaGlkZSAnZW0uXG4gICAgICAgICAgICBfdGhpcy5wcm9wZXJ0eVBvcG92ZXIuaGlkZVBvcG92ZXIoKTtcbiAgICAgICAgICAgIC8vIExvY2sgcHJldmlvdXMgaXRlbXNcbiAgICAgICAgICAgIF90aGlzLmxvY2tFeGlzdGluZyhfdGhpcy5wcmltYXJ5SXRlbXMpO1xuICAgICAgICAgICAgX3RoaXMubG9ja0V4aXN0aW5nKF90aGlzLnNlY29uZGFyeUl0ZW1zKTtcbiAgICAgICAgICAgIF90aGlzLmxvY2tFeGlzdGluZyhfdGhpcy50ZXJ0aWFyeUl0ZW1zKTtcbiAgICAgICAgICAgIHZhciBkaXNwbGF5VHlwZXMgPSBfdGhpcy50eXBlcy5kaXNwbGF5VHlwZXM7XG4gICAgICAgICAgICB2YXIgY3VycmVudFVudHlwZWQgPSBfdGhpcy5maWx0ZXJJdGVtc0J5VHlwZShpdGVtcywgT1dMLlRoaW5nLnZhbHVlKTtcbiAgICAgICAgICAgIF90aGlzLnJlbW92ZWRVbnR5cGVkSXRlbXMgPSBfdGhpcy51bnR5cGVkSXRlbXMuZmlsdGVyKGZ1bmN0aW9uIChpdCkgeyByZXR1cm4gY3VycmVudFVudHlwZWQuaW5kZXhPZihpdCkgPT09IC0xOyB9KTtcbiAgICAgICAgICAgIF90aGlzLnVudHlwZWRJdGVtcyA9IF90aGlzLm1lcmdlTm9kZXMoX3RoaXMudW50eXBlZEl0ZW1zLCBfdGhpcy5maWx0ZXJJdGVtc0J5VHlwZShpdGVtcywgT1dMLlRoaW5nLnZhbHVlKSk7XG4gICAgICAgICAgICBpZiAoZGlzcGxheVR5cGVzWzBdKVxuICAgICAgICAgICAgICAgIF90aGlzLnByaW1hcnlJdGVtcyA9IF90aGlzLm1lcmdlTm9kZXMoX3RoaXMucHJpbWFyeUl0ZW1zLCBfdGhpcy5maWx0ZXJJdGVtc0J5VHlwZShpdGVtcywgZGlzcGxheVR5cGVzWzBdLmlkKSk7XG4gICAgICAgICAgICBpZiAoZGlzcGxheVR5cGVzWzFdKVxuICAgICAgICAgICAgICAgIF90aGlzLnNlY29uZGFyeUl0ZW1zID0gX3RoaXMubWVyZ2VOb2RlcyhfdGhpcy5zZWNvbmRhcnlJdGVtcywgX3RoaXMuZmlsdGVySXRlbXNCeVR5cGUoaXRlbXMsIGRpc3BsYXlUeXBlc1sxXS5pZCkpO1xuICAgICAgICAgICAgaWYgKGRpc3BsYXlUeXBlc1syXSlcbiAgICAgICAgICAgICAgICBfdGhpcy50ZXJ0aWFyeUl0ZW1zID0gX3RoaXMubWVyZ2VOb2RlcyhfdGhpcy50ZXJ0aWFyeUl0ZW1zLCBfdGhpcy5maWx0ZXJJdGVtc0J5VHlwZShpdGVtcywgZGlzcGxheVR5cGVzWzJdLmlkKSk7XG4gICAgICAgICAgICBfdGhpcy5hbGxJdGVtcyA9IF90aGlzLnByaW1hcnlJdGVtcy5jb25jYXQoX3RoaXMuc2Vjb25kYXJ5SXRlbXMpLmNvbmNhdChfdGhpcy50ZXJ0aWFyeUl0ZW1zKS5jb25jYXQoX3RoaXMudW50eXBlZEl0ZW1zKTtcbiAgICAgICAgICAgIF90aGlzLnByb3BlcnRpZXMgPSBbXTtcbiAgICAgICAgICAgIGlmIChfdGhpcy5wcmltYXJ5SXRlbXNbMF0gJiYgX3RoaXMucHJpbWFyeUl0ZW1zWzBdLmxvY2FsUHJvcGVydGllcykge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSBfdGhpcy5wcmltYXJ5SXRlbXNbMF0ubG9jYWxQcm9wZXJ0aWVzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IF9hW19pXTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMucHJvcGVydGllcy5wdXNoKHsga2V5OiBwLnRvQ2Fub25pY2FsKCksIHZhbHVlOiBwLmxhYmVsIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF90aGlzLmxpbmtzID0gX3RoaXMubWVyZ2VMaW5rcyhfdGhpcy5saW5rcyk7XG4gICAgICAgICAgICByZXR1cm4gJ29rJztcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy51cGRhdGVFeHBsb3JlKCk7IH0pO1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZS5kaXNwYXRjaEFjdGlvbih0aGlzLmZpYnJhU2VydmljZS5wbGFjZUhvbGRlckFjdGlvbihwcm9tKSk7XG4gICAgICAgIHJldHVybiBwcm9tO1xuICAgIH07XG4gICAgRXhwbG9yZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmxvY2tFeGlzdGluZyA9IGZ1bmN0aW9uIChub2Rlcykge1xuICAgICAgICBub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICBub2RlLmZ4ID0gbm9kZS5neDtcbiAgICAgICAgICAgIG5vZGUuZnkgPSBub2RlLmd5O1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5maWx0ZXJJdGVtc0J5VHlwZSA9IGZ1bmN0aW9uIChpdGVtcywgdHlwZSkge1xuICAgICAgICByZXR1cm4gaXRlbXMuZmlsdGVyKGZ1bmN0aW9uIChpdCkge1xuICAgICAgICAgICAgdmFyIHR5cGVQcm9wID0gaXQubG9jYWxQcm9wZXJ0aWVzLmNvbmNhdChpdC5yZW1vdGVQcm9wZXJ0aWVzKS5maWx0ZXIoZnVuY3Rpb24gKHByKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByLnZhbHVlID09PSAnaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zI3R5cGUnO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAodHlwZVByb3BbMF0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZVByb3BbMF0udmFsdWVzLm1hcChmdW5jdGlvbiAodikgeyByZXR1cm4gdi52YWx1ZS52YWx1ZTsgfSkuaW5kZXhPZih0eXBlKSAhPT0gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgRXhwbG9yZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLnVwZGF0ZVNpemluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gYWxsb3cgaXRlbV9pbmZvX3RpcCB0byBleHBhbmQgc29tZWhvd1xuICAgICAgICAvLyBhZGQgZGVsZXRlIGFuZCBhbHRlciBhYmlsaXR5IHRvIHNwYXJxbC1pdGVtLnB1Z1xuICAgICAgICAvLyBmaXggaG93IGxpbmtzIHNpdCBvbiB0b3Agb2Ygbm9kZXNcbiAgICAgICAgdmFyIHZpZXdwb3J0X3dpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG4gICAgICAgIHZhciB2aWV3cG9ydF9oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgICAgIHRoaXMuZXhwbG9yZVdpZHRoID0gdmlld3BvcnRfd2lkdGg7XG4gICAgICAgIHRoaXMuZXhwbG9yZUhlaWdodCA9IHZpZXdwb3J0X2hlaWdodCAtIDM2O1xuICAgICAgICBkMy5zZWxlY3QodGhpcy4kZWxlbWVudFswXSkuc2VsZWN0KCcjZXhwbG9yZWNvbnRhaW5lcicpXG4gICAgICAgICAgICAuc3R5bGUoJ2hlaWdodCcsIHRoaXMuZXhwbG9yZUhlaWdodCArICdweCcpO1xuICAgICAgICAvLyBtb3ZlIHRhYmxlIGRvd24gc28gdG9wIGlzIGF0IGJvdHRvbSBvZiB2aWV3cG9ydFxuICAgICAgICBkMy5zZWxlY3QodGhpcy4kZWxlbWVudFswXSkuc2VsZWN0KCcjZXhwbG9yZXRhYmxlJylcbiAgICAgICAgICAgIC5zdHlsZSgnaGVpZ2h0Jywgdmlld3BvcnRfaGVpZ2h0IC0gNTAgKyAncHgnKTtcbiAgICAgICAgdGhpcy5zdmdTZWwuc3R5bGUoJ3dpZHRoJywgdmlld3BvcnRfd2lkdGggKyAncHgnKVxuICAgICAgICAgICAgLnN0eWxlKCdoZWlnaHQnLCB2aWV3cG9ydF9oZWlnaHQgLSAzNiArICdweCcpO1xuICAgICAgICB0aGlzLnN2Z1NlbC5zZWxlY3QoJ3JlY3QuYmFja2dyb3VuZCcpXG4gICAgICAgICAgICAuc3R5bGUoJ3dpZHRoJywgdmlld3BvcnRfd2lkdGggKyAncHgnKVxuICAgICAgICAgICAgLnN0eWxlKCdoZWlnaHQnLCB2aWV3cG9ydF9oZWlnaHQgLSAzNiArICdweCcpO1xuICAgICAgICB2YXIgc3ZnX3dpZHRoID0gK3RoaXMuc3ZnU2VsLnN0eWxlKCd3aWR0aCcpLnJlcGxhY2UoJ3B4JywgJycpO1xuICAgICAgICB2YXIgc3ZnX2hlaWdodCA9ICt0aGlzLnN2Z1NlbC5zdHlsZSgnaGVpZ2h0JykucmVwbGFjZSgncHgnLCAnJyk7XG4gICAgfTtcbiAgICBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuYXBwZW5kTm9kZXMgPSBmdW5jdGlvbiAoZW50ZXJTZWxlY3Rpb24sIGNsYXNzTmFtZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgYXBwZW5kU2VsZWN0aW9uID0gZW50ZXJTZWxlY3Rpb24uYXBwZW5kKCdnJylcbiAgICAgICAgICAgIC5hdHRyKCdpZCcsIGZ1bmN0aW9uIChkLCBpKSB7IHJldHVybiAnbm9kZS0nICsgaSArICctJyArIGNsYXNzTmFtZTsgfSlcbiAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdub2RlJylcbiAgICAgICAgICAgIC5jbGFzc2VkKGNsYXNzTmFtZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5hcHBlbmQoJ2NpcmNsZScpXG4gICAgICAgICAgICAuY2xhc3NlZCgnbm9kZS1jaXJjbGUnLCB0cnVlKVxuICAgICAgICAgICAgLmNsYXNzZWQoY2xhc3NOYW1lLCB0cnVlKVxuICAgICAgICAgICAgLmF0dHIoJ2lkJywgZnVuY3Rpb24gKGQsIGkpIHsgcmV0dXJuICdub2RlLWNpcmNsZS0nICsgaSArICctJyArIGNsYXNzTmFtZTsgfSlcbiAgICAgICAgICAgIC5hdHRyKCdyJywgdGhpcy5yYWRpdXNJbml0aWFsICsgJ3B4JylcbiAgICAgICAgICAgIC5jYWxsKGQzLmRyYWcoKVxuICAgICAgICAgICAgLm9uKCdzdGFydCcsIGZ1bmN0aW9uIChkLCBpKSB7XG4gICAgICAgICAgICBpZiAoIV90aGlzLmxpbmtNb2RlKSB7XG4gICAgICAgICAgICAgICAgZC5meCA9IGQueDtcbiAgICAgICAgICAgICAgICBkLmZ5ID0gZC55O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuZHJhZ2xpbmUgPSBfdGhpcy5zdmdTZWwuYXBwZW5kKCdsaW5lJylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2RyYWdMaW5lJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgICAgICAub24oJ2RyYWcnLCBmdW5jdGlvbiAoZCwgaSwgZ3JvdXApIHtcbiAgICAgICAgICAgIGlmICghX3RoaXMubGlua01vZGUpIHtcbiAgICAgICAgICAgICAgICBkMy5zZWxlY3QoZ3JvdXBbaV0pLmNsYXNzZWQoJ2ZpeGVkJywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgZC54ID0gZDMuZXZlbnQueDtcbiAgICAgICAgICAgICAgICBkLnkgPSBkMy5ldmVudC55O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuZHJhZ2xpbmUuYXR0cigneDEnLCBkLngpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd5MScsIGQueSlcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3gyJywgZDMuZXZlbnQueClcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3kyJywgZDMuZXZlbnQueSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBfdGhpcy51cGRhdGVFeHBsb3JlKGZhbHNlLCBmYWxzZSk7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAub24oJ2VuZCcsIGZ1bmN0aW9uIChkLCBpLCBncm91cCkge1xuICAgICAgICAgICAgaWYgKCFfdGhpcy5saW5rTW9kZSkge1xuICAgICAgICAgICAgICAgIGlmICghZDMuc2VsZWN0KGdyb3VwW2ldKS5jbGFzc2VkKCdmaXhlZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIGQuZnggPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIGQuZnkgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGxpbmVYXzEgPSArX3RoaXMuZHJhZ2xpbmUuYXR0cigneDInKTtcbiAgICAgICAgICAgICAgICB2YXIgbGluZVlfMSA9ICtfdGhpcy5kcmFnbGluZS5hdHRyKCd5MicpO1xuICAgICAgICAgICAgICAgIHZhciBub2RlRHJvcF8xID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgZDMuc2VsZWN0QWxsKCcubm9kZScpXG4gICAgICAgICAgICAgICAgICAgIC5lYWNoKGZ1bmN0aW9uIChmLCBqKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhsaW5lWF8xIC0gZi54KSA8IF90aGlzLnJhZGl1cyAmJiBNYXRoLmFicyhsaW5lWV8xIC0gZi55KSA8IF90aGlzLnJhZGl1cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZURyb3BfMSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5maWJyYVNlcnZpY2UuZGlzcGF0Y2hBY3Rpb24oX3RoaXMuaXRlbVByb3BlcnR5KGYsIFtuZXcgUHJvcGVydHlBbmRWYWx1ZShTS09TLnJlbGF0ZWQsIERhdGFGYWN0b3J5Lmluc3RhbmNlLm5vZGVGcm9tTm9kZShkKSldLCBbXSkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZHJhZ2xpbmUucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMucXVlcnlBbmRCdWlsZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKCFub2RlRHJvcF8xKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmRyYWdsaW5lLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpXG4gICAgICAgICAgICAub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uIChkLCBpKSB7XG4gICAgICAgICAgICBfdGhpcy5oaWdobGlnaHRMaW5rcyhkLCBpKTtcbiAgICAgICAgICAgIF90aGlzLnRvb2x0aXAuc3R5bGUoJ3RvcCcsIChkMy5ldmVudC5wYWdlWSAtIDEwKSArICdweCcpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdsZWZ0JywgKGQzLmV2ZW50LnBhZ2VYICsgMTApICsgJ3B4JylcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpXG4gICAgICAgICAgICAgICAgLnRleHQoZC5sYWJlbCk7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAub24oJ21vdXNlb3V0JywgZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgICAgIF90aGlzLnN2Z1NlbC5zZWxlY3RBbGwoJ2xpbmUnKS5jbGFzc2VkKCdyZWxldmFudCcsIGZhbHNlKTtcbiAgICAgICAgICAgIF90aGlzLnRvb2x0aXAuc3R5bGUoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAub24oJ2NsaWNrJywgZnVuY3Rpb24gKGQsIGksIGdyb3VwKSB7XG4gICAgICAgICAgICB2YXIgbG9jYWxTZWxlY3RlZCA9IGQuc2VsZWN0ZWQ7XG4gICAgICAgICAgICAvLyBVbnNlbGVjdCBldmVyeXRoaW5nXG4gICAgICAgICAgICBfdGhpcy5zdmdTZWwuc2VsZWN0QWxsKCcubm9kZScpXG4gICAgICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24gKG4pIHsgbi5zZWxlY3RlZCA9IGZhbHNlOyB9KTtcbiAgICAgICAgICAgIC8vIEZsaXAgdGhpcyBvbmVcbiAgICAgICAgICAgIGQuc2VsZWN0ZWQgPSAhbG9jYWxTZWxlY3RlZDtcbiAgICAgICAgICAgIF90aGlzLnVwZGF0ZUV4cGxvcmUoZmFsc2UpO1xuICAgICAgICAgICAgaWYgKGQuc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5zdmdTZWwuc2VsZWN0KCdnLnN1bmJ1cnN0LW92ZXJsYXknKVxuICAgICAgICAgICAgICAgICAgICAuZGF0dW0oZClcbiAgICAgICAgICAgICAgICAgICAgLmVhY2goX3RoaXMuc3VuYnVyc3QuYnVpbGRTdW5idXJzdC5iaW5kKF90aGlzKSlcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5zdmdTZWwuc2VsZWN0KCcuc3VuYnVyc3Qtb3ZlcmxheScpLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF90aGlzLmhpZ2hsaWdodExpbmtzKGQsIGkpO1xuICAgICAgICB9KTtcbiAgICAgICAgYXBwZW5kU2VsZWN0aW9uXG4gICAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAuYXR0cigncicsICh0aGlzLnJhZGl1cyArIHRoaXMucmFkaXVzQm91bmNlKSArICdweCcpXG4gICAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAuYXR0cigncicsIHRoaXMucmFkaXVzICsgJ3B4Jyk7XG4gICAgICAgIHJldHVybiBhcHBlbmRTZWxlY3Rpb247XG4gICAgfTtcbiAgICBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuc25hcFRvR3JpZCA9IGZ1bmN0aW9uICh4LCB5LCBwcmltYXJ5KSB7XG4gICAgICAgIGlmIChwcmltYXJ5ID09PSB2b2lkIDApIHsgcHJpbWFyeSA9IHRydWU7IH1cbiAgICAgICAgdmFyIHN4LCBzeTtcbiAgICAgICAgLy8gU25hcCB0byBncmlkT2Zmc2V0IHdpdGggZnVydGhlciBvZmZzZXQgZm9yIG11bHRpcGxlc1xuICAgICAgICBpZiAocHJpbWFyeSkge1xuICAgICAgICAgICAgc3ggPSBNYXRoLnJvdW5kKHggLyB0aGlzLmdyaWRPZmZzZXQpICogdGhpcy5ncmlkT2Zmc2V0O1xuICAgICAgICAgICAgc3kgPSBNYXRoLnJvdW5kKHkgLyB0aGlzLmdyaWRPZmZzZXQpICogdGhpcy5ncmlkT2Zmc2V0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc3ggPSBNYXRoLnJvdW5kKHggLyB0aGlzLmdyaWRPZmZzZXQpICogdGhpcy5ncmlkT2Zmc2V0IC0gdGhpcy5ncmlkT2Zmc2V0IC8gMjtcbiAgICAgICAgICAgIHN5ID0gTWF0aC5yb3VuZCh5IC8gdGhpcy5ncmlkT2Zmc2V0KSAqIHRoaXMuZ3JpZE9mZnNldCAtIHRoaXMuZ3JpZE9mZnNldCAvIDI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtzeCwgc3ldO1xuICAgIH07XG4gICAgRXhwbG9yZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLnRpY2tUcmFuc2Zvcm1Ob2RlcyA9IGZ1bmN0aW9uIChzZWwsIHByaW1hcnkpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgaWYgKHByaW1hcnkgPT09IHZvaWQgMCkgeyBwcmltYXJ5ID0gdHJ1ZTsgfVxuICAgICAgICBzZWwuYXR0cigndHJhbnNmb3JtJywgZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgICAgIHZhciB4ID0gZC54LCB5ID0gZC55O1xuICAgICAgICAgICAgaWYgKGQueCA8IF90aGlzLnJhZGl1cylcbiAgICAgICAgICAgICAgICB4ID0gX3RoaXMucmFkaXVzO1xuICAgICAgICAgICAgaWYgKGQueSA8IF90aGlzLnJhZGl1cylcbiAgICAgICAgICAgICAgICB5ID0gX3RoaXMucmFkaXVzO1xuICAgICAgICAgICAgdmFyIF9hID0gW3gsIHldLCBneCA9IF9hWzBdLCBneSA9IF9hWzFdO1xuICAgICAgICAgICAgaWYgKF90aGlzLiRzY29wZS5sYXlvdXQuY2hvaWNlID09PSAnZm9yY2VncmlkJykge1xuICAgICAgICAgICAgICAgIF9iID0gX3RoaXMuc25hcFRvR3JpZCh4LCB5LCBwcmltYXJ5KSwgZ3ggPSBfYlswXSwgZ3kgPSBfYlsxXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGQuZ3ggPSBneDtcbiAgICAgICAgICAgIGQuZ3kgPSBneTtcbiAgICAgICAgICAgIHJldHVybiAndHJhbnNsYXRlKCcgKyBneCArICcsICcgKyBneSArICcpJztcbiAgICAgICAgICAgIHZhciBfYjtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChzZWwuZmlsdGVyKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnNlbGVjdGVkOyB9KS5ub2RlKCkpIHtcbiAgICAgICAgICAgIHZhciBzYkZ1bmNfMSA9IHRoaXMuc3VuYnVyc3QuYnVpbGRTdW5idXJzdDtcbiAgICAgICAgICAgIHZhciBzdmdTZWxfMSA9IHRoaXMuc3ZnU2VsO1xuICAgICAgICAgICAgdmFyIHRpY2tTdW5idXJzdCA9IGZ1bmN0aW9uIChkLCBpLCBnKSB7XG4gICAgICAgICAgICAgICAgc3ZnU2VsXzEuc2VsZWN0KCdnLnN1bmJ1cnN0LW92ZXJsYXknKS5kYXR1bShkKS5lYWNoKHNiRnVuY18xLmJpbmQodGhpcykpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHNlbC5maWx0ZXIoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuc2VsZWN0ZWQ7IH0pXG4gICAgICAgICAgICAgICAgLmVhY2godGlja1N1bmJ1cnN0LmJpbmQodGhpcykpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuZ2VuZXJpY1RpY2sgPSBmdW5jdGlvbiAocHJpbWFyeU5vZGVzLCBzZWNvbmRhcnlOb2RlcywgdW50eXBlZE5vZGVzLCBsaW5rTGluZXMsIHRyYW5zaXRpb24pIHtcbiAgICAgICAgaWYgKHRyYW5zaXRpb24gPT09IHZvaWQgMCkgeyB0cmFuc2l0aW9uID0gZmFsc2U7IH1cbiAgICAgICAgdmFyIGxQcmltYXJ5Tm9kZXMgPSBwcmltYXJ5Tm9kZXM7XG4gICAgICAgIHZhciBsU2Vjb25kYXJ5Tm9kZXMgPSBzZWNvbmRhcnlOb2RlcztcbiAgICAgICAgdmFyIGxVbnR5cGVkTm9kZXMgPSB1bnR5cGVkTm9kZXM7XG4gICAgICAgIHZhciBsTGlua0xpbmVzID0gbGlua0xpbmVzO1xuICAgICAgICBpZiAodHJhbnNpdGlvbikge1xuICAgICAgICAgICAgbFByaW1hcnlOb2RlcyA9IGxQcmltYXJ5Tm9kZXMudHJhbnNpdGlvbigpO1xuICAgICAgICAgICAgbFNlY29uZGFyeU5vZGVzID0gbFNlY29uZGFyeU5vZGVzLnRyYW5zaXRpb24oKTtcbiAgICAgICAgICAgIGxVbnR5cGVkTm9kZXMgPSBsVW50eXBlZE5vZGVzLnRyYW5zaXRpb24oKTtcbiAgICAgICAgICAgIGxMaW5rTGluZXMgPSBsTGlua0xpbmVzLnRyYW5zaXRpb24oKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRpY2tUcmFuc2Zvcm1Ob2RlcyhsUHJpbWFyeU5vZGVzLCB0cnVlKTtcbiAgICAgICAgdGhpcy50aWNrVHJhbnNmb3JtTm9kZXMobFNlY29uZGFyeU5vZGVzLCBmYWxzZSk7XG4gICAgICAgIHRoaXMudGlja1RyYW5zZm9ybU5vZGVzKGxVbnR5cGVkTm9kZXMsIGZhbHNlKTtcbiAgICAgICAgdGhpcy5zdmdTZWwuc2VsZWN0QWxsKCcubm9kZS1jaXJjbGUnKVxuICAgICAgICAgICAgLmNsYXNzZWQoJ3NlbGVjdGVkLWNpcmNsZScsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnNlbGVjdGVkOyB9KVxuICAgICAgICAgICAgLnN0eWxlKCdjdXJzb3InLCB0aGlzLmxpbmtNb2RlID8gJ2Nyb3NzaGFpcicgOiAnaW5pdGlhbCcpO1xuICAgICAgICB0aGlzLnN2Z1NlbC5zZWxlY3RBbGwoJy5ub2RlLWNpcmNsZScpXG4gICAgICAgICAgICAuY2xhc3NlZCgnbGFiZWxlZCcsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmxhYmVsID8gdHJ1ZSA6IGZhbHNlOyB9KVxuICAgICAgICAgICAgLmNsYXNzZWQoJ3ZlcmlmaWVkJywgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQubG9jYWxQcm9wZXJ0aWVzLmZpbHRlcihmdW5jdGlvbiAocCkgeyByZXR1cm4gcC52YWx1ZSA9PT0gJ2h0dHA6Ly93d3cudzMub3JnLzIwMDIvMDcvb3dsI3NhbWVBcyc7IH0pLmxlbmd0aCA+IDA7IH0pO1xuICAgICAgICBsTGlua0xpbmVzXG4gICAgICAgICAgICAuYXR0cigneDEnLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5zb3VyY2UuZ3g7IH0pXG4gICAgICAgICAgICAuYXR0cigneTEnLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5zb3VyY2UuZ3k7IH0pXG4gICAgICAgICAgICAuYXR0cigneDInLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC50YXJnZXQuZ3g7IH0pXG4gICAgICAgICAgICAuYXR0cigneTInLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC50YXJnZXQuZ3k7IH0pO1xuICAgIH07XG4gICAgRXhwbG9yZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLnVwZGF0ZUV4cGxvcmUgPSBmdW5jdGlvbiAocnVuU2ltLCB0cmFuc2l0aW9uKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmIChydW5TaW0gPT09IHZvaWQgMCkgeyBydW5TaW0gPSB0cnVlOyB9XG4gICAgICAgIGlmICh0cmFuc2l0aW9uID09PSB2b2lkIDApIHsgdHJhbnNpdGlvbiA9IGZhbHNlOyB9XG4gICAgICAgIHZhciB1bnR5cGVkTm9kZXMgPSB0aGlzLnN2Z1NlbFxuICAgICAgICAgICAgLnNlbGVjdEFsbCgnY2lyY2xlLnVudHlwZWQnKVxuICAgICAgICAgICAgLmRhdGEodGhpcy51bnR5cGVkSXRlbXMsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnZhbHVlOyB9KTtcbiAgICAgICAgdmFyIHByaW1hcnlOb2RlcyA9IHRoaXMuc3ZnU2VsXG4gICAgICAgICAgICAuc2VsZWN0QWxsKCdjaXJjbGUucHJpbWFyeScpXG4gICAgICAgICAgICAuZGF0YSh0aGlzLnByaW1hcnlJdGVtcywgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudmFsdWU7IH0pO1xuICAgICAgICB2YXIgc2Vjb25kYXJ5Tm9kZXMgPSB0aGlzLnN2Z1NlbFxuICAgICAgICAgICAgLnNlbGVjdEFsbCgnY2lyY2xlLnNlY29uZGFyeScpXG4gICAgICAgICAgICAuZGF0YSh0aGlzLnNlY29uZGFyeUl0ZW1zLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC52YWx1ZTsgfSk7XG4gICAgICAgIHByaW1hcnlOb2Rlcy5leGl0KCkucmVtb3ZlKCk7XG4gICAgICAgIHNlY29uZGFyeU5vZGVzLmV4aXQoKS5yZW1vdmUoKTtcbiAgICAgICAgdW50eXBlZE5vZGVzLmV4aXQoKS5yZW1vdmUoKTtcbiAgICAgICAgLy8gVW50eXBlZCBub2RlcyBzaG91bGQgY29tZSBpbiBvbmUgYXQgYSB0aW1lIGJhc2VkIG9uIGEgdXNlcidzIGNsaWNrIGV2ZW50LiBGb3IgdGhlc2VcbiAgICAgICAgLy8gd2UgYWxzbyB3YW50IGFwcGVuZCB0aGUgdXNlciBpbnRlcmZhY2UgZm9yIHNldHRpbmcgdHlwZSBhbmQgbGFiZWwuXG4gICAgICAgIHVudHlwZWROb2Rlcy5lbnRlcigpLmVhY2goZnVuY3Rpb24gKGRhdHVtLCBpLCBnKSB7XG4gICAgICAgICAgICBkYXR1bS54ID0gX3RoaXMubGFzdENsaWNrWDtcbiAgICAgICAgICAgIGRhdHVtLnkgPSBfdGhpcy5sYXN0Q2xpY2tZO1xuICAgICAgICAgICAgZGF0dW0uZnggPSBfdGhpcy5sYXN0Q2xpY2tYO1xuICAgICAgICAgICAgZGF0dW0uZnkgPSBfdGhpcy5sYXN0Q2xpY2tZO1xuICAgICAgICAgICAgZGF0dW0uZ3ggPSBfdGhpcy5sYXN0Q2xpY2tYO1xuICAgICAgICAgICAgZGF0dW0uZ3kgPSBfdGhpcy5sYXN0Q2xpY2tZO1xuICAgICAgICB9KS5lYWNoKHRoaXMucHJvcGVydHlQb3BvdmVyLmFkZFBvcG92ZXIuYmluZCh0aGlzLCB0aGlzLiRzY29wZSwgdGhpcy5zdmdTZWwpKTtcbiAgICAgICAgLy8gSWYgYSBub2RlIHdlbnQgZnJvbSBiZWluZyB1bnR5cGVkIHRvIGJlaW5nIHByaW1hcnkgb3Igc2Vjb25kYXJ5LCBicmluZyBhbG9uZyBpdHMgcG9zaXRpb25cbiAgICAgICAgLy8gQWxzbyBoYW5kbGUgcG9zaXRpb24gZ2V0dGluZyBzZXQgZnJvbSBhIGRyb3AgKHB1bGwgcG9zaXRpb24gZnJvbSBzdGF0ZSlcbiAgICAgICAgdmFyIGFwcGx5T2xkUG9zaXRpb24gPSBmdW5jdGlvbiAoZGF0dW0pIHtcbiAgICAgICAgICAgIC8vIEdldCBwb3NpdGlvbiBmcm9tIHN0YXRlIGlmIGl0IHdhcyBzZXQgdGhlcmUuXG4gICAgICAgICAgICBkYXR1bS54ID0gX3RoaXMuZmlicmFTZXJ2aWNlLmdldFN0YXRlKCkuY29uc3RydWN0Lml0ZW1JbmRleFtkYXR1bS52YWx1ZV0ueDtcbiAgICAgICAgICAgIGRhdHVtLnkgPSBfdGhpcy5maWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5jb25zdHJ1Y3QuaXRlbUluZGV4W2RhdHVtLnZhbHVlXS55O1xuICAgICAgICAgICAgZGF0dW0uZnggPSBfdGhpcy5maWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5jb25zdHJ1Y3QuaXRlbUluZGV4W2RhdHVtLnZhbHVlXS54O1xuICAgICAgICAgICAgZGF0dW0uZnkgPSBfdGhpcy5maWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5jb25zdHJ1Y3QuaXRlbUluZGV4W2RhdHVtLnZhbHVlXS55O1xuICAgICAgICAgICAgZGF0dW0uZ3ggPSBfdGhpcy5maWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5jb25zdHJ1Y3QuaXRlbUluZGV4W2RhdHVtLnZhbHVlXS54O1xuICAgICAgICAgICAgZGF0dW0uZ3ggPSBfdGhpcy5maWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5jb25zdHJ1Y3QuaXRlbUluZGV4W2RhdHVtLnZhbHVlXS55O1xuICAgICAgICAgICAgLy8gT3IgaWYgbm9kZSB3YXMgYWxyZWFkeSBoZXJlLCBnZXQgcG9zaXRpb24gZnJvbSBvbGQgbm9kZVxuICAgICAgICAgICAgdmFyIG9sZE5vZGUgPSBfdGhpcy5yZW1vdmVkVW50eXBlZEl0ZW1zLmZpbHRlcihmdW5jdGlvbiAoaXQpIHsgcmV0dXJuIGl0LnZhbHVlID09PSBkYXR1bS52YWx1ZTsgfSlbMF07XG4gICAgICAgICAgICBpZiAob2xkTm9kZSkge1xuICAgICAgICAgICAgICAgIGRhdHVtLnggPSBvbGROb2RlLng7XG4gICAgICAgICAgICAgICAgZGF0dW0ueSA9IG9sZE5vZGUueTtcbiAgICAgICAgICAgICAgICBkYXR1bS5meCA9IG9sZE5vZGUuZng7XG4gICAgICAgICAgICAgICAgZGF0dW0uZnkgPSBvbGROb2RlLmZ5O1xuICAgICAgICAgICAgICAgIGRhdHVtLmd4ID0gb2xkTm9kZS5neDtcbiAgICAgICAgICAgICAgICBkYXR1bS5neSA9IG9sZE5vZGUuZ3k7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHByaW1hcnlOb2Rlcy5lbnRlcigpLmVhY2goYXBwbHlPbGRQb3NpdGlvbik7XG4gICAgICAgIHNlY29uZGFyeU5vZGVzLmVudGVyKCkuZWFjaChhcHBseU9sZFBvc2l0aW9uKTtcbiAgICAgICAgcHJpbWFyeU5vZGVzID0gcHJpbWFyeU5vZGVzLm1lcmdlKHRoaXMuYXBwZW5kTm9kZXMocHJpbWFyeU5vZGVzLmVudGVyKCksICdwcmltYXJ5JykpO1xuICAgICAgICBzZWNvbmRhcnlOb2RlcyA9IHNlY29uZGFyeU5vZGVzLm1lcmdlKHRoaXMuYXBwZW5kTm9kZXMoc2Vjb25kYXJ5Tm9kZXMuZW50ZXIoKSwgJ3NlY29uZGFyeScpKTtcbiAgICAgICAgdW50eXBlZE5vZGVzID0gdW50eXBlZE5vZGVzLm1lcmdlKHRoaXMuYXBwZW5kTm9kZXModW50eXBlZE5vZGVzLmVudGVyKCksICd1bnR5cGVkJykpO1xuICAgICAgICB2YXIgbGlua0xpbmVzID0gdGhpcy5zdmdTZWxcbiAgICAgICAgICAgIC5zZWxlY3QoJ2cubGlua3MnKVxuICAgICAgICAgICAgLnNlbGVjdEFsbCgnbGluZScpXG4gICAgICAgICAgICAuZGF0YSh0aGlzLmxpbmtzKTtcbiAgICAgICAgbGlua0xpbmVzLmV4aXQoKS5yZW1vdmUoKTtcbiAgICAgICAgbGlua0xpbmVzID0gbGlua0xpbmVzXG4gICAgICAgICAgICAuZW50ZXIoKS5hcHBlbmQoJ2xpbmUnKVxuICAgICAgICAgICAgLmF0dHIoJ2lkJywgZnVuY3Rpb24gKGQsIGkpIHsgcmV0dXJuICdsaW5rLScgKyBpOyB9KVxuICAgICAgICAgICAgLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgICAgICAgX3RoaXMudG9vbHRpcC5zdHlsZSgndG9wJywgKGQzLmV2ZW50LnBhZ2VZIC0gMTApICsgJ3B4JylcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2xlZnQnLCAoZDMuZXZlbnQucGFnZVggKyAxMCkgKyAncHgnKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgndmlzaWJpbGl0eScsICd2aXNpYmxlJylcbiAgICAgICAgICAgICAgICAudGV4dChkLnByb3BlcnR5LmxhYmVsKTtcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC5vbignbW91c2VvdXQnLCBmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgICAgICAgX3RoaXMudG9vbHRpcC5zdHlsZSgndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC5tZXJnZShsaW5rTGluZXMpXG4gICAgICAgICAgICAuc3R5bGUoJ3Zpc2liaWxpdHknLCB0aGlzLiRzY29wZS5sYXlvdXQubGlua3MgPT09ICdzaG93JyA/ICd2aXNpYmxlJyA6ICdoaWRkZW4nKTtcbiAgICAgICAgLy8gQWRkIHN1bmJ1cnN0IGFnYWluIHNvIGl0IHN0YXlzIG9uIHRvcFxuICAgICAgICB0aGlzLnN1bmJ1cnN0LmFkZFN1bmJ1cnN0R3JvdXAodGhpcy5zdmdTZWwpO1xuICAgICAgICB0aGlzLmdlbmVyaWNUaWNrKHByaW1hcnlOb2Rlcywgc2Vjb25kYXJ5Tm9kZXMsIHVudHlwZWROb2RlcywgbGlua0xpbmVzLCB0cmFuc2l0aW9uKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHEucmVzb2x2ZSgnb2snKTtcbiAgICB9O1xuICAgIEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5tYXBWZXJpZnlUb1RoaXMgPSBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHZlcmlmeTogc3RhdGUudmVyaWZ5XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUubWFwVHlwZXNUb1RoaXMgPSBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGVzOiBzdGF0ZS50eXBlc1xuICAgICAgICB9O1xuICAgIH07XG4gICAgRXhwbG9yZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLm1hcEl0ZW1zVG9UaGlzID0gZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpdGVtczogc3RhdGUuaXRlbXNcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5tZXJnZU5vZGVzID0gZnVuY3Rpb24gKG9sZE5vZGVzLCBub2Rlcykge1xuICAgICAgICB2YXIgbmV3Tm9kZXMgPSBbXTtcbiAgICAgICAgLy8gQ2hlY2sgaWYgb2xkIG5vZGVzIGFyZSBzdGlsbCBpbiB0aGUgbWl4XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2xkTm9kZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbm9kZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBpZiAob2xkTm9kZXNbaV0udG9DYW5vbmljYWwoKSA9PT0gbm9kZXNbal0udG9DYW5vbmljYWwoKSkge1xuICAgICAgICAgICAgICAgICAgICBuZXdOb2Rlcy5wdXNoKG9sZE5vZGVzW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBncmFiIG5ldyBub2RlIGluZm9ybWF0aW9uIGxpa2UgbGFiZWxzIGFuZCBwcm9wcyBpbiBjYXNlIGl0J3MgY2hhbmdlZFxuICAgICAgICAgICAgICAgICAgICBvbGROb2Rlc1tpXS5sYWJlbCA9IG5vZGVzW2pdLmxhYmVsO1xuICAgICAgICAgICAgICAgICAgICBvbGROb2Rlc1tpXS5sb2NhbFByb3BlcnRpZXMgPSBub2Rlc1tqXS5sb2NhbFByb3BlcnRpZXM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIEFkZCB0aGUgbmV3IG5vZGVzXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBjaGVjayA9IGZhbHNlO1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBuZXdOb2Rlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIGlmIChuZXdOb2Rlc1tqXS50b0Nhbm9uaWNhbCgpID09PSBub2Rlc1tpXS50b0Nhbm9uaWNhbCgpKVxuICAgICAgICAgICAgICAgICAgICBjaGVjayA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWNoZWNrKSB7XG4gICAgICAgICAgICAgICAgbmV3Tm9kZXMucHVzaChub2Rlc1tpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ld05vZGVzO1xuICAgIH07XG4gICAgRXhwbG9yZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLm1lcmdlTGlua3MgPSBmdW5jdGlvbiAob2xkTGlua3MpIHtcbiAgICAgICAgdmFyIG5ld0xpbmtzID0gW107XG4gICAgICAgIHZhciBpdGVtcyA9IHRoaXMucHJpbWFyeUl0ZW1zLmNvbmNhdCh0aGlzLnNlY29uZGFyeUl0ZW1zKTtcbiAgICAgICAgdmFyIHNhbWVBcyA9IG5ldyBFTm9kZU1hcCgpO1xuICAgICAgICBmb3IgKHZhciBfaSA9IDAsIGl0ZW1zXzEgPSBpdGVtczsgX2kgPCBpdGVtc18xLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSBpdGVtc18xW19pXTtcbiAgICAgICAgICAgIHNhbWVBcy5zZXQoaXRlbSwgaXRlbSk7XG4gICAgICAgICAgICB2YXIgc2FtZUFzUHJvcCA9IGl0ZW0ubG9jYWxQcm9wZXJ0aWVzLmZpbHRlcihmdW5jdGlvbiAocCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBPV0wuc2FtZUFzLmVxdWFscyhwKTtcbiAgICAgICAgICAgIH0pWzBdO1xuICAgICAgICAgICAgaWYgKHNhbWVBc1Byb3AgJiYgc2FtZUFzUHJvcC52YWx1ZXMpXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgX2EgPSAwLCBfYiA9IHNhbWVBc1Byb3AudmFsdWVzOyBfYSA8IF9iLmxlbmd0aDsgX2ErKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IF9iW19hXTtcbiAgICAgICAgICAgICAgICAgICAgc2FtZUFzLnNldChuLnZhbHVlLCBpdGVtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gSXRlcmF0ZSBvdmVyIGl0ZW0gcHJvcGVydHkgdmFsdWVzIHRvIHNlZSBpZiB0aGV5IG1hdGNoIHRoZSBpZCBvZiBhbnlcbiAgICAgICAgLy8gb2YgdGhlIGl0ZW1zIGRpc3BsYXllZC4gQWxzbyBjaGVjayBpZiB0aGV5IG1hdGNoIHNhbWVBcyB2YWx1ZXMuLi5cbiAgICAgICAgZm9yICh2YXIgX2MgPSAwLCBpdGVtc18yID0gaXRlbXM7IF9jIDwgaXRlbXNfMi5sZW5ndGg7IF9jKyspIHtcbiAgICAgICAgICAgIHZhciBpdGVtID0gaXRlbXNfMltfY107XG4gICAgICAgICAgICBmb3IgKHZhciBfZCA9IDAsIF9lID0gaXRlbS5sb2NhbFByb3BlcnRpZXM7IF9kIDwgX2UubGVuZ3RoOyBfZCsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHAgPSBfZVtfZF07XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgX2YgPSAwLCBfZyA9IHAudmFsdWVzOyBfZiA8IF9nLmxlbmd0aDsgX2YrKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdiA9IF9nW19mXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNhbWVBcy5oYXModi52YWx1ZSkgJiYgaXRlbSAhPT0gc2FtZUFzLmdldCh2LnZhbHVlKSAmJiBpdGVtcy5pbmRleE9mKHNhbWVBcy5nZXQodi52YWx1ZSkpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3TGlua3MucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiBpdGVtLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldDogc2FtZUFzLmdldCh2LnZhbHVlKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eTogcFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ld0xpbmtzO1xuICAgIH07XG4gICAgcmV0dXJuIEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyO1xufSgpKTtcbnZhciBFeHBsb3JlQ29tcG9uZW50ID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBFeHBsb3JlQ29tcG9uZW50KCkge1xuICAgICAgICB0aGlzLmJpbmRpbmdzID0ge1xuICAgICAgICAgICAgbGlua01vZGU6ICc8JyxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5jb250cm9sbGVyID0gRXhwbG9yZUNvbXBvbmVudENvbnRyb2xsZXI7IC8vIChuZXcgKC4uLmFyZ3M6IGFueVtdKSA9PiBhbmd1bGFyLklDb250cm9sbGVyKSA9IEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyXG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSByZXF1aXJlKCcuL2V4cGxvcmUucHVnJykoKTtcbiAgICB9XG4gICAgcmV0dXJuIEV4cGxvcmVDb21wb25lbnQ7XG59KCkpO1xuZXhwb3J0IHsgRXhwbG9yZUNvbXBvbmVudCB9O1xuYW5ndWxhci5tb2R1bGUoJ2ZpYnJhLmNvbXBvbmVudHMuZXhwbG9yZScsIFsnZmlicmEuc2VydmljZXMnXSlcbiAgICAuY29tcG9uZW50KCdleHBsb3JlJywgbmV3IEV4cGxvcmVDb21wb25lbnQoKSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL2NvbXBvbmVudHMvY29uc3RydWN0LXZpZXcvZXhwbG9yZS1jb21wb25lbnQudHMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUUE7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFFQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFNQTtBQUFBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFJQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBSUE7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFFQTtBQUFBO0FBRUE7QUFJQTtBQUVBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),

/***/ "./app/components/construct-view/explore-verify-component/explore-verify-component.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__services_sparql_item_service__ = __webpack_require__(\"./app/services/sparql-item-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__services_sparql_autocomplete_service__ = __webpack_require__(\"./app/services/sparql-autocomplete-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__models_rdf__ = __webpack_require__(\"./app/models/rdf.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__actions_verify__ = __webpack_require__(\"./app/actions/verify.ts\");\n/* unused harmony export ExploreVerifyComponentController */\n/* unused harmony export ExploreVerifyComponent */\n\n\n\n\n\n\n\nvar ExploreVerifyComponentController = function () {\n    function ExploreVerifyComponentController(fibraService, $ngRedux, $q, sparqlAutocompleteService) {\n        this.fibraService = fibraService;\n        this.$ngRedux = $ngRedux;\n        this.$q = $q;\n        this.sparqlAutocompleteService = sparqlAutocompleteService;\n        this.limitFilter = '';\n        this.queryString = '';\n        this.relevantTypes = [];\n        this.fibraService = fibraService;\n        this.canceller = $q.defer();\n        var unsub1 = $ngRedux.connect(this.mapVerifyToThis, __WEBPACK_IMPORTED_MODULE_4__actions_verify__)(this);\n        var unsub2 = $ngRedux.connect(this.mapItemsToThis, __WEBPACK_IMPORTED_MODULE_4__actions_verify__)(this);\n        this.unsubscribe = function () {\n            unsub1();\n            unsub2();\n        };\n    }\n    ExploreVerifyComponentController.prototype.$onDestroy = function () {\n        this.unsubscribe();\n    };\n    ExploreVerifyComponentController.prototype.$onChanges = function (chngsObj) {\n        if (this.node) {\n            this.queryString = this.node.label;\n            this.runQuery();\n        }\n    };\n    ExploreVerifyComponentController.prototype.mapVerifyToThis = function (state) {\n        return {\n            verify: state.verify\n        };\n    };\n    ExploreVerifyComponentController.prototype.mapItemsToThis = function (state) {\n        return {\n            items: state.items\n        };\n    };\n    ExploreVerifyComponentController.prototype.runQuery = function () {\n        var _this = this;\n        this.canceller.resolve();\n        this.updateResults(new __WEBPACK_IMPORTED_MODULE_1__services_sparql_autocomplete_service__[\"b\" /* AutocompletionResults */]());\n        this.queryRunning = true;\n        this.error = false;\n        this.limitFilter = '';\n        this.canceller = this.$q.defer();\n        var nodeTypes = this.node.localProperties.filter(function (p) {\n            return p.value === 'http://www.w3.org/1999/02/22-rdf-syntax-ns#type';\n        })[0];\n        this.relevantTypes = nodeTypes ? nodeTypes.values.map(function (v) {\n            return v.value;\n        }) : [];\n        this.relevantTypes.forEach(function (t) {\n            if (t) _this.limitFilter += '<' + t.value + '>' + ',';\n        });\n        if (this.limitFilter.length !== 0) this.limitFilter = 'FILTER (?groupId IN (' + this.limitFilter.substring(0, this.limitFilter.length - 1) + '))';\n        this.sparqlAutocompleteService.autocomplete(this.queryString, 6, true, this.limitFilter, this.canceller.promise).then(function (results) {\n            console.log(\"Results in verify: \", results);\n            _this.queryRunning = false;\n            _this.updateResults(results);\n        }, function () {\n            console.log(\"Error in verify\");\n            _this.queryRunning = false;\n            _this.error = true;\n        }, function (update) {\n            console.log(\"Update in verify: \", update);\n            if (update.error) _this.error = true;else _this.updateResults(update.results);\n        });\n    };\n    ExploreVerifyComponentController.prototype.updateResults = function (results) {\n        console.log(this.relevantTypes);\n        var typeLabels = this.relevantTypes.map(function (t) {\n            return t.label;\n        });\n        // this.matchingResults = results.remoteResults.filter((r) => typeLabels.indexOf(r.label) !== -1)\n        this.matchingResults = results.remoteResults;\n        console.log(this.matchingResults);\n    };\n    ExploreVerifyComponentController.prototype.sourcesFromResult = function (result) {\n        return ' (Sources: ' + result.datasources.join(', ') + ')';\n    };\n    ExploreVerifyComponentController.prototype.verify = function (result) {\n        var _this = this;\n        var prop = result.ids.map(function (id) {\n            return new __WEBPACK_IMPORTED_MODULE_0__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"d\" /* OWL */].sameAs, id);\n        });\n        this.fibraService.dispatchAction(this.itemProperty(this.node, prop)).then(function () {\n            _this.clear();\n        });\n    };\n    ExploreVerifyComponentController.prototype.clear = function () {\n        this.verifyItem(null);\n    };\n    return ExploreVerifyComponentController;\n}();\n\nvar ExploreVerifyComponent = function () {\n    function ExploreVerifyComponent() {\n        this.template = __webpack_require__(\"./app/components/construct-view/explore-verify-component/explore-verify-component.pug\")();\n        this.controller = ExploreVerifyComponentController;\n        this.bindings = {\n            node: '<'\n        };\n    }\n    return ExploreVerifyComponent;\n}();\n\n__WEBPACK_IMPORTED_MODULE_3_angular__[\"module\"]('fibra.components.verify', ['fibra.services']).component('verify', new ExploreVerifyComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9leHBsb3JlLXZlcmlmeS1jb21wb25lbnQvZXhwbG9yZS12ZXJpZnktY29tcG9uZW50LnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL2FwcC9jb21wb25lbnRzL2NvbnN0cnVjdC12aWV3L2V4cGxvcmUtdmVyaWZ5LWNvbXBvbmVudC9leHBsb3JlLXZlcmlmeS1jb21wb25lbnQudHM/YmY0NiJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5pbXBvcnQgeyBQcm9wZXJ0eUFuZFZhbHVlIH0gZnJvbSAnLi4vLi4vLi4vc2VydmljZXMvc3BhcnFsLWl0ZW0tc2VydmljZSc7XG5pbXBvcnQgeyBBdXRvY29tcGxldGlvblJlc3VsdHMgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9zcGFycWwtYXV0b2NvbXBsZXRlLXNlcnZpY2UnO1xuaW1wb3J0IHsgT1dMIH0gZnJvbSAnLi4vLi4vLi4vbW9kZWxzL3JkZic7XG5pbXBvcnQgKiBhcyBhbmd1bGFyIGZyb20gJ2FuZ3VsYXInO1xuaW1wb3J0ICogYXMgVmVyaWZ5QWN0aW9ucyBmcm9tICcuLi8uLi8uLi9hY3Rpb25zL3ZlcmlmeSc7XG52YXIgRXhwbG9yZVZlcmlmeUNvbXBvbmVudENvbnRyb2xsZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEV4cGxvcmVWZXJpZnlDb21wb25lbnRDb250cm9sbGVyKGZpYnJhU2VydmljZSwgJG5nUmVkdXgsICRxLCBzcGFycWxBdXRvY29tcGxldGVTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMuZmlicmFTZXJ2aWNlID0gZmlicmFTZXJ2aWNlO1xuICAgICAgICB0aGlzLiRuZ1JlZHV4ID0gJG5nUmVkdXg7XG4gICAgICAgIHRoaXMuJHEgPSAkcTtcbiAgICAgICAgdGhpcy5zcGFycWxBdXRvY29tcGxldGVTZXJ2aWNlID0gc3BhcnFsQXV0b2NvbXBsZXRlU2VydmljZTtcbiAgICAgICAgdGhpcy5saW1pdEZpbHRlciA9ICcnO1xuICAgICAgICB0aGlzLnF1ZXJ5U3RyaW5nID0gJyc7XG4gICAgICAgIHRoaXMucmVsZXZhbnRUeXBlcyA9IFtdO1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZSA9IGZpYnJhU2VydmljZTtcbiAgICAgICAgdGhpcy5jYW5jZWxsZXIgPSAkcS5kZWZlcigpO1xuICAgICAgICB2YXIgdW5zdWIxID0gJG5nUmVkdXguY29ubmVjdCh0aGlzLm1hcFZlcmlmeVRvVGhpcywgVmVyaWZ5QWN0aW9ucykodGhpcyk7XG4gICAgICAgIHZhciB1bnN1YjIgPSAkbmdSZWR1eC5jb25uZWN0KHRoaXMubWFwSXRlbXNUb1RoaXMsIFZlcmlmeUFjdGlvbnMpKHRoaXMpO1xuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdW5zdWIxKCk7XG4gICAgICAgICAgICB1bnN1YjIoKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgRXhwbG9yZVZlcmlmeUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLiRvbkRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudW5zdWJzY3JpYmUoKTtcbiAgICB9O1xuICAgIEV4cGxvcmVWZXJpZnlDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS4kb25DaGFuZ2VzID0gZnVuY3Rpb24gKGNobmdzT2JqKSB7XG4gICAgICAgIGlmICh0aGlzLm5vZGUpIHtcbiAgICAgICAgICAgIHRoaXMucXVlcnlTdHJpbmcgPSB0aGlzLm5vZGUubGFiZWw7XG4gICAgICAgICAgICB0aGlzLnJ1blF1ZXJ5KCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEV4cGxvcmVWZXJpZnlDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5tYXBWZXJpZnlUb1RoaXMgPSBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHZlcmlmeTogc3RhdGUudmVyaWZ5XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBFeHBsb3JlVmVyaWZ5Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUubWFwSXRlbXNUb1RoaXMgPSBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGl0ZW1zOiBzdGF0ZS5pdGVtc1xuICAgICAgICB9O1xuICAgIH07XG4gICAgRXhwbG9yZVZlcmlmeUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLnJ1blF1ZXJ5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLmNhbmNlbGxlci5yZXNvbHZlKCk7XG4gICAgICAgIHRoaXMudXBkYXRlUmVzdWx0cyhuZXcgQXV0b2NvbXBsZXRpb25SZXN1bHRzKCkpO1xuICAgICAgICB0aGlzLnF1ZXJ5UnVubmluZyA9IHRydWU7XG4gICAgICAgIHRoaXMuZXJyb3IgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5saW1pdEZpbHRlciA9ICcnO1xuICAgICAgICB0aGlzLmNhbmNlbGxlciA9IHRoaXMuJHEuZGVmZXIoKTtcbiAgICAgICAgdmFyIG5vZGVUeXBlcyA9IHRoaXMubm9kZS5sb2NhbFByb3BlcnRpZXMuZmlsdGVyKGZ1bmN0aW9uIChwKSB7IHJldHVybiBwLnZhbHVlID09PSAnaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zI3R5cGUnOyB9KVswXTtcbiAgICAgICAgdGhpcy5yZWxldmFudFR5cGVzID0gbm9kZVR5cGVzID8gbm9kZVR5cGVzLnZhbHVlcy5tYXAoZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHYudmFsdWU7IH0pIDogW107XG4gICAgICAgIHRoaXMucmVsZXZhbnRUeXBlcy5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7IGlmICh0KVxuICAgICAgICAgICAgX3RoaXMubGltaXRGaWx0ZXIgKz0gJzwnICsgdC52YWx1ZSArICc+JyArICcsJzsgfSk7XG4gICAgICAgIGlmICh0aGlzLmxpbWl0RmlsdGVyLmxlbmd0aCAhPT0gMClcbiAgICAgICAgICAgIHRoaXMubGltaXRGaWx0ZXIgPSAnRklMVEVSICg/Z3JvdXBJZCBJTiAoJyArIHRoaXMubGltaXRGaWx0ZXIuc3Vic3RyaW5nKDAsIHRoaXMubGltaXRGaWx0ZXIubGVuZ3RoIC0gMSkgKyAnKSknO1xuICAgICAgICB0aGlzLnNwYXJxbEF1dG9jb21wbGV0ZVNlcnZpY2UuYXV0b2NvbXBsZXRlKHRoaXMucXVlcnlTdHJpbmcsIDYsIHRydWUsIHRoaXMubGltaXRGaWx0ZXIsIHRoaXMuY2FuY2VsbGVyLnByb21pc2UpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdHMpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiUmVzdWx0cyBpbiB2ZXJpZnk6IFwiLCByZXN1bHRzKTtcbiAgICAgICAgICAgIF90aGlzLnF1ZXJ5UnVubmluZyA9IGZhbHNlO1xuICAgICAgICAgICAgX3RoaXMudXBkYXRlUmVzdWx0cyhyZXN1bHRzKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJFcnJvciBpbiB2ZXJpZnlcIik7XG4gICAgICAgICAgICBfdGhpcy5xdWVyeVJ1bm5pbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIF90aGlzLmVycm9yID0gdHJ1ZTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKHVwZGF0ZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJVcGRhdGUgaW4gdmVyaWZ5OiBcIiwgdXBkYXRlKTtcbiAgICAgICAgICAgIGlmICh1cGRhdGUuZXJyb3IpXG4gICAgICAgICAgICAgICAgX3RoaXMuZXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIF90aGlzLnVwZGF0ZVJlc3VsdHModXBkYXRlLnJlc3VsdHMpO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIEV4cGxvcmVWZXJpZnlDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS51cGRhdGVSZXN1bHRzID0gZnVuY3Rpb24gKHJlc3VsdHMpIHtcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5yZWxldmFudFR5cGVzKTtcbiAgICAgICAgdmFyIHR5cGVMYWJlbHMgPSB0aGlzLnJlbGV2YW50VHlwZXMubWFwKGZ1bmN0aW9uICh0KSB7IHJldHVybiB0LmxhYmVsOyB9KTtcbiAgICAgICAgLy8gdGhpcy5tYXRjaGluZ1Jlc3VsdHMgPSByZXN1bHRzLnJlbW90ZVJlc3VsdHMuZmlsdGVyKChyKSA9PiB0eXBlTGFiZWxzLmluZGV4T2Yoci5sYWJlbCkgIT09IC0xKVxuICAgICAgICB0aGlzLm1hdGNoaW5nUmVzdWx0cyA9IHJlc3VsdHMucmVtb3RlUmVzdWx0cztcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5tYXRjaGluZ1Jlc3VsdHMpO1xuICAgIH07XG4gICAgRXhwbG9yZVZlcmlmeUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLnNvdXJjZXNGcm9tUmVzdWx0ID0gZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICByZXR1cm4gJyAoU291cmNlczogJyArIHJlc3VsdC5kYXRhc291cmNlcy5qb2luKCcsICcpICsgJyknO1xuICAgIH07XG4gICAgRXhwbG9yZVZlcmlmeUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLnZlcmlmeSA9IGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIHByb3AgPSByZXN1bHQuaWRzLm1hcChmdW5jdGlvbiAoaWQpIHsgcmV0dXJuIG5ldyBQcm9wZXJ0eUFuZFZhbHVlKE9XTC5zYW1lQXMsIGlkKTsgfSk7XG4gICAgICAgIHRoaXMuZmlicmFTZXJ2aWNlLmRpc3BhdGNoQWN0aW9uKHRoaXMuaXRlbVByb3BlcnR5KHRoaXMubm9kZSwgcHJvcCkpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdGhpcy5jbGVhcigpO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIEV4cGxvcmVWZXJpZnlDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy52ZXJpZnlJdGVtKG51bGwpO1xuICAgIH07XG4gICAgcmV0dXJuIEV4cGxvcmVWZXJpZnlDb21wb25lbnRDb250cm9sbGVyO1xufSgpKTtcbmV4cG9ydCB7IEV4cGxvcmVWZXJpZnlDb21wb25lbnRDb250cm9sbGVyIH07XG52YXIgRXhwbG9yZVZlcmlmeUNvbXBvbmVudCA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRXhwbG9yZVZlcmlmeUNvbXBvbmVudCgpIHtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IHJlcXVpcmUoJy4vZXhwbG9yZS12ZXJpZnktY29tcG9uZW50LnB1ZycpKCk7XG4gICAgICAgIHRoaXMuY29udHJvbGxlciA9IEV4cGxvcmVWZXJpZnlDb21wb25lbnRDb250cm9sbGVyO1xuICAgICAgICB0aGlzLmJpbmRpbmdzID0ge1xuICAgICAgICAgICAgbm9kZTogJzwnXG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBFeHBsb3JlVmVyaWZ5Q29tcG9uZW50O1xufSgpKTtcbmV4cG9ydCB7IEV4cGxvcmVWZXJpZnlDb21wb25lbnQgfTtcbmFuZ3VsYXIubW9kdWxlKCdmaWJyYS5jb21wb25lbnRzLnZlcmlmeScsIFsnZmlicmEuc2VydmljZXMnXSlcbiAgICAuY29tcG9uZW50KCd2ZXJpZnknLCBuZXcgRXhwbG9yZVZlcmlmeUNvbXBvbmVudCgpKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBhcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9leHBsb3JlLXZlcmlmeS1jb21wb25lbnQvZXhwbG9yZS12ZXJpZnktY29tcG9uZW50LnRzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ })

})