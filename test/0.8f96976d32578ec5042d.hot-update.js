webpackHotUpdate(0,{

/***/ "./app/actions/types.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("Object.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__services_sparql_item_service__ = __webpack_require__(\"./app/services/sparql-item-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__models_rdf__ = __webpack_require__(\"./app/models/rdf.ts\");\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CREATE_TYPE\", function() { return CREATE_TYPE; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"TYPE_CREATED\", function() { return TYPE_CREATED; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ADD_TYPE\", function() { return ADD_TYPE; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CLEAR_TYPES\", function() { return CLEAR_TYPES; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SET_ORDERED_TYPES\", function() { return SET_ORDERED_TYPES; });\n/* harmony export (immutable) */ __webpack_exports__[\"addType\"] = addType;\n/* harmony export (immutable) */ __webpack_exports__[\"clearTypes\"] = clearTypes;\n/* harmony export (immutable) */ __webpack_exports__[\"setOrderedTypes\"] = setOrderedTypes;\n/* harmony export (immutable) */ __webpack_exports__[\"createType\"] = createType;\n/* harmony export (immutable) */ __webpack_exports__[\"typeCreated\"] = typeCreated;\n\n\nvar CREATE_TYPE = 'CREATE_TYPE';\nvar TYPE_CREATED = 'TYPE_CREATED';\nvar ADD_TYPE = 'ADD_TYPE';\nvar CLEAR_TYPES = 'CLEAR_TYPES';\nvar SET_ORDERED_TYPES = 'SET_ORDERED_TYPES';\nfunction addType(type) {\n    return {\n        type: ADD_TYPE,\n        payload: type\n    };\n}\nfunction clearTypes() {\n    return {\n        type: CLEAR_TYPES,\n        payload: undefined\n    };\n}\nfunction setOrderedTypes(types) {\n    return {\n        type: SET_ORDERED_TYPES,\n        payload: types\n    };\n}\nfunction createType(label, service) {\n    return function (dispatch) {\n        return service.createNewItem([new __WEBPACK_IMPORTED_MODULE_0__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"a\" /* SKOS */].prefLabel, __WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"b\" /* DataFactory */].instance.literal(label)), new __WEBPACK_IMPORTED_MODULE_0__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"c\" /* RDF */].type, __WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"d\" /* OWL */].Class)]).then(function (node) {\n            dispatch(typeCreated(node, label));\n        });\n    };\n}\nfunction typeCreated(node, label) {\n    return {\n        type: TYPE_CREATED,\n        payload: {\n            node: node,\n            label: label\n        }\n    };\n}//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvYWN0aW9ucy90eXBlcy50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hcHAvYWN0aW9ucy90eXBlcy50cz9iMzZhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFByb3BlcnR5QW5kVmFsdWUgfSBmcm9tICcuLi9zZXJ2aWNlcy9zcGFycWwtaXRlbS1zZXJ2aWNlJztcbmltcG9ydCB7IFNLT1MsIERhdGFGYWN0b3J5LCBSREYsIE9XTCB9IGZyb20gJy4uL21vZGVscy9yZGYnO1xuZXhwb3J0IHZhciBDUkVBVEVfVFlQRSA9ICdDUkVBVEVfVFlQRSc7XG5leHBvcnQgdmFyIFRZUEVfQ1JFQVRFRCA9ICdUWVBFX0NSRUFURUQnO1xuZXhwb3J0IHZhciBBRERfVFlQRSA9ICdBRERfVFlQRSc7XG5leHBvcnQgdmFyIENMRUFSX1RZUEVTID0gJ0NMRUFSX1RZUEVTJztcbmV4cG9ydCB2YXIgU0VUX09SREVSRURfVFlQRVMgPSAnU0VUX09SREVSRURfVFlQRVMnO1xuZXhwb3J0IGZ1bmN0aW9uIGFkZFR5cGUodHlwZSkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IEFERF9UWVBFLFxuICAgICAgICBwYXlsb2FkOiB0eXBlXG4gICAgfTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBjbGVhclR5cGVzKCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IENMRUFSX1RZUEVTLFxuICAgICAgICBwYXlsb2FkOiB1bmRlZmluZWRcbiAgICB9O1xufVxuZXhwb3J0IGZ1bmN0aW9uIHNldE9yZGVyZWRUeXBlcyh0eXBlcykge1xuICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFNFVF9PUkRFUkVEX1RZUEVTLFxuICAgICAgICBwYXlsb2FkOiB0eXBlc1xuICAgIH07XG59XG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlVHlwZShsYWJlbCwgc2VydmljZSkge1xuICAgIHJldHVybiBmdW5jdGlvbiAoZGlzcGF0Y2gpIHtcbiAgICAgICAgcmV0dXJuIHNlcnZpY2UuY3JlYXRlTmV3SXRlbShbbmV3IFByb3BlcnR5QW5kVmFsdWUoU0tPUy5wcmVmTGFiZWwsIERhdGFGYWN0b3J5Lmluc3RhbmNlLmxpdGVyYWwobGFiZWwpKSwgbmV3IFByb3BlcnR5QW5kVmFsdWUoUkRGLnR5cGUsIE9XTC5DbGFzcyldKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgIGRpc3BhdGNoKHR5cGVDcmVhdGVkKG5vZGUsIGxhYmVsKSk7XG4gICAgICAgIH0pO1xuICAgIH07XG59XG5leHBvcnQgZnVuY3Rpb24gdHlwZUNyZWF0ZWQobm9kZSwgbGFiZWwpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBUWVBFX0NSRUFURUQsXG4gICAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgICAgIG5vZGU6IG5vZGUsXG4gICAgICAgICAgICBsYWJlbDogbGFiZWxcbiAgICAgICAgfVxuICAgIH07XG59XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL2FjdGlvbnMvdHlwZXMudHMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBRkE7QUFPQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),

/***/ "./app/components/construct-view/construct-view-component.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__services_sparql_tree_service__ = __webpack_require__(\"./app/services/sparql-tree-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__actions_types__ = __webpack_require__(\"./app/actions/types.ts\");\n/* unused harmony export ConstructViewComponentController */\n/* unused harmony export ConstructViewComponent */\n\n\n\n\n\n// class TreeViewConfiguration {\n//   constructor(public endpoint: string, public queryTemplate: string) {}\n// }\nvar ConstructViewComponentController = function () {\n    function ConstructViewComponentController(sparqlTreeService, projectService, fibraService, $ngRedux, $q) {\n        var _this = this;\n        this.sparqlTreeService = sparqlTreeService;\n        this.projectService = projectService;\n        this.fibraService = fibraService;\n        this.$ngRedux = $ngRedux;\n        this.$q = $q;\n        this.paletteDisplay = false;\n        this.limitFilter = '';\n        this.unsubscribe = $ngRedux.connect(this.mapStateToThis, __WEBPACK_IMPORTED_MODULE_2__actions_types__)(this);\n        var currentProject = projectService.getCurrentProject();\n        this.currentProjectSource = projectService.getProjectSources().find(function (ps) {\n            return ps.sparqlEndpoint === currentProject.source.sparqlEndpoint && ps.graph === currentProject.source.graph;\n        });\n        fibraService.on('change', function () {\n            var chosenTypes = fibraService.getState().construct.displayTypes;\n            _this.limitFilter = '';\n            chosenTypes.forEach(function (t) {\n                if (t) _this.limitFilter += '<' + t.id + '>' + ',';\n            });\n            if (_this.limitFilter.length !== 0) _this.limitFilter = 'FILTER (?groupId IN (' + _this.limitFilter.substring(0, _this.limitFilter.length - 1) + '))';\n            return _this.$q.resolve('ok');\n        });\n        this.classTreePromise = sparqlTreeService.getTree(this.fibraService.getState().project.endpoint, this.fibraService.getState().project.treeQuery);\n        this.classTreePromise.then(function (c) {\n            _this.classTree = c;\n            _this.clearTypes();\n            _this.traverseClassTree(c, function (n) {\n                return _this.types.types.indexOf(n) === -1 && n.children.length === 0;\n            }, function (n) {\n                return _this.addType(n);\n            });\n        });\n        this.fibraService.on('change', function () {\n            _this.classTreePromise = sparqlTreeService.getTree(_this.fibraService.getState().project.endpoint, __WEBPACK_IMPORTED_MODULE_0__services_sparql_tree_service__[\"a\" /* SparqlTreeService */].getClassTreeQuery);\n            return _this.classTreePromise.then(function (c) {\n                _this.classTree = c;\n                return 'ok';\n            });\n        });\n        this.fibraService.on('action', function () {\n            _this.state = fibraService.getState();\n            return _this.$q.resolve('ok');\n        });\n        this.state = fibraService.getState();\n    }\n    ConstructViewComponentController.prototype.createItem = function (item) {\n        // Is there a type on this item? If so, and it is not already in chosenTypes,\n        // add it.\n        var itemTypeKey = item.additionalInformation['type'][0] ? item.additionalInformation['type'][0].value : \"\";\n        var itemType = this.types.types.filter(function (t) {\n            return t.id === itemTypeKey;\n        })[0];\n        var chosenTypes = this.fibraService.getState().construct.displayTypes;\n        if (!chosenTypes[0] && itemType) {\n            this.setOrderedTypes([itemType]);\n        } else if (!chosenTypes[1] && itemType && chosenTypes[0] !== itemType) {\n            var newTypes = chosenTypes.concat([]);\n            newTypes.push(itemType);\n            this.setOrderedTypes(newTypes);\n        }\n        return this.fibraService.dispatchAction(this.fibraService.displayItem(item.ids[0]));\n    };\n    ConstructViewComponentController.prototype.downloadRDF = function () {\n        var currentConfig = this.fibraService.getState().project.graph;\n        var downloadlink = \"http://ldf.fi/fibra/sparql?graph=\" + currentConfig; // + \"&force-accept=application/rdf+xml\"\n        var request = new XMLHttpRequest();\n        request.open(\"GET\", downloadlink, true);\n        request.onload = function (e) {\n            if (request.readyState === 4) {\n                if (request.status === 200) {\n                    var data = request.responseText;\n                    var download = document.createElement(\"a\");\n                    download.href = \"data:application/rdf+xml;charset=utf-8,\" + data;\n                    download.download = \"fibra.ttl\";\n                    document.body.appendChild(download);\n                    download.click();\n                    document.body.removeChild(download);\n                } else {\n                    console.error(request.statusText);\n                }\n            }\n        };\n        request.send(null);\n    };\n    ConstructViewComponentController.prototype.$onDestroy = function () {\n        this.unsubscribe();\n    };\n    ConstructViewComponentController.prototype.mapStateToThis = function (state) {\n        return {\n            types: state.types\n        };\n    };\n    ConstructViewComponentController.prototype.traverseClassTree = function (nodes, test, onSuccess) {\n        var traverse = function (node) {\n            if (test(node)) {\n                onSuccess(node);\n                node.children.forEach(traverse);\n            }\n        };\n        nodes.forEach(traverse);\n    };\n    return ConstructViewComponentController;\n}();\n\nvar ConstructViewComponent = function () {\n    function ConstructViewComponent() {\n        this.controller = ConstructViewComponentController; // (new (...args: any[]) => angular.IController) = ConstructViewComponentController\n        this.template = __webpack_require__(\"./app/components/construct-view/construct-view.pug\")();\n    }\n    return ConstructViewComponent;\n}();\n\n__WEBPACK_IMPORTED_MODULE_1_angular__[\"module\"]('fibra.components.construct-view', ['fibra.services']).component('constructView', new ConstructViewComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9jb25zdHJ1Y3Qtdmlldy1jb21wb25lbnQudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL2NvbXBvbmVudHMvY29uc3RydWN0LXZpZXcvY29uc3RydWN0LXZpZXctY29tcG9uZW50LnRzPzZmODMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuaW1wb3J0IHsgU3BhcnFsVHJlZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9zcGFycWwtdHJlZS1zZXJ2aWNlJztcbmltcG9ydCAqIGFzIGFuZ3VsYXIgZnJvbSAnYW5ndWxhcic7XG5pbXBvcnQgKiBhcyBUeXBlQWN0aW9ucyBmcm9tICcuLi8uLi9hY3Rpb25zL3R5cGVzJztcbi8vIGNsYXNzIFRyZWVWaWV3Q29uZmlndXJhdGlvbiB7XG4vLyAgIGNvbnN0cnVjdG9yKHB1YmxpYyBlbmRwb2ludDogc3RyaW5nLCBwdWJsaWMgcXVlcnlUZW1wbGF0ZTogc3RyaW5nKSB7fVxuLy8gfVxudmFyIENvbnN0cnVjdFZpZXdDb21wb25lbnRDb250cm9sbGVyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBDb25zdHJ1Y3RWaWV3Q29tcG9uZW50Q29udHJvbGxlcihzcGFycWxUcmVlU2VydmljZSwgcHJvamVjdFNlcnZpY2UsIGZpYnJhU2VydmljZSwgJG5nUmVkdXgsICRxKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuc3BhcnFsVHJlZVNlcnZpY2UgPSBzcGFycWxUcmVlU2VydmljZTtcbiAgICAgICAgdGhpcy5wcm9qZWN0U2VydmljZSA9IHByb2plY3RTZXJ2aWNlO1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZSA9IGZpYnJhU2VydmljZTtcbiAgICAgICAgdGhpcy4kbmdSZWR1eCA9ICRuZ1JlZHV4O1xuICAgICAgICB0aGlzLiRxID0gJHE7XG4gICAgICAgIHRoaXMucGFsZXR0ZURpc3BsYXkgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5saW1pdEZpbHRlciA9ICcnO1xuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlID0gJG5nUmVkdXguY29ubmVjdCh0aGlzLm1hcFN0YXRlVG9UaGlzLCBUeXBlQWN0aW9ucykodGhpcyk7XG4gICAgICAgIHZhciBjdXJyZW50UHJvamVjdCA9IHByb2plY3RTZXJ2aWNlLmdldEN1cnJlbnRQcm9qZWN0KCk7XG4gICAgICAgIHRoaXMuY3VycmVudFByb2plY3RTb3VyY2UgPSBwcm9qZWN0U2VydmljZS5nZXRQcm9qZWN0U291cmNlcygpLmZpbmQoZnVuY3Rpb24gKHBzKSB7IHJldHVybiBwcy5zcGFycWxFbmRwb2ludCA9PT0gY3VycmVudFByb2plY3Quc291cmNlLnNwYXJxbEVuZHBvaW50ICYmIHBzLmdyYXBoID09PSBjdXJyZW50UHJvamVjdC5zb3VyY2UuZ3JhcGg7IH0pO1xuICAgICAgICBmaWJyYVNlcnZpY2Uub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBjaG9zZW5UeXBlcyA9IGZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLmNvbnN0cnVjdC5kaXNwbGF5VHlwZXM7XG4gICAgICAgICAgICBfdGhpcy5saW1pdEZpbHRlciA9ICcnO1xuICAgICAgICAgICAgY2hvc2VuVHlwZXMuZm9yRWFjaChmdW5jdGlvbiAodCkgeyBpZiAodClcbiAgICAgICAgICAgICAgICBfdGhpcy5saW1pdEZpbHRlciArPSAnPCcgKyB0LmlkICsgJz4nICsgJywnOyB9KTtcbiAgICAgICAgICAgIGlmIChfdGhpcy5saW1pdEZpbHRlci5sZW5ndGggIT09IDApXG4gICAgICAgICAgICAgICAgX3RoaXMubGltaXRGaWx0ZXIgPSAnRklMVEVSICg/Z3JvdXBJZCBJTiAoJyArIF90aGlzLmxpbWl0RmlsdGVyLnN1YnN0cmluZygwLCBfdGhpcy5saW1pdEZpbHRlci5sZW5ndGggLSAxKSArICcpKSc7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuJHEucmVzb2x2ZSgnb2snKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY2xhc3NUcmVlUHJvbWlzZSA9IHNwYXJxbFRyZWVTZXJ2aWNlLmdldFRyZWUodGhpcy5maWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5wcm9qZWN0LmVuZHBvaW50LCB0aGlzLmZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLnByb2plY3QudHJlZVF1ZXJ5KTtcbiAgICAgICAgdGhpcy5jbGFzc1RyZWVQcm9taXNlLnRoZW4oZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIF90aGlzLmNsYXNzVHJlZSA9IGM7XG4gICAgICAgICAgICBfdGhpcy5jbGVhclR5cGVzKCk7XG4gICAgICAgICAgICBfdGhpcy50cmF2ZXJzZUNsYXNzVHJlZShjLCBmdW5jdGlvbiAobikgeyByZXR1cm4gX3RoaXMudHlwZXMudHlwZXMuaW5kZXhPZihuKSA9PT0gLTEgJiYgbi5jaGlsZHJlbi5sZW5ndGggPT09IDA7IH0sIGZ1bmN0aW9uIChuKSB7IHJldHVybiBfdGhpcy5hZGRUeXBlKG4pOyB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZmlicmFTZXJ2aWNlLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdGhpcy5jbGFzc1RyZWVQcm9taXNlID0gc3BhcnFsVHJlZVNlcnZpY2UuZ2V0VHJlZShfdGhpcy5maWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5wcm9qZWN0LmVuZHBvaW50LCBTcGFycWxUcmVlU2VydmljZS5nZXRDbGFzc1RyZWVRdWVyeSk7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuY2xhc3NUcmVlUHJvbWlzZS50aGVuKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuY2xhc3NUcmVlID0gYztcbiAgICAgICAgICAgICAgICByZXR1cm4gJ29rJztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5maWJyYVNlcnZpY2Uub24oJ2FjdGlvbicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF90aGlzLnN0YXRlID0gZmlicmFTZXJ2aWNlLmdldFN0YXRlKCk7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuJHEucmVzb2x2ZSgnb2snKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc3RhdGUgPSBmaWJyYVNlcnZpY2UuZ2V0U3RhdGUoKTtcbiAgICB9XG4gICAgQ29uc3RydWN0Vmlld0NvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmNyZWF0ZUl0ZW0gPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAvLyBJcyB0aGVyZSBhIHR5cGUgb24gdGhpcyBpdGVtPyBJZiBzbywgYW5kIGl0IGlzIG5vdCBhbHJlYWR5IGluIGNob3NlblR5cGVzLFxuICAgICAgICAvLyBhZGQgaXQuXG4gICAgICAgIHZhciBpdGVtVHlwZUtleSA9IGl0ZW0uYWRkaXRpb25hbEluZm9ybWF0aW9uWyd0eXBlJ11bMF0gPyBpdGVtLmFkZGl0aW9uYWxJbmZvcm1hdGlvblsndHlwZSddWzBdLnZhbHVlIDogXCJcIjtcbiAgICAgICAgdmFyIGl0ZW1UeXBlID0gdGhpcy50eXBlcy50eXBlcy5maWx0ZXIoZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHQuaWQgPT09IGl0ZW1UeXBlS2V5OyB9KVswXTtcbiAgICAgICAgdmFyIGNob3NlblR5cGVzID0gdGhpcy5maWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5jb25zdHJ1Y3QuZGlzcGxheVR5cGVzO1xuICAgICAgICBpZiAoIWNob3NlblR5cGVzWzBdICYmIGl0ZW1UeXBlKSB7XG4gICAgICAgICAgICB0aGlzLnNldE9yZGVyZWRUeXBlcyhbaXRlbVR5cGVdKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICghY2hvc2VuVHlwZXNbMV0gJiYgaXRlbVR5cGUgJiYgKGNob3NlblR5cGVzWzBdICE9PSBpdGVtVHlwZSkpIHtcbiAgICAgICAgICAgIHZhciBuZXdUeXBlcyA9IGNob3NlblR5cGVzLmNvbmNhdChbXSk7XG4gICAgICAgICAgICBuZXdUeXBlcy5wdXNoKGl0ZW1UeXBlKTtcbiAgICAgICAgICAgIHRoaXMuc2V0T3JkZXJlZFR5cGVzKG5ld1R5cGVzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5maWJyYVNlcnZpY2UuZGlzcGF0Y2hBY3Rpb24odGhpcy5maWJyYVNlcnZpY2UuZGlzcGxheUl0ZW0oaXRlbS5pZHNbMF0pKTtcbiAgICB9O1xuICAgIENvbnN0cnVjdFZpZXdDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5kb3dubG9hZFJERiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGN1cnJlbnRDb25maWcgPSB0aGlzLmZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLnByb2plY3QuZ3JhcGg7XG4gICAgICAgIHZhciBkb3dubG9hZGxpbmsgPSBcImh0dHA6Ly9sZGYuZmkvZmlicmEvc3BhcnFsP2dyYXBoPVwiICsgY3VycmVudENvbmZpZzsgLy8gKyBcIiZmb3JjZS1hY2NlcHQ9YXBwbGljYXRpb24vcmRmK3htbFwiXG4gICAgICAgIHZhciByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgIHJlcXVlc3Qub3BlbihcIkdFVFwiLCBkb3dubG9hZGxpbmssIHRydWUpO1xuICAgICAgICByZXF1ZXN0Lm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBpZiAocmVxdWVzdC5yZWFkeVN0YXRlID09PSA0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlcXVlc3Quc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSByZXF1ZXN0LnJlc3BvbnNlVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRvd25sb2FkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XG4gICAgICAgICAgICAgICAgICAgIGRvd25sb2FkLmhyZWYgPSBcImRhdGE6YXBwbGljYXRpb24vcmRmK3htbDtjaGFyc2V0PXV0Zi04LFwiICsgZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgZG93bmxvYWQuZG93bmxvYWQgPSBcImZpYnJhLnR0bFwiO1xuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGRvd25sb2FkKTtcbiAgICAgICAgICAgICAgICAgICAgZG93bmxvYWQuY2xpY2soKTtcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChkb3dubG9hZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKHJlcXVlc3Quc3RhdHVzVGV4dCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXF1ZXN0LnNlbmQobnVsbCk7XG4gICAgfTtcbiAgICBDb25zdHJ1Y3RWaWV3Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuJG9uRGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy51bnN1YnNjcmliZSgpO1xuICAgIH07XG4gICAgQ29uc3RydWN0Vmlld0NvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLm1hcFN0YXRlVG9UaGlzID0gZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlczogc3RhdGUudHlwZXNcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIENvbnN0cnVjdFZpZXdDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS50cmF2ZXJzZUNsYXNzVHJlZSA9IGZ1bmN0aW9uIChub2RlcywgdGVzdCwgb25TdWNjZXNzKSB7XG4gICAgICAgIHZhciB0cmF2ZXJzZSA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICBpZiAodGVzdChub2RlKSkge1xuICAgICAgICAgICAgICAgIG9uU3VjY2Vzcyhub2RlKTtcbiAgICAgICAgICAgICAgICBub2RlLmNoaWxkcmVuLmZvckVhY2godHJhdmVyc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBub2Rlcy5mb3JFYWNoKHRyYXZlcnNlKTtcbiAgICB9O1xuICAgIHJldHVybiBDb25zdHJ1Y3RWaWV3Q29tcG9uZW50Q29udHJvbGxlcjtcbn0oKSk7XG5leHBvcnQgeyBDb25zdHJ1Y3RWaWV3Q29tcG9uZW50Q29udHJvbGxlciB9O1xudmFyIENvbnN0cnVjdFZpZXdDb21wb25lbnQgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIENvbnN0cnVjdFZpZXdDb21wb25lbnQoKSB7XG4gICAgICAgIHRoaXMuY29udHJvbGxlciA9IENvbnN0cnVjdFZpZXdDb21wb25lbnRDb250cm9sbGVyOyAvLyAobmV3ICguLi5hcmdzOiBhbnlbXSkgPT4gYW5ndWxhci5JQ29udHJvbGxlcikgPSBDb25zdHJ1Y3RWaWV3Q29tcG9uZW50Q29udHJvbGxlclxuICAgICAgICB0aGlzLnRlbXBsYXRlID0gcmVxdWlyZSgnLi9jb25zdHJ1Y3Qtdmlldy5wdWcnKSgpO1xuICAgIH1cbiAgICByZXR1cm4gQ29uc3RydWN0Vmlld0NvbXBvbmVudDtcbn0oKSk7XG5leHBvcnQgeyBDb25zdHJ1Y3RWaWV3Q29tcG9uZW50IH07XG5hbmd1bGFyLm1vZHVsZSgnZmlicmEuY29tcG9uZW50cy5jb25zdHJ1Y3QtdmlldycsIFsnZmlicmEuc2VydmljZXMnXSlcbiAgICAuY29tcG9uZW50KCdjb25zdHJ1Y3RWaWV3JywgbmV3IENvbnN0cnVjdFZpZXdDb21wb25lbnQoKSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL2NvbXBvbmVudHMvY29uc3RydWN0LXZpZXcvY29uc3RydWN0LXZpZXctY29tcG9uZW50LnRzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),

/***/ "./app/components/construct-view/explore-component.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__services_sparql_item_service__ = __webpack_require__(\"./app/services/sparql-item-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__sunburst__ = __webpack_require__(\"./app/components/construct-view/sunburst.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__property_popover__ = __webpack_require__(\"./app/components/construct-view/property-popover.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_d3__ = __webpack_require__(\"./app/bower_components/d3/d3.js\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_d3___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_d3__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__models_rdf__ = __webpack_require__(\"./app/models/rdf.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_5_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__actions_verify__ = __webpack_require__(\"./app/actions/verify.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__actions_types__ = __webpack_require__(\"./app/actions/types.ts\");\n/* unused harmony export ExploreComponent */\n\n\n\n\n\n\n\n\n\n\nvar ExploreComponentController = function () {\n    function ExploreComponentController($element, $compile, $window, $scope, $timeout, sparqlItemService, fibraService, $ngRedux, $q) {\n        var _this = this;\n        this.$element = $element;\n        this.$compile = $compile;\n        this.$window = $window;\n        this.$scope = $scope;\n        this.$timeout = $timeout;\n        this.sparqlItemService = sparqlItemService;\n        this.fibraService = fibraService;\n        this.$ngRedux = $ngRedux;\n        this.$q = $q;\n        this.primaryItems = [];\n        this.secondaryItems = [];\n        this.tertiaryItems = [];\n        this.untypedItems = [];\n        this.removedUntypedItems = [];\n        this.allItems = [];\n        this.radiusInitial = 1;\n        this.radius = 8;\n        this.radiusBounce = 15;\n        this.gridOffset = 50; // Should be even\n        this.chargeForce = __WEBPACK_IMPORTED_MODULE_3_d3__[\"forceCollide\"](this.gridOffset / 1.5);\n        this.chargeForce2 = __WEBPACK_IMPORTED_MODULE_3_d3__[\"forceCollide\"](this.gridOffset / 1.5);\n        this.svgBackgroundColor = '#EEE';\n        this.lastClickX = 0;\n        this.lastClickY = 0;\n        var unsub1 = $ngRedux.connect(this.mapVerifyToThis, __WEBPACK_IMPORTED_MODULE_6__actions_verify__)(this);\n        var unsub2 = $ngRedux.connect(this.mapTypesToThis, __WEBPACK_IMPORTED_MODULE_7__actions_types__)(this);\n        this.unsubscribe = function () {\n            unsub1();\n            unsub2();\n        };\n        this.sunburst = new __WEBPACK_IMPORTED_MODULE_1__sunburst__[\"a\" /* Sunburst */]($element, $compile, $scope, sparqlItemService, fibraService);\n        this.propertyPopover = new __WEBPACK_IMPORTED_MODULE_2__property_popover__[\"a\" /* PropertyPopover */]($element, $scope, fibraService, $compile);\n        this.fibraService.on('change', function () {\n            // this.verifyItem = this.fibraService.getState().construct.verifyItem\n            return _this.queryAndBuild();\n        });\n        this.itemService = sparqlItemService;\n        this.links = [];\n        this.$scope.layout = {\n            'choice': 'force',\n            'links': 'hide'\n        };\n        this.$scope.$watch('layout.choice', this.updateExplore.bind(this, false));\n        this.$scope.$watch('layout.links', this.updateExplore.bind(this, false));\n    }\n    ExploreComponentController.prototype.$onChanges = function (chngsObj) {\n        if (this.svgSel) {\n            this.updateExplore(false, false);\n        }\n    };\n    ExploreComponentController.prototype.$postLink = function () {\n        var _this = this;\n        this.svgSel = __WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"](this.$element[0]).select('svg');\n        this.svgSel.append('rect').classed('background', true).style('fill', this.svgBackgroundColor).on('click', function () {\n            _this.lastClickX = __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].offsetX;\n            _this.lastClickY = __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].offsetY;\n            _this.fibraService.dispatchAction(_this.fibraService.createDisplayItem());\n        });\n        // Create link g\n        this.svgSel.append('g').attr('class', 'links');\n        this.sunburst.addSunburstGroup(this.svgSel);\n        this.radius = 8;\n        this.tooltip = __WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"]('body').append('div').style('position', 'absolute').style('z-index', '20').style('background-color', 'gray').style('color', 'white').style('padding', '3px').style('border-radius', '2px').style('visibility', 'hidden');\n        this.edittip = __WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"]('body').append('div').attr('id', 'edittip').style('position', 'absolute').style('z-index', '40').style('background-color', 'white').style('color', 'gray').style('border', '1px solid gray').style('padding', '3px').style('border-radius', '2px').style('visibility', 'hidden');\n        this.updateSizing();\n        this.queryAndBuild();\n    };\n    // currently broken on deleting a link\n    ExploreComponentController.prototype.highlightLinks = function (d, i) {\n        __WEBPACK_IMPORTED_MODULE_3_d3__[\"selectAll\"]('line').classed('relevant', false);\n        for (var j = 0; j < this.links.length; j++) {\n            var linksource = this.links[j].source;\n            var linktarget = this.links[j].target;\n            if (linksource.index === i || linktarget.index === i) __WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"]('#link-' + j).classed('relevant', true);\n        }\n    };\n    ExploreComponentController.prototype.$onDestroy = function () {\n        this.unsubscribe();\n    };\n    ExploreComponentController.prototype.queryAndBuild = function () {\n        var _this = this;\n        var prom = this.sparqlItemService.getItems(this.fibraService.getState().construct.items, false).then(function (items) {\n            // If we are showing property popovers, hide 'em.\n            _this.propertyPopover.hidePopover();\n            // Lock previous items\n            _this.lockExisting(_this.primaryItems);\n            _this.lockExisting(_this.secondaryItems);\n            _this.lockExisting(_this.tertiaryItems);\n            var displayTypes = _this.types.displayTypes;\n            var currentUntyped = _this.filterItemsByType(items, __WEBPACK_IMPORTED_MODULE_4__models_rdf__[\"d\" /* OWL */].Thing.value);\n            _this.removedUntypedItems = _this.untypedItems.filter(function (it) {\n                return currentUntyped.indexOf(it) === -1;\n            });\n            _this.untypedItems = _this.mergeNodes(_this.untypedItems, _this.filterItemsByType(items, __WEBPACK_IMPORTED_MODULE_4__models_rdf__[\"d\" /* OWL */].Thing.value));\n            if (displayTypes[0]) _this.primaryItems = _this.mergeNodes(_this.primaryItems, _this.filterItemsByType(items, displayTypes[0].id));\n            if (displayTypes[1]) _this.secondaryItems = _this.mergeNodes(_this.secondaryItems, _this.filterItemsByType(items, displayTypes[1].id));\n            if (displayTypes[2]) _this.tertiaryItems = _this.mergeNodes(_this.tertiaryItems, _this.filterItemsByType(items, displayTypes[2].id));\n            _this.allItems = _this.primaryItems.concat(_this.secondaryItems).concat(_this.tertiaryItems).concat(_this.untypedItems);\n            _this.properties = [];\n            if (_this.primaryItems[0] && _this.primaryItems[0].localProperties) {\n                for (var _i = 0, _a = _this.primaryItems[0].localProperties; _i < _a.length; _i++) {\n                    var p = _a[_i];\n                    _this.properties.push({ key: p.toCanonical(), value: p.label });\n                }\n            }\n            _this.links = _this.mergeLinks(_this.links);\n            return 'ok';\n        }).then(function () {\n            return _this.updateExplore();\n        });\n        this.fibraService.dispatchAction(this.fibraService.placeHolderAction(prom));\n        return prom;\n    };\n    ExploreComponentController.prototype.lockExisting = function (nodes) {\n        nodes.forEach(function (node) {\n            node.fx = node.gx;\n            node.fy = node.gy;\n        });\n    };\n    ExploreComponentController.prototype.filterItemsByType = function (items, type) {\n        return items.filter(function (it) {\n            var typeProp = it.localProperties.concat(it.remoteProperties).filter(function (pr) {\n                return pr.value === 'http://www.w3.org/1999/02/22-rdf-syntax-ns#type';\n            });\n            if (typeProp[0]) {\n                return typeProp[0].values.map(function (v) {\n                    return v.value.value;\n                }).indexOf(type) !== -1;\n            } else {\n                return false;\n            }\n        });\n    };\n    ExploreComponentController.prototype.updateSizing = function () {\n        // allow item_info_tip to expand somehow\n        // add delete and alter ability to sparql-item.pug\n        // fix how links sit on top of nodes\n        var viewport_width = window.innerWidth;\n        var viewport_height = window.innerHeight;\n        this.exploreWidth = viewport_width;\n        this.exploreHeight = viewport_height - 36;\n        __WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"](this.$element[0]).select('#explorecontainer').style('height', this.exploreHeight + 'px');\n        // move table down so top is at bottom of viewport\n        __WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"](this.$element[0]).select('#exploretable').style('height', viewport_height - 50 + 'px');\n        this.svgSel.style('width', viewport_width + 'px').style('height', viewport_height - 36 + 'px');\n        this.svgSel.select('rect.background').style('width', viewport_width + 'px').style('height', viewport_height - 36 + 'px');\n        var svg_width = +this.svgSel.style('width').replace('px', '');\n        var svg_height = +this.svgSel.style('height').replace('px', '');\n    };\n    ExploreComponentController.prototype.appendNodes = function (enterSelection, className) {\n        var _this = this;\n        var appendSelection = enterSelection.append('g').attr('id', function (d, i) {\n            return 'node-' + i + '-' + className;\n        }).attr('class', 'node').classed(className, true).append('circle').classed('node-circle', true).classed(className, true).attr('id', function (d, i) {\n            return 'node-circle-' + i + '-' + className;\n        }).attr('r', this.radiusInitial + 'px').call(__WEBPACK_IMPORTED_MODULE_3_d3__[\"drag\"]().on('start', function (d, i) {\n            if (!_this.linkMode) {\n                d.fx = d.x;\n                d.fy = d.y;\n            } else {\n                _this.dragline = _this.svgSel.append('line').attr('class', 'dragLine');\n            }\n        }).on('drag', function (d, i, group) {\n            if (!_this.linkMode) {\n                __WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"](group[i]).classed('fixed', true);\n                d.x = __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].x;\n                d.y = __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].y;\n            } else {\n                _this.dragline.attr('x1', d.x).attr('y1', d.y).attr('x2', __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].x).attr('y2', __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].y);\n            }\n            _this.updateExplore(false, false);\n        }).on('end', function (d, i, group) {\n            if (!_this.linkMode) {\n                if (!__WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"](group[i]).classed('fixed')) {\n                    d.fx = undefined;\n                    d.fy = undefined;\n                }\n            } else {\n                var lineX_1 = +_this.dragline.attr('x2');\n                var lineY_1 = +_this.dragline.attr('y2');\n                var nodeDrop_1 = false;\n                __WEBPACK_IMPORTED_MODULE_3_d3__[\"selectAll\"]('.node').each(function (f, j) {\n                    if (Math.abs(lineX_1 - f.x) < _this.radius && Math.abs(lineY_1 - f.y) < _this.radius) {\n                        nodeDrop_1 = true;\n                        _this.fibraService.dispatchAction(_this.fibraService.itemProperty(f, [new __WEBPACK_IMPORTED_MODULE_0__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_4__models_rdf__[\"a\" /* SKOS */].related, __WEBPACK_IMPORTED_MODULE_4__models_rdf__[\"b\" /* DataFactory */].instance.nodeFromNode(d))], [])).then(function (state) {\n                            _this.dragline.remove();\n                            _this.queryAndBuild();\n                            return state;\n                        });\n                    }\n                });\n                if (!nodeDrop_1) {\n                    _this.dragline.remove();\n                }\n            }\n        })).on('mouseover', function (d, i) {\n            _this.highlightLinks(d, i);\n            _this.tooltip.style('top', __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].pageY - 10 + 'px').style('left', __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].pageX + 10 + 'px').style('visibility', 'visible').text(d.label);\n        }).on('mouseout', function (d, i) {\n            _this.svgSel.selectAll('line').classed('relevant', false);\n            _this.tooltip.style('visibility', 'hidden');\n        }).on('click', function (d, i, group) {\n            var localSelected = d.selected;\n            // Unselect everything\n            _this.svgSel.selectAll('.node').each(function (n) {\n                n.selected = false;\n            });\n            // Flip this one\n            d.selected = !localSelected;\n            _this.updateExplore(false);\n            if (d.selected) {\n                _this.svgSel.select('g.sunburst-overlay').datum(d).each(_this.sunburst.buildSunburst.bind(_this)).style('display', 'block');\n            } else {\n                _this.svgSel.select('.sunburst-overlay').style('display', 'none');\n            }\n            _this.highlightLinks(d, i);\n        });\n        appendSelection.transition().attr('r', this.radius + this.radiusBounce + 'px').transition().attr('r', this.radius + 'px');\n        return appendSelection;\n    };\n    ExploreComponentController.prototype.snapToGrid = function (x, y, primary) {\n        if (primary === void 0) {\n            primary = true;\n        }\n        var sx, sy;\n        // Snap to gridOffset with further offset for multiples\n        if (primary) {\n            sx = Math.round(x / this.gridOffset) * this.gridOffset;\n            sy = Math.round(y / this.gridOffset) * this.gridOffset;\n        } else {\n            sx = Math.round(x / this.gridOffset) * this.gridOffset - this.gridOffset / 2;\n            sy = Math.round(y / this.gridOffset) * this.gridOffset - this.gridOffset / 2;\n        }\n        return [sx, sy];\n    };\n    ExploreComponentController.prototype.tickTransformNodes = function (sel, primary) {\n        var _this = this;\n        if (primary === void 0) {\n            primary = true;\n        }\n        sel.attr('transform', function (d, i) {\n            var x = d.x,\n                y = d.y;\n            if (d.x < _this.radius) x = _this.radius;\n            if (d.y < _this.radius) y = _this.radius;\n            var _a = [x, y],\n                gx = _a[0],\n                gy = _a[1];\n            if (_this.$scope.layout.choice === 'forcegrid') {\n                _b = _this.snapToGrid(x, y, primary), gx = _b[0], gy = _b[1];\n            }\n            d.gx = gx;\n            d.gy = gy;\n            return 'translate(' + gx + ', ' + gy + ')';\n            var _b;\n        });\n        if (sel.filter(function (d) {\n            return d.selected;\n        }).node()) {\n            var sbFunc_1 = this.sunburst.buildSunburst;\n            var svgSel_1 = this.svgSel;\n            var tickSunburst = function (d, i, g) {\n                svgSel_1.select('g.sunburst-overlay').datum(d).each(sbFunc_1.bind(this));\n            };\n            sel.filter(function (d) {\n                return d.selected;\n            }).each(tickSunburst.bind(this));\n        }\n    };\n    ExploreComponentController.prototype.genericTick = function (primaryNodes, secondaryNodes, untypedNodes, linkLines, transition) {\n        if (transition === void 0) {\n            transition = false;\n        }\n        var lPrimaryNodes = primaryNodes;\n        var lSecondaryNodes = secondaryNodes;\n        var lUntypedNodes = untypedNodes;\n        var lLinkLines = linkLines;\n        if (transition) {\n            lPrimaryNodes = lPrimaryNodes.transition();\n            lSecondaryNodes = lSecondaryNodes.transition();\n            lUntypedNodes = lUntypedNodes.transition();\n            lLinkLines = lLinkLines.transition();\n        }\n        this.tickTransformNodes(lPrimaryNodes, true);\n        this.tickTransformNodes(lSecondaryNodes, false);\n        this.tickTransformNodes(lUntypedNodes, false);\n        this.svgSel.selectAll('.node-circle').classed('selected-circle', function (d) {\n            return d.selected;\n        }).style('cursor', this.linkMode ? 'crosshair' : 'initial');\n        this.svgSel.selectAll('.node-circle').classed('labeled', function (d) {\n            return d.label ? true : false;\n        }).classed('verified', function (d) {\n            return d.localProperties.filter(function (p) {\n                return p.value === 'http://www.w3.org/2002/07/owl#sameAs';\n            }).length > 0;\n        });\n        lLinkLines.attr('x1', function (d) {\n            return d.source.gx;\n        }).attr('y1', function (d) {\n            return d.source.gy;\n        }).attr('x2', function (d) {\n            return d.target.gx;\n        }).attr('y2', function (d) {\n            return d.target.gy;\n        });\n    };\n    ExploreComponentController.prototype.updateExplore = function (runSim, transition) {\n        var _this = this;\n        if (runSim === void 0) {\n            runSim = true;\n        }\n        if (transition === void 0) {\n            transition = false;\n        }\n        var untypedNodes = this.svgSel.selectAll('circle.untyped').data(this.untypedItems, function (d) {\n            return d.value;\n        });\n        var primaryNodes = this.svgSel.selectAll('circle.primary').data(this.primaryItems, function (d) {\n            return d.value;\n        });\n        var secondaryNodes = this.svgSel.selectAll('circle.secondary').data(this.secondaryItems, function (d) {\n            return d.value;\n        });\n        primaryNodes.exit().remove();\n        secondaryNodes.exit().remove();\n        untypedNodes.exit().remove();\n        // Untyped nodes should come in one at a time based on a user's click event. For these\n        // we also want append the user interface for setting type and label.\n        untypedNodes.enter().each(function (datum, i, g) {\n            datum.x = _this.lastClickX;\n            datum.y = _this.lastClickY;\n            datum.fx = _this.lastClickX;\n            datum.fy = _this.lastClickY;\n            datum.gx = _this.lastClickX;\n            datum.gy = _this.lastClickY;\n        }).each(this.propertyPopover.addPopover.bind(this, this.$scope, this.svgSel));\n        // If a node went from being untyped to being primary or secondary, bring along its position\n        // Also handle position getting set from a drop (pull position from state)\n        var applyOldPosition = function (datum) {\n            // Get position from state if it was set there.\n            datum.x = _this.fibraService.getState().construct.itemIndex[datum.value].x;\n            datum.y = _this.fibraService.getState().construct.itemIndex[datum.value].y;\n            datum.fx = _this.fibraService.getState().construct.itemIndex[datum.value].x;\n            datum.fy = _this.fibraService.getState().construct.itemIndex[datum.value].y;\n            datum.gx = _this.fibraService.getState().construct.itemIndex[datum.value].x;\n            datum.gx = _this.fibraService.getState().construct.itemIndex[datum.value].y;\n            // Or if node was already here, get position from old node\n            var oldNode = _this.removedUntypedItems.filter(function (it) {\n                return it.value === datum.value;\n            })[0];\n            if (oldNode) {\n                datum.x = oldNode.x;\n                datum.y = oldNode.y;\n                datum.fx = oldNode.fx;\n                datum.fy = oldNode.fy;\n                datum.gx = oldNode.gx;\n                datum.gy = oldNode.gy;\n            }\n        };\n        primaryNodes.enter().each(applyOldPosition);\n        secondaryNodes.enter().each(applyOldPosition);\n        primaryNodes = primaryNodes.merge(this.appendNodes(primaryNodes.enter(), 'primary'));\n        secondaryNodes = secondaryNodes.merge(this.appendNodes(secondaryNodes.enter(), 'secondary'));\n        untypedNodes = untypedNodes.merge(this.appendNodes(untypedNodes.enter(), 'untyped'));\n        var linkLines = this.svgSel.select('g.links').selectAll('line').data(this.links);\n        linkLines.exit().remove();\n        linkLines = linkLines.enter().append('line').attr('id', function (d, i) {\n            return 'link-' + i;\n        }).on('mouseover', function (d, i) {\n            _this.tooltip.style('top', __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].pageY - 10 + 'px').style('left', __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].pageX + 10 + 'px').style('visibility', 'visible').text(d.property.label);\n        }).on('mouseout', function (d, i) {\n            _this.tooltip.style('visibility', 'hidden');\n        }).merge(linkLines).style('visibility', this.$scope.layout.links === 'show' ? 'visible' : 'hidden');\n        // Add sunburst again so it stays on top\n        this.sunburst.addSunburstGroup(this.svgSel);\n        this.genericTick(primaryNodes, secondaryNodes, untypedNodes, linkLines, transition);\n        return this.$q.resolve('ok');\n    };\n    ExploreComponentController.prototype.mapVerifyToThis = function (state) {\n        return {\n            verify: state.verify\n        };\n    };\n    ExploreComponentController.prototype.mapTypesToThis = function (state) {\n        return {\n            types: state.types\n        };\n    };\n    ExploreComponentController.prototype.mergeNodes = function (oldNodes, nodes) {\n        var newNodes = [];\n        // Check if old nodes are still in the mix\n        for (var i = 0; i < oldNodes.length; i++) {\n            for (var j = 0; j < nodes.length; j++) {\n                if (oldNodes[i].toCanonical() === nodes[j].toCanonical()) {\n                    newNodes.push(oldNodes[i]);\n                    // We need to grab new node information like labels and props in case it's changed\n                    oldNodes[i].label = nodes[j].label;\n                    oldNodes[i].localProperties = nodes[j].localProperties;\n                }\n            }\n        }\n        // Add the new nodes\n        for (var i = 0; i < nodes.length; i++) {\n            var check = false;\n            for (var j = 0; j < newNodes.length; j++) {\n                if (newNodes[j].toCanonical() === nodes[i].toCanonical()) check = true;\n            }\n            if (!check) {\n                newNodes.push(nodes[i]);\n            }\n        }\n        return newNodes;\n    };\n    ExploreComponentController.prototype.mergeLinks = function (oldLinks) {\n        var newLinks = [];\n        var items = this.primaryItems.concat(this.secondaryItems);\n        var sameAs = new __WEBPACK_IMPORTED_MODULE_4__models_rdf__[\"e\" /* ENodeMap */]();\n        for (var _i = 0, items_1 = items; _i < items_1.length; _i++) {\n            var item = items_1[_i];\n            sameAs.set(item, item);\n            var sameAsProp = item.localProperties.filter(function (p) {\n                return __WEBPACK_IMPORTED_MODULE_4__models_rdf__[\"d\" /* OWL */].sameAs.equals(p);\n            })[0];\n            if (sameAsProp && sameAsProp.values) for (var _a = 0, _b = sameAsProp.values; _a < _b.length; _a++) {\n                var n = _b[_a];\n                sameAs.set(n.value, item);\n            }\n        }\n        // Iterate over item property values to see if they match the id of any\n        // of the items displayed. Also check if they match sameAs values...\n        for (var _c = 0, items_2 = items; _c < items_2.length; _c++) {\n            var item = items_2[_c];\n            for (var _d = 0, _e = item.localProperties; _d < _e.length; _d++) {\n                var p = _e[_d];\n                for (var _f = 0, _g = p.values; _f < _g.length; _f++) {\n                    var v = _g[_f];\n                    if (sameAs.has(v.value) && item !== sameAs.get(v.value) && items.indexOf(sameAs.get(v.value)) !== -1) {\n                        newLinks.push({\n                            source: item,\n                            target: sameAs.get(v.value),\n                            property: p\n                        });\n                    }\n                }\n            }\n        }\n        return newLinks;\n    };\n    return ExploreComponentController;\n}();\nvar ExploreComponent = function () {\n    function ExploreComponent() {\n        this.bindings = {\n            linkMode: '<'\n        };\n        this.controller = ExploreComponentController; // (new (...args: any[]) => angular.IController) = ExploreComponentController\n        this.template = __webpack_require__(\"./app/components/construct-view/explore.pug\")();\n    }\n    return ExploreComponent;\n}();\n\n__WEBPACK_IMPORTED_MODULE_5_angular__[\"module\"]('fibra.components.explore', ['fibra.services']).component('explore', new ExploreComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9leHBsb3JlLWNvbXBvbmVudC50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9leHBsb3JlLWNvbXBvbmVudC50cz85OTJjIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmltcG9ydCB7IFByb3BlcnR5QW5kVmFsdWUgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9zcGFycWwtaXRlbS1zZXJ2aWNlJztcbmltcG9ydCB7IFN1bmJ1cnN0IH0gZnJvbSAnLi9zdW5idXJzdCc7XG5pbXBvcnQgeyBQcm9wZXJ0eVBvcG92ZXIgfSBmcm9tICcuL3Byb3BlcnR5LXBvcG92ZXInO1xuaW1wb3J0ICogYXMgZDMgZnJvbSAnZDMnO1xuaW1wb3J0IHsgT1dMLCBTS09TLCBEYXRhRmFjdG9yeSwgRU5vZGVNYXAgfSBmcm9tICcuLi8uLi9tb2RlbHMvcmRmJztcbmltcG9ydCAqIGFzIGFuZ3VsYXIgZnJvbSAnYW5ndWxhcic7XG5pbXBvcnQgKiBhcyBWZXJpZnlBY3Rpb25zIGZyb20gJy4uLy4uL2FjdGlvbnMvdmVyaWZ5JztcbmltcG9ydCAqIGFzIFR5cGVBY3Rpb25zIGZyb20gJy4uLy4uL2FjdGlvbnMvdHlwZXMnO1xudmFyIEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlcigkZWxlbWVudCwgJGNvbXBpbGUsICR3aW5kb3csICRzY29wZSwgJHRpbWVvdXQsIHNwYXJxbEl0ZW1TZXJ2aWNlLCBmaWJyYVNlcnZpY2UsICRuZ1JlZHV4LCAkcSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLiRlbGVtZW50ID0gJGVsZW1lbnQ7XG4gICAgICAgIHRoaXMuJGNvbXBpbGUgPSAkY29tcGlsZTtcbiAgICAgICAgdGhpcy4kd2luZG93ID0gJHdpbmRvdztcbiAgICAgICAgdGhpcy4kc2NvcGUgPSAkc2NvcGU7XG4gICAgICAgIHRoaXMuJHRpbWVvdXQgPSAkdGltZW91dDtcbiAgICAgICAgdGhpcy5zcGFycWxJdGVtU2VydmljZSA9IHNwYXJxbEl0ZW1TZXJ2aWNlO1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZSA9IGZpYnJhU2VydmljZTtcbiAgICAgICAgdGhpcy4kbmdSZWR1eCA9ICRuZ1JlZHV4O1xuICAgICAgICB0aGlzLiRxID0gJHE7XG4gICAgICAgIHRoaXMucHJpbWFyeUl0ZW1zID0gW107XG4gICAgICAgIHRoaXMuc2Vjb25kYXJ5SXRlbXMgPSBbXTtcbiAgICAgICAgdGhpcy50ZXJ0aWFyeUl0ZW1zID0gW107XG4gICAgICAgIHRoaXMudW50eXBlZEl0ZW1zID0gW107XG4gICAgICAgIHRoaXMucmVtb3ZlZFVudHlwZWRJdGVtcyA9IFtdO1xuICAgICAgICB0aGlzLmFsbEl0ZW1zID0gW107XG4gICAgICAgIHRoaXMucmFkaXVzSW5pdGlhbCA9IDE7XG4gICAgICAgIHRoaXMucmFkaXVzID0gODtcbiAgICAgICAgdGhpcy5yYWRpdXNCb3VuY2UgPSAxNTtcbiAgICAgICAgdGhpcy5ncmlkT2Zmc2V0ID0gNTA7IC8vIFNob3VsZCBiZSBldmVuXG4gICAgICAgIHRoaXMuY2hhcmdlRm9yY2UgPSBkMy5mb3JjZUNvbGxpZGUodGhpcy5ncmlkT2Zmc2V0IC8gMS41KTtcbiAgICAgICAgdGhpcy5jaGFyZ2VGb3JjZTIgPSBkMy5mb3JjZUNvbGxpZGUodGhpcy5ncmlkT2Zmc2V0IC8gMS41KTtcbiAgICAgICAgdGhpcy5zdmdCYWNrZ3JvdW5kQ29sb3IgPSAnI0VFRSc7XG4gICAgICAgIHRoaXMubGFzdENsaWNrWCA9IDA7XG4gICAgICAgIHRoaXMubGFzdENsaWNrWSA9IDA7XG4gICAgICAgIHZhciB1bnN1YjEgPSAkbmdSZWR1eC5jb25uZWN0KHRoaXMubWFwVmVyaWZ5VG9UaGlzLCBWZXJpZnlBY3Rpb25zKSh0aGlzKTtcbiAgICAgICAgdmFyIHVuc3ViMiA9ICRuZ1JlZHV4LmNvbm5lY3QodGhpcy5tYXBUeXBlc1RvVGhpcywgVHlwZUFjdGlvbnMpKHRoaXMpO1xuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdW5zdWIxKCk7XG4gICAgICAgICAgICB1bnN1YjIoKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zdW5idXJzdCA9IG5ldyBTdW5idXJzdCgkZWxlbWVudCwgJGNvbXBpbGUsICRzY29wZSwgc3BhcnFsSXRlbVNlcnZpY2UsIGZpYnJhU2VydmljZSk7XG4gICAgICAgIHRoaXMucHJvcGVydHlQb3BvdmVyID0gbmV3IFByb3BlcnR5UG9wb3ZlcigkZWxlbWVudCwgJHNjb3BlLCBmaWJyYVNlcnZpY2UsICRjb21waWxlKTtcbiAgICAgICAgdGhpcy5maWJyYVNlcnZpY2Uub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIHRoaXMudmVyaWZ5SXRlbSA9IHRoaXMuZmlicmFTZXJ2aWNlLmdldFN0YXRlKCkuY29uc3RydWN0LnZlcmlmeUl0ZW1cbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5xdWVyeUFuZEJ1aWxkKCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLml0ZW1TZXJ2aWNlID0gc3BhcnFsSXRlbVNlcnZpY2U7XG4gICAgICAgIHRoaXMubGlua3MgPSBbXTtcbiAgICAgICAgdGhpcy4kc2NvcGUubGF5b3V0ID0ge1xuICAgICAgICAgICAgJ2Nob2ljZSc6ICdmb3JjZScsXG4gICAgICAgICAgICAnbGlua3MnOiAnaGlkZSdcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy4kc2NvcGUuJHdhdGNoKCdsYXlvdXQuY2hvaWNlJywgdGhpcy51cGRhdGVFeHBsb3JlLmJpbmQodGhpcywgZmFsc2UpKTtcbiAgICAgICAgdGhpcy4kc2NvcGUuJHdhdGNoKCdsYXlvdXQubGlua3MnLCB0aGlzLnVwZGF0ZUV4cGxvcmUuYmluZCh0aGlzLCBmYWxzZSkpO1xuICAgIH1cbiAgICBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuJG9uQ2hhbmdlcyA9IGZ1bmN0aW9uIChjaG5nc09iaikge1xuICAgICAgICBpZiAodGhpcy5zdmdTZWwpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlRXhwbG9yZShmYWxzZSwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuJHBvc3RMaW5rID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLnN2Z1NlbCA9IGQzLnNlbGVjdCh0aGlzLiRlbGVtZW50WzBdKS5zZWxlY3QoJ3N2ZycpO1xuICAgICAgICB0aGlzLnN2Z1NlbC5hcHBlbmQoJ3JlY3QnKVxuICAgICAgICAgICAgLmNsYXNzZWQoJ2JhY2tncm91bmQnLCB0cnVlKVxuICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgdGhpcy5zdmdCYWNrZ3JvdW5kQ29sb3IpXG4gICAgICAgICAgICAub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX3RoaXMubGFzdENsaWNrWCA9IGQzLmV2ZW50Lm9mZnNldFg7XG4gICAgICAgICAgICBfdGhpcy5sYXN0Q2xpY2tZID0gZDMuZXZlbnQub2Zmc2V0WTtcbiAgICAgICAgICAgIF90aGlzLmZpYnJhU2VydmljZS5kaXNwYXRjaEFjdGlvbihfdGhpcy5maWJyYVNlcnZpY2UuY3JlYXRlRGlzcGxheUl0ZW0oKSk7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBDcmVhdGUgbGluayBnXG4gICAgICAgIHRoaXMuc3ZnU2VsLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ2xpbmtzJyk7XG4gICAgICAgIHRoaXMuc3VuYnVyc3QuYWRkU3VuYnVyc3RHcm91cCh0aGlzLnN2Z1NlbCk7XG4gICAgICAgIHRoaXMucmFkaXVzID0gODtcbiAgICAgICAgdGhpcy50b29sdGlwID0gZDMuc2VsZWN0KCdib2R5JykuYXBwZW5kKCdkaXYnKVxuICAgICAgICAgICAgLnN0eWxlKCdwb3NpdGlvbicsICdhYnNvbHV0ZScpXG4gICAgICAgICAgICAuc3R5bGUoJ3otaW5kZXgnLCAnMjAnKVxuICAgICAgICAgICAgLnN0eWxlKCdiYWNrZ3JvdW5kLWNvbG9yJywgJ2dyYXknKVxuICAgICAgICAgICAgLnN0eWxlKCdjb2xvcicsICd3aGl0ZScpXG4gICAgICAgICAgICAuc3R5bGUoJ3BhZGRpbmcnLCAnM3B4JylcbiAgICAgICAgICAgIC5zdHlsZSgnYm9yZGVyLXJhZGl1cycsICcycHgnKVxuICAgICAgICAgICAgLnN0eWxlKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xuICAgICAgICB0aGlzLmVkaXR0aXAgPSBkMy5zZWxlY3QoJ2JvZHknKS5hcHBlbmQoJ2RpdicpXG4gICAgICAgICAgICAuYXR0cignaWQnLCAnZWRpdHRpcCcpXG4gICAgICAgICAgICAuc3R5bGUoJ3Bvc2l0aW9uJywgJ2Fic29sdXRlJylcbiAgICAgICAgICAgIC5zdHlsZSgnei1pbmRleCcsICc0MCcpXG4gICAgICAgICAgICAuc3R5bGUoJ2JhY2tncm91bmQtY29sb3InLCAnd2hpdGUnKVxuICAgICAgICAgICAgLnN0eWxlKCdjb2xvcicsICdncmF5JylcbiAgICAgICAgICAgIC5zdHlsZSgnYm9yZGVyJywgJzFweCBzb2xpZCBncmF5JylcbiAgICAgICAgICAgIC5zdHlsZSgncGFkZGluZycsICczcHgnKVxuICAgICAgICAgICAgLnN0eWxlKCdib3JkZXItcmFkaXVzJywgJzJweCcpXG4gICAgICAgICAgICAuc3R5bGUoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgICAgIHRoaXMudXBkYXRlU2l6aW5nKCk7XG4gICAgICAgIHRoaXMucXVlcnlBbmRCdWlsZCgpO1xuICAgIH07XG4gICAgLy8gY3VycmVudGx5IGJyb2tlbiBvbiBkZWxldGluZyBhIGxpbmtcbiAgICBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuaGlnaGxpZ2h0TGlua3MgPSBmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgICBkMy5zZWxlY3RBbGwoJ2xpbmUnKS5jbGFzc2VkKCdyZWxldmFudCcsIGZhbHNlKTtcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLmxpbmtzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICB2YXIgbGlua3NvdXJjZSA9IHRoaXMubGlua3Nbal0uc291cmNlO1xuICAgICAgICAgICAgdmFyIGxpbmt0YXJnZXQgPSB0aGlzLmxpbmtzW2pdLnRhcmdldDtcbiAgICAgICAgICAgIGlmIChsaW5rc291cmNlLmluZGV4ID09PSBpIHx8IGxpbmt0YXJnZXQuaW5kZXggPT09IGkpXG4gICAgICAgICAgICAgICAgZDMuc2VsZWN0KCcjbGluay0nICsgaikuY2xhc3NlZCgncmVsZXZhbnQnLCB0cnVlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgRXhwbG9yZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLiRvbkRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudW5zdWJzY3JpYmUoKTtcbiAgICB9O1xuICAgIEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5xdWVyeUFuZEJ1aWxkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgcHJvbSA9IHRoaXMuc3BhcnFsSXRlbVNlcnZpY2UuZ2V0SXRlbXModGhpcy5maWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5jb25zdHJ1Y3QuaXRlbXMsIGZhbHNlKS50aGVuKGZ1bmN0aW9uIChpdGVtcykge1xuICAgICAgICAgICAgLy8gSWYgd2UgYXJlIHNob3dpbmcgcHJvcGVydHkgcG9wb3ZlcnMsIGhpZGUgJ2VtLlxuICAgICAgICAgICAgX3RoaXMucHJvcGVydHlQb3BvdmVyLmhpZGVQb3BvdmVyKCk7XG4gICAgICAgICAgICAvLyBMb2NrIHByZXZpb3VzIGl0ZW1zXG4gICAgICAgICAgICBfdGhpcy5sb2NrRXhpc3RpbmcoX3RoaXMucHJpbWFyeUl0ZW1zKTtcbiAgICAgICAgICAgIF90aGlzLmxvY2tFeGlzdGluZyhfdGhpcy5zZWNvbmRhcnlJdGVtcyk7XG4gICAgICAgICAgICBfdGhpcy5sb2NrRXhpc3RpbmcoX3RoaXMudGVydGlhcnlJdGVtcyk7XG4gICAgICAgICAgICB2YXIgZGlzcGxheVR5cGVzID0gX3RoaXMudHlwZXMuZGlzcGxheVR5cGVzO1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRVbnR5cGVkID0gX3RoaXMuZmlsdGVySXRlbXNCeVR5cGUoaXRlbXMsIE9XTC5UaGluZy52YWx1ZSk7XG4gICAgICAgICAgICBfdGhpcy5yZW1vdmVkVW50eXBlZEl0ZW1zID0gX3RoaXMudW50eXBlZEl0ZW1zLmZpbHRlcihmdW5jdGlvbiAoaXQpIHsgcmV0dXJuIGN1cnJlbnRVbnR5cGVkLmluZGV4T2YoaXQpID09PSAtMTsgfSk7XG4gICAgICAgICAgICBfdGhpcy51bnR5cGVkSXRlbXMgPSBfdGhpcy5tZXJnZU5vZGVzKF90aGlzLnVudHlwZWRJdGVtcywgX3RoaXMuZmlsdGVySXRlbXNCeVR5cGUoaXRlbXMsIE9XTC5UaGluZy52YWx1ZSkpO1xuICAgICAgICAgICAgaWYgKGRpc3BsYXlUeXBlc1swXSlcbiAgICAgICAgICAgICAgICBfdGhpcy5wcmltYXJ5SXRlbXMgPSBfdGhpcy5tZXJnZU5vZGVzKF90aGlzLnByaW1hcnlJdGVtcywgX3RoaXMuZmlsdGVySXRlbXNCeVR5cGUoaXRlbXMsIGRpc3BsYXlUeXBlc1swXS5pZCkpO1xuICAgICAgICAgICAgaWYgKGRpc3BsYXlUeXBlc1sxXSlcbiAgICAgICAgICAgICAgICBfdGhpcy5zZWNvbmRhcnlJdGVtcyA9IF90aGlzLm1lcmdlTm9kZXMoX3RoaXMuc2Vjb25kYXJ5SXRlbXMsIF90aGlzLmZpbHRlckl0ZW1zQnlUeXBlKGl0ZW1zLCBkaXNwbGF5VHlwZXNbMV0uaWQpKTtcbiAgICAgICAgICAgIGlmIChkaXNwbGF5VHlwZXNbMl0pXG4gICAgICAgICAgICAgICAgX3RoaXMudGVydGlhcnlJdGVtcyA9IF90aGlzLm1lcmdlTm9kZXMoX3RoaXMudGVydGlhcnlJdGVtcywgX3RoaXMuZmlsdGVySXRlbXNCeVR5cGUoaXRlbXMsIGRpc3BsYXlUeXBlc1syXS5pZCkpO1xuICAgICAgICAgICAgX3RoaXMuYWxsSXRlbXMgPSBfdGhpcy5wcmltYXJ5SXRlbXMuY29uY2F0KF90aGlzLnNlY29uZGFyeUl0ZW1zKS5jb25jYXQoX3RoaXMudGVydGlhcnlJdGVtcykuY29uY2F0KF90aGlzLnVudHlwZWRJdGVtcyk7XG4gICAgICAgICAgICBfdGhpcy5wcm9wZXJ0aWVzID0gW107XG4gICAgICAgICAgICBpZiAoX3RoaXMucHJpbWFyeUl0ZW1zWzBdICYmIF90aGlzLnByaW1hcnlJdGVtc1swXS5sb2NhbFByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gX3RoaXMucHJpbWFyeUl0ZW1zWzBdLmxvY2FsUHJvcGVydGllczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSBfYVtfaV07XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnByb3BlcnRpZXMucHVzaCh7IGtleTogcC50b0Nhbm9uaWNhbCgpLCB2YWx1ZTogcC5sYWJlbCB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBfdGhpcy5saW5rcyA9IF90aGlzLm1lcmdlTGlua3MoX3RoaXMubGlua3MpO1xuICAgICAgICAgICAgcmV0dXJuICdvayc7XG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMudXBkYXRlRXhwbG9yZSgpOyB9KTtcbiAgICAgICAgdGhpcy5maWJyYVNlcnZpY2UuZGlzcGF0Y2hBY3Rpb24odGhpcy5maWJyYVNlcnZpY2UucGxhY2VIb2xkZXJBY3Rpb24ocHJvbSkpO1xuICAgICAgICByZXR1cm4gcHJvbTtcbiAgICB9O1xuICAgIEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5sb2NrRXhpc3RpbmcgPSBmdW5jdGlvbiAobm9kZXMpIHtcbiAgICAgICAgbm9kZXMuZm9yRWFjaChmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgICAgbm9kZS5meCA9IG5vZGUuZ3g7XG4gICAgICAgICAgICBub2RlLmZ5ID0gbm9kZS5neTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuZmlsdGVySXRlbXNCeVR5cGUgPSBmdW5jdGlvbiAoaXRlbXMsIHR5cGUpIHtcbiAgICAgICAgcmV0dXJuIGl0ZW1zLmZpbHRlcihmdW5jdGlvbiAoaXQpIHtcbiAgICAgICAgICAgIHZhciB0eXBlUHJvcCA9IGl0LmxvY2FsUHJvcGVydGllcy5jb25jYXQoaXQucmVtb3RlUHJvcGVydGllcykuZmlsdGVyKGZ1bmN0aW9uIChwcikge1xuICAgICAgICAgICAgICAgIHJldHVybiBwci52YWx1ZSA9PT0gJ2h0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyN0eXBlJztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKHR5cGVQcm9wWzBdKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVQcm9wWzBdLnZhbHVlcy5tYXAoZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHYudmFsdWUudmFsdWU7IH0pLmluZGV4T2YodHlwZSkgIT09IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS51cGRhdGVTaXppbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIGFsbG93IGl0ZW1faW5mb190aXAgdG8gZXhwYW5kIHNvbWVob3dcbiAgICAgICAgLy8gYWRkIGRlbGV0ZSBhbmQgYWx0ZXIgYWJpbGl0eSB0byBzcGFycWwtaXRlbS5wdWdcbiAgICAgICAgLy8gZml4IGhvdyBsaW5rcyBzaXQgb24gdG9wIG9mIG5vZGVzXG4gICAgICAgIHZhciB2aWV3cG9ydF93aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgICAgICB2YXIgdmlld3BvcnRfaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuICAgICAgICB0aGlzLmV4cGxvcmVXaWR0aCA9IHZpZXdwb3J0X3dpZHRoO1xuICAgICAgICB0aGlzLmV4cGxvcmVIZWlnaHQgPSB2aWV3cG9ydF9oZWlnaHQgLSAzNjtcbiAgICAgICAgZDMuc2VsZWN0KHRoaXMuJGVsZW1lbnRbMF0pLnNlbGVjdCgnI2V4cGxvcmVjb250YWluZXInKVxuICAgICAgICAgICAgLnN0eWxlKCdoZWlnaHQnLCB0aGlzLmV4cGxvcmVIZWlnaHQgKyAncHgnKTtcbiAgICAgICAgLy8gbW92ZSB0YWJsZSBkb3duIHNvIHRvcCBpcyBhdCBib3R0b20gb2Ygdmlld3BvcnRcbiAgICAgICAgZDMuc2VsZWN0KHRoaXMuJGVsZW1lbnRbMF0pLnNlbGVjdCgnI2V4cGxvcmV0YWJsZScpXG4gICAgICAgICAgICAuc3R5bGUoJ2hlaWdodCcsIHZpZXdwb3J0X2hlaWdodCAtIDUwICsgJ3B4Jyk7XG4gICAgICAgIHRoaXMuc3ZnU2VsLnN0eWxlKCd3aWR0aCcsIHZpZXdwb3J0X3dpZHRoICsgJ3B4JylcbiAgICAgICAgICAgIC5zdHlsZSgnaGVpZ2h0Jywgdmlld3BvcnRfaGVpZ2h0IC0gMzYgKyAncHgnKTtcbiAgICAgICAgdGhpcy5zdmdTZWwuc2VsZWN0KCdyZWN0LmJhY2tncm91bmQnKVxuICAgICAgICAgICAgLnN0eWxlKCd3aWR0aCcsIHZpZXdwb3J0X3dpZHRoICsgJ3B4JylcbiAgICAgICAgICAgIC5zdHlsZSgnaGVpZ2h0Jywgdmlld3BvcnRfaGVpZ2h0IC0gMzYgKyAncHgnKTtcbiAgICAgICAgdmFyIHN2Z193aWR0aCA9ICt0aGlzLnN2Z1NlbC5zdHlsZSgnd2lkdGgnKS5yZXBsYWNlKCdweCcsICcnKTtcbiAgICAgICAgdmFyIHN2Z19oZWlnaHQgPSArdGhpcy5zdmdTZWwuc3R5bGUoJ2hlaWdodCcpLnJlcGxhY2UoJ3B4JywgJycpO1xuICAgIH07XG4gICAgRXhwbG9yZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmFwcGVuZE5vZGVzID0gZnVuY3Rpb24gKGVudGVyU2VsZWN0aW9uLCBjbGFzc05hbWUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIGFwcGVuZFNlbGVjdGlvbiA9IGVudGVyU2VsZWN0aW9uLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAuYXR0cignaWQnLCBmdW5jdGlvbiAoZCwgaSkgeyByZXR1cm4gJ25vZGUtJyArIGkgKyAnLScgKyBjbGFzc05hbWU7IH0pXG4gICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnbm9kZScpXG4gICAgICAgICAgICAuY2xhc3NlZChjbGFzc05hbWUsIHRydWUpXG4gICAgICAgICAgICAuYXBwZW5kKCdjaXJjbGUnKVxuICAgICAgICAgICAgLmNsYXNzZWQoJ25vZGUtY2lyY2xlJywgdHJ1ZSlcbiAgICAgICAgICAgIC5jbGFzc2VkKGNsYXNzTmFtZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5hdHRyKCdpZCcsIGZ1bmN0aW9uIChkLCBpKSB7IHJldHVybiAnbm9kZS1jaXJjbGUtJyArIGkgKyAnLScgKyBjbGFzc05hbWU7IH0pXG4gICAgICAgICAgICAuYXR0cigncicsIHRoaXMucmFkaXVzSW5pdGlhbCArICdweCcpXG4gICAgICAgICAgICAuY2FsbChkMy5kcmFnKClcbiAgICAgICAgICAgIC5vbignc3RhcnQnLCBmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgICAgICAgaWYgKCFfdGhpcy5saW5rTW9kZSkge1xuICAgICAgICAgICAgICAgIGQuZnggPSBkLng7XG4gICAgICAgICAgICAgICAgZC5meSA9IGQueTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIF90aGlzLmRyYWdsaW5lID0gX3RoaXMuc3ZnU2VsLmFwcGVuZCgnbGluZScpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdkcmFnTGluZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAgICAgLm9uKCdkcmFnJywgZnVuY3Rpb24gKGQsIGksIGdyb3VwKSB7XG4gICAgICAgICAgICBpZiAoIV90aGlzLmxpbmtNb2RlKSB7XG4gICAgICAgICAgICAgICAgZDMuc2VsZWN0KGdyb3VwW2ldKS5jbGFzc2VkKCdmaXhlZCcsIHRydWUpO1xuICAgICAgICAgICAgICAgIGQueCA9IGQzLmV2ZW50Lng7XG4gICAgICAgICAgICAgICAgZC55ID0gZDMuZXZlbnQueTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIF90aGlzLmRyYWdsaW5lLmF0dHIoJ3gxJywgZC54KVxuICAgICAgICAgICAgICAgICAgICAuYXR0cigneTEnLCBkLnkpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd4MicsIGQzLmV2ZW50LngpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd5MicsIGQzLmV2ZW50LnkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX3RoaXMudXBkYXRlRXhwbG9yZShmYWxzZSwgZmFsc2UpO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLm9uKCdlbmQnLCBmdW5jdGlvbiAoZCwgaSwgZ3JvdXApIHtcbiAgICAgICAgICAgIGlmICghX3RoaXMubGlua01vZGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWQzLnNlbGVjdChncm91cFtpXSkuY2xhc3NlZCgnZml4ZWQnKSkge1xuICAgICAgICAgICAgICAgICAgICBkLmZ4ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICBkLmZ5ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBsaW5lWF8xID0gK190aGlzLmRyYWdsaW5lLmF0dHIoJ3gyJyk7XG4gICAgICAgICAgICAgICAgdmFyIGxpbmVZXzEgPSArX3RoaXMuZHJhZ2xpbmUuYXR0cigneTInKTtcbiAgICAgICAgICAgICAgICB2YXIgbm9kZURyb3BfMSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGQzLnNlbGVjdEFsbCgnLm5vZGUnKVxuICAgICAgICAgICAgICAgICAgICAuZWFjaChmdW5jdGlvbiAoZiwgaikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMobGluZVhfMSAtIGYueCkgPCBfdGhpcy5yYWRpdXMgJiYgTWF0aC5hYnMobGluZVlfMSAtIGYueSkgPCBfdGhpcy5yYWRpdXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVEcm9wXzEgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZmlicmFTZXJ2aWNlLmRpc3BhdGNoQWN0aW9uKF90aGlzLmZpYnJhU2VydmljZS5pdGVtUHJvcGVydHkoZiwgW25ldyBQcm9wZXJ0eUFuZFZhbHVlKFNLT1MucmVsYXRlZCwgRGF0YUZhY3RvcnkuaW5zdGFuY2Uubm9kZUZyb21Ob2RlKGQpKV0sIFtdKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5kcmFnbGluZS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5xdWVyeUFuZEJ1aWxkKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoIW5vZGVEcm9wXzEpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuZHJhZ2xpbmUucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KSlcbiAgICAgICAgICAgIC5vbignbW91c2VvdmVyJywgZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgICAgIF90aGlzLmhpZ2hsaWdodExpbmtzKGQsIGkpO1xuICAgICAgICAgICAgX3RoaXMudG9vbHRpcC5zdHlsZSgndG9wJywgKGQzLmV2ZW50LnBhZ2VZIC0gMTApICsgJ3B4JylcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2xlZnQnLCAoZDMuZXZlbnQucGFnZVggKyAxMCkgKyAncHgnKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgndmlzaWJpbGl0eScsICd2aXNpYmxlJylcbiAgICAgICAgICAgICAgICAudGV4dChkLmxhYmVsKTtcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC5vbignbW91c2VvdXQnLCBmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgICAgICAgX3RoaXMuc3ZnU2VsLnNlbGVjdEFsbCgnbGluZScpLmNsYXNzZWQoJ3JlbGV2YW50JywgZmFsc2UpO1xuICAgICAgICAgICAgX3RoaXMudG9vbHRpcC5zdHlsZSgndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC5vbignY2xpY2snLCBmdW5jdGlvbiAoZCwgaSwgZ3JvdXApIHtcbiAgICAgICAgICAgIHZhciBsb2NhbFNlbGVjdGVkID0gZC5zZWxlY3RlZDtcbiAgICAgICAgICAgIC8vIFVuc2VsZWN0IGV2ZXJ5dGhpbmdcbiAgICAgICAgICAgIF90aGlzLnN2Z1NlbC5zZWxlY3RBbGwoJy5ub2RlJylcbiAgICAgICAgICAgICAgICAuZWFjaChmdW5jdGlvbiAobikgeyBuLnNlbGVjdGVkID0gZmFsc2U7IH0pO1xuICAgICAgICAgICAgLy8gRmxpcCB0aGlzIG9uZVxuICAgICAgICAgICAgZC5zZWxlY3RlZCA9ICFsb2NhbFNlbGVjdGVkO1xuICAgICAgICAgICAgX3RoaXMudXBkYXRlRXhwbG9yZShmYWxzZSk7XG4gICAgICAgICAgICBpZiAoZC5zZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgIF90aGlzLnN2Z1NlbC5zZWxlY3QoJ2cuc3VuYnVyc3Qtb3ZlcmxheScpXG4gICAgICAgICAgICAgICAgICAgIC5kYXR1bShkKVxuICAgICAgICAgICAgICAgICAgICAuZWFjaChfdGhpcy5zdW5idXJzdC5idWlsZFN1bmJ1cnN0LmJpbmQoX3RoaXMpKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIF90aGlzLnN2Z1NlbC5zZWxlY3QoJy5zdW5idXJzdC1vdmVybGF5Jykuc3R5bGUoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX3RoaXMuaGlnaGxpZ2h0TGlua3MoZCwgaSk7XG4gICAgICAgIH0pO1xuICAgICAgICBhcHBlbmRTZWxlY3Rpb25cbiAgICAgICAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgICAgICAgIC5hdHRyKCdyJywgKHRoaXMucmFkaXVzICsgdGhpcy5yYWRpdXNCb3VuY2UpICsgJ3B4JylcbiAgICAgICAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgICAgICAgIC5hdHRyKCdyJywgdGhpcy5yYWRpdXMgKyAncHgnKTtcbiAgICAgICAgcmV0dXJuIGFwcGVuZFNlbGVjdGlvbjtcbiAgICB9O1xuICAgIEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5zbmFwVG9HcmlkID0gZnVuY3Rpb24gKHgsIHksIHByaW1hcnkpIHtcbiAgICAgICAgaWYgKHByaW1hcnkgPT09IHZvaWQgMCkgeyBwcmltYXJ5ID0gdHJ1ZTsgfVxuICAgICAgICB2YXIgc3gsIHN5O1xuICAgICAgICAvLyBTbmFwIHRvIGdyaWRPZmZzZXQgd2l0aCBmdXJ0aGVyIG9mZnNldCBmb3IgbXVsdGlwbGVzXG4gICAgICAgIGlmIChwcmltYXJ5KSB7XG4gICAgICAgICAgICBzeCA9IE1hdGgucm91bmQoeCAvIHRoaXMuZ3JpZE9mZnNldCkgKiB0aGlzLmdyaWRPZmZzZXQ7XG4gICAgICAgICAgICBzeSA9IE1hdGgucm91bmQoeSAvIHRoaXMuZ3JpZE9mZnNldCkgKiB0aGlzLmdyaWRPZmZzZXQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzeCA9IE1hdGgucm91bmQoeCAvIHRoaXMuZ3JpZE9mZnNldCkgKiB0aGlzLmdyaWRPZmZzZXQgLSB0aGlzLmdyaWRPZmZzZXQgLyAyO1xuICAgICAgICAgICAgc3kgPSBNYXRoLnJvdW5kKHkgLyB0aGlzLmdyaWRPZmZzZXQpICogdGhpcy5ncmlkT2Zmc2V0IC0gdGhpcy5ncmlkT2Zmc2V0IC8gMjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW3N4LCBzeV07XG4gICAgfTtcbiAgICBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUudGlja1RyYW5zZm9ybU5vZGVzID0gZnVuY3Rpb24gKHNlbCwgcHJpbWFyeSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAocHJpbWFyeSA9PT0gdm9pZCAwKSB7IHByaW1hcnkgPSB0cnVlOyB9XG4gICAgICAgIHNlbC5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgICAgICAgdmFyIHggPSBkLngsIHkgPSBkLnk7XG4gICAgICAgICAgICBpZiAoZC54IDwgX3RoaXMucmFkaXVzKVxuICAgICAgICAgICAgICAgIHggPSBfdGhpcy5yYWRpdXM7XG4gICAgICAgICAgICBpZiAoZC55IDwgX3RoaXMucmFkaXVzKVxuICAgICAgICAgICAgICAgIHkgPSBfdGhpcy5yYWRpdXM7XG4gICAgICAgICAgICB2YXIgX2EgPSBbeCwgeV0sIGd4ID0gX2FbMF0sIGd5ID0gX2FbMV07XG4gICAgICAgICAgICBpZiAoX3RoaXMuJHNjb3BlLmxheW91dC5jaG9pY2UgPT09ICdmb3JjZWdyaWQnKSB7XG4gICAgICAgICAgICAgICAgX2IgPSBfdGhpcy5zbmFwVG9HcmlkKHgsIHksIHByaW1hcnkpLCBneCA9IF9iWzBdLCBneSA9IF9iWzFdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZC5neCA9IGd4O1xuICAgICAgICAgICAgZC5neSA9IGd5O1xuICAgICAgICAgICAgcmV0dXJuICd0cmFuc2xhdGUoJyArIGd4ICsgJywgJyArIGd5ICsgJyknO1xuICAgICAgICAgICAgdmFyIF9iO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHNlbC5maWx0ZXIoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuc2VsZWN0ZWQ7IH0pLm5vZGUoKSkge1xuICAgICAgICAgICAgdmFyIHNiRnVuY18xID0gdGhpcy5zdW5idXJzdC5idWlsZFN1bmJ1cnN0O1xuICAgICAgICAgICAgdmFyIHN2Z1NlbF8xID0gdGhpcy5zdmdTZWw7XG4gICAgICAgICAgICB2YXIgdGlja1N1bmJ1cnN0ID0gZnVuY3Rpb24gKGQsIGksIGcpIHtcbiAgICAgICAgICAgICAgICBzdmdTZWxfMS5zZWxlY3QoJ2cuc3VuYnVyc3Qtb3ZlcmxheScpLmRhdHVtKGQpLmVhY2goc2JGdW5jXzEuYmluZCh0aGlzKSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgc2VsLmZpbHRlcihmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5zZWxlY3RlZDsgfSlcbiAgICAgICAgICAgICAgICAuZWFjaCh0aWNrU3VuYnVyc3QuYmluZCh0aGlzKSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5nZW5lcmljVGljayA9IGZ1bmN0aW9uIChwcmltYXJ5Tm9kZXMsIHNlY29uZGFyeU5vZGVzLCB1bnR5cGVkTm9kZXMsIGxpbmtMaW5lcywgdHJhbnNpdGlvbikge1xuICAgICAgICBpZiAodHJhbnNpdGlvbiA9PT0gdm9pZCAwKSB7IHRyYW5zaXRpb24gPSBmYWxzZTsgfVxuICAgICAgICB2YXIgbFByaW1hcnlOb2RlcyA9IHByaW1hcnlOb2RlcztcbiAgICAgICAgdmFyIGxTZWNvbmRhcnlOb2RlcyA9IHNlY29uZGFyeU5vZGVzO1xuICAgICAgICB2YXIgbFVudHlwZWROb2RlcyA9IHVudHlwZWROb2RlcztcbiAgICAgICAgdmFyIGxMaW5rTGluZXMgPSBsaW5rTGluZXM7XG4gICAgICAgIGlmICh0cmFuc2l0aW9uKSB7XG4gICAgICAgICAgICBsUHJpbWFyeU5vZGVzID0gbFByaW1hcnlOb2Rlcy50cmFuc2l0aW9uKCk7XG4gICAgICAgICAgICBsU2Vjb25kYXJ5Tm9kZXMgPSBsU2Vjb25kYXJ5Tm9kZXMudHJhbnNpdGlvbigpO1xuICAgICAgICAgICAgbFVudHlwZWROb2RlcyA9IGxVbnR5cGVkTm9kZXMudHJhbnNpdGlvbigpO1xuICAgICAgICAgICAgbExpbmtMaW5lcyA9IGxMaW5rTGluZXMudHJhbnNpdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudGlja1RyYW5zZm9ybU5vZGVzKGxQcmltYXJ5Tm9kZXMsIHRydWUpO1xuICAgICAgICB0aGlzLnRpY2tUcmFuc2Zvcm1Ob2RlcyhsU2Vjb25kYXJ5Tm9kZXMsIGZhbHNlKTtcbiAgICAgICAgdGhpcy50aWNrVHJhbnNmb3JtTm9kZXMobFVudHlwZWROb2RlcywgZmFsc2UpO1xuICAgICAgICB0aGlzLnN2Z1NlbC5zZWxlY3RBbGwoJy5ub2RlLWNpcmNsZScpXG4gICAgICAgICAgICAuY2xhc3NlZCgnc2VsZWN0ZWQtY2lyY2xlJywgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuc2VsZWN0ZWQ7IH0pXG4gICAgICAgICAgICAuc3R5bGUoJ2N1cnNvcicsIHRoaXMubGlua01vZGUgPyAnY3Jvc3NoYWlyJyA6ICdpbml0aWFsJyk7XG4gICAgICAgIHRoaXMuc3ZnU2VsLnNlbGVjdEFsbCgnLm5vZGUtY2lyY2xlJylcbiAgICAgICAgICAgIC5jbGFzc2VkKCdsYWJlbGVkJywgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQubGFiZWwgPyB0cnVlIDogZmFsc2U7IH0pXG4gICAgICAgICAgICAuY2xhc3NlZCgndmVyaWZpZWQnLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5sb2NhbFByb3BlcnRpZXMuZmlsdGVyKGZ1bmN0aW9uIChwKSB7IHJldHVybiBwLnZhbHVlID09PSAnaHR0cDovL3d3dy53My5vcmcvMjAwMi8wNy9vd2wjc2FtZUFzJzsgfSkubGVuZ3RoID4gMDsgfSk7XG4gICAgICAgIGxMaW5rTGluZXNcbiAgICAgICAgICAgIC5hdHRyKCd4MScsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnNvdXJjZS5neDsgfSlcbiAgICAgICAgICAgIC5hdHRyKCd5MScsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnNvdXJjZS5neTsgfSlcbiAgICAgICAgICAgIC5hdHRyKCd4MicsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnRhcmdldC5neDsgfSlcbiAgICAgICAgICAgIC5hdHRyKCd5MicsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnRhcmdldC5neTsgfSk7XG4gICAgfTtcbiAgICBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUudXBkYXRlRXhwbG9yZSA9IGZ1bmN0aW9uIChydW5TaW0sIHRyYW5zaXRpb24pIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgaWYgKHJ1blNpbSA9PT0gdm9pZCAwKSB7IHJ1blNpbSA9IHRydWU7IH1cbiAgICAgICAgaWYgKHRyYW5zaXRpb24gPT09IHZvaWQgMCkgeyB0cmFuc2l0aW9uID0gZmFsc2U7IH1cbiAgICAgICAgdmFyIHVudHlwZWROb2RlcyA9IHRoaXMuc3ZnU2VsXG4gICAgICAgICAgICAuc2VsZWN0QWxsKCdjaXJjbGUudW50eXBlZCcpXG4gICAgICAgICAgICAuZGF0YSh0aGlzLnVudHlwZWRJdGVtcywgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudmFsdWU7IH0pO1xuICAgICAgICB2YXIgcHJpbWFyeU5vZGVzID0gdGhpcy5zdmdTZWxcbiAgICAgICAgICAgIC5zZWxlY3RBbGwoJ2NpcmNsZS5wcmltYXJ5JylcbiAgICAgICAgICAgIC5kYXRhKHRoaXMucHJpbWFyeUl0ZW1zLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC52YWx1ZTsgfSk7XG4gICAgICAgIHZhciBzZWNvbmRhcnlOb2RlcyA9IHRoaXMuc3ZnU2VsXG4gICAgICAgICAgICAuc2VsZWN0QWxsKCdjaXJjbGUuc2Vjb25kYXJ5JylcbiAgICAgICAgICAgIC5kYXRhKHRoaXMuc2Vjb25kYXJ5SXRlbXMsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnZhbHVlOyB9KTtcbiAgICAgICAgcHJpbWFyeU5vZGVzLmV4aXQoKS5yZW1vdmUoKTtcbiAgICAgICAgc2Vjb25kYXJ5Tm9kZXMuZXhpdCgpLnJlbW92ZSgpO1xuICAgICAgICB1bnR5cGVkTm9kZXMuZXhpdCgpLnJlbW92ZSgpO1xuICAgICAgICAvLyBVbnR5cGVkIG5vZGVzIHNob3VsZCBjb21lIGluIG9uZSBhdCBhIHRpbWUgYmFzZWQgb24gYSB1c2VyJ3MgY2xpY2sgZXZlbnQuIEZvciB0aGVzZVxuICAgICAgICAvLyB3ZSBhbHNvIHdhbnQgYXBwZW5kIHRoZSB1c2VyIGludGVyZmFjZSBmb3Igc2V0dGluZyB0eXBlIGFuZCBsYWJlbC5cbiAgICAgICAgdW50eXBlZE5vZGVzLmVudGVyKCkuZWFjaChmdW5jdGlvbiAoZGF0dW0sIGksIGcpIHtcbiAgICAgICAgICAgIGRhdHVtLnggPSBfdGhpcy5sYXN0Q2xpY2tYO1xuICAgICAgICAgICAgZGF0dW0ueSA9IF90aGlzLmxhc3RDbGlja1k7XG4gICAgICAgICAgICBkYXR1bS5meCA9IF90aGlzLmxhc3RDbGlja1g7XG4gICAgICAgICAgICBkYXR1bS5meSA9IF90aGlzLmxhc3RDbGlja1k7XG4gICAgICAgICAgICBkYXR1bS5neCA9IF90aGlzLmxhc3RDbGlja1g7XG4gICAgICAgICAgICBkYXR1bS5neSA9IF90aGlzLmxhc3RDbGlja1k7XG4gICAgICAgIH0pLmVhY2godGhpcy5wcm9wZXJ0eVBvcG92ZXIuYWRkUG9wb3Zlci5iaW5kKHRoaXMsIHRoaXMuJHNjb3BlLCB0aGlzLnN2Z1NlbCkpO1xuICAgICAgICAvLyBJZiBhIG5vZGUgd2VudCBmcm9tIGJlaW5nIHVudHlwZWQgdG8gYmVpbmcgcHJpbWFyeSBvciBzZWNvbmRhcnksIGJyaW5nIGFsb25nIGl0cyBwb3NpdGlvblxuICAgICAgICAvLyBBbHNvIGhhbmRsZSBwb3NpdGlvbiBnZXR0aW5nIHNldCBmcm9tIGEgZHJvcCAocHVsbCBwb3NpdGlvbiBmcm9tIHN0YXRlKVxuICAgICAgICB2YXIgYXBwbHlPbGRQb3NpdGlvbiA9IGZ1bmN0aW9uIChkYXR1bSkge1xuICAgICAgICAgICAgLy8gR2V0IHBvc2l0aW9uIGZyb20gc3RhdGUgaWYgaXQgd2FzIHNldCB0aGVyZS5cbiAgICAgICAgICAgIGRhdHVtLnggPSBfdGhpcy5maWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5jb25zdHJ1Y3QuaXRlbUluZGV4W2RhdHVtLnZhbHVlXS54O1xuICAgICAgICAgICAgZGF0dW0ueSA9IF90aGlzLmZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLmNvbnN0cnVjdC5pdGVtSW5kZXhbZGF0dW0udmFsdWVdLnk7XG4gICAgICAgICAgICBkYXR1bS5meCA9IF90aGlzLmZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLmNvbnN0cnVjdC5pdGVtSW5kZXhbZGF0dW0udmFsdWVdLng7XG4gICAgICAgICAgICBkYXR1bS5meSA9IF90aGlzLmZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLmNvbnN0cnVjdC5pdGVtSW5kZXhbZGF0dW0udmFsdWVdLnk7XG4gICAgICAgICAgICBkYXR1bS5neCA9IF90aGlzLmZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLmNvbnN0cnVjdC5pdGVtSW5kZXhbZGF0dW0udmFsdWVdLng7XG4gICAgICAgICAgICBkYXR1bS5neCA9IF90aGlzLmZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLmNvbnN0cnVjdC5pdGVtSW5kZXhbZGF0dW0udmFsdWVdLnk7XG4gICAgICAgICAgICAvLyBPciBpZiBub2RlIHdhcyBhbHJlYWR5IGhlcmUsIGdldCBwb3NpdGlvbiBmcm9tIG9sZCBub2RlXG4gICAgICAgICAgICB2YXIgb2xkTm9kZSA9IF90aGlzLnJlbW92ZWRVbnR5cGVkSXRlbXMuZmlsdGVyKGZ1bmN0aW9uIChpdCkgeyByZXR1cm4gaXQudmFsdWUgPT09IGRhdHVtLnZhbHVlOyB9KVswXTtcbiAgICAgICAgICAgIGlmIChvbGROb2RlKSB7XG4gICAgICAgICAgICAgICAgZGF0dW0ueCA9IG9sZE5vZGUueDtcbiAgICAgICAgICAgICAgICBkYXR1bS55ID0gb2xkTm9kZS55O1xuICAgICAgICAgICAgICAgIGRhdHVtLmZ4ID0gb2xkTm9kZS5meDtcbiAgICAgICAgICAgICAgICBkYXR1bS5meSA9IG9sZE5vZGUuZnk7XG4gICAgICAgICAgICAgICAgZGF0dW0uZ3ggPSBvbGROb2RlLmd4O1xuICAgICAgICAgICAgICAgIGRhdHVtLmd5ID0gb2xkTm9kZS5neTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcHJpbWFyeU5vZGVzLmVudGVyKCkuZWFjaChhcHBseU9sZFBvc2l0aW9uKTtcbiAgICAgICAgc2Vjb25kYXJ5Tm9kZXMuZW50ZXIoKS5lYWNoKGFwcGx5T2xkUG9zaXRpb24pO1xuICAgICAgICBwcmltYXJ5Tm9kZXMgPSBwcmltYXJ5Tm9kZXMubWVyZ2UodGhpcy5hcHBlbmROb2RlcyhwcmltYXJ5Tm9kZXMuZW50ZXIoKSwgJ3ByaW1hcnknKSk7XG4gICAgICAgIHNlY29uZGFyeU5vZGVzID0gc2Vjb25kYXJ5Tm9kZXMubWVyZ2UodGhpcy5hcHBlbmROb2RlcyhzZWNvbmRhcnlOb2Rlcy5lbnRlcigpLCAnc2Vjb25kYXJ5JykpO1xuICAgICAgICB1bnR5cGVkTm9kZXMgPSB1bnR5cGVkTm9kZXMubWVyZ2UodGhpcy5hcHBlbmROb2Rlcyh1bnR5cGVkTm9kZXMuZW50ZXIoKSwgJ3VudHlwZWQnKSk7XG4gICAgICAgIHZhciBsaW5rTGluZXMgPSB0aGlzLnN2Z1NlbFxuICAgICAgICAgICAgLnNlbGVjdCgnZy5saW5rcycpXG4gICAgICAgICAgICAuc2VsZWN0QWxsKCdsaW5lJylcbiAgICAgICAgICAgIC5kYXRhKHRoaXMubGlua3MpO1xuICAgICAgICBsaW5rTGluZXMuZXhpdCgpLnJlbW92ZSgpO1xuICAgICAgICBsaW5rTGluZXMgPSBsaW5rTGluZXNcbiAgICAgICAgICAgIC5lbnRlcigpLmFwcGVuZCgnbGluZScpXG4gICAgICAgICAgICAuYXR0cignaWQnLCBmdW5jdGlvbiAoZCwgaSkgeyByZXR1cm4gJ2xpbmstJyArIGk7IH0pXG4gICAgICAgICAgICAub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uIChkLCBpKSB7XG4gICAgICAgICAgICBfdGhpcy50b29sdGlwLnN0eWxlKCd0b3AnLCAoZDMuZXZlbnQucGFnZVkgLSAxMCkgKyAncHgnKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnbGVmdCcsIChkMy5ldmVudC5wYWdlWCArIDEwKSArICdweCcpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCd2aXNpYmlsaXR5JywgJ3Zpc2libGUnKVxuICAgICAgICAgICAgICAgIC50ZXh0KGQucHJvcGVydHkubGFiZWwpO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLm9uKCdtb3VzZW91dCcsIGZ1bmN0aW9uIChkLCBpKSB7XG4gICAgICAgICAgICBfdGhpcy50b29sdGlwLnN0eWxlKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLm1lcmdlKGxpbmtMaW5lcylcbiAgICAgICAgICAgIC5zdHlsZSgndmlzaWJpbGl0eScsIHRoaXMuJHNjb3BlLmxheW91dC5saW5rcyA9PT0gJ3Nob3cnID8gJ3Zpc2libGUnIDogJ2hpZGRlbicpO1xuICAgICAgICAvLyBBZGQgc3VuYnVyc3QgYWdhaW4gc28gaXQgc3RheXMgb24gdG9wXG4gICAgICAgIHRoaXMuc3VuYnVyc3QuYWRkU3VuYnVyc3RHcm91cCh0aGlzLnN2Z1NlbCk7XG4gICAgICAgIHRoaXMuZ2VuZXJpY1RpY2socHJpbWFyeU5vZGVzLCBzZWNvbmRhcnlOb2RlcywgdW50eXBlZE5vZGVzLCBsaW5rTGluZXMsIHRyYW5zaXRpb24pO1xuICAgICAgICByZXR1cm4gdGhpcy4kcS5yZXNvbHZlKCdvaycpO1xuICAgIH07XG4gICAgRXhwbG9yZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLm1hcFZlcmlmeVRvVGhpcyA9IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdmVyaWZ5OiBzdGF0ZS52ZXJpZnlcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5tYXBUeXBlc1RvVGhpcyA9IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZXM6IHN0YXRlLnR5cGVzXG4gICAgICAgIH07XG4gICAgfTtcbiAgICBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUubWVyZ2VOb2RlcyA9IGZ1bmN0aW9uIChvbGROb2Rlcywgbm9kZXMpIHtcbiAgICAgICAgdmFyIG5ld05vZGVzID0gW107XG4gICAgICAgIC8vIENoZWNrIGlmIG9sZCBub2RlcyBhcmUgc3RpbGwgaW4gdGhlIG1peFxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9sZE5vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG5vZGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9sZE5vZGVzW2ldLnRvQ2Fub25pY2FsKCkgPT09IG5vZGVzW2pdLnRvQ2Fub25pY2FsKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3Tm9kZXMucHVzaChvbGROb2Rlc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gZ3JhYiBuZXcgbm9kZSBpbmZvcm1hdGlvbiBsaWtlIGxhYmVscyBhbmQgcHJvcHMgaW4gY2FzZSBpdCdzIGNoYW5nZWRcbiAgICAgICAgICAgICAgICAgICAgb2xkTm9kZXNbaV0ubGFiZWwgPSBub2Rlc1tqXS5sYWJlbDtcbiAgICAgICAgICAgICAgICAgICAgb2xkTm9kZXNbaV0ubG9jYWxQcm9wZXJ0aWVzID0gbm9kZXNbal0ubG9jYWxQcm9wZXJ0aWVzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBBZGQgdGhlIG5ldyBub2Rlc1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgY2hlY2sgPSBmYWxzZTtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbmV3Tm9kZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBpZiAobmV3Tm9kZXNbal0udG9DYW5vbmljYWwoKSA9PT0gbm9kZXNbaV0udG9DYW5vbmljYWwoKSlcbiAgICAgICAgICAgICAgICAgICAgY2hlY2sgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFjaGVjaykge1xuICAgICAgICAgICAgICAgIG5ld05vZGVzLnB1c2gobm9kZXNbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXdOb2RlcztcbiAgICB9O1xuICAgIEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5tZXJnZUxpbmtzID0gZnVuY3Rpb24gKG9sZExpbmtzKSB7XG4gICAgICAgIHZhciBuZXdMaW5rcyA9IFtdO1xuICAgICAgICB2YXIgaXRlbXMgPSB0aGlzLnByaW1hcnlJdGVtcy5jb25jYXQodGhpcy5zZWNvbmRhcnlJdGVtcyk7XG4gICAgICAgIHZhciBzYW1lQXMgPSBuZXcgRU5vZGVNYXAoKTtcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBpdGVtc18xID0gaXRlbXM7IF9pIDwgaXRlbXNfMS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgIHZhciBpdGVtID0gaXRlbXNfMVtfaV07XG4gICAgICAgICAgICBzYW1lQXMuc2V0KGl0ZW0sIGl0ZW0pO1xuICAgICAgICAgICAgdmFyIHNhbWVBc1Byb3AgPSBpdGVtLmxvY2FsUHJvcGVydGllcy5maWx0ZXIoZnVuY3Rpb24gKHApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gT1dMLnNhbWVBcy5lcXVhbHMocCk7XG4gICAgICAgICAgICB9KVswXTtcbiAgICAgICAgICAgIGlmIChzYW1lQXNQcm9wICYmIHNhbWVBc1Byb3AudmFsdWVzKVxuICAgICAgICAgICAgICAgIGZvciAodmFyIF9hID0gMCwgX2IgPSBzYW1lQXNQcm9wLnZhbHVlczsgX2EgPCBfYi5sZW5ndGg7IF9hKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSBfYltfYV07XG4gICAgICAgICAgICAgICAgICAgIHNhbWVBcy5zZXQobi52YWx1ZSwgaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIEl0ZXJhdGUgb3ZlciBpdGVtIHByb3BlcnR5IHZhbHVlcyB0byBzZWUgaWYgdGhleSBtYXRjaCB0aGUgaWQgb2YgYW55XG4gICAgICAgIC8vIG9mIHRoZSBpdGVtcyBkaXNwbGF5ZWQuIEFsc28gY2hlY2sgaWYgdGhleSBtYXRjaCBzYW1lQXMgdmFsdWVzLi4uXG4gICAgICAgIGZvciAodmFyIF9jID0gMCwgaXRlbXNfMiA9IGl0ZW1zOyBfYyA8IGl0ZW1zXzIubGVuZ3RoOyBfYysrKSB7XG4gICAgICAgICAgICB2YXIgaXRlbSA9IGl0ZW1zXzJbX2NdO1xuICAgICAgICAgICAgZm9yICh2YXIgX2QgPSAwLCBfZSA9IGl0ZW0ubG9jYWxQcm9wZXJ0aWVzOyBfZCA8IF9lLmxlbmd0aDsgX2QrKykge1xuICAgICAgICAgICAgICAgIHZhciBwID0gX2VbX2RdO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIF9mID0gMCwgX2cgPSBwLnZhbHVlczsgX2YgPCBfZy5sZW5ndGg7IF9mKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHYgPSBfZ1tfZl07XG4gICAgICAgICAgICAgICAgICAgIGlmIChzYW1lQXMuaGFzKHYudmFsdWUpICYmIGl0ZW0gIT09IHNhbWVBcy5nZXQodi52YWx1ZSkgJiYgaXRlbXMuaW5kZXhPZihzYW1lQXMuZ2V0KHYudmFsdWUpKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0xpbmtzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZTogaXRlbSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IHNhbWVBcy5nZXQodi52YWx1ZSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHk6IHBcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXdMaW5rcztcbiAgICB9O1xuICAgIHJldHVybiBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlcjtcbn0oKSk7XG52YXIgRXhwbG9yZUNvbXBvbmVudCA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRXhwbG9yZUNvbXBvbmVudCgpIHtcbiAgICAgICAgdGhpcy5iaW5kaW5ncyA9IHtcbiAgICAgICAgICAgIGxpbmtNb2RlOiAnPCcsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY29udHJvbGxlciA9IEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyOyAvLyAobmV3ICguLi5hcmdzOiBhbnlbXSkgPT4gYW5ndWxhci5JQ29udHJvbGxlcikgPSBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlclxuICAgICAgICB0aGlzLnRlbXBsYXRlID0gcmVxdWlyZSgnLi9leHBsb3JlLnB1ZycpKCk7XG4gICAgfVxuICAgIHJldHVybiBFeHBsb3JlQ29tcG9uZW50O1xufSgpKTtcbmV4cG9ydCB7IEV4cGxvcmVDb21wb25lbnQgfTtcbmFuZ3VsYXIubW9kdWxlKCdmaWJyYS5jb21wb25lbnRzLmV4cGxvcmUnLCBbJ2ZpYnJhLnNlcnZpY2VzJ10pXG4gICAgLmNvbXBvbmVudCgnZXhwbG9yZScsIG5ldyBFeHBsb3JlQ29tcG9uZW50KCkpO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGFwcC9jb21wb25lbnRzL2NvbnN0cnVjdC12aWV3L2V4cGxvcmUtY29tcG9uZW50LnRzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFRQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUVBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQU1BO0FBQUE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUlBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFJQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUVBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFFQTtBQUFBO0FBQ0E7QUFFQTtBQUFBO0FBQ0E7QUFFQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUVBO0FBQUE7QUFFQTtBQUlBO0FBRUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),

/***/ "./app/components/construct-view/explore-type-component/explore-type-component.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__actions_types__ = __webpack_require__(\"./app/actions/types.ts\");\n/* unused harmony export ExploreTypeComponentController */\n/* unused harmony export ExploreTypeComponent */\n\n\n\n\nvar ExploreTypeComponentController = function () {\n    function ExploreTypeComponentController(fibraService, $ngRedux) {\n        this.fibraService = fibraService;\n        this.$ngRedux = $ngRedux;\n        this.unsubscribe = $ngRedux.connect(this.mapStateToThis, __WEBPACK_IMPORTED_MODULE_1__actions_types__)(this);\n        this.fibraService = fibraService;\n    }\n    ExploreTypeComponentController.prototype.primaryClick = function (type) {\n        var newTypes = this.types.displayTypes.concat([]);\n        newTypes[0] = type;\n        this.setOrderedTypes(newTypes);\n        this.fibraService.dispatch('change');\n    };\n    ExploreTypeComponentController.prototype.secondaryClick = function (type) {\n        var newTypes = this.types.displayTypes.concat([]);\n        newTypes[1] = type;\n        this.setOrderedTypes(newTypes);\n        this.fibraService.dispatch('change');\n    };\n    ExploreTypeComponentController.prototype.tertiaryClick = function (type) {\n        var newTypes = this.types.displayTypes.concat([]);\n        newTypes[2] = type;\n        this.setOrderedTypes(newTypes);\n        this.fibraService.dispatch('change');\n    };\n    ExploreTypeComponentController.prototype.$onDestroy = function () {\n        this.unsubscribe();\n    };\n    ExploreTypeComponentController.prototype.mapStateToThis = function (state) {\n        return {\n            types: state.types\n        };\n    };\n    return ExploreTypeComponentController;\n}();\n\nvar ExploreTypeComponent = function () {\n    function ExploreTypeComponent() {\n        this.template = __webpack_require__(\"./app/components/construct-view/explore-type-component/explore-type-component.pug\")();\n        this.controller = ExploreTypeComponentController;\n    }\n    return ExploreTypeComponent;\n}();\n\n__WEBPACK_IMPORTED_MODULE_0_angular__[\"module\"]('fibra.components.explore-type', ['fibra.services']).component('exploreType', new ExploreTypeComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9leHBsb3JlLXR5cGUtY29tcG9uZW50L2V4cGxvcmUtdHlwZS1jb21wb25lbnQudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL2NvbXBvbmVudHMvY29uc3RydWN0LXZpZXcvZXhwbG9yZS10eXBlLWNvbXBvbmVudC9leHBsb3JlLXR5cGUtY29tcG9uZW50LnRzPzBhY2YiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuaW1wb3J0ICogYXMgYW5ndWxhciBmcm9tICdhbmd1bGFyJztcbmltcG9ydCAqIGFzIFR5cGVBY3Rpb25zIGZyb20gJy4uLy4uLy4uL2FjdGlvbnMvdHlwZXMnO1xudmFyIEV4cGxvcmVUeXBlQ29tcG9uZW50Q29udHJvbGxlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRXhwbG9yZVR5cGVDb21wb25lbnRDb250cm9sbGVyKGZpYnJhU2VydmljZSwgJG5nUmVkdXgpIHtcbiAgICAgICAgdGhpcy5maWJyYVNlcnZpY2UgPSBmaWJyYVNlcnZpY2U7XG4gICAgICAgIHRoaXMuJG5nUmVkdXggPSAkbmdSZWR1eDtcbiAgICAgICAgdGhpcy51bnN1YnNjcmliZSA9ICRuZ1JlZHV4LmNvbm5lY3QodGhpcy5tYXBTdGF0ZVRvVGhpcywgVHlwZUFjdGlvbnMpKHRoaXMpO1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZSA9IGZpYnJhU2VydmljZTtcbiAgICB9XG4gICAgRXhwbG9yZVR5cGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5wcmltYXJ5Q2xpY2sgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICB2YXIgbmV3VHlwZXMgPSB0aGlzLnR5cGVzLmRpc3BsYXlUeXBlcy5jb25jYXQoW10pO1xuICAgICAgICBuZXdUeXBlc1swXSA9IHR5cGU7XG4gICAgICAgIHRoaXMuc2V0T3JkZXJlZFR5cGVzKG5ld1R5cGVzKTtcbiAgICAgICAgdGhpcy5maWJyYVNlcnZpY2UuZGlzcGF0Y2goJ2NoYW5nZScpO1xuICAgIH07XG4gICAgRXhwbG9yZVR5cGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5zZWNvbmRhcnlDbGljayA9IGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICAgIHZhciBuZXdUeXBlcyA9IHRoaXMudHlwZXMuZGlzcGxheVR5cGVzLmNvbmNhdChbXSk7XG4gICAgICAgIG5ld1R5cGVzWzFdID0gdHlwZTtcbiAgICAgICAgdGhpcy5zZXRPcmRlcmVkVHlwZXMobmV3VHlwZXMpO1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZS5kaXNwYXRjaCgnY2hhbmdlJyk7XG4gICAgfTtcbiAgICBFeHBsb3JlVHlwZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLnRlcnRpYXJ5Q2xpY2sgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICB2YXIgbmV3VHlwZXMgPSB0aGlzLnR5cGVzLmRpc3BsYXlUeXBlcy5jb25jYXQoW10pO1xuICAgICAgICBuZXdUeXBlc1syXSA9IHR5cGU7XG4gICAgICAgIHRoaXMuc2V0T3JkZXJlZFR5cGVzKG5ld1R5cGVzKTtcbiAgICAgICAgdGhpcy5maWJyYVNlcnZpY2UuZGlzcGF0Y2goJ2NoYW5nZScpO1xuICAgIH07XG4gICAgRXhwbG9yZVR5cGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS4kb25EZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlKCk7XG4gICAgfTtcbiAgICBFeHBsb3JlVHlwZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLm1hcFN0YXRlVG9UaGlzID0gZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlczogc3RhdGUudHlwZXNcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIHJldHVybiBFeHBsb3JlVHlwZUNvbXBvbmVudENvbnRyb2xsZXI7XG59KCkpO1xuZXhwb3J0IHsgRXhwbG9yZVR5cGVDb21wb25lbnRDb250cm9sbGVyIH07XG52YXIgRXhwbG9yZVR5cGVDb21wb25lbnQgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEV4cGxvcmVUeXBlQ29tcG9uZW50KCkge1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gcmVxdWlyZSgnLi9leHBsb3JlLXR5cGUtY29tcG9uZW50LnB1ZycpKCk7XG4gICAgICAgIHRoaXMuY29udHJvbGxlciA9IEV4cGxvcmVUeXBlQ29tcG9uZW50Q29udHJvbGxlcjtcbiAgICB9XG4gICAgcmV0dXJuIEV4cGxvcmVUeXBlQ29tcG9uZW50O1xufSgpKTtcbmV4cG9ydCB7IEV4cGxvcmVUeXBlQ29tcG9uZW50IH07XG5hbmd1bGFyLm1vZHVsZSgnZmlicmEuY29tcG9uZW50cy5leHBsb3JlLXR5cGUnLCBbJ2ZpYnJhLnNlcnZpY2VzJ10pXG4gICAgLmNvbXBvbmVudCgnZXhwbG9yZVR5cGUnLCBuZXcgRXhwbG9yZVR5cGVDb21wb25lbnQoKSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL2NvbXBvbmVudHMvY29uc3RydWN0LXZpZXcvZXhwbG9yZS10eXBlLWNvbXBvbmVudC9leHBsb3JlLXR5cGUtY29tcG9uZW50LnRzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),

/***/ "./app/components/construct-view/palette-component/palette-component.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_d3__ = __webpack_require__(\"./app/bower_components/d3/d3.js\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_d3___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_d3__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__models_rdf__ = __webpack_require__(\"./app/models/rdf.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__actions_types__ = __webpack_require__(\"./app/actions/types.ts\");\n/* unused harmony export PaletteComponentController */\n/* unused harmony export PaletteComponent */\n\n\n\n\n\n\nvar PaletteComponentController = function () {\n    function PaletteComponentController(fibraService, $element, sparqlItemService, sparqlTreeService, $q, $ngRedux, FileSaver) {\n        this.fibraService = fibraService;\n        this.$element = $element;\n        this.sparqlItemService = sparqlItemService;\n        this.sparqlTreeService = sparqlTreeService;\n        this.$q = $q;\n        this.$ngRedux = $ngRedux;\n        this.FileSaver = FileSaver;\n        this.paletteSearchHeight = 40;\n        this.typeColorScale = __WEBPACK_IMPORTED_MODULE_0_d3__[\"scaleOrdinal\"](__WEBPACK_IMPORTED_MODULE_0_d3__[\"schemeCategory20c\"]);\n        this.labelFilter = '';\n        this.typeItemTree = __WEBPACK_IMPORTED_MODULE_0_d3__[\"map\"]();\n        this.unsubscribe = $ngRedux.connect(this.mapStateToThis, __WEBPACK_IMPORTED_MODULE_3__actions_types__)(this);\n        this.typeItemTree.set('', {\n            label: 'No type defined',\n            items: [],\n            expanded: false\n        });\n        this.query();\n    }\n    PaletteComponentController.prototype.$onDestroy = function () {\n        this.unsubscribe();\n    };\n    PaletteComponentController.prototype.query = function () {\n        var _this = this;\n        return this.typeItemTreePromise = this.sparqlItemService.getAllItems().then(function (items) {\n            return _this.mergeItems(_this.items, items);\n        });\n    };\n    PaletteComponentController.prototype.$postLink = function () {\n        var _this = this;\n        this.divSel = __WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"](this.$element[0]).select('div.palette');\n        this.nodeDrag = __WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"](this.$element[0]).select('.palette-node-drag');\n        this.nodeDrag.style('display', 'none');\n        this.nodeDrag.append('circle');\n        this.divSel.style('height', '100%').style('width', '100%');\n        this.tooltip = __WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"]('body').append('div').style('position', 'absolute').style('z-index', '20').style('background-color', 'gray').style('color', 'white').style('padding', '3px').style('border-radius', '2px').style('visibility', 'hidden');\n        var onChangeFunction = function () {\n            return _this.query().then(_this.build.bind(_this)).then(function () {\n                return 'Done';\n            });\n        };\n        this.fibraService.on('change', onChangeFunction);\n        this.typeItemTreePromise.then(function (itemTree) {\n            _this.build.bind(_this)(itemTree);\n        });\n    };\n    PaletteComponentController.prototype.addItem = function (item, coordinates) {\n        var _this = this;\n        var itemTypeKey = item.typeValue;\n        var itemType = this.types.types.filter(function (t) {\n            return t.id === itemTypeKey;\n        })[0];\n        var chosenTypes = this.types.displayTypes;\n        if (!chosenTypes[0] && itemType) {\n            this.setOrderedTypes([itemType]);\n        } else if (!chosenTypes[1] && itemType && chosenTypes[0] !== itemType) {\n            var newTypes = chosenTypes.concat([]);\n            newTypes.push(itemType);\n            this.setOrderedTypes(newTypes);\n        }\n        return this.fibraService.dispatchAction(this.fibraService.displayItem(item, coordinates)).then(function (state) {\n            _this.fibraService.dispatch('change');\n            return state;\n        });\n    };\n    PaletteComponentController.prototype.createItem = function (label) {\n        var _this = this;\n        var node = __WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"b\" /* DataFactory */].instance.namedNode(label);\n        this.fibraService.dispatchAction(this.fibraService.createItem(node)).then(function () {\n            _this.query().then(function (items) {\n                _this.build.bind(_this)(items);\n            });\n        });\n    };\n    PaletteComponentController.prototype.downloadCSV = function (datum) {\n        var blob = new Blob([__WEBPACK_IMPORTED_MODULE_0_d3__[\"csvFormat\"](datum.value.items.map(function (d) {\n            var sameAs = d.localProperties.filter(function (p) {\n                return p.value === __WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"d\" /* OWL */].sameAs.value;\n            })[0];\n            var prefLabel = d.localProperties.filter(function (p) {\n                return p.value === __WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"a\" /* SKOS */].prefLabel.value;\n            })[0];\n            return _a = {}, _a[__WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"a\" /* SKOS */].prefLabel.value] = prefLabel ? prefLabel.values[0].value.value : '', _a.FibraId = d.value, _a.Match = sameAs ? sameAs.values[0].value.value : '', _a;\n            var _a;\n        }), [__WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"a\" /* SKOS */].prefLabel.value, 'FibraId', 'Match'])], { type: 'application/csv;charset=utf-8' });\n        var filename = datum.value.label + '.csv';\n        this.FileSaver.saveAs(blob, filename);\n    };\n    PaletteComponentController.prototype.build = function (itemTree) {\n        var _this = this;\n        this.updateSizing();\n        console.log(itemTree.entries());\n        var itemTreeFiltered = itemTree.entries().filter(function (d) {\n            return d.key !== '';\n        });\n        var items = itemTreeFiltered.reduce(function (a, b) {\n            return a.concat(b.value.items);\n        }, []);\n        var padding = items.length > 300 ? items.length > 2000 ? 1 : 2 : 4;\n        var paletteHeightLessTypes = this.paletteHeight - itemTreeFiltered.length * 25;\n        var rawRadius = (Math.sqrt(this.paletteWidth * paletteHeightLessTypes / items.length) - padding) / 2;\n        var radius = rawRadius > 8 ? 8 : rawRadius;\n        var xOffset = radius * 2 + padding / 2;\n        var yOffset = radius * 2 + padding / 2;\n        var xDots = Math.floor(this.paletteWidth / xOffset) - 1;\n        // Bring the node drag SVG and the addItem function local\n        var nodeDrag = this.nodeDrag;\n        var addItem = this.addItem.bind(this);\n        var paletteWidth = this.paletteWidth;\n        this.typesD3 = this.divSel.selectAll('div.type').data(itemTreeFiltered, function (d) {\n            return d.key;\n        });\n        this.typesD3.exit().remove();\n        var typesDivsEnter = this.typesD3.enter().append('div').classed('type', true).classed('inverse-icon', true).text(function (d) {\n            return d.value.label;\n        });\n        typesDivsEnter.append('span').classed('glyphicon', true).classed('glyphicon-download', true).on('click', function (d) {\n            return _this.downloadCSV(d);\n        });\n        typesDivsEnter.append('span').classed('glyphicon', true).classed('expand-button', true).on('click', function (d) {\n            d.value.expanded = !d.value.expanded;\n            _this.typeItemTreePromise.then(_this.build.bind(_this));\n        });\n        typesDivsEnter.append('svg').attr('width', '100%');\n        this.typesD3 = typesDivsEnter.merge(this.typesD3);\n        this.typesD3.selectAll('.expand-button').classed('glyphicon-resize-small', function (d) {\n            return d.value.expanded;\n        }).classed('glyphicon-resize-full', function (d) {\n            return !d.value.expanded;\n        });\n        this.typesD3.selectAll('svg').style('display', function (d) {\n            return d.value.expanded ? 'block' : 'none';\n        });\n        var typeSvgs = this.typesD3.select('svg').attr('height', function (d) {\n            return (Math.ceil(d.value.items.length / xDots) + 1) * yOffset;\n        });\n        this.circles = typeSvgs.selectAll('circle.item').data(function (d) {\n            return d.value.items;\n        }, function (d) {\n            return d.value;\n        });\n        this.circles.exit().remove();\n        this.circles = this.circles.enter().append('circle').classed('item', true).attr('r', radius).on('mouseover', function (d, i) {\n            _this.tooltip.style('top', __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].pageY - 10 + 'px').style('left', __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].pageX + 10 + 'px').style('visibility', 'visible').text(d.label + ' (' + d.typeLabel + ')');\n        }).on('mouseout', function (d, i) {\n            _this.tooltip.style('visibility', 'hidden');\n        }).call(__WEBPACK_IMPORTED_MODULE_0_d3__[\"drag\"]().on('start', function (d) {\n            var thisCircle = __WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"](this);\n            nodeDrag.style('display', 'block');\n            nodeDrag.select('circle').classed('item', thisCircle.classed('item')).attr('r', thisCircle.attr('r')).attr('fill', thisCircle.attr('fill')).attr('transform', 'translate(8,8)');\n            nodeDrag.style('left', __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientX - 8).style('top', __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientY - 8);\n        }).on('drag', function (d) {\n            nodeDrag.style('left', __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientX - 8).style('top', __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientY - 8);\n        }).on('end', function (d) {\n            // If the cursor is on the canvas, display\n            var exploreContainer = __WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"]('#explorecontainer').node();\n            if (__WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientX > exploreContainer.getBoundingClientRect().left && __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientX < exploreContainer.getBoundingClientRect().right && __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientY > exploreContainer.getBoundingClientRect().top && __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientY < exploreContainer.getBoundingClientRect().bottom) {\n                addItem(__WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"](this).datum(), [__WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientX - exploreContainer.getBoundingClientRect().left, __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientY - exploreContainer.getBoundingClientRect().top]).then(function () {\n                    nodeDrag.style('display', 'none');\n                });\n            } else {\n                nodeDrag.style('display', 'none');\n            }\n        })).merge(this.circles).call(this.update.bind(this));\n        this.circles.transition().attr('fill', function (d) {\n            return _this.typeColorScale(d.typeValue);\n        }).attr('transform', function (d, i) {\n            return 'translate(' + (i % xDots + 1) * xOffset + ',' + (Math.floor(i / xDots) + 1) * yOffset + ')';\n        });\n    };\n    PaletteComponentController.prototype.update = function (circles) {\n        var _this = this;\n        var c = circles ? circles : this.circles;\n        c.classed('displayed', function (d) {\n            return _this.fibraService.getState().construct.itemIndex[d.value] ? true : false;\n        }).classed('filtered', function (d) {\n            return _this.labelFilter && !(d.label.toUpperCase().indexOf(_this.labelFilter.toUpperCase()) !== -1);\n        });\n    };\n    PaletteComponentController.prototype.mapStateToThis = function (state) {\n        return {\n            types: state.types\n        };\n    };\n    PaletteComponentController.prototype.updateSizing = function () {\n        this.paletteWidth = Math.round(window.innerWidth * 0.15); // this.svgSel.node().clientWidth\n        this.paletteHeight = Math.round(window.innerHeight) - this.paletteSearchHeight;\n        this.divSel.style('height', this.paletteHeight + 'px');\n    };\n    PaletteComponentController.prototype.mergeItems = function (oldItems, newItems) {\n        var _this = this;\n        // Wipe old items (bad, but temporary)\n        this.typeItemTree.values().forEach(function (v) {\n            v.items = [];\n        });\n        newItems.forEach(function (item) {\n            var typeProp = item.localProperties.filter(function (p) {\n                return p.value === __WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"c\" /* RDF */].type.value;\n            })[0];\n            if (typeProp && typeProp.values[0]) {\n                item.typeValue = typeProp.values[0].value.value;\n                item.typeLabel = typeProp.values[0].value.label;\n                // Add type to the type map\n                if (!_this.typeItemTree.has(item.typeValue)) {\n                    _this.typeItemTree.set(item.typeValue, {\n                        label: item.typeLabel,\n                        items: [item],\n                        expanded: true\n                    });\n                } else {\n                    _this.typeItemTree.get(item.typeValue).items.push(item);\n                }\n            } else {\n                item.typeValue = '';\n                item.typeLabel = 'No type defined';\n            }\n        });\n        // Sort by label\n        this.typeItemTree.values().forEach(function (v) {\n            v.items.sort(function (a, b) {\n                return a.label === b.label ? 0 : a.label > b.label ? 1 : -1;\n            });\n        });\n        return this.typeItemTree;\n    };\n    return PaletteComponentController;\n}();\n\nvar PaletteComponent = function () {\n    function PaletteComponent() {\n        this.template = __webpack_require__(\"./app/components/construct-view/palette-component/palette-component.pug\")();\n        this.controller = PaletteComponentController;\n    }\n    return PaletteComponent;\n}();\n\n__WEBPACK_IMPORTED_MODULE_2_angular__[\"module\"]('fibra.components.palette', ['fibra.services']).component('palette', new PaletteComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9wYWxldHRlLWNvbXBvbmVudC9wYWxldHRlLWNvbXBvbmVudC50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9wYWxldHRlLWNvbXBvbmVudC9wYWxldHRlLWNvbXBvbmVudC50cz83M2FiIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmltcG9ydCAqIGFzIGQzIGZyb20gJ2QzJztcbmltcG9ydCB7IERhdGFGYWN0b3J5LCBTS09TLCBPV0wsIFJERiB9IGZyb20gJy4uLy4uLy4uL21vZGVscy9yZGYnO1xuaW1wb3J0ICogYXMgYW5ndWxhciBmcm9tICdhbmd1bGFyJztcbmltcG9ydCAqIGFzIFR5cGVBY3Rpb25zIGZyb20gJy4uLy4uLy4uL2FjdGlvbnMvdHlwZXMnO1xudmFyIFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBQYWxldHRlQ29tcG9uZW50Q29udHJvbGxlcihmaWJyYVNlcnZpY2UsICRlbGVtZW50LCBzcGFycWxJdGVtU2VydmljZSwgc3BhcnFsVHJlZVNlcnZpY2UsICRxLCAkbmdSZWR1eCwgRmlsZVNhdmVyKSB7XG4gICAgICAgIHRoaXMuZmlicmFTZXJ2aWNlID0gZmlicmFTZXJ2aWNlO1xuICAgICAgICB0aGlzLiRlbGVtZW50ID0gJGVsZW1lbnQ7XG4gICAgICAgIHRoaXMuc3BhcnFsSXRlbVNlcnZpY2UgPSBzcGFycWxJdGVtU2VydmljZTtcbiAgICAgICAgdGhpcy5zcGFycWxUcmVlU2VydmljZSA9IHNwYXJxbFRyZWVTZXJ2aWNlO1xuICAgICAgICB0aGlzLiRxID0gJHE7XG4gICAgICAgIHRoaXMuJG5nUmVkdXggPSAkbmdSZWR1eDtcbiAgICAgICAgdGhpcy5GaWxlU2F2ZXIgPSBGaWxlU2F2ZXI7XG4gICAgICAgIHRoaXMucGFsZXR0ZVNlYXJjaEhlaWdodCA9IDQwO1xuICAgICAgICB0aGlzLnR5cGVDb2xvclNjYWxlID0gZDMuc2NhbGVPcmRpbmFsKGQzLnNjaGVtZUNhdGVnb3J5MjBjKTtcbiAgICAgICAgdGhpcy5sYWJlbEZpbHRlciA9ICcnO1xuICAgICAgICB0aGlzLnR5cGVJdGVtVHJlZSA9IGQzLm1hcCgpO1xuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlID0gJG5nUmVkdXguY29ubmVjdCh0aGlzLm1hcFN0YXRlVG9UaGlzLCBUeXBlQWN0aW9ucykodGhpcyk7XG4gICAgICAgIHRoaXMudHlwZUl0ZW1UcmVlLnNldCgnJywge1xuICAgICAgICAgICAgbGFiZWw6ICdObyB0eXBlIGRlZmluZWQnLFxuICAgICAgICAgICAgaXRlbXM6IFtdLFxuICAgICAgICAgICAgZXhwYW5kZWQ6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnF1ZXJ5KCk7XG4gICAgfVxuICAgIFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS4kb25EZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlKCk7XG4gICAgfTtcbiAgICBQYWxldHRlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUucXVlcnkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHJldHVybiB0aGlzLnR5cGVJdGVtVHJlZVByb21pc2UgPSB0aGlzLnNwYXJxbEl0ZW1TZXJ2aWNlLmdldEFsbEl0ZW1zKCkudGhlbihmdW5jdGlvbiAoaXRlbXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5tZXJnZUl0ZW1zKF90aGlzLml0ZW1zLCBpdGVtcyk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgUGFsZXR0ZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLiRwb3N0TGluayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5kaXZTZWwgPSBkMy5zZWxlY3QodGhpcy4kZWxlbWVudFswXSkuc2VsZWN0KCdkaXYucGFsZXR0ZScpO1xuICAgICAgICB0aGlzLm5vZGVEcmFnID0gZDMuc2VsZWN0KHRoaXMuJGVsZW1lbnRbMF0pLnNlbGVjdCgnLnBhbGV0dGUtbm9kZS1kcmFnJyk7XG4gICAgICAgIHRoaXMubm9kZURyYWcuc3R5bGUoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgICB0aGlzLm5vZGVEcmFnLmFwcGVuZCgnY2lyY2xlJyk7XG4gICAgICAgIHRoaXMuZGl2U2VsXG4gICAgICAgICAgICAuc3R5bGUoJ2hlaWdodCcsICcxMDAlJylcbiAgICAgICAgICAgIC5zdHlsZSgnd2lkdGgnLCAnMTAwJScpO1xuICAgICAgICB0aGlzLnRvb2x0aXAgPSBkMy5zZWxlY3QoJ2JvZHknKS5hcHBlbmQoJ2RpdicpXG4gICAgICAgICAgICAuc3R5bGUoJ3Bvc2l0aW9uJywgJ2Fic29sdXRlJylcbiAgICAgICAgICAgIC5zdHlsZSgnei1pbmRleCcsICcyMCcpXG4gICAgICAgICAgICAuc3R5bGUoJ2JhY2tncm91bmQtY29sb3InLCAnZ3JheScpXG4gICAgICAgICAgICAuc3R5bGUoJ2NvbG9yJywgJ3doaXRlJylcbiAgICAgICAgICAgIC5zdHlsZSgncGFkZGluZycsICczcHgnKVxuICAgICAgICAgICAgLnN0eWxlKCdib3JkZXItcmFkaXVzJywgJzJweCcpXG4gICAgICAgICAgICAuc3R5bGUoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgICAgIHZhciBvbkNoYW5nZUZ1bmN0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzLnF1ZXJ5KCkudGhlbihfdGhpcy5idWlsZC5iaW5kKF90aGlzKSkudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiAnRG9uZSc7IH0pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZS5vbignY2hhbmdlJywgb25DaGFuZ2VGdW5jdGlvbik7XG4gICAgICAgIHRoaXMudHlwZUl0ZW1UcmVlUHJvbWlzZS50aGVuKGZ1bmN0aW9uIChpdGVtVHJlZSkge1xuICAgICAgICAgICAgX3RoaXMuYnVpbGQuYmluZChfdGhpcykoaXRlbVRyZWUpO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5hZGRJdGVtID0gZnVuY3Rpb24gKGl0ZW0sIGNvb3JkaW5hdGVzKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBpdGVtVHlwZUtleSA9IGl0ZW0udHlwZVZhbHVlO1xuICAgICAgICB2YXIgaXRlbVR5cGUgPSB0aGlzLnR5cGVzLnR5cGVzLmZpbHRlcihmdW5jdGlvbiAodCkgeyByZXR1cm4gdC5pZCA9PT0gaXRlbVR5cGVLZXk7IH0pWzBdO1xuICAgICAgICB2YXIgY2hvc2VuVHlwZXMgPSB0aGlzLnR5cGVzLmRpc3BsYXlUeXBlcztcbiAgICAgICAgaWYgKCFjaG9zZW5UeXBlc1swXSAmJiBpdGVtVHlwZSkge1xuICAgICAgICAgICAgdGhpcy5zZXRPcmRlcmVkVHlwZXMoW2l0ZW1UeXBlXSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIWNob3NlblR5cGVzWzFdICYmIGl0ZW1UeXBlICYmIChjaG9zZW5UeXBlc1swXSAhPT0gaXRlbVR5cGUpKSB7XG4gICAgICAgICAgICB2YXIgbmV3VHlwZXMgPSBjaG9zZW5UeXBlcy5jb25jYXQoW10pO1xuICAgICAgICAgICAgbmV3VHlwZXMucHVzaChpdGVtVHlwZSk7XG4gICAgICAgICAgICB0aGlzLnNldE9yZGVyZWRUeXBlcyhuZXdUeXBlcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuZmlicmFTZXJ2aWNlLmRpc3BhdGNoQWN0aW9uKHRoaXMuZmlicmFTZXJ2aWNlLmRpc3BsYXlJdGVtKGl0ZW0sIGNvb3JkaW5hdGVzKSkudGhlbihmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgICAgIF90aGlzLmZpYnJhU2VydmljZS5kaXNwYXRjaCgnY2hhbmdlJyk7XG4gICAgICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgUGFsZXR0ZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmNyZWF0ZUl0ZW0gPSBmdW5jdGlvbiAobGFiZWwpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIG5vZGUgPSBEYXRhRmFjdG9yeS5pbnN0YW5jZS5uYW1lZE5vZGUobGFiZWwpO1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZS5kaXNwYXRjaEFjdGlvbih0aGlzLmZpYnJhU2VydmljZS5jcmVhdGVJdGVtKG5vZGUpKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF90aGlzLnF1ZXJ5KCkudGhlbihmdW5jdGlvbiAoaXRlbXMpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5idWlsZC5iaW5kKF90aGlzKShpdGVtcyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBQYWxldHRlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuZG93bmxvYWRDU1YgPSBmdW5jdGlvbiAoZGF0dW0pIHtcbiAgICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbZDMuY3N2Rm9ybWF0KGRhdHVtLnZhbHVlLml0ZW1zLm1hcChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgIHZhciBzYW1lQXMgPSBkLmxvY2FsUHJvcGVydGllcy5maWx0ZXIoZnVuY3Rpb24gKHApIHsgcmV0dXJuIHAudmFsdWUgPT09IE9XTC5zYW1lQXMudmFsdWU7IH0pWzBdO1xuICAgICAgICAgICAgICAgIHZhciBwcmVmTGFiZWwgPSBkLmxvY2FsUHJvcGVydGllcy5maWx0ZXIoZnVuY3Rpb24gKHApIHsgcmV0dXJuIHAudmFsdWUgPT09IFNLT1MucHJlZkxhYmVsLnZhbHVlOyB9KVswXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gX2EgPSB7fSxcbiAgICAgICAgICAgICAgICAgICAgX2FbU0tPUy5wcmVmTGFiZWwudmFsdWVdID0gcHJlZkxhYmVsID8gcHJlZkxhYmVsLnZhbHVlc1swXS52YWx1ZS52YWx1ZSA6ICcnLFxuICAgICAgICAgICAgICAgICAgICBfYS5GaWJyYUlkID0gZC52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgX2EuTWF0Y2ggPSBzYW1lQXMgPyBzYW1lQXMudmFsdWVzWzBdLnZhbHVlLnZhbHVlIDogJycsXG4gICAgICAgICAgICAgICAgICAgIF9hO1xuICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIH0pLCBbU0tPUy5wcmVmTGFiZWwudmFsdWUsICdGaWJyYUlkJywgJ01hdGNoJ10pXSwgeyB0eXBlOiAnYXBwbGljYXRpb24vY3N2O2NoYXJzZXQ9dXRmLTgnIH0pO1xuICAgICAgICB2YXIgZmlsZW5hbWUgPSBkYXR1bS52YWx1ZS5sYWJlbCArICcuY3N2JztcbiAgICAgICAgdGhpcy5GaWxlU2F2ZXIuc2F2ZUFzKGJsb2IsIGZpbGVuYW1lKTtcbiAgICB9O1xuICAgIFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5idWlsZCA9IGZ1bmN0aW9uIChpdGVtVHJlZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLnVwZGF0ZVNpemluZygpO1xuICAgICAgICBjb25zb2xlLmxvZyhpdGVtVHJlZS5lbnRyaWVzKCkpO1xuICAgICAgICB2YXIgaXRlbVRyZWVGaWx0ZXJlZCA9IGl0ZW1UcmVlLmVudHJpZXMoKS5maWx0ZXIoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQua2V5ICE9PSAnJzsgfSk7XG4gICAgICAgIHZhciBpdGVtcyA9IGl0ZW1UcmVlRmlsdGVyZWQucmVkdWNlKGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICByZXR1cm4gYS5jb25jYXQoYi52YWx1ZS5pdGVtcyk7XG4gICAgICAgIH0sIFtdKTtcbiAgICAgICAgdmFyIHBhZGRpbmcgPSBpdGVtcy5sZW5ndGggPiAzMDAgPyBpdGVtcy5sZW5ndGggPiAyMDAwID8gMSA6IDIgOiA0O1xuICAgICAgICB2YXIgcGFsZXR0ZUhlaWdodExlc3NUeXBlcyA9IHRoaXMucGFsZXR0ZUhlaWdodCAtIChpdGVtVHJlZUZpbHRlcmVkLmxlbmd0aCAqIDI1KTtcbiAgICAgICAgdmFyIHJhd1JhZGl1cyA9IChNYXRoLnNxcnQodGhpcy5wYWxldHRlV2lkdGggKiBwYWxldHRlSGVpZ2h0TGVzc1R5cGVzIC8gaXRlbXMubGVuZ3RoKSAtIHBhZGRpbmcpIC8gMjtcbiAgICAgICAgdmFyIHJhZGl1cyA9IHJhd1JhZGl1cyA+IDggPyA4IDogcmF3UmFkaXVzO1xuICAgICAgICB2YXIgeE9mZnNldCA9IHJhZGl1cyAqIDIgKyBwYWRkaW5nIC8gMjtcbiAgICAgICAgdmFyIHlPZmZzZXQgPSByYWRpdXMgKiAyICsgcGFkZGluZyAvIDI7XG4gICAgICAgIHZhciB4RG90cyA9IE1hdGguZmxvb3IoKHRoaXMucGFsZXR0ZVdpZHRoKSAvIHhPZmZzZXQpIC0gMTtcbiAgICAgICAgLy8gQnJpbmcgdGhlIG5vZGUgZHJhZyBTVkcgYW5kIHRoZSBhZGRJdGVtIGZ1bmN0aW9uIGxvY2FsXG4gICAgICAgIHZhciBub2RlRHJhZyA9IHRoaXMubm9kZURyYWc7XG4gICAgICAgIHZhciBhZGRJdGVtID0gdGhpcy5hZGRJdGVtLmJpbmQodGhpcyk7XG4gICAgICAgIHZhciBwYWxldHRlV2lkdGggPSB0aGlzLnBhbGV0dGVXaWR0aDtcbiAgICAgICAgdGhpcy50eXBlc0QzID0gdGhpcy5kaXZTZWxcbiAgICAgICAgICAgIC5zZWxlY3RBbGwoJ2Rpdi50eXBlJylcbiAgICAgICAgICAgIC5kYXRhKGl0ZW1UcmVlRmlsdGVyZWQsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmtleTsgfSk7XG4gICAgICAgIHRoaXMudHlwZXNEMy5leGl0KCkucmVtb3ZlKCk7XG4gICAgICAgIHZhciB0eXBlc0RpdnNFbnRlciA9IHRoaXMudHlwZXNEMy5lbnRlcigpXG4gICAgICAgICAgICAuYXBwZW5kKCdkaXYnKVxuICAgICAgICAgICAgLmNsYXNzZWQoJ3R5cGUnLCB0cnVlKVxuICAgICAgICAgICAgLmNsYXNzZWQoJ2ludmVyc2UtaWNvbicsIHRydWUpXG4gICAgICAgICAgICAudGV4dChmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC52YWx1ZS5sYWJlbDsgfSk7XG4gICAgICAgIHR5cGVzRGl2c0VudGVyXG4gICAgICAgICAgICAuYXBwZW5kKCdzcGFuJylcbiAgICAgICAgICAgIC5jbGFzc2VkKCdnbHlwaGljb24nLCB0cnVlKVxuICAgICAgICAgICAgLmNsYXNzZWQoJ2dseXBoaWNvbi1kb3dubG9hZCcsIHRydWUpXG4gICAgICAgICAgICAub24oJ2NsaWNrJywgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIF90aGlzLmRvd25sb2FkQ1NWKGQpOyB9KTtcbiAgICAgICAgdHlwZXNEaXZzRW50ZXJcbiAgICAgICAgICAgIC5hcHBlbmQoJ3NwYW4nKVxuICAgICAgICAgICAgLmNsYXNzZWQoJ2dseXBoaWNvbicsIHRydWUpXG4gICAgICAgICAgICAuY2xhc3NlZCgnZXhwYW5kLWJ1dHRvbicsIHRydWUpXG4gICAgICAgICAgICAub24oJ2NsaWNrJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIGQudmFsdWUuZXhwYW5kZWQgPSAhZC52YWx1ZS5leHBhbmRlZDtcbiAgICAgICAgICAgIF90aGlzLnR5cGVJdGVtVHJlZVByb21pc2UudGhlbihfdGhpcy5idWlsZC5iaW5kKF90aGlzKSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0eXBlc0RpdnNFbnRlclxuICAgICAgICAgICAgLmFwcGVuZCgnc3ZnJylcbiAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsICcxMDAlJyk7XG4gICAgICAgIHRoaXMudHlwZXNEMyA9IHR5cGVzRGl2c0VudGVyXG4gICAgICAgICAgICAubWVyZ2UodGhpcy50eXBlc0QzKTtcbiAgICAgICAgdGhpcy50eXBlc0QzLnNlbGVjdEFsbCgnLmV4cGFuZC1idXR0b24nKVxuICAgICAgICAgICAgLmNsYXNzZWQoJ2dseXBoaWNvbi1yZXNpemUtc21hbGwnLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC52YWx1ZS5leHBhbmRlZDsgfSlcbiAgICAgICAgICAgIC5jbGFzc2VkKCdnbHlwaGljb24tcmVzaXplLWZ1bGwnLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gIWQudmFsdWUuZXhwYW5kZWQ7IH0pO1xuICAgICAgICB0aGlzLnR5cGVzRDMuc2VsZWN0QWxsKCdzdmcnKVxuICAgICAgICAgICAgLnN0eWxlKCdkaXNwbGF5JywgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudmFsdWUuZXhwYW5kZWQgPyAnYmxvY2snIDogJ25vbmUnOyB9KTtcbiAgICAgICAgdmFyIHR5cGVTdmdzID0gdGhpcy50eXBlc0QzLnNlbGVjdCgnc3ZnJylcbiAgICAgICAgICAgIC5hdHRyKCdoZWlnaHQnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuIChNYXRoLmNlaWwoZC52YWx1ZS5pdGVtcy5sZW5ndGggLyB4RG90cykgKyAxKSAqIHlPZmZzZXQ7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmNpcmNsZXMgPSB0eXBlU3Znc1xuICAgICAgICAgICAgLnNlbGVjdEFsbCgnY2lyY2xlLml0ZW0nKVxuICAgICAgICAgICAgLmRhdGEoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudmFsdWUuaXRlbXM7IH0sIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnZhbHVlOyB9KTtcbiAgICAgICAgdGhpcy5jaXJjbGVzLmV4aXQoKS5yZW1vdmUoKTtcbiAgICAgICAgdGhpcy5jaXJjbGVzID0gdGhpcy5jaXJjbGVzLmVudGVyKClcbiAgICAgICAgICAgIC5hcHBlbmQoJ2NpcmNsZScpXG4gICAgICAgICAgICAuY2xhc3NlZCgnaXRlbScsIHRydWUpXG4gICAgICAgICAgICAuYXR0cigncicsIHJhZGl1cylcbiAgICAgICAgICAgIC5vbignbW91c2VvdmVyJywgZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgICAgIF90aGlzLnRvb2x0aXAuc3R5bGUoJ3RvcCcsIChkMy5ldmVudC5wYWdlWSAtIDEwKSArICdweCcpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdsZWZ0JywgKGQzLmV2ZW50LnBhZ2VYICsgMTApICsgJ3B4JylcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpXG4gICAgICAgICAgICAgICAgLnRleHQoZC5sYWJlbCArICcgKCcgKyBkLnR5cGVMYWJlbCArICcpJyk7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAub24oJ21vdXNlb3V0JywgZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgICAgIF90aGlzLnRvb2x0aXAuc3R5bGUoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAuY2FsbChkMy5kcmFnKClcbiAgICAgICAgICAgIC5vbignc3RhcnQnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgdmFyIHRoaXNDaXJjbGUgPSBkMy5zZWxlY3QodGhpcyk7XG4gICAgICAgICAgICBub2RlRHJhZ1xuICAgICAgICAgICAgICAgIC5zdHlsZSgnZGlzcGxheScsICdibG9jaycpO1xuICAgICAgICAgICAgbm9kZURyYWcuc2VsZWN0KCdjaXJjbGUnKVxuICAgICAgICAgICAgICAgIC5jbGFzc2VkKCdpdGVtJywgdGhpc0NpcmNsZS5jbGFzc2VkKCdpdGVtJykpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3InLCB0aGlzQ2lyY2xlLmF0dHIoJ3InKSlcbiAgICAgICAgICAgICAgICAuYXR0cignZmlsbCcsIHRoaXNDaXJjbGUuYXR0cignZmlsbCcpKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDgsOCknKTtcbiAgICAgICAgICAgIG5vZGVEcmFnXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdsZWZ0JywgZDMuZXZlbnQuc291cmNlRXZlbnQuY2xpZW50WCAtIDgpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCd0b3AnLCBkMy5ldmVudC5zb3VyY2VFdmVudC5jbGllbnRZIC0gOCk7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAub24oJ2RyYWcnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgbm9kZURyYWdcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2xlZnQnLCBkMy5ldmVudC5zb3VyY2VFdmVudC5jbGllbnRYIC0gOClcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ3RvcCcsIGQzLmV2ZW50LnNvdXJjZUV2ZW50LmNsaWVudFkgLSA4KTtcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC5vbignZW5kJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIC8vIElmIHRoZSBjdXJzb3IgaXMgb24gdGhlIGNhbnZhcywgZGlzcGxheVxuICAgICAgICAgICAgdmFyIGV4cGxvcmVDb250YWluZXIgPSBkMy5zZWxlY3QoJyNleHBsb3JlY29udGFpbmVyJykubm9kZSgpO1xuICAgICAgICAgICAgaWYgKGQzLmV2ZW50LnNvdXJjZUV2ZW50LmNsaWVudFggPiBleHBsb3JlQ29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQgJiZcbiAgICAgICAgICAgICAgICBkMy5ldmVudC5zb3VyY2VFdmVudC5jbGllbnRYIDwgZXhwbG9yZUNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5yaWdodCAmJlxuICAgICAgICAgICAgICAgIGQzLmV2ZW50LnNvdXJjZUV2ZW50LmNsaWVudFkgPiBleHBsb3JlQ29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCAmJlxuICAgICAgICAgICAgICAgIGQzLmV2ZW50LnNvdXJjZUV2ZW50LmNsaWVudFkgPCBleHBsb3JlQ29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmJvdHRvbSkge1xuICAgICAgICAgICAgICAgIGFkZEl0ZW0oZDMuc2VsZWN0KHRoaXMpLmRhdHVtKCksIFtcbiAgICAgICAgICAgICAgICAgICAgZDMuZXZlbnQuc291cmNlRXZlbnQuY2xpZW50WCAtIGV4cGxvcmVDb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCxcbiAgICAgICAgICAgICAgICAgICAgZDMuZXZlbnQuc291cmNlRXZlbnQuY2xpZW50WSAtIGV4cGxvcmVDb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wXG4gICAgICAgICAgICAgICAgXSkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGVEcmFnLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG5vZGVEcmFnLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpXG4gICAgICAgICAgICAubWVyZ2UodGhpcy5jaXJjbGVzKVxuICAgICAgICAgICAgLmNhbGwodGhpcy51cGRhdGUuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMuY2lyY2xlc1xuICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgLmF0dHIoJ2ZpbGwnLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gX3RoaXMudHlwZUNvbG9yU2NhbGUoZC50eXBlVmFsdWUpOyB9KVxuICAgICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uIChkLCBpKSB7IHJldHVybiAndHJhbnNsYXRlKCcgKyAoKGkgJSB4RG90cykgKyAxKSAqIHhPZmZzZXQgKyAnLCcgKyAoTWF0aC5mbG9vcihpIC8geERvdHMpICsgMSkgKiB5T2Zmc2V0ICsgJyknOyB9KTtcbiAgICB9O1xuICAgIFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoY2lyY2xlcykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgYyA9IGNpcmNsZXMgPyBjaXJjbGVzIDogdGhpcy5jaXJjbGVzO1xuICAgICAgICBjLmNsYXNzZWQoJ2Rpc3BsYXllZCcsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBfdGhpcy5maWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5jb25zdHJ1Y3QuaXRlbUluZGV4W2QudmFsdWVdID8gdHJ1ZSA6IGZhbHNlOyB9KVxuICAgICAgICAgICAgLmNsYXNzZWQoJ2ZpbHRlcmVkJywgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIF90aGlzLmxhYmVsRmlsdGVyICYmICEoZC5sYWJlbC50b1VwcGVyQ2FzZSgpLmluZGV4T2YoX3RoaXMubGFiZWxGaWx0ZXIudG9VcHBlckNhc2UoKSkgIT09IC0xKTsgfSk7XG4gICAgfTtcbiAgICBQYWxldHRlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUubWFwU3RhdGVUb1RoaXMgPSBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGVzOiBzdGF0ZS50eXBlc1xuICAgICAgICB9O1xuICAgIH07XG4gICAgUGFsZXR0ZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLnVwZGF0ZVNpemluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5wYWxldHRlV2lkdGggPSBNYXRoLnJvdW5kKHdpbmRvdy5pbm5lcldpZHRoICogMC4xNSk7IC8vIHRoaXMuc3ZnU2VsLm5vZGUoKS5jbGllbnRXaWR0aFxuICAgICAgICB0aGlzLnBhbGV0dGVIZWlnaHQgPSBNYXRoLnJvdW5kKHdpbmRvdy5pbm5lckhlaWdodCkgLSB0aGlzLnBhbGV0dGVTZWFyY2hIZWlnaHQ7XG4gICAgICAgIHRoaXMuZGl2U2VsLnN0eWxlKCdoZWlnaHQnLCB0aGlzLnBhbGV0dGVIZWlnaHQgKyAncHgnKTtcbiAgICB9O1xuICAgIFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5tZXJnZUl0ZW1zID0gZnVuY3Rpb24gKG9sZEl0ZW1zLCBuZXdJdGVtcykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAvLyBXaXBlIG9sZCBpdGVtcyAoYmFkLCBidXQgdGVtcG9yYXJ5KVxuICAgICAgICB0aGlzLnR5cGVJdGVtVHJlZS52YWx1ZXMoKS5mb3JFYWNoKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICB2Lml0ZW1zID0gW107XG4gICAgICAgIH0pO1xuICAgICAgICBuZXdJdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICB2YXIgdHlwZVByb3AgPSBpdGVtLmxvY2FsUHJvcGVydGllcy5maWx0ZXIoZnVuY3Rpb24gKHApIHsgcmV0dXJuIHAudmFsdWUgPT09IFJERi50eXBlLnZhbHVlOyB9KVswXTtcbiAgICAgICAgICAgIGlmICh0eXBlUHJvcCAmJiB0eXBlUHJvcC52YWx1ZXNbMF0pIHtcbiAgICAgICAgICAgICAgICBpdGVtLnR5cGVWYWx1ZSA9IHR5cGVQcm9wLnZhbHVlc1swXS52YWx1ZS52YWx1ZTtcbiAgICAgICAgICAgICAgICBpdGVtLnR5cGVMYWJlbCA9IHR5cGVQcm9wLnZhbHVlc1swXS52YWx1ZS5sYWJlbDtcbiAgICAgICAgICAgICAgICAvLyBBZGQgdHlwZSB0byB0aGUgdHlwZSBtYXBcbiAgICAgICAgICAgICAgICBpZiAoIV90aGlzLnR5cGVJdGVtVHJlZS5oYXMoaXRlbS50eXBlVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnR5cGVJdGVtVHJlZS5zZXQoaXRlbS50eXBlVmFsdWUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBpdGVtLnR5cGVMYWJlbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBbaXRlbV0sXG4gICAgICAgICAgICAgICAgICAgICAgICBleHBhbmRlZDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnR5cGVJdGVtVHJlZS5nZXQoaXRlbS50eXBlVmFsdWUpLml0ZW1zLnB1c2goaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaXRlbS50eXBlVmFsdWUgPSAnJztcbiAgICAgICAgICAgICAgICBpdGVtLnR5cGVMYWJlbCA9ICdObyB0eXBlIGRlZmluZWQnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gU29ydCBieSBsYWJlbFxuICAgICAgICB0aGlzLnR5cGVJdGVtVHJlZS52YWx1ZXMoKS5mb3JFYWNoKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICB2Lml0ZW1zLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIGEubGFiZWwgPT09IGIubGFiZWwgPyAwIDogYS5sYWJlbCA+IGIubGFiZWwgPyAxIDogLTE7IH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHlwZUl0ZW1UcmVlO1xuICAgIH07XG4gICAgcmV0dXJuIFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyO1xufSgpKTtcbmV4cG9ydCB7IFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyIH07XG52YXIgUGFsZXR0ZUNvbXBvbmVudCA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gUGFsZXR0ZUNvbXBvbmVudCgpIHtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IHJlcXVpcmUoJy4vcGFsZXR0ZS1jb21wb25lbnQucHVnJykoKTtcbiAgICAgICAgdGhpcy5jb250cm9sbGVyID0gUGFsZXR0ZUNvbXBvbmVudENvbnRyb2xsZXI7XG4gICAgfVxuICAgIHJldHVybiBQYWxldHRlQ29tcG9uZW50O1xufSgpKTtcbmV4cG9ydCB7IFBhbGV0dGVDb21wb25lbnQgfTtcbmFuZ3VsYXIubW9kdWxlKCdmaWJyYS5jb21wb25lbnRzLnBhbGV0dGUnLCBbJ2ZpYnJhLnNlcnZpY2VzJ10pXG4gICAgLmNvbXBvbmVudCgncGFsZXR0ZScsIG5ldyBQYWxldHRlQ29tcG9uZW50KCkpO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGFwcC9jb21wb25lbnRzL2NvbnN0cnVjdC12aWV3L3BhbGV0dGUtY29tcG9uZW50L3BhbGV0dGUtY29tcG9uZW50LnRzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQVFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQ0E7QUFDQTtBQUlBO0FBQUE7QUFDQTtBQUlBO0FBQUE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFLQTtBQUlBO0FBRUE7QUFDQTtBQUdBO0FBQ0E7QUFFQTtBQUtBO0FBR0E7QUFFQTtBQUdBO0FBRUE7QUFDQTtBQUNBO0FBSUE7QUFJQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFHQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),

/***/ "./app/components/construct-view/property-popover.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_d3__ = __webpack_require__(\"./app/bower_components/d3/d3.js\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_d3___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_d3__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__services_sparql_item_service__ = __webpack_require__(\"./app/services/sparql-item-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__models_rdf__ = __webpack_require__(\"./app/models/rdf.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__actions_types__ = __webpack_require__(\"./app/actions/types.ts\");\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return PropertyPopover; });\n/* unused harmony export PropertyPopoverComponent */\n/* unused harmony export PropertyPopoverComponentController */\n\n\n\n\n\n\n\nvar PropertyPopover = function () {\n    function PropertyPopover($element, $scope, fibraService, $compile) {\n        this.$element = $element;\n        this.$scope = $scope;\n        this.fibraService = fibraService;\n        this.$compile = $compile;\n        this.propertyPopover = __WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"]($element[0]).append('div').classed('property-popover', true);\n    }\n    PropertyPopover.prototype.addPopover = function ($scope, baseSVG, d, i, g) {\n        var propertyPopover = __WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"](baseSVG.node().parentElement.parentElement).select('div.property-popover');\n        propertyPopover.select('property-popover').remove();\n        propertyPopover.style('left', d.fx - 3 + 'px').style('top', d.fy + 12 + 'px');\n        var cscope = $scope.$new(true);\n        cscope['node'] = d;\n        cscope['close'] = function () {\n            propertyPopover.style('visibility', 'hidden');\n        };\n        propertyPopover.node().appendChild(this.$compile('<property-popover node=\"node\" types=\"types\" close=\"close\"></property-popover>')(cscope)[0]);\n        propertyPopover.style('visibility', 'visible');\n    };\n    PropertyPopover.prototype.hidePopover = function () {\n        this.propertyPopover.style('visibility', 'hidden');\n    };\n    return PropertyPopover;\n}();\n\nvar PropertyPopoverComponent = function () {\n    function PropertyPopoverComponent() {\n        this.bindings = {\n            node: '=',\n            close: '='\n        };\n        this.template = __webpack_require__(\"./app/components/construct-view/property-popover-component.pug\")();\n        this.controller = PropertyPopoverComponentController;\n    }\n    return PropertyPopoverComponent;\n}();\n\nvar PropertyPopoverComponentController = function () {\n    function PropertyPopoverComponentController(fibraService, sparqlItemService, $scope, $q, $ngRedux) {\n        var _this = this;\n        this.fibraService = fibraService;\n        this.sparqlItemService = sparqlItemService;\n        this.$scope = $scope;\n        this.$q = $q;\n        this.$ngRedux = $ngRedux;\n        this.thingType = __WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"d\" /* OWL */].Thing.value;\n        this.showTypeCreate = false;\n        this.typeQuery = '';\n        this.typeQueryGS = function (query) {\n            if (query !== undefined) {\n                _this.typeQuery = query;\n            }\n            return _this.typeQuery;\n        };\n        this.unsubscribe = $ngRedux.connect(this.mapStateToThis, __WEBPACK_IMPORTED_MODULE_4__actions_types__)(this);\n        this.getTypes = function () {\n            return _this.types.types.concat(_this.types.userTypes);\n        };\n    }\n    PropertyPopoverComponentController.prototype.$onDestroy = function () {\n        this.unsubscribe();\n    };\n    PropertyPopoverComponentController.prototype.$postLink = function () {\n        this.label = this.node.label;\n        var nodeType = this.node.localProperties.filter(function (p) {\n            return p.value === 'http://www.w3.org/1999/02/22-rdf-syntax-ns#type';\n        })[0].values[0].value.value;\n        this.chosenType = this.types.types.filter(function (t) {\n            return t.id === nodeType;\n        })[0];\n        if (this.chosenType) this.typeQuery = this.chosenType.label;\n    };\n    PropertyPopoverComponentController.prototype.typeCreate = function (label) {\n        var _this = this;\n        if (label && !this.types.types.filter(function (t) {\n            return t.label === label;\n        })[0]) {\n            // We have a string and no matching type is in scope.\n            this.createType(label, this.sparqlItemService).then(function () {\n                // Type should now show up in the list. Assign the type that was picked\n                var typePicked = _this.types.userTypes.filter(function (t) {\n                    return t.label === label;\n                })[0];\n                if (typePicked) return _this.typeChange(typePicked);else return _this.$q.resolve({});\n            });\n        }\n    };\n    PropertyPopoverComponentController.prototype.mapStateToThis = function (state) {\n        return {\n            types: state.types\n        };\n    };\n    PropertyPopoverComponentController.prototype.typeEvaluate = function (label) {\n        if (label && !this.getTypes().filter(function (t) {\n            return t.label === label;\n        })[0]) {\n            this.showTypeCreate = true;\n        } else {\n            // Does match an existing type, or is empty\n            this.showTypeCreate = false;\n        }\n    };\n    PropertyPopoverComponentController.prototype.typeChange = function (type) {\n        var _this = this;\n        this.chosenType = type;\n        var oldTypes = this.node.localProperties.filter(function (p) {\n            return p.value === __WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"c\" /* RDF */].type.value;\n        })[0].values.map(function (n) {\n            return new __WEBPACK_IMPORTED_MODULE_1__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"c\" /* RDF */].type, n.value);\n        });\n        var typeNode = new __WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"i\" /* NamedNode */](type.id);\n        this.showTypeCreate = false;\n        return this.fibraService.dispatchAction(this.fibraService.itemProperty(this.node, [new __WEBPACK_IMPORTED_MODULE_1__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"c\" /* RDF */].type, typeNode)], oldTypes)).then(function (state) {\n            // Update the type displayed in the construct interface if appropriate (duplicative)\n            var chosenTypes = _this.fibraService.getState().construct.displayTypes;\n            if (!chosenTypes[0] && type) {\n                return _this.setOrderedTypes([type]);\n            } else if (!chosenTypes[1] && type && chosenTypes[0] !== type) {\n                var newTypes = chosenTypes.concat([]);\n                newTypes.push(type);\n                return _this.setOrderedTypes(newTypes);\n            }\n        });\n    };\n    PropertyPopoverComponentController.prototype.labelChange = function () {\n        var oldLabels = this.node.localProperties.filter(function (p) {\n            return p.value === __WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"a\" /* SKOS */].prefLabel.value;\n        })[0].values.map(function (n) {\n            return new __WEBPACK_IMPORTED_MODULE_1__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"a\" /* SKOS */].prefLabel, n.value);\n        });\n        this.fibraService.dispatchAction(this.fibraService.itemProperty(this.node, [new __WEBPACK_IMPORTED_MODULE_1__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"a\" /* SKOS */].prefLabel, __WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"b\" /* DataFactory */].instance.literal(this.label))], oldLabels));\n    };\n    PropertyPopoverComponentController.prototype.deleteAndClose = function () {\n        var _this = this;\n        this.fibraService.dispatchAction(this.fibraService.deleteItem(this.node)).then(function () {\n            _this.fibraService.dispatch('change');\n            _this.close();\n        });\n    };\n    PropertyPopoverComponentController.prototype.closePopover = function () {\n        this.close();\n        this.fibraService.dispatch('change');\n    };\n    return PropertyPopoverComponentController;\n}();\n\n__WEBPACK_IMPORTED_MODULE_3_angular__[\"module\"]('fibra.components.property-popover', ['fibra.services', 'ui.bootstrap']).component('propertyPopover', new PropertyPopoverComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9wcm9wZXJ0eS1wb3BvdmVyLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL2FwcC9jb21wb25lbnRzL2NvbnN0cnVjdC12aWV3L3Byb3BlcnR5LXBvcG92ZXIudHM/Yjg5NiJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5pbXBvcnQgKiBhcyBkMyBmcm9tICdkMyc7XG5pbXBvcnQgeyBQcm9wZXJ0eUFuZFZhbHVlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvc3BhcnFsLWl0ZW0tc2VydmljZSc7XG5pbXBvcnQgeyBPV0wsIFJERiwgTmFtZWROb2RlLCBTS09TLCBEYXRhRmFjdG9yeSB9IGZyb20gJy4uLy4uL21vZGVscy9yZGYnO1xuaW1wb3J0ICogYXMgYW5ndWxhciBmcm9tICdhbmd1bGFyJztcbmltcG9ydCAqIGFzIFR5cGVBY3Rpb25zIGZyb20gJy4uLy4uL2FjdGlvbnMvdHlwZXMnO1xudmFyIFByb3BlcnR5UG9wb3ZlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gUHJvcGVydHlQb3BvdmVyKCRlbGVtZW50LCAkc2NvcGUsIGZpYnJhU2VydmljZSwgJGNvbXBpbGUpIHtcbiAgICAgICAgdGhpcy4kZWxlbWVudCA9ICRlbGVtZW50O1xuICAgICAgICB0aGlzLiRzY29wZSA9ICRzY29wZTtcbiAgICAgICAgdGhpcy5maWJyYVNlcnZpY2UgPSBmaWJyYVNlcnZpY2U7XG4gICAgICAgIHRoaXMuJGNvbXBpbGUgPSAkY29tcGlsZTtcbiAgICAgICAgdGhpcy5wcm9wZXJ0eVBvcG92ZXIgPSBkMy5zZWxlY3QoJGVsZW1lbnRbMF0pLmFwcGVuZCgnZGl2JylcbiAgICAgICAgICAgIC5jbGFzc2VkKCdwcm9wZXJ0eS1wb3BvdmVyJywgdHJ1ZSk7XG4gICAgfVxuICAgIFByb3BlcnR5UG9wb3Zlci5wcm90b3R5cGUuYWRkUG9wb3ZlciA9IGZ1bmN0aW9uICgkc2NvcGUsIGJhc2VTVkcsIGQsIGksIGcpIHtcbiAgICAgICAgdmFyIHByb3BlcnR5UG9wb3ZlciA9IGQzLnNlbGVjdChiYXNlU1ZHLm5vZGUoKS5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQpLnNlbGVjdCgnZGl2LnByb3BlcnR5LXBvcG92ZXInKTtcbiAgICAgICAgcHJvcGVydHlQb3BvdmVyLnNlbGVjdCgncHJvcGVydHktcG9wb3ZlcicpLnJlbW92ZSgpO1xuICAgICAgICBwcm9wZXJ0eVBvcG92ZXJcbiAgICAgICAgICAgIC5zdHlsZSgnbGVmdCcsIChkLmZ4IC0gMykgKyAncHgnKVxuICAgICAgICAgICAgLnN0eWxlKCd0b3AnLCAoZC5meSArIDEyKSArICdweCcpO1xuICAgICAgICB2YXIgY3Njb3BlID0gJHNjb3BlLiRuZXcodHJ1ZSk7XG4gICAgICAgIGNzY29wZVsnbm9kZSddID0gZDtcbiAgICAgICAgY3Njb3BlWydjbG9zZSddID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcHJvcGVydHlQb3BvdmVyLnN0eWxlKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xuICAgICAgICB9O1xuICAgICAgICBwcm9wZXJ0eVBvcG92ZXIubm9kZSgpLmFwcGVuZENoaWxkKHRoaXMuJGNvbXBpbGUoJzxwcm9wZXJ0eS1wb3BvdmVyIG5vZGU9XCJub2RlXCIgdHlwZXM9XCJ0eXBlc1wiIGNsb3NlPVwiY2xvc2VcIj48L3Byb3BlcnR5LXBvcG92ZXI+JykoY3Njb3BlKVswXSk7XG4gICAgICAgIHByb3BlcnR5UG9wb3Zlci5zdHlsZSgndmlzaWJpbGl0eScsICd2aXNpYmxlJyk7XG4gICAgfTtcbiAgICBQcm9wZXJ0eVBvcG92ZXIucHJvdG90eXBlLmhpZGVQb3BvdmVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnByb3BlcnR5UG9wb3Zlci5zdHlsZSgndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICB9O1xuICAgIHJldHVybiBQcm9wZXJ0eVBvcG92ZXI7XG59KCkpO1xuZXhwb3J0IHsgUHJvcGVydHlQb3BvdmVyIH07XG52YXIgUHJvcGVydHlQb3BvdmVyQ29tcG9uZW50ID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBQcm9wZXJ0eVBvcG92ZXJDb21wb25lbnQoKSB7XG4gICAgICAgIHRoaXMuYmluZGluZ3MgPSB7XG4gICAgICAgICAgICBub2RlOiAnPScsXG4gICAgICAgICAgICBjbG9zZTogJz0nXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSByZXF1aXJlKCcuL3Byb3BlcnR5LXBvcG92ZXItY29tcG9uZW50LnB1ZycpKCk7XG4gICAgICAgIHRoaXMuY29udHJvbGxlciA9IFByb3BlcnR5UG9wb3ZlckNvbXBvbmVudENvbnRyb2xsZXI7XG4gICAgfVxuICAgIHJldHVybiBQcm9wZXJ0eVBvcG92ZXJDb21wb25lbnQ7XG59KCkpO1xuZXhwb3J0IHsgUHJvcGVydHlQb3BvdmVyQ29tcG9uZW50IH07XG52YXIgUHJvcGVydHlQb3BvdmVyQ29tcG9uZW50Q29udHJvbGxlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gUHJvcGVydHlQb3BvdmVyQ29tcG9uZW50Q29udHJvbGxlcihmaWJyYVNlcnZpY2UsIHNwYXJxbEl0ZW1TZXJ2aWNlLCAkc2NvcGUsICRxLCAkbmdSZWR1eCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZSA9IGZpYnJhU2VydmljZTtcbiAgICAgICAgdGhpcy5zcGFycWxJdGVtU2VydmljZSA9IHNwYXJxbEl0ZW1TZXJ2aWNlO1xuICAgICAgICB0aGlzLiRzY29wZSA9ICRzY29wZTtcbiAgICAgICAgdGhpcy4kcSA9ICRxO1xuICAgICAgICB0aGlzLiRuZ1JlZHV4ID0gJG5nUmVkdXg7XG4gICAgICAgIHRoaXMudGhpbmdUeXBlID0gT1dMLlRoaW5nLnZhbHVlO1xuICAgICAgICB0aGlzLnNob3dUeXBlQ3JlYXRlID0gZmFsc2U7XG4gICAgICAgIHRoaXMudHlwZVF1ZXJ5ID0gJyc7XG4gICAgICAgIHRoaXMudHlwZVF1ZXJ5R1MgPSBmdW5jdGlvbiAocXVlcnkpIHtcbiAgICAgICAgICAgIGlmIChxdWVyeSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMudHlwZVF1ZXJ5ID0gcXVlcnk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMudHlwZVF1ZXJ5O1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlID0gJG5nUmVkdXguY29ubmVjdCh0aGlzLm1hcFN0YXRlVG9UaGlzLCBUeXBlQWN0aW9ucykodGhpcyk7XG4gICAgICAgIHRoaXMuZ2V0VHlwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMudHlwZXMudHlwZXMuY29uY2F0KF90aGlzLnR5cGVzLnVzZXJUeXBlcyk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIFByb3BlcnR5UG9wb3ZlckNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLiRvbkRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudW5zdWJzY3JpYmUoKTtcbiAgICB9O1xuICAgIFByb3BlcnR5UG9wb3ZlckNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLiRwb3N0TGluayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5sYWJlbCA9IHRoaXMubm9kZS5sYWJlbDtcbiAgICAgICAgdmFyIG5vZGVUeXBlID0gdGhpcy5ub2RlLmxvY2FsUHJvcGVydGllcy5maWx0ZXIoZnVuY3Rpb24gKHApIHtcbiAgICAgICAgICAgIHJldHVybiBwLnZhbHVlID09PSAnaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zI3R5cGUnO1xuICAgICAgICB9KVswXS52YWx1ZXNbMF0udmFsdWUudmFsdWU7XG4gICAgICAgIHRoaXMuY2hvc2VuVHlwZSA9IHRoaXMudHlwZXMudHlwZXMuZmlsdGVyKGZ1bmN0aW9uICh0KSB7IHJldHVybiB0LmlkID09PSBub2RlVHlwZTsgfSlbMF07XG4gICAgICAgIGlmICh0aGlzLmNob3NlblR5cGUpXG4gICAgICAgICAgICB0aGlzLnR5cGVRdWVyeSA9IHRoaXMuY2hvc2VuVHlwZS5sYWJlbDtcbiAgICB9O1xuICAgIFByb3BlcnR5UG9wb3ZlckNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLnR5cGVDcmVhdGUgPSBmdW5jdGlvbiAobGFiZWwpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgaWYgKGxhYmVsICYmICF0aGlzLnR5cGVzLnR5cGVzLmZpbHRlcihmdW5jdGlvbiAodCkgeyByZXR1cm4gdC5sYWJlbCA9PT0gbGFiZWw7IH0pWzBdKSB7XG4gICAgICAgICAgICAvLyBXZSBoYXZlIGEgc3RyaW5nIGFuZCBubyBtYXRjaGluZyB0eXBlIGlzIGluIHNjb3BlLlxuICAgICAgICAgICAgdGhpcy5jcmVhdGVUeXBlKGxhYmVsLCB0aGlzLnNwYXJxbEl0ZW1TZXJ2aWNlKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAvLyBUeXBlIHNob3VsZCBub3cgc2hvdyB1cCBpbiB0aGUgbGlzdC4gQXNzaWduIHRoZSB0eXBlIHRoYXQgd2FzIHBpY2tlZFxuICAgICAgICAgICAgICAgIHZhciB0eXBlUGlja2VkID0gX3RoaXMudHlwZXMudXNlclR5cGVzLmZpbHRlcihmdW5jdGlvbiAodCkgeyByZXR1cm4gdC5sYWJlbCA9PT0gbGFiZWw7IH0pWzBdO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlUGlja2VkKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMudHlwZUNoYW5nZSh0eXBlUGlja2VkKTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy4kcS5yZXNvbHZlKHt9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBQcm9wZXJ0eVBvcG92ZXJDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5tYXBTdGF0ZVRvVGhpcyA9IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZXM6IHN0YXRlLnR5cGVzXG4gICAgICAgIH07XG4gICAgfTtcbiAgICBQcm9wZXJ0eVBvcG92ZXJDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS50eXBlRXZhbHVhdGUgPSBmdW5jdGlvbiAobGFiZWwpIHtcbiAgICAgICAgaWYgKGxhYmVsICYmICF0aGlzLmdldFR5cGVzKCkuZmlsdGVyKGZ1bmN0aW9uICh0KSB7IHJldHVybiB0LmxhYmVsID09PSBsYWJlbDsgfSlbMF0pIHtcbiAgICAgICAgICAgIHRoaXMuc2hvd1R5cGVDcmVhdGUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gRG9lcyBtYXRjaCBhbiBleGlzdGluZyB0eXBlLCBvciBpcyBlbXB0eVxuICAgICAgICAgICAgdGhpcy5zaG93VHlwZUNyZWF0ZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBQcm9wZXJ0eVBvcG92ZXJDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS50eXBlQ2hhbmdlID0gZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5jaG9zZW5UeXBlID0gdHlwZTtcbiAgICAgICAgdmFyIG9sZFR5cGVzID0gdGhpcy5ub2RlLmxvY2FsUHJvcGVydGllcy5maWx0ZXIoZnVuY3Rpb24gKHApIHsgcmV0dXJuIHAudmFsdWUgPT09IFJERi50eXBlLnZhbHVlOyB9KVswXS52YWx1ZXMubWFwKGZ1bmN0aW9uIChuKSB7IHJldHVybiBuZXcgUHJvcGVydHlBbmRWYWx1ZShSREYudHlwZSwgbi52YWx1ZSk7IH0pO1xuICAgICAgICB2YXIgdHlwZU5vZGUgPSBuZXcgTmFtZWROb2RlKHR5cGUuaWQpO1xuICAgICAgICB0aGlzLnNob3dUeXBlQ3JlYXRlID0gZmFsc2U7XG4gICAgICAgIHJldHVybiB0aGlzLmZpYnJhU2VydmljZS5kaXNwYXRjaEFjdGlvbih0aGlzLmZpYnJhU2VydmljZS5pdGVtUHJvcGVydHkodGhpcy5ub2RlLCBbbmV3IFByb3BlcnR5QW5kVmFsdWUoUkRGLnR5cGUsIHR5cGVOb2RlKV0sIG9sZFR5cGVzKSkudGhlbihmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgdHlwZSBkaXNwbGF5ZWQgaW4gdGhlIGNvbnN0cnVjdCBpbnRlcmZhY2UgaWYgYXBwcm9wcmlhdGUgKGR1cGxpY2F0aXZlKVxuICAgICAgICAgICAgdmFyIGNob3NlblR5cGVzID0gX3RoaXMuZmlicmFTZXJ2aWNlLmdldFN0YXRlKCkuY29uc3RydWN0LmRpc3BsYXlUeXBlcztcbiAgICAgICAgICAgIGlmICghY2hvc2VuVHlwZXNbMF0gJiYgdHlwZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5zZXRPcmRlcmVkVHlwZXMoW3R5cGVdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFjaG9zZW5UeXBlc1sxXSAmJiB0eXBlICYmIChjaG9zZW5UeXBlc1swXSAhPT0gdHlwZSkpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmV3VHlwZXMgPSBjaG9zZW5UeXBlcy5jb25jYXQoW10pO1xuICAgICAgICAgICAgICAgIG5ld1R5cGVzLnB1c2godHlwZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnNldE9yZGVyZWRUeXBlcyhuZXdUeXBlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgUHJvcGVydHlQb3BvdmVyQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUubGFiZWxDaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBvbGRMYWJlbHMgPSB0aGlzLm5vZGUubG9jYWxQcm9wZXJ0aWVzLmZpbHRlcihmdW5jdGlvbiAocCkgeyByZXR1cm4gcC52YWx1ZSA9PT0gU0tPUy5wcmVmTGFiZWwudmFsdWU7IH0pWzBdLnZhbHVlcy5tYXAoZnVuY3Rpb24gKG4pIHsgcmV0dXJuIG5ldyBQcm9wZXJ0eUFuZFZhbHVlKFNLT1MucHJlZkxhYmVsLCBuLnZhbHVlKTsgfSk7XG4gICAgICAgIHRoaXMuZmlicmFTZXJ2aWNlLmRpc3BhdGNoQWN0aW9uKHRoaXMuZmlicmFTZXJ2aWNlLml0ZW1Qcm9wZXJ0eSh0aGlzLm5vZGUsIFtuZXcgUHJvcGVydHlBbmRWYWx1ZShTS09TLnByZWZMYWJlbCwgRGF0YUZhY3RvcnkuaW5zdGFuY2UubGl0ZXJhbCh0aGlzLmxhYmVsKSldLCBvbGRMYWJlbHMpKTtcbiAgICB9O1xuICAgIFByb3BlcnR5UG9wb3ZlckNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmRlbGV0ZUFuZENsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZS5kaXNwYXRjaEFjdGlvbih0aGlzLmZpYnJhU2VydmljZS5kZWxldGVJdGVtKHRoaXMubm9kZSkpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdGhpcy5maWJyYVNlcnZpY2UuZGlzcGF0Y2goJ2NoYW5nZScpO1xuICAgICAgICAgICAgX3RoaXMuY2xvc2UoKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBQcm9wZXJ0eVBvcG92ZXJDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5jbG9zZVBvcG92ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgdGhpcy5maWJyYVNlcnZpY2UuZGlzcGF0Y2goJ2NoYW5nZScpO1xuICAgIH07XG4gICAgcmV0dXJuIFByb3BlcnR5UG9wb3ZlckNvbXBvbmVudENvbnRyb2xsZXI7XG59KCkpO1xuZXhwb3J0IHsgUHJvcGVydHlQb3BvdmVyQ29tcG9uZW50Q29udHJvbGxlciB9O1xuYW5ndWxhci5tb2R1bGUoJ2ZpYnJhLmNvbXBvbmVudHMucHJvcGVydHktcG9wb3ZlcicsIFsnZmlicmEuc2VydmljZXMnLCAndWkuYm9vdHN0cmFwJ10pXG4gICAgLmNvbXBvbmVudCgncHJvcGVydHlQb3BvdmVyJywgbmV3IFByb3BlcnR5UG9wb3ZlckNvbXBvbmVudCgpKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBhcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9wcm9wZXJ0eS1wb3BvdmVyLnRzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),

/***/ "./app/components/upload/upload-component.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_d3__ = __webpack_require__(\"./app/bower_components/d3/d3.js\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_d3___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_d3__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__services_sparql_item_service__ = __webpack_require__(\"./app/services/sparql-item-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__models_rdf__ = __webpack_require__(\"./app/models/rdf.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__actions_types__ = __webpack_require__(\"./app/actions/types.ts\");\n/* unused harmony export UploadComponentController */\n/* unused harmony export UploadComponent */\n\n\n\n\n\n\n\nvar UploadComponentController = function () {\n    function UploadComponentController(fibraService, $ngRedux, $q, $scope) {\n        this.fibraService = fibraService;\n        this.$ngRedux = $ngRedux;\n        this.$q = $q;\n        this.$scope = $scope;\n        this.classSelect = null;\n        this.unsubscribe = $ngRedux.connect(this.mapStateToThis, __WEBPACK_IMPORTED_MODULE_4__actions_types__)(this);\n        this.fibraService = fibraService;\n        $scope.registerFile = this.registerFile.bind(this);\n    }\n    UploadComponentController.prototype.mapStateToThis = function (state) {\n        return {\n            types: state.types\n        };\n    };\n    UploadComponentController.prototype.registerFile = function (file) {\n        this.fileInput = file;\n    };\n    UploadComponentController.prototype.uploadFile = function () {\n        var _this = this;\n        console.log(this.fileInput, this.types.types.filter(function (t) {\n            return t.id === _this.classSelect;\n        })[0]);\n        var selectedClass = this.types.types.filter(function (t) {\n            return t.id === _this.classSelect;\n        })[0];\n        // Notes: column headers we should handle\n        //  - 'FibraId' - this will be the matching Fibra identifier. In this case we should not createItem\n        //              but rather update an existing item if necessary\n        //  - SKOS.prefLabel.value - Will be the label to use\n        //  - 'Match' - will be the Recon matched value and should go to OWL.sameAs property\n        //  - 'Notes' - will do onto a notes property?\n        // Just uses the first column of the file as labels\n        var reader = new FileReader();\n        reader.onload = function () {\n            var parsedCSV = __WEBPACK_IMPORTED_MODULE_1_d3__[\"csvParse\"](reader.result);\n            var newRows = parsedCSV.filter(function (row) {\n                return !row['FibraId']; // Not an update\n            });\n            var labelColumnKey = parsedCSV.columns[0];\n            console.log(parsedCSV, labelColumnKey);\n            var proms = [newRows.length > 0 ? _this.fibraService.dispatchAction(_this.fibraService.createItems(newRows.map(function (row) {\n                var node = __WEBPACK_IMPORTED_MODULE_3__models_rdf__[\"b\" /* DataFactory */].instance.namedNode(row[labelColumnKey]);\n                return node;\n            }), selectedClass.id)) : _this.$q.resolve(_this.fibraService.getState()), _this.$q.all(parsedCSV.filter(function (row) {\n                return !!row['FibraId'];\n            }).map(function (row) {\n                if (row['Match'] && !row[__WEBPACK_IMPORTED_MODULE_3__models_rdf__[\"d\" /* OWL */].sameAs.value]) {\n                    row[__WEBPACK_IMPORTED_MODULE_3__models_rdf__[\"d\" /* OWL */].sameAs.value] = row['Match'];\n                    delete row['Match'];\n                }\n                var entries = __WEBPACK_IMPORTED_MODULE_1_d3__[\"entries\"](row);\n                var props = entries.filter(function (entry) {\n                    return entry.key !== 'FibraId' && entry.value && entry.key !== __WEBPACK_IMPORTED_MODULE_3__models_rdf__[\"d\" /* OWL */].sameAs.value && entry.key !== 'Notes' && entry.key !== 'Match';\n                }).map(function (entry) {\n                    return new __WEBPACK_IMPORTED_MODULE_2__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_3__models_rdf__[\"b\" /* DataFactory */].instance.namedNode(entry.key), entry.value.indexOf('http://') === 0 ? __WEBPACK_IMPORTED_MODULE_3__models_rdf__[\"b\" /* DataFactory */].instance.namedNode(entry.value) : __WEBPACK_IMPORTED_MODULE_3__models_rdf__[\"b\" /* DataFactory */].instance.literal(entry.value));\n                });\n                // Handle OWL.sameAs\n                entries.filter(function (entry) {\n                    return entry.key === __WEBPACK_IMPORTED_MODULE_3__models_rdf__[\"d\" /* OWL */].sameAs.value && entry.value;\n                }).forEach(function (entry) {\n                    return props.push(new __WEBPACK_IMPORTED_MODULE_2__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_3__models_rdf__[\"d\" /* OWL */].sameAs, __WEBPACK_IMPORTED_MODULE_3__models_rdf__[\"b\" /* DataFactory */].instance.namedNode(entry.value)));\n                });\n                return _this.fibraService.dispatchAction(_this.fibraService.itemProperty(new __WEBPACK_IMPORTED_MODULE_3__models_rdf__[\"i\" /* NamedNode */](row['FibraId']), props));\n            })).then(function (states) {\n                return states[states.length - 1];\n            })];\n            _this.$q.all(proms).then(function () {\n                _this.fibraService.dispatch('change');\n            });\n        };\n        reader.readAsText(this.fileInput.files[0]);\n        // We need to clear the input so that we pick up future uploads. This is *not*\n        // cross-browser-compatible.\n        this.fileInput.value = null;\n        this.onUpload();\n    };\n    return UploadComponentController;\n}();\n\nvar UploadComponent = function () {\n    function UploadComponent() {\n        this.controller = UploadComponentController; // (new (...args: any[]) => angular.IController) = SelectViewComponentController\n        this.template = __webpack_require__(\"./app/components/upload/upload.pug\")();\n        this.bindings = {\n            onUpload: '&'\n        };\n    }\n    return UploadComponent;\n}();\n\n__WEBPACK_IMPORTED_MODULE_0_angular__[\"module\"]('fibra.components.upload', []).component('upload', new UploadComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy91cGxvYWQvdXBsb2FkLWNvbXBvbmVudC50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hcHAvY29tcG9uZW50cy91cGxvYWQvdXBsb2FkLWNvbXBvbmVudC50cz8xMTE4Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmltcG9ydCAqIGFzIGFuZ3VsYXIgZnJvbSAnYW5ndWxhcic7XG5pbXBvcnQgKiBhcyBkMyBmcm9tICdkMyc7XG5pbXBvcnQgeyBQcm9wZXJ0eUFuZFZhbHVlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvc3BhcnFsLWl0ZW0tc2VydmljZSc7XG5pbXBvcnQgeyBEYXRhRmFjdG9yeSwgT1dMLCBOYW1lZE5vZGUgfSBmcm9tICcuLi8uLi9tb2RlbHMvcmRmJztcbmltcG9ydCAqIGFzIFR5cGVBY3Rpb25zIGZyb20gJy4uLy4uL2FjdGlvbnMvdHlwZXMnO1xudmFyIFVwbG9hZENvbXBvbmVudENvbnRyb2xsZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFVwbG9hZENvbXBvbmVudENvbnRyb2xsZXIoZmlicmFTZXJ2aWNlLCAkbmdSZWR1eCwgJHEsICRzY29wZSkge1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZSA9IGZpYnJhU2VydmljZTtcbiAgICAgICAgdGhpcy4kbmdSZWR1eCA9ICRuZ1JlZHV4O1xuICAgICAgICB0aGlzLiRxID0gJHE7XG4gICAgICAgIHRoaXMuJHNjb3BlID0gJHNjb3BlO1xuICAgICAgICB0aGlzLmNsYXNzU2VsZWN0ID0gbnVsbDtcbiAgICAgICAgdGhpcy51bnN1YnNjcmliZSA9ICRuZ1JlZHV4LmNvbm5lY3QodGhpcy5tYXBTdGF0ZVRvVGhpcywgVHlwZUFjdGlvbnMpKHRoaXMpO1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZSA9IGZpYnJhU2VydmljZTtcbiAgICAgICAgJHNjb3BlLnJlZ2lzdGVyRmlsZSA9IHRoaXMucmVnaXN0ZXJGaWxlLmJpbmQodGhpcyk7XG4gICAgfVxuICAgIFVwbG9hZENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLm1hcFN0YXRlVG9UaGlzID0gZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlczogc3RhdGUudHlwZXNcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIFVwbG9hZENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLnJlZ2lzdGVyRmlsZSA9IGZ1bmN0aW9uIChmaWxlKSB7XG4gICAgICAgIHRoaXMuZmlsZUlucHV0ID0gZmlsZTtcbiAgICB9O1xuICAgIFVwbG9hZENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLnVwbG9hZEZpbGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuZmlsZUlucHV0LCB0aGlzLnR5cGVzLnR5cGVzLmZpbHRlcihmdW5jdGlvbiAodCkgeyByZXR1cm4gdC5pZCA9PT0gX3RoaXMuY2xhc3NTZWxlY3Q7IH0pWzBdKTtcbiAgICAgICAgdmFyIHNlbGVjdGVkQ2xhc3MgPSB0aGlzLnR5cGVzLnR5cGVzLmZpbHRlcihmdW5jdGlvbiAodCkgeyByZXR1cm4gdC5pZCA9PT0gX3RoaXMuY2xhc3NTZWxlY3Q7IH0pWzBdO1xuICAgICAgICAvLyBOb3RlczogY29sdW1uIGhlYWRlcnMgd2Ugc2hvdWxkIGhhbmRsZVxuICAgICAgICAvLyAgLSAnRmlicmFJZCcgLSB0aGlzIHdpbGwgYmUgdGhlIG1hdGNoaW5nIEZpYnJhIGlkZW50aWZpZXIuIEluIHRoaXMgY2FzZSB3ZSBzaG91bGQgbm90IGNyZWF0ZUl0ZW1cbiAgICAgICAgLy8gICAgICAgICAgICAgIGJ1dCByYXRoZXIgdXBkYXRlIGFuIGV4aXN0aW5nIGl0ZW0gaWYgbmVjZXNzYXJ5XG4gICAgICAgIC8vICAtIFNLT1MucHJlZkxhYmVsLnZhbHVlIC0gV2lsbCBiZSB0aGUgbGFiZWwgdG8gdXNlXG4gICAgICAgIC8vICAtICdNYXRjaCcgLSB3aWxsIGJlIHRoZSBSZWNvbiBtYXRjaGVkIHZhbHVlIGFuZCBzaG91bGQgZ28gdG8gT1dMLnNhbWVBcyBwcm9wZXJ0eVxuICAgICAgICAvLyAgLSAnTm90ZXMnIC0gd2lsbCBkbyBvbnRvIGEgbm90ZXMgcHJvcGVydHk/XG4gICAgICAgIC8vIEp1c3QgdXNlcyB0aGUgZmlyc3QgY29sdW1uIG9mIHRoZSBmaWxlIGFzIGxhYmVsc1xuICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBwYXJzZWRDU1YgPSBkMy5jc3ZQYXJzZShyZWFkZXIucmVzdWx0KTtcbiAgICAgICAgICAgIHZhciBuZXdSb3dzID0gcGFyc2VkQ1NWLmZpbHRlcihmdW5jdGlvbiAocm93KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICFyb3dbJ0ZpYnJhSWQnXTsgLy8gTm90IGFuIHVwZGF0ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgbGFiZWxDb2x1bW5LZXkgPSBwYXJzZWRDU1YuY29sdW1uc1swXTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHBhcnNlZENTViwgbGFiZWxDb2x1bW5LZXkpO1xuICAgICAgICAgICAgdmFyIHByb21zID0gW1xuICAgICAgICAgICAgICAgIG5ld1Jvd3MubGVuZ3RoID4gMCA/IF90aGlzLmZpYnJhU2VydmljZS5kaXNwYXRjaEFjdGlvbihfdGhpcy5maWJyYVNlcnZpY2UuY3JlYXRlSXRlbXMobmV3Um93cy5tYXAoZnVuY3Rpb24gKHJvdykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IERhdGFGYWN0b3J5Lmluc3RhbmNlLm5hbWVkTm9kZShyb3dbbGFiZWxDb2x1bW5LZXldKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vZGU7XG4gICAgICAgICAgICAgICAgfSksIHNlbGVjdGVkQ2xhc3MuaWQpKSA6IF90aGlzLiRxLnJlc29sdmUoX3RoaXMuZmlicmFTZXJ2aWNlLmdldFN0YXRlKCkpLFxuICAgICAgICAgICAgICAgIF90aGlzLiRxLmFsbChwYXJzZWRDU1YuZmlsdGVyKGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEhcm93WydGaWJyYUlkJ107XG4gICAgICAgICAgICAgICAgfSkubWFwKGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJvd1snTWF0Y2gnXSAmJiAhcm93W09XTC5zYW1lQXMudmFsdWVdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByb3dbT1dMLnNhbWVBcy52YWx1ZV0gPSByb3dbJ01hdGNoJ107XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgcm93WydNYXRjaCddO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbnRyaWVzID0gZDMuZW50cmllcyhyb3cpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcHJvcHMgPSBlbnRyaWVzXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChlbnRyeSkgeyByZXR1cm4gZW50cnkua2V5ICE9PSAnRmlicmFJZCdcbiAgICAgICAgICAgICAgICAgICAgICAgICYmIGVudHJ5LnZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgICAmJiBlbnRyeS5rZXkgIT09IE9XTC5zYW1lQXMudmFsdWVcbiAgICAgICAgICAgICAgICAgICAgICAgICYmIGVudHJ5LmtleSAhPT0gJ05vdGVzJ1xuICAgICAgICAgICAgICAgICAgICAgICAgJiYgZW50cnkua2V5ICE9PSAnTWF0Y2gnOyB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoZW50cnkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvcGVydHlBbmRWYWx1ZShEYXRhRmFjdG9yeS5pbnN0YW5jZS5uYW1lZE5vZGUoZW50cnkua2V5KSwgZW50cnkudmFsdWUuaW5kZXhPZignaHR0cDovLycpID09PSAwID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRhRmFjdG9yeS5pbnN0YW5jZS5uYW1lZE5vZGUoZW50cnkudmFsdWUpIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRhRmFjdG9yeS5pbnN0YW5jZS5saXRlcmFsKGVudHJ5LnZhbHVlKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgT1dMLnNhbWVBc1xuICAgICAgICAgICAgICAgICAgICBlbnRyaWVzXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChlbnRyeSkgeyByZXR1cm4gZW50cnkua2V5ID09PSBPV0wuc2FtZUFzLnZhbHVlICYmIGVudHJ5LnZhbHVlOyB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZvckVhY2goZnVuY3Rpb24gKGVudHJ5KSB7IHJldHVybiBwcm9wcy5wdXNoKG5ldyBQcm9wZXJ0eUFuZFZhbHVlKE9XTC5zYW1lQXMsIERhdGFGYWN0b3J5Lmluc3RhbmNlLm5hbWVkTm9kZShlbnRyeS52YWx1ZSkpKTsgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5maWJyYVNlcnZpY2UuZGlzcGF0Y2hBY3Rpb24oX3RoaXMuZmlicmFTZXJ2aWNlLml0ZW1Qcm9wZXJ0eShuZXcgTmFtZWROb2RlKHJvd1snRmlicmFJZCddKSwgcHJvcHMpKTtcbiAgICAgICAgICAgICAgICB9KSkudGhlbihmdW5jdGlvbiAoc3RhdGVzKSB7IHJldHVybiBzdGF0ZXNbc3RhdGVzLmxlbmd0aCAtIDFdOyB9KVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIF90aGlzLiRxLmFsbChwcm9tcykudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuZmlicmFTZXJ2aWNlLmRpc3BhdGNoKCdjaGFuZ2UnKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICByZWFkZXIucmVhZEFzVGV4dCh0aGlzLmZpbGVJbnB1dC5maWxlc1swXSk7XG4gICAgICAgIC8vIFdlIG5lZWQgdG8gY2xlYXIgdGhlIGlucHV0IHNvIHRoYXQgd2UgcGljayB1cCBmdXR1cmUgdXBsb2Fkcy4gVGhpcyBpcyAqbm90KlxuICAgICAgICAvLyBjcm9zcy1icm93c2VyLWNvbXBhdGlibGUuXG4gICAgICAgIHRoaXMuZmlsZUlucHV0LnZhbHVlID0gbnVsbDtcbiAgICAgICAgdGhpcy5vblVwbG9hZCgpO1xuICAgIH07XG4gICAgcmV0dXJuIFVwbG9hZENvbXBvbmVudENvbnRyb2xsZXI7XG59KCkpO1xuZXhwb3J0IHsgVXBsb2FkQ29tcG9uZW50Q29udHJvbGxlciB9O1xudmFyIFVwbG9hZENvbXBvbmVudCA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gVXBsb2FkQ29tcG9uZW50KCkge1xuICAgICAgICB0aGlzLmNvbnRyb2xsZXIgPSBVcGxvYWRDb21wb25lbnRDb250cm9sbGVyOyAvLyAobmV3ICguLi5hcmdzOiBhbnlbXSkgPT4gYW5ndWxhci5JQ29udHJvbGxlcikgPSBTZWxlY3RWaWV3Q29tcG9uZW50Q29udHJvbGxlclxuICAgICAgICB0aGlzLnRlbXBsYXRlID0gcmVxdWlyZSgnLi91cGxvYWQucHVnJykoKTtcbiAgICAgICAgdGhpcy5iaW5kaW5ncyA9IHtcbiAgICAgICAgICAgIG9uVXBsb2FkOiAnJidcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIFVwbG9hZENvbXBvbmVudDtcbn0oKSk7XG5leHBvcnQgeyBVcGxvYWRDb21wb25lbnQgfTtcbmFuZ3VsYXIubW9kdWxlKCdmaWJyYS5jb21wb25lbnRzLnVwbG9hZCcsIFtdKVxuICAgIC5jb21wb25lbnQoJ3VwbG9hZCcsIG5ldyBVcGxvYWRDb21wb25lbnQoKSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL2NvbXBvbmVudHMvdXBsb2FkL3VwbG9hZC1jb21wb25lbnQudHMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUVBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),

/***/ "./app/reducers/types.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__actions_types__ = __webpack_require__(\"./app/actions/types.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__components_tree_tree_component__ = __webpack_require__(\"./app/components/tree/tree-component.ts\");\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = types;\n\n\nfunction types(state, action) {\n    if (state === void 0) {\n        state = { userTypes: [], types: [], displayTypes: [] };\n    }\n    switch (action.type) {\n        case __WEBPACK_IMPORTED_MODULE_0__actions_types__[\"ADD_TYPE\"]:\n            // Check if this matches any user-defined types and remove them if so\n            var dupType = state.userTypes.filter(function (tn) {\n                return tn.id === action.payload.id;\n            })[0];\n            var newUserTypes = state.userTypes.slice(0);\n            if (dupType) newUserTypes.splice(state.userTypes.indexOf(dupType), 1);\n            var newTypes = state.types.slice(0);\n            newTypes.push(action.payload);\n            return Object.assign({}, state, {\n                types: newTypes,\n                userTypes: newUserTypes\n            });\n        case __WEBPACK_IMPORTED_MODULE_0__actions_types__[\"CLEAR_TYPES\"]:\n            return Object.assign({}, state, {\n                types: []\n            });\n        case __WEBPACK_IMPORTED_MODULE_0__actions_types__[\"SET_ORDERED_TYPES\"]:\n            return Object.assign({}, state, {\n                displayTypes: action.payload\n            });\n        case __WEBPACK_IMPORTED_MODULE_0__actions_types__[\"TYPE_CREATED\"]:\n            var tn = new __WEBPACK_IMPORTED_MODULE_1__components_tree_tree_component__[\"a\" /* TreeNode */](action.payload.node.value, action.payload.label);\n            var newUserTypes2 = state.userTypes.slice(0);\n            newUserTypes2.push(tn);\n            return Object.assign({}, state, {\n                userTypes: newUserTypes2\n            });\n        default:\n            return state;\n    }\n}//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvcmVkdWNlcnMvdHlwZXMudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3JlZHVjZXJzL3R5cGVzLnRzPzQ3NzYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQUREX1RZUEUsIENMRUFSX1RZUEVTLCBTRVRfT1JERVJFRF9UWVBFUywgVFlQRV9DUkVBVEVEIH0gZnJvbSAnLi4vYWN0aW9ucy90eXBlcyc7XG5pbXBvcnQgeyBUcmVlTm9kZSB9IGZyb20gJy4uL2NvbXBvbmVudHMvdHJlZS90cmVlLWNvbXBvbmVudCc7XG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiB0eXBlcyhzdGF0ZSwgYWN0aW9uKSB7XG4gICAgaWYgKHN0YXRlID09PSB2b2lkIDApIHsgc3RhdGUgPSB7IHVzZXJUeXBlczogW10sIHR5cGVzOiBbXSwgZGlzcGxheVR5cGVzOiBbXSB9OyB9XG4gICAgc3dpdGNoIChhY3Rpb24udHlwZSkge1xuICAgICAgICBjYXNlIEFERF9UWVBFOlxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBtYXRjaGVzIGFueSB1c2VyLWRlZmluZWQgdHlwZXMgYW5kIHJlbW92ZSB0aGVtIGlmIHNvXG4gICAgICAgICAgICB2YXIgZHVwVHlwZSA9IHN0YXRlLnVzZXJUeXBlcy5maWx0ZXIoZnVuY3Rpb24gKHRuKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRuLmlkID09PSBhY3Rpb24ucGF5bG9hZC5pZDtcbiAgICAgICAgICAgIH0pWzBdO1xuICAgICAgICAgICAgdmFyIG5ld1VzZXJUeXBlcyA9IHN0YXRlLnVzZXJUeXBlcy5zbGljZSgwKTtcbiAgICAgICAgICAgIGlmIChkdXBUeXBlKVxuICAgICAgICAgICAgICAgIG5ld1VzZXJUeXBlcy5zcGxpY2Uoc3RhdGUudXNlclR5cGVzLmluZGV4T2YoZHVwVHlwZSksIDEpO1xuICAgICAgICAgICAgdmFyIG5ld1R5cGVzID0gc3RhdGUudHlwZXMuc2xpY2UoMCk7XG4gICAgICAgICAgICBuZXdUeXBlcy5wdXNoKGFjdGlvbi5wYXlsb2FkKTtcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCBzdGF0ZSwge1xuICAgICAgICAgICAgICAgIHR5cGVzOiBuZXdUeXBlcyxcbiAgICAgICAgICAgICAgICB1c2VyVHlwZXM6IG5ld1VzZXJUeXBlc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIGNhc2UgQ0xFQVJfVFlQRVM6XG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgc3RhdGUsIHtcbiAgICAgICAgICAgICAgICB0eXBlczogW11cbiAgICAgICAgICAgIH0pO1xuICAgICAgICBjYXNlIFNFVF9PUkRFUkVEX1RZUEVTOlxuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIHN0YXRlLCB7XG4gICAgICAgICAgICAgICAgZGlzcGxheVR5cGVzOiBhY3Rpb24ucGF5bG9hZFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIGNhc2UgVFlQRV9DUkVBVEVEOlxuICAgICAgICAgICAgdmFyIHRuID0gbmV3IFRyZWVOb2RlKGFjdGlvbi5wYXlsb2FkLm5vZGUudmFsdWUsIGFjdGlvbi5wYXlsb2FkLmxhYmVsKTtcbiAgICAgICAgICAgIHZhciBuZXdVc2VyVHlwZXMyID0gc3RhdGUudXNlclR5cGVzLnNsaWNlKDApO1xuICAgICAgICAgICAgbmV3VXNlclR5cGVzMi5wdXNoKHRuKTtcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCBzdGF0ZSwge1xuICAgICAgICAgICAgICAgIHVzZXJUeXBlczogbmV3VXNlclR5cGVzMlxuICAgICAgICAgICAgfSk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgfVxufVxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGFwcC9yZWR1Y2Vycy90eXBlcy50cyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUEvQkE7QUFpQ0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ })

})