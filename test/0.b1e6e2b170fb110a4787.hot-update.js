webpackHotUpdate(0,{

/***/ "./app/app/app-configuration-ui.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_angular__);\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = toastConfig;\n/* harmony export (immutable) */ __webpack_exports__[\"b\"] = uiConfig;\n/* harmony export (immutable) */ __webpack_exports__[\"c\"] = localStorageConfig;\n/* harmony export (immutable) */ __webpack_exports__[\"d\"] = uiRun;\n\n\n\nfunction toastConfig(toastrConfig) {\n    'ngInject'; // needed when directly exporting a class or function\n\n    __WEBPACK_IMPORTED_MODULE_0_angular__[\"extend\"](toastrConfig, { positionClass: 'toast-top-full-width' });\n}\nfunction uiConfig($stateProvider, $urlServiceProvider, $locationProvider, $uiRouterProvider) {\n    'ngInject'; // needed when directly exporting a class or function\n\n    $urlServiceProvider.rules.otherwise(function (match, url, router) {\n        // Manually parse the search because it is not visible to Angular.\n        var search = url.search;\n        window.location.search.replace('?', '').split('&').forEach(function (pair) {\n            var pa = pair.split('=');\n            search[pa[0]] = pa[1];\n        });\n        if (search['code']) {\n            $uiRouterProvider.stateService.go('callback', search);\n        } else {\n            $uiRouterProvider.stateService.go('projects');\n        }\n    });\n    $stateProvider.state('projects', {\n        url: '/projects',\n        template: '<projects-view></projects-view>'\n    });\n    $stateProvider.state('rdfstoreTest', {\n        url: '/rdfstore-test',\n        template: '<rdfstore-test-view></rdfstore-test-view>'\n    });\n    $stateProvider.state('projectSources', {\n        url: '/project-sources?sourceId&sparqlEndpoint&updateEndpoint&graphStoreEndpoint&graph&type',\n        template: '<project-sources-view></project-sources-view>'\n    });\n    $stateProvider.state('projectSourceConfigurations', {\n        url: '/project-source-configurations?sourceId',\n        template: '<project-source-configurations-view></project-source-configurations-view>'\n    });\n    $stateProvider.state('editPrimaryEndpointConfiguration', {\n        url: '/edit-primary-endpoint-configuration?sourceId&id',\n        template: '<edit-primary-endpoint-configuration-view></edit-primary-endpoint-configuration-view>'\n    });\n    $stateProvider.state('editRemoteEndpointConfiguration', {\n        url: '/edit-remote-endpoint-configuration?sourceId&id',\n        template: '<edit-remote-endpoint-configuration-view></edit-remote-endpoint-configuration-view>'\n    });\n    $stateProvider.state('editSchema', {\n        url: '/edit-schema?sourceId&id',\n        template: '<edit-schema-view></edit-schema-view>'\n    });\n    $stateProvider.state('configure', {\n        url: '/configure?sourceId&id',\n        template: '<configure-view></configure-view>'\n    });\n    $stateProvider.state('construct', {\n        url: '/construct?id&sparqlEndpoint&graph',\n        resolve: { project: function (projectService, fibraService, $stateParams) {\n                return projectService.loadProject({ sparqlEndpoint: $stateParams.sparqlEndpoint, graph: $stateParams.graph }, $stateParams.id, true).then(function (project) {\n                    return fibraService.dispatchAction(fibraService.setProject(project));\n                });\n            }\n        },\n        template: '<construct-view></construct-view>'\n    });\n    $stateProvider.state('author', {\n        url: '/author?id&sparqlEndpoint&graph',\n        resolve: { project: function (projectService, fibraService, $stateParams) {\n                return projectService.loadProject({ sparqlEndpoint: $stateParams.sparqlEndpoint, graph: $stateParams.graph }, $stateParams.id, true).then(function (project) {\n                    return fibraService.dispatchAction(fibraService.setProject(project));\n                });\n            }\n        },\n        template: '<author-view></author-view>'\n    });\n    $stateProvider.state('login', {\n        url: '/login',\n        template: '<login></login>',\n        params: {\n            redirect_hash: {\n                type: 'string',\n                value: ''\n            }\n        }\n    });\n    $stateProvider.state('callback', {\n        url: '/callback',\n        template: '<callback></callback>',\n        params: {\n            code: {\n                type: 'string',\n                array: false,\n                value: ''\n            }\n        }\n    });\n}\nfunction localStorageConfig($localStorageProvider) {\n    'ngInject'; // needed when directly exporting a class or function\n\n    $localStorageProvider.setKeyPrefix('fibra-');\n}\nfunction uiRun($rootScope, $localStorage, $http, $state, authService, $location, workerService, socialAuthService, $window, $transitions) {\n    'ngInject'; // needed when directly exporting a class or function\n\n    $rootScope.authInfo = {\n        authOpen: false,\n        username: undefined,\n        password: undefined\n    };\n    if ($localStorage.authorization) {\n        $http.defaults.headers.common['Authorization'] = $localStorage.authorization;\n        workerService.$broadcast('main:auth-loginAuthInfo', $localStorage.authorization);\n    }\n    $rootScope.setAuth = function () {\n        $rootScope.authInfo.authOpen = false;\n        $localStorage.authorization = 'Basic ' + btoa($rootScope.authInfo.username + ':' + $rootScope.authInfo.password);\n        $http.defaults.headers.common['Authorization'] = $localStorage.authorization;\n        workerService.$broadcast('main:auth-loginAuthInfo', $localStorage.authorization);\n        authService.loginConfirmed();\n    };\n    $rootScope.dismissAuth = function () {\n        $rootScope.authInfo.authOpen = false;\n        authService.loginCancelled({ status: 401 }, 'Authentication required');\n    };\n    $rootScope.$on('event:auth-loginRequired', function () {\n        return $rootScope.authInfo.authOpen = true;\n    });\n    // Social logon\n    var requiresAuthCriteria = {\n        to: function (state) {\n            return state.data && state.data.requiresAuth;\n        }\n    };\n    // Function that returns a redirect for the current transition to the login state\n    // if the user is not currently authenticated (according to the AuthService)\n    var redirectToLogin = function (transition) {\n        if (!socialAuthService.isAuthenticated()) {\n            // Save state token on local storage.\n            return transition.router.stateService.target('login', { redirect_hash: window.location.hash });\n        }\n    };\n    $rootScope.socialAuthService = socialAuthService;\n    // Register the \"requires auth\" hook with the TransitionsService\n    // Turn this off for the moment - go to #/login to login.\n    $transitions.onBefore(requiresAuthCriteria, redirectToLogin, { priority: 10 });\n    // add info on which view we're in to the page title (currently just the raw view name)\n    $transitions.onSuccess({}, function (transition) {\n        return $rootScope.viewName = transition._targetState.name();\n    });\n}//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvYXBwL2FwcC1jb25maWd1cmF0aW9uLXVpLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL2FwcC9hcHAvYXBwLWNvbmZpZ3VyYXRpb24tdWkudHM/MzM2NyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5pbXBvcnQgKiBhcyBhbmd1bGFyIGZyb20gJ2FuZ3VsYXInO1xuZXhwb3J0IGZ1bmN0aW9uIHRvYXN0Q29uZmlnKHRvYXN0ckNvbmZpZykge1xuICAgICduZ0luamVjdCc7IC8vIG5lZWRlZCB3aGVuIGRpcmVjdGx5IGV4cG9ydGluZyBhIGNsYXNzIG9yIGZ1bmN0aW9uXG4gICAgYW5ndWxhci5leHRlbmQodG9hc3RyQ29uZmlnLCB7IHBvc2l0aW9uQ2xhc3M6ICd0b2FzdC10b3AtZnVsbC13aWR0aCcgfSk7XG59XG5leHBvcnQgZnVuY3Rpb24gdWlDb25maWcoJHN0YXRlUHJvdmlkZXIsICR1cmxTZXJ2aWNlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyLCAkdWlSb3V0ZXJQcm92aWRlcikge1xuICAgICduZ0luamVjdCc7IC8vIG5lZWRlZCB3aGVuIGRpcmVjdGx5IGV4cG9ydGluZyBhIGNsYXNzIG9yIGZ1bmN0aW9uXG4gICAgJHVybFNlcnZpY2VQcm92aWRlci5ydWxlcy5vdGhlcndpc2UoZnVuY3Rpb24gKG1hdGNoLCB1cmwsIHJvdXRlcikge1xuICAgICAgICAvLyBNYW51YWxseSBwYXJzZSB0aGUgc2VhcmNoIGJlY2F1c2UgaXQgaXMgbm90IHZpc2libGUgdG8gQW5ndWxhci5cbiAgICAgICAgdmFyIHNlYXJjaCA9IHVybC5zZWFyY2g7XG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gucmVwbGFjZSgnPycsICcnKS5zcGxpdCgnJicpLmZvckVhY2goZnVuY3Rpb24gKHBhaXIpIHtcbiAgICAgICAgICAgIHZhciBwYSA9IHBhaXIuc3BsaXQoJz0nKTtcbiAgICAgICAgICAgIHNlYXJjaFtwYVswXV0gPSBwYVsxXTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChzZWFyY2hbJ2NvZGUnXSkge1xuICAgICAgICAgICAgJHVpUm91dGVyUHJvdmlkZXIuc3RhdGVTZXJ2aWNlLmdvKCdjYWxsYmFjaycsIHNlYXJjaCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkdWlSb3V0ZXJQcm92aWRlci5zdGF0ZVNlcnZpY2UuZ28oJ3Byb2plY3RzJyk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgncHJvamVjdHMnLCB7XG4gICAgICAgIHVybDogJy9wcm9qZWN0cycsXG4gICAgICAgIHRlbXBsYXRlOiAnPHByb2plY3RzLXZpZXc+PC9wcm9qZWN0cy12aWV3PidcbiAgICB9KTtcbiAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgncmRmc3RvcmVUZXN0Jywge1xuICAgICAgICB1cmw6ICcvcmRmc3RvcmUtdGVzdCcsXG4gICAgICAgIHRlbXBsYXRlOiAnPHJkZnN0b3JlLXRlc3Qtdmlldz48L3JkZnN0b3JlLXRlc3Qtdmlldz4nXG4gICAgfSk7XG4gICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ3Byb2plY3RTb3VyY2VzJywge1xuICAgICAgICB1cmw6ICcvcHJvamVjdC1zb3VyY2VzP3NvdXJjZUlkJnNwYXJxbEVuZHBvaW50JnVwZGF0ZUVuZHBvaW50JmdyYXBoU3RvcmVFbmRwb2ludCZncmFwaCZ0eXBlJyxcbiAgICAgICAgdGVtcGxhdGU6ICc8cHJvamVjdC1zb3VyY2VzLXZpZXc+PC9wcm9qZWN0LXNvdXJjZXMtdmlldz4nLFxuICAgIH0pO1xuICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdwcm9qZWN0U291cmNlQ29uZmlndXJhdGlvbnMnLCB7XG4gICAgICAgIHVybDogJy9wcm9qZWN0LXNvdXJjZS1jb25maWd1cmF0aW9ucz9zb3VyY2VJZCcsXG4gICAgICAgIHRlbXBsYXRlOiAnPHByb2plY3Qtc291cmNlLWNvbmZpZ3VyYXRpb25zLXZpZXc+PC9wcm9qZWN0LXNvdXJjZS1jb25maWd1cmF0aW9ucy12aWV3PicsXG4gICAgfSk7XG4gICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2VkaXRQcmltYXJ5RW5kcG9pbnRDb25maWd1cmF0aW9uJywge1xuICAgICAgICB1cmw6ICcvZWRpdC1wcmltYXJ5LWVuZHBvaW50LWNvbmZpZ3VyYXRpb24/c291cmNlSWQmaWQnLFxuICAgICAgICB0ZW1wbGF0ZTogJzxlZGl0LXByaW1hcnktZW5kcG9pbnQtY29uZmlndXJhdGlvbi12aWV3PjwvZWRpdC1wcmltYXJ5LWVuZHBvaW50LWNvbmZpZ3VyYXRpb24tdmlldz4nLFxuICAgIH0pO1xuICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdlZGl0UmVtb3RlRW5kcG9pbnRDb25maWd1cmF0aW9uJywge1xuICAgICAgICB1cmw6ICcvZWRpdC1yZW1vdGUtZW5kcG9pbnQtY29uZmlndXJhdGlvbj9zb3VyY2VJZCZpZCcsXG4gICAgICAgIHRlbXBsYXRlOiAnPGVkaXQtcmVtb3RlLWVuZHBvaW50LWNvbmZpZ3VyYXRpb24tdmlldz48L2VkaXQtcmVtb3RlLWVuZHBvaW50LWNvbmZpZ3VyYXRpb24tdmlldz4nLFxuICAgIH0pO1xuICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdlZGl0U2NoZW1hJywge1xuICAgICAgICB1cmw6ICcvZWRpdC1zY2hlbWE/c291cmNlSWQmaWQnLFxuICAgICAgICB0ZW1wbGF0ZTogJzxlZGl0LXNjaGVtYS12aWV3PjwvZWRpdC1zY2hlbWEtdmlldz4nLFxuICAgIH0pO1xuICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdjb25maWd1cmUnLCB7XG4gICAgICAgIHVybDogJy9jb25maWd1cmU/c291cmNlSWQmaWQnLFxuICAgICAgICB0ZW1wbGF0ZTogJzxjb25maWd1cmUtdmlldz48L2NvbmZpZ3VyZS12aWV3PidcbiAgICB9KTtcbiAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnY29uc3RydWN0Jywge1xuICAgICAgICB1cmw6ICcvY29uc3RydWN0P2lkJnNwYXJxbEVuZHBvaW50JmdyYXBoJyxcbiAgICAgICAgcmVzb2x2ZTogeyBwcm9qZWN0OiBmdW5jdGlvbiAocHJvamVjdFNlcnZpY2UsIGZpYnJhU2VydmljZSwgJHN0YXRlUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb2plY3RTZXJ2aWNlLmxvYWRQcm9qZWN0KHsgc3BhcnFsRW5kcG9pbnQ6ICRzdGF0ZVBhcmFtcy5zcGFycWxFbmRwb2ludCwgZ3JhcGg6ICRzdGF0ZVBhcmFtcy5ncmFwaCB9LCAkc3RhdGVQYXJhbXMuaWQsIHRydWUpLnRoZW4oZnVuY3Rpb24gKHByb2plY3QpIHsgcmV0dXJuIGZpYnJhU2VydmljZS5kaXNwYXRjaEFjdGlvbihmaWJyYVNlcnZpY2Uuc2V0UHJvamVjdChwcm9qZWN0KSk7IH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB0ZW1wbGF0ZTogJzxjb25zdHJ1Y3Qtdmlldz48L2NvbnN0cnVjdC12aWV3PicsXG4gICAgfSk7XG4gICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2F1dGhvcicsIHtcbiAgICAgICAgdXJsOiAnL2F1dGhvcj9pZCZzcGFycWxFbmRwb2ludCZncmFwaCcsXG4gICAgICAgIHJlc29sdmU6IHsgcHJvamVjdDogZnVuY3Rpb24gKHByb2plY3RTZXJ2aWNlLCBmaWJyYVNlcnZpY2UsICRzdGF0ZVBhcmFtcykge1xuICAgICAgICAgICAgICAgIHJldHVybiBwcm9qZWN0U2VydmljZS5sb2FkUHJvamVjdCh7IHNwYXJxbEVuZHBvaW50OiAkc3RhdGVQYXJhbXMuc3BhcnFsRW5kcG9pbnQsIGdyYXBoOiAkc3RhdGVQYXJhbXMuZ3JhcGggfSwgJHN0YXRlUGFyYW1zLmlkLCB0cnVlKS50aGVuKGZ1bmN0aW9uIChwcm9qZWN0KSB7IHJldHVybiBmaWJyYVNlcnZpY2UuZGlzcGF0Y2hBY3Rpb24oZmlicmFTZXJ2aWNlLnNldFByb2plY3QocHJvamVjdCkpOyB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgdGVtcGxhdGU6ICc8YXV0aG9yLXZpZXc+PC9hdXRob3Itdmlldz4nLFxuICAgIH0pO1xuICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdsb2dpbicsIHtcbiAgICAgICAgdXJsOiAnL2xvZ2luJyxcbiAgICAgICAgdGVtcGxhdGU6ICc8bG9naW4+PC9sb2dpbj4nLFxuICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICAgIHJlZGlyZWN0X2hhc2g6IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogJydcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdjYWxsYmFjaycsIHtcbiAgICAgICAgdXJsOiAnL2NhbGxiYWNrJyxcbiAgICAgICAgdGVtcGxhdGU6ICc8Y2FsbGJhY2s+PC9jYWxsYmFjaz4nLFxuICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICAgIGNvZGU6IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICAgICAgICAgICAgdmFsdWU6ICcnXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBsb2NhbFN0b3JhZ2VDb25maWcoJGxvY2FsU3RvcmFnZVByb3ZpZGVyKSB7XG4gICAgJ25nSW5qZWN0JzsgLy8gbmVlZGVkIHdoZW4gZGlyZWN0bHkgZXhwb3J0aW5nIGEgY2xhc3Mgb3IgZnVuY3Rpb25cbiAgICAkbG9jYWxTdG9yYWdlUHJvdmlkZXIuc2V0S2V5UHJlZml4KCdmaWJyYS0nKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB1aVJ1bigkcm9vdFNjb3BlLCAkbG9jYWxTdG9yYWdlLCAkaHR0cCwgJHN0YXRlLCBhdXRoU2VydmljZSwgJGxvY2F0aW9uLCB3b3JrZXJTZXJ2aWNlLCBzb2NpYWxBdXRoU2VydmljZSwgJHdpbmRvdywgJHRyYW5zaXRpb25zKSB7XG4gICAgJ25nSW5qZWN0JzsgLy8gbmVlZGVkIHdoZW4gZGlyZWN0bHkgZXhwb3J0aW5nIGEgY2xhc3Mgb3IgZnVuY3Rpb25cbiAgICAkcm9vdFNjb3BlLmF1dGhJbmZvID0ge1xuICAgICAgICBhdXRoT3BlbjogZmFsc2UsXG4gICAgICAgIHVzZXJuYW1lOiB1bmRlZmluZWQsXG4gICAgICAgIHBhc3N3b3JkOiB1bmRlZmluZWRcbiAgICB9O1xuICAgIGlmICgkbG9jYWxTdG9yYWdlLmF1dGhvcml6YXRpb24pIHtcbiAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ0F1dGhvcml6YXRpb24nXSA9ICRsb2NhbFN0b3JhZ2UuYXV0aG9yaXphdGlvbjtcbiAgICAgICAgd29ya2VyU2VydmljZS4kYnJvYWRjYXN0KCdtYWluOmF1dGgtbG9naW5BdXRoSW5mbycsICRsb2NhbFN0b3JhZ2UuYXV0aG9yaXphdGlvbik7XG4gICAgfVxuICAgICRyb290U2NvcGUuc2V0QXV0aCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJHJvb3RTY29wZS5hdXRoSW5mby5hdXRoT3BlbiA9IGZhbHNlO1xuICAgICAgICAkbG9jYWxTdG9yYWdlLmF1dGhvcml6YXRpb24gPSAnQmFzaWMgJyArIGJ0b2EoJHJvb3RTY29wZS5hdXRoSW5mby51c2VybmFtZSArICc6JyArICRyb290U2NvcGUuYXV0aEluZm8ucGFzc3dvcmQpO1xuICAgICAgICAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnQXV0aG9yaXphdGlvbiddID0gJGxvY2FsU3RvcmFnZS5hdXRob3JpemF0aW9uO1xuICAgICAgICB3b3JrZXJTZXJ2aWNlLiRicm9hZGNhc3QoJ21haW46YXV0aC1sb2dpbkF1dGhJbmZvJywgJGxvY2FsU3RvcmFnZS5hdXRob3JpemF0aW9uKTtcbiAgICAgICAgYXV0aFNlcnZpY2UubG9naW5Db25maXJtZWQoKTtcbiAgICB9O1xuICAgICRyb290U2NvcGUuZGlzbWlzc0F1dGggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICRyb290U2NvcGUuYXV0aEluZm8uYXV0aE9wZW4gPSBmYWxzZTtcbiAgICAgICAgYXV0aFNlcnZpY2UubG9naW5DYW5jZWxsZWQoeyBzdGF0dXM6IDQwMSB9LCAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnKTtcbiAgICB9O1xuICAgICRyb290U2NvcGUuJG9uKCdldmVudDphdXRoLWxvZ2luUmVxdWlyZWQnLCBmdW5jdGlvbiAoKSB7IHJldHVybiAkcm9vdFNjb3BlLmF1dGhJbmZvLmF1dGhPcGVuID0gdHJ1ZTsgfSk7XG4gICAgLy8gU29jaWFsIGxvZ29uXG4gICAgdmFyIHJlcXVpcmVzQXV0aENyaXRlcmlhID0ge1xuICAgICAgICB0bzogZnVuY3Rpb24gKHN0YXRlKSB7IHJldHVybiBzdGF0ZS5kYXRhICYmIHN0YXRlLmRhdGEucmVxdWlyZXNBdXRoOyB9XG4gICAgfTtcbiAgICAvLyBGdW5jdGlvbiB0aGF0IHJldHVybnMgYSByZWRpcmVjdCBmb3IgdGhlIGN1cnJlbnQgdHJhbnNpdGlvbiB0byB0aGUgbG9naW4gc3RhdGVcbiAgICAvLyBpZiB0aGUgdXNlciBpcyBub3QgY3VycmVudGx5IGF1dGhlbnRpY2F0ZWQgKGFjY29yZGluZyB0byB0aGUgQXV0aFNlcnZpY2UpXG4gICAgdmFyIHJlZGlyZWN0VG9Mb2dpbiA9IGZ1bmN0aW9uICh0cmFuc2l0aW9uKSB7XG4gICAgICAgIGlmICghc29jaWFsQXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkKCkpIHtcbiAgICAgICAgICAgIC8vIFNhdmUgc3RhdGUgdG9rZW4gb24gbG9jYWwgc3RvcmFnZS5cbiAgICAgICAgICAgIHJldHVybiB0cmFuc2l0aW9uLnJvdXRlci5zdGF0ZVNlcnZpY2UudGFyZ2V0KCdsb2dpbicsIHsgcmVkaXJlY3RfaGFzaDogd2luZG93LmxvY2F0aW9uLmhhc2ggfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgICRyb290U2NvcGUuc29jaWFsQXV0aFNlcnZpY2UgPSBzb2NpYWxBdXRoU2VydmljZTtcbiAgICAvLyBSZWdpc3RlciB0aGUgXCJyZXF1aXJlcyBhdXRoXCIgaG9vayB3aXRoIHRoZSBUcmFuc2l0aW9uc1NlcnZpY2VcbiAgICAvLyBUdXJuIHRoaXMgb2ZmIGZvciB0aGUgbW9tZW50IC0gZ28gdG8gIy9sb2dpbiB0byBsb2dpbi5cbiAgICAkdHJhbnNpdGlvbnMub25CZWZvcmUocmVxdWlyZXNBdXRoQ3JpdGVyaWEsIHJlZGlyZWN0VG9Mb2dpbiwgeyBwcmlvcml0eTogMTAgfSk7XG4gICAgLy8gYWRkIGluZm8gb24gd2hpY2ggdmlldyB3ZSdyZSBpbiB0byB0aGUgcGFnZSB0aXRsZSAoY3VycmVudGx5IGp1c3QgdGhlIHJhdyB2aWV3IG5hbWUpXG4gICAgJHRyYW5zaXRpb25zLm9uU3VjY2Vzcyh7fSwgZnVuY3Rpb24gKHRyYW5zaXRpb24pIHsgcmV0dXJuICRyb290U2NvcGUudmlld05hbWUgPSB0cmFuc2l0aW9uLl90YXJnZXRTdGF0ZS5uYW1lKCk7IH0pO1xufVxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGFwcC9hcHAvYXBwLWNvbmZpZ3VyYXRpb24tdWkudHMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUZBO0FBSUE7QUFOQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBRkE7QUFJQTtBQU5BO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQURBO0FBSEE7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFEQTtBQUhBO0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),

/***/ "./app/components/citable-editor/citable-editor-component.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__models_citable__ = __webpack_require__(\"./app/models/citable.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__misc_utils__ = __webpack_require__(\"./app/components/misc-utils.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__models_rdf__ = __webpack_require__(\"./app/models/rdf.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_angular__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return EditCitableComponentController; });\n/* unused harmony export CitableEditorComponentController */\n/* unused harmony export CitableEditorComponent */\n\n\n\n\n\n\nvar EditCitableComponentController = function () {\n    function EditCitableComponentController(sourceId, projectService, toastr) {\n        this.projectService = projectService;\n        this.toastr = toastr;\n        this.disabled = false;\n        this.projectSources = projectService.getProjectSources();\n        this.projectSource = this.projectSources.find(function (cs2) {\n            return cs2.id === sourceId;\n        });\n    }\n    EditCitableComponentController.prototype.delete = function () {\n        var _this = this;\n        this.disabled = true;\n        this.projectService.deleteCitable(this.projectSource.updateEndpoint, this.c).then(function () {\n            _this.toastr.success('Resource deleted');\n            _this.disabled = false;\n        }, function (err) {\n            _this.toastr.error('Error deleting resource', err);\n            _this.disabled = false;\n        });\n    };\n    EditCitableComponentController.prototype.save = function () {\n        var _this = this;\n        this.disabled = true;\n        this.c.source = this.projectSource;\n        this.projectService.saveCitable(this.projectSource.updateEndpoint, this.projectSource.graphStoreEndpoint, this.c).then(function () {\n            _this.toastr.success('Resource saved');\n            _this.disabled = false;\n        }, function (err) {\n            _this.toastr.error('Error saving resource', err);\n            _this.disabled = false;\n        });\n    };\n    return EditCitableComponentController;\n}();\n\nvar CitableEditorComponentController = function () {\n    function CitableEditorComponentController(fibraService) {\n        this.fibraService = fibraService;\n    }\n    CitableEditorComponentController.prototype.addRightsHolder = function () {\n        var c = new __WEBPACK_IMPORTED_MODULE_0__models_citable__[\"a\" /* Citable */]('http://ldf.fi/fibra/citable_' + __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__misc_utils__[\"b\" /* UUID */])());\n        c.labels = [__WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"b\" /* DataFactory */].literal('', this.fibraService.getState().language)];\n        c.descriptions = [__WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"b\" /* DataFactory */].literal('', this.fibraService.getState().language)];\n        this.citable.rightsHolders.push(c);\n    };\n    CitableEditorComponentController.prototype.addLabel = function () {\n        this.citable.labels.push(__WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"b\" /* DataFactory */].literal('', ''));\n    };\n    CitableEditorComponentController.prototype.addDescription = function () {\n        this.citable.descriptions.push(__WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"b\" /* DataFactory */].literal('', ''));\n    };\n    CitableEditorComponentController.prototype.removeLabel = function (index) {\n        this.citable.labels.splice(index, 1);\n    };\n    CitableEditorComponentController.prototype.removeDescription = function (index) {\n        this.citable.descriptions.splice(index, 1);\n    };\n    return CitableEditorComponentController;\n}();\n\nvar CitableEditorComponent = function () {\n    function CitableEditorComponent() {\n        this.bindings = {\n            citable: '=',\n            noRightsHolders: '@',\n            noId: '@',\n            noRightsHolderIds: '@'\n        };\n        this.controller = CitableEditorComponentController; // (new (...args: any[]) => angular.IController) = ConfigureViewComponentController\n        this.template = __webpack_require__(\"./app/components/citable-editor/citable-editor.pug\")();\n    }\n    return CitableEditorComponent;\n}();\n\n__WEBPACK_IMPORTED_MODULE_3_angular__[\"module\"]('fibra.components.citable-editor', ['fibra.services']).component('citableEditor', new CitableEditorComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9jaXRhYmxlLWVkaXRvci9jaXRhYmxlLWVkaXRvci1jb21wb25lbnQudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL2NvbXBvbmVudHMvY2l0YWJsZS1lZGl0b3IvY2l0YWJsZS1lZGl0b3ItY29tcG9uZW50LnRzPzU0ODQiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuaW1wb3J0IHsgQ2l0YWJsZSB9IGZyb20gJy4uLy4uL21vZGVscy9jaXRhYmxlJztcbmltcG9ydCB7IFVVSUQgfSBmcm9tICcuLi9taXNjLXV0aWxzJztcbmltcG9ydCB7IERhdGFGYWN0b3J5IH0gZnJvbSAnLi4vLi4vbW9kZWxzL3JkZic7XG5pbXBvcnQgKiBhcyBhbmd1bGFyIGZyb20gJ2FuZ3VsYXInO1xudmFyIEVkaXRDaXRhYmxlQ29tcG9uZW50Q29udHJvbGxlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRWRpdENpdGFibGVDb21wb25lbnRDb250cm9sbGVyKHNvdXJjZUlkLCBwcm9qZWN0U2VydmljZSwgdG9hc3RyKSB7XG4gICAgICAgIHRoaXMucHJvamVjdFNlcnZpY2UgPSBwcm9qZWN0U2VydmljZTtcbiAgICAgICAgdGhpcy50b2FzdHIgPSB0b2FzdHI7XG4gICAgICAgIHRoaXMuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5wcm9qZWN0U291cmNlcyA9IHByb2plY3RTZXJ2aWNlLmdldFByb2plY3RTb3VyY2VzKCk7XG4gICAgICAgIHRoaXMucHJvamVjdFNvdXJjZSA9IHRoaXMucHJvamVjdFNvdXJjZXMuZmluZChmdW5jdGlvbiAoY3MyKSB7IHJldHVybiBjczIuaWQgPT09IHNvdXJjZUlkOyB9KTtcbiAgICB9XG4gICAgRWRpdENpdGFibGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5kZWxldGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLnByb2plY3RTZXJ2aWNlLmRlbGV0ZUNpdGFibGUodGhpcy5wcm9qZWN0U291cmNlLnVwZGF0ZUVuZHBvaW50LCB0aGlzLmMpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX3RoaXMudG9hc3RyLnN1Y2Nlc3MoJ1Jlc291cmNlIGRlbGV0ZWQnKTtcbiAgICAgICAgICAgIF90aGlzLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIF90aGlzLnRvYXN0ci5lcnJvcignRXJyb3IgZGVsZXRpbmcgcmVzb3VyY2UnLCBlcnIpO1xuICAgICAgICAgICAgX3RoaXMuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBFZGl0Q2l0YWJsZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLnNhdmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmMuc291cmNlID0gdGhpcy5wcm9qZWN0U291cmNlO1xuICAgICAgICB0aGlzLnByb2plY3RTZXJ2aWNlLnNhdmVDaXRhYmxlKHRoaXMucHJvamVjdFNvdXJjZS51cGRhdGVFbmRwb2ludCwgdGhpcy5wcm9qZWN0U291cmNlLmdyYXBoU3RvcmVFbmRwb2ludCwgdGhpcy5jKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF90aGlzLnRvYXN0ci5zdWNjZXNzKCdSZXNvdXJjZSBzYXZlZCcpO1xuICAgICAgICAgICAgX3RoaXMuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgX3RoaXMudG9hc3RyLmVycm9yKCdFcnJvciBzYXZpbmcgcmVzb3VyY2UnLCBlcnIpO1xuICAgICAgICAgICAgX3RoaXMuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICByZXR1cm4gRWRpdENpdGFibGVDb21wb25lbnRDb250cm9sbGVyO1xufSgpKTtcbmV4cG9ydCB7IEVkaXRDaXRhYmxlQ29tcG9uZW50Q29udHJvbGxlciB9O1xudmFyIENpdGFibGVFZGl0b3JDb21wb25lbnRDb250cm9sbGVyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBDaXRhYmxlRWRpdG9yQ29tcG9uZW50Q29udHJvbGxlcihmaWJyYVNlcnZpY2UpIHtcbiAgICAgICAgdGhpcy5maWJyYVNlcnZpY2UgPSBmaWJyYVNlcnZpY2U7XG4gICAgfVxuICAgIENpdGFibGVFZGl0b3JDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5hZGRSaWdodHNIb2xkZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjID0gbmV3IENpdGFibGUoJ2h0dHA6Ly9sZGYuZmkvZmlicmEvY2l0YWJsZV8nICsgVVVJRCgpKTtcbiAgICAgICAgYy5sYWJlbHMgPSBbRGF0YUZhY3RvcnkubGl0ZXJhbCgnJywgdGhpcy5maWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5sYW5ndWFnZSldO1xuICAgICAgICBjLmRlc2NyaXB0aW9ucyA9IFtEYXRhRmFjdG9yeS5saXRlcmFsKCcnLCB0aGlzLmZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLmxhbmd1YWdlKV07XG4gICAgICAgIHRoaXMuY2l0YWJsZS5yaWdodHNIb2xkZXJzLnB1c2goYyk7XG4gICAgfTtcbiAgICBDaXRhYmxlRWRpdG9yQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuYWRkTGFiZWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuY2l0YWJsZS5sYWJlbHMucHVzaChEYXRhRmFjdG9yeS5saXRlcmFsKCcnLCAnJykpO1xuICAgIH07XG4gICAgQ2l0YWJsZUVkaXRvckNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmFkZERlc2NyaXB0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmNpdGFibGUuZGVzY3JpcHRpb25zLnB1c2goRGF0YUZhY3RvcnkubGl0ZXJhbCgnJywgJycpKTtcbiAgICB9O1xuICAgIENpdGFibGVFZGl0b3JDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5yZW1vdmVMYWJlbCA9IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICB0aGlzLmNpdGFibGUubGFiZWxzLnNwbGljZShpbmRleCwgMSk7XG4gICAgfTtcbiAgICBDaXRhYmxlRWRpdG9yQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUucmVtb3ZlRGVzY3JpcHRpb24gPSBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgdGhpcy5jaXRhYmxlLmRlc2NyaXB0aW9ucy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIH07XG4gICAgcmV0dXJuIENpdGFibGVFZGl0b3JDb21wb25lbnRDb250cm9sbGVyO1xufSgpKTtcbmV4cG9ydCB7IENpdGFibGVFZGl0b3JDb21wb25lbnRDb250cm9sbGVyIH07XG52YXIgQ2l0YWJsZUVkaXRvckNvbXBvbmVudCA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQ2l0YWJsZUVkaXRvckNvbXBvbmVudCgpIHtcbiAgICAgICAgdGhpcy5iaW5kaW5ncyA9IHtcbiAgICAgICAgICAgIGNpdGFibGU6ICc9JyxcbiAgICAgICAgICAgIG5vUmlnaHRzSG9sZGVyczogJ0AnLFxuICAgICAgICAgICAgbm9JZDogJ0AnLFxuICAgICAgICAgICAgbm9SaWdodHNIb2xkZXJJZHM6ICdAJ1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNvbnRyb2xsZXIgPSBDaXRhYmxlRWRpdG9yQ29tcG9uZW50Q29udHJvbGxlcjsgLy8gKG5ldyAoLi4uYXJnczogYW55W10pID0+IGFuZ3VsYXIuSUNvbnRyb2xsZXIpID0gQ29uZmlndXJlVmlld0NvbXBvbmVudENvbnRyb2xsZXJcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IHJlcXVpcmUoJy4vY2l0YWJsZS1lZGl0b3IucHVnJykoKTtcbiAgICB9XG4gICAgcmV0dXJuIENpdGFibGVFZGl0b3JDb21wb25lbnQ7XG59KCkpO1xuZXhwb3J0IHsgQ2l0YWJsZUVkaXRvckNvbXBvbmVudCB9O1xuYW5ndWxhci5tb2R1bGUoJ2ZpYnJhLmNvbXBvbmVudHMuY2l0YWJsZS1lZGl0b3InLCBbJ2ZpYnJhLnNlcnZpY2VzJ10pXG4gICAgLmNvbXBvbmVudCgnY2l0YWJsZUVkaXRvcicsIG5ldyBDaXRhYmxlRWRpdG9yQ29tcG9uZW50KCkpO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGFwcC9jb21wb25lbnRzL2NpdGFibGUtZWRpdG9yL2NpdGFibGUtZWRpdG9yLWNvbXBvbmVudC50cyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),

/***/ "./app/components/configure-view/configure-view-component.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__services_project_service_project__ = __webpack_require__(\"./app/services/project-service/project.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__misc_utils__ = __webpack_require__(\"./app/components/misc-utils.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__models_rdf__ = __webpack_require__(\"./app/models/rdf.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_angular__);\n/* unused harmony export ConfigureViewComponentController */\n/* unused harmony export ConfigureViewComponent */\n\n\n\n\n\n\nvar ConfigureViewComponentController = function () {\n    function ConfigureViewComponentController($q, projectService, fibraService, sparqlTreeService, $stateParams, $state) {\n        var _this = this;\n        this.$q = $q;\n        this.projectService = projectService;\n        this.sparqlTreeService = sparqlTreeService;\n        this.$state = $state;\n        this.primaryEndpointConfigurations = [];\n        this.statistics = {};\n        this.selectedAuthorities = {};\n        this.selectedArchives = {};\n        this.selectedSchemas = {};\n        this.schemas = [];\n        this.authorities = [];\n        this.archives = [];\n        this.projectSources = projectService.getProjectSources();\n        this.projectSource = this.projectSources.find(function (ps) {\n            return ps.id === $stateParams.sourceId;\n        });\n        if ($stateParams.id) {\n            projectService.loadProject(this.projectSource, $stateParams.id, false).then(function (p) {\n                _this.project = p;\n                _this.selectedTemplate = p.asTemplate();\n            });\n        } else {\n            var pid = 'http://ldf.fi/fibra/project_' + __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__misc_utils__[\"b\" /* UUID */])();\n            this.project = new __WEBPACK_IMPORTED_MODULE_0__services_project_service_project__[\"a\" /* Project */](pid);\n            this.project.labels = [__WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"b\" /* DataFactory */].literal('', fibraService.getState().language)];\n            this.project.descriptions = [__WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"b\" /* DataFactory */].literal('', fibraService.getState().language)];\n            this.project.source = this.projectSource;\n            this.project.endpoint = this.projectSource.sparqlEndpoint;\n            this.project.updateEndpoint = this.projectSource.updateEndpoint;\n            this.project.graphStoreEndpoint = this.projectSource.graphStoreEndpoint;\n            this.project.graph = pid;\n        }\n        this.projectSources.forEach(function (ps) {\n            projectService.listPrimaryEndpointConfigurations(ps).then(function (pt) {\n                if (!_this.selectedTemplate) {\n                    var matchingEC = pt.find(function (ec) {\n                        return ec.compatibleEndpoints.find(function (et) {\n                            return et === _this.projectSource.type;\n                        }) !== undefined;\n                    });\n                    if (matchingEC) {\n                        _this.selectedTemplate = matchingEC;\n                        _this.changeTemplate();\n                    }\n                }\n                _this.primaryEndpointConfigurations = _this.primaryEndpointConfigurations.concat(pt);\n            });\n            projectService.listAuthorityEndpointConfigurations(ps).then(function (pt) {\n                return _this.authorities = _this.authorities.concat(pt);\n            });\n            projectService.listArchiveEndpointConfigurations(ps).then(function (pt) {\n                return _this.archives = _this.archives.concat(pt);\n            });\n            projectService.listSchemas(ps).then(function (pt) {\n                return _this.schemas = _this.schemas.concat(pt);\n            });\n        });\n    }\n    ConfigureViewComponentController.prototype.saveAndOpen = function () {\n        var _this = this;\n        this.project.authorityEndpoints = this.authorities.filter(function (a) {\n            return _this.selectedAuthorities[a.id];\n        });\n        this.project.archiveEndpoints = this.archives.filter(function (a) {\n            return _this.selectedArchives[a.id];\n        });\n        this.project.schemas = this.schemas.filter(function (a) {\n            return _this.selectedSchemas[a.id];\n        });\n        this.projectService.saveCitable(this.projectSource.updateEndpoint, this.projectSource.graphStoreEndpoint, this.project).then(function () {\n            return _this.$state.go('construct', { id: _this.project.id, sparqlEndpoint: _this.project.source.sparqlEndpoint, graph: _this.project.source.graph });\n        });\n    };\n    ConfigureViewComponentController.prototype.delete = function () {\n        var _this = this;\n        this.projectService.deleteCitable(this.projectSource.updateEndpoint, this.project).then(function () {\n            return _this.$state.go('projects');\n        });\n    };\n    ConfigureViewComponentController.prototype.changeTemplate = function () {\n        if (this.project) this.selectedTemplate.copyToProject(this.project);\n    };\n    return ConfigureViewComponentController;\n}();\n\nvar ConfigureViewComponent = function () {\n    function ConfigureViewComponent() {\n        this.controller = ConfigureViewComponentController; // (new (...args: any[]) => angular.IController) = ConfigureViewComponentController\n        this.template = __webpack_require__(\"./app/components/configure-view/configure-view.pug\")();\n    }\n    return ConfigureViewComponent;\n}();\n\n__WEBPACK_IMPORTED_MODULE_3_angular__[\"module\"]('fibra.components.configure', ['fibra.services']).component('configureView', new ConfigureViewComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9jb25maWd1cmUtdmlldy9jb25maWd1cmUtdmlldy1jb21wb25lbnQudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL2NvbXBvbmVudHMvY29uZmlndXJlLXZpZXcvY29uZmlndXJlLXZpZXctY29tcG9uZW50LnRzPzAxNGUiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuaW1wb3J0IHsgUHJvamVjdCB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3Byb2plY3Qtc2VydmljZS9wcm9qZWN0JztcbmltcG9ydCB7IFVVSUQgfSBmcm9tICcuLi9taXNjLXV0aWxzJztcbmltcG9ydCB7IERhdGFGYWN0b3J5IH0gZnJvbSAnLi4vLi4vbW9kZWxzL3JkZic7XG5pbXBvcnQgKiBhcyBhbmd1bGFyIGZyb20gJ2FuZ3VsYXInO1xudmFyIENvbmZpZ3VyZVZpZXdDb21wb25lbnRDb250cm9sbGVyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBDb25maWd1cmVWaWV3Q29tcG9uZW50Q29udHJvbGxlcigkcSwgcHJvamVjdFNlcnZpY2UsIGZpYnJhU2VydmljZSwgc3BhcnFsVHJlZVNlcnZpY2UsICRzdGF0ZVBhcmFtcywgJHN0YXRlKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuJHEgPSAkcTtcbiAgICAgICAgdGhpcy5wcm9qZWN0U2VydmljZSA9IHByb2plY3RTZXJ2aWNlO1xuICAgICAgICB0aGlzLnNwYXJxbFRyZWVTZXJ2aWNlID0gc3BhcnFsVHJlZVNlcnZpY2U7XG4gICAgICAgIHRoaXMuJHN0YXRlID0gJHN0YXRlO1xuICAgICAgICB0aGlzLnByaW1hcnlFbmRwb2ludENvbmZpZ3VyYXRpb25zID0gW107XG4gICAgICAgIHRoaXMuc3RhdGlzdGljcyA9IHt9O1xuICAgICAgICB0aGlzLnNlbGVjdGVkQXV0aG9yaXRpZXMgPSB7fTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEFyY2hpdmVzID0ge307XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRTY2hlbWFzID0ge307XG4gICAgICAgIHRoaXMuc2NoZW1hcyA9IFtdO1xuICAgICAgICB0aGlzLmF1dGhvcml0aWVzID0gW107XG4gICAgICAgIHRoaXMuYXJjaGl2ZXMgPSBbXTtcbiAgICAgICAgdGhpcy5wcm9qZWN0U291cmNlcyA9IHByb2plY3RTZXJ2aWNlLmdldFByb2plY3RTb3VyY2VzKCk7XG4gICAgICAgIHRoaXMucHJvamVjdFNvdXJjZSA9IHRoaXMucHJvamVjdFNvdXJjZXMuZmluZChmdW5jdGlvbiAocHMpIHsgcmV0dXJuIHBzLmlkID09PSAkc3RhdGVQYXJhbXMuc291cmNlSWQ7IH0pO1xuICAgICAgICBpZiAoJHN0YXRlUGFyYW1zLmlkKSB7XG4gICAgICAgICAgICBwcm9qZWN0U2VydmljZS5sb2FkUHJvamVjdCh0aGlzLnByb2plY3RTb3VyY2UsICRzdGF0ZVBhcmFtcy5pZCwgZmFsc2UpLnRoZW4oZnVuY3Rpb24gKHApIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5wcm9qZWN0ID0gcDtcbiAgICAgICAgICAgICAgICBfdGhpcy5zZWxlY3RlZFRlbXBsYXRlID0gcC5hc1RlbXBsYXRlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhciBwaWQgPSAnaHR0cDovL2xkZi5maS9maWJyYS9wcm9qZWN0XycgKyBVVUlEKCk7XG4gICAgICAgICAgICB0aGlzLnByb2plY3QgPSBuZXcgUHJvamVjdChwaWQpO1xuICAgICAgICAgICAgdGhpcy5wcm9qZWN0LmxhYmVscyA9IFtEYXRhRmFjdG9yeS5saXRlcmFsKCcnLCBmaWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5sYW5ndWFnZSldO1xuICAgICAgICAgICAgdGhpcy5wcm9qZWN0LmRlc2NyaXB0aW9ucyA9IFtEYXRhRmFjdG9yeS5saXRlcmFsKCcnLCBmaWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5sYW5ndWFnZSldO1xuICAgICAgICAgICAgdGhpcy5wcm9qZWN0LnNvdXJjZSA9IHRoaXMucHJvamVjdFNvdXJjZTtcbiAgICAgICAgICAgIHRoaXMucHJvamVjdC5lbmRwb2ludCA9IHRoaXMucHJvamVjdFNvdXJjZS5zcGFycWxFbmRwb2ludDtcbiAgICAgICAgICAgIHRoaXMucHJvamVjdC51cGRhdGVFbmRwb2ludCA9IHRoaXMucHJvamVjdFNvdXJjZS51cGRhdGVFbmRwb2ludDtcbiAgICAgICAgICAgIHRoaXMucHJvamVjdC5ncmFwaFN0b3JlRW5kcG9pbnQgPSB0aGlzLnByb2plY3RTb3VyY2UuZ3JhcGhTdG9yZUVuZHBvaW50O1xuICAgICAgICAgICAgdGhpcy5wcm9qZWN0LmdyYXBoID0gcGlkO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucHJvamVjdFNvdXJjZXMuZm9yRWFjaChmdW5jdGlvbiAocHMpIHtcbiAgICAgICAgICAgIHByb2plY3RTZXJ2aWNlLmxpc3RQcmltYXJ5RW5kcG9pbnRDb25maWd1cmF0aW9ucyhwcykudGhlbihmdW5jdGlvbiAocHQpIHtcbiAgICAgICAgICAgICAgICBpZiAoIV90aGlzLnNlbGVjdGVkVGVtcGxhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1hdGNoaW5nRUMgPSBwdC5maW5kKGZ1bmN0aW9uIChlYykgeyByZXR1cm4gZWMuY29tcGF0aWJsZUVuZHBvaW50cy5maW5kKGZ1bmN0aW9uIChldCkgeyByZXR1cm4gZXQgPT09IF90aGlzLnByb2plY3RTb3VyY2UudHlwZTsgfSkgIT09IHVuZGVmaW5lZDsgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaGluZ0VDKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZWxlY3RlZFRlbXBsYXRlID0gbWF0Y2hpbmdFQztcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNoYW5nZVRlbXBsYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgX3RoaXMucHJpbWFyeUVuZHBvaW50Q29uZmlndXJhdGlvbnMgPSBfdGhpcy5wcmltYXJ5RW5kcG9pbnRDb25maWd1cmF0aW9ucy5jb25jYXQocHQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBwcm9qZWN0U2VydmljZS5saXN0QXV0aG9yaXR5RW5kcG9pbnRDb25maWd1cmF0aW9ucyhwcykudGhlbihmdW5jdGlvbiAocHQpIHsgcmV0dXJuIF90aGlzLmF1dGhvcml0aWVzID0gX3RoaXMuYXV0aG9yaXRpZXMuY29uY2F0KHB0KTsgfSk7XG4gICAgICAgICAgICBwcm9qZWN0U2VydmljZS5saXN0QXJjaGl2ZUVuZHBvaW50Q29uZmlndXJhdGlvbnMocHMpLnRoZW4oZnVuY3Rpb24gKHB0KSB7IHJldHVybiBfdGhpcy5hcmNoaXZlcyA9IF90aGlzLmFyY2hpdmVzLmNvbmNhdChwdCk7IH0pO1xuICAgICAgICAgICAgcHJvamVjdFNlcnZpY2UubGlzdFNjaGVtYXMocHMpLnRoZW4oZnVuY3Rpb24gKHB0KSB7IHJldHVybiBfdGhpcy5zY2hlbWFzID0gX3RoaXMuc2NoZW1hcy5jb25jYXQocHQpOyB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIENvbmZpZ3VyZVZpZXdDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5zYXZlQW5kT3BlbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5wcm9qZWN0LmF1dGhvcml0eUVuZHBvaW50cyA9IHRoaXMuYXV0aG9yaXRpZXMuZmlsdGVyKGZ1bmN0aW9uIChhKSB7IHJldHVybiBfdGhpcy5zZWxlY3RlZEF1dGhvcml0aWVzW2EuaWRdOyB9KTtcbiAgICAgICAgdGhpcy5wcm9qZWN0LmFyY2hpdmVFbmRwb2ludHMgPSB0aGlzLmFyY2hpdmVzLmZpbHRlcihmdW5jdGlvbiAoYSkgeyByZXR1cm4gX3RoaXMuc2VsZWN0ZWRBcmNoaXZlc1thLmlkXTsgfSk7XG4gICAgICAgIHRoaXMucHJvamVjdC5zY2hlbWFzID0gdGhpcy5zY2hlbWFzLmZpbHRlcihmdW5jdGlvbiAoYSkgeyByZXR1cm4gX3RoaXMuc2VsZWN0ZWRTY2hlbWFzW2EuaWRdOyB9KTtcbiAgICAgICAgdGhpcy5wcm9qZWN0U2VydmljZS5zYXZlQ2l0YWJsZSh0aGlzLnByb2plY3RTb3VyY2UudXBkYXRlRW5kcG9pbnQsIHRoaXMucHJvamVjdFNvdXJjZS5ncmFwaFN0b3JlRW5kcG9pbnQsIHRoaXMucHJvamVjdCkudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy4kc3RhdGUuZ28oJ2NvbnN0cnVjdCcsIHsgaWQ6IF90aGlzLnByb2plY3QuaWQsIHNwYXJxbEVuZHBvaW50OiBfdGhpcy5wcm9qZWN0LnNvdXJjZS5zcGFycWxFbmRwb2ludCwgZ3JhcGg6IF90aGlzLnByb2plY3Quc291cmNlLmdyYXBoIH0pOyB9KTtcbiAgICB9O1xuICAgIENvbmZpZ3VyZVZpZXdDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5kZWxldGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMucHJvamVjdFNlcnZpY2UuZGVsZXRlQ2l0YWJsZSh0aGlzLnByb2plY3RTb3VyY2UudXBkYXRlRW5kcG9pbnQsIHRoaXMucHJvamVjdCkudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy4kc3RhdGUuZ28oJ3Byb2plY3RzJyk7IH0pO1xuICAgIH07XG4gICAgQ29uZmlndXJlVmlld0NvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmNoYW5nZVRlbXBsYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5wcm9qZWN0KVxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFRlbXBsYXRlLmNvcHlUb1Byb2plY3QodGhpcy5wcm9qZWN0KTtcbiAgICB9O1xuICAgIHJldHVybiBDb25maWd1cmVWaWV3Q29tcG9uZW50Q29udHJvbGxlcjtcbn0oKSk7XG5leHBvcnQgeyBDb25maWd1cmVWaWV3Q29tcG9uZW50Q29udHJvbGxlciB9O1xudmFyIENvbmZpZ3VyZVZpZXdDb21wb25lbnQgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIENvbmZpZ3VyZVZpZXdDb21wb25lbnQoKSB7XG4gICAgICAgIHRoaXMuY29udHJvbGxlciA9IENvbmZpZ3VyZVZpZXdDb21wb25lbnRDb250cm9sbGVyOyAvLyAobmV3ICguLi5hcmdzOiBhbnlbXSkgPT4gYW5ndWxhci5JQ29udHJvbGxlcikgPSBDb25maWd1cmVWaWV3Q29tcG9uZW50Q29udHJvbGxlclxuICAgICAgICB0aGlzLnRlbXBsYXRlID0gcmVxdWlyZSgnLi9jb25maWd1cmUtdmlldy5wdWcnKSgpO1xuICAgIH1cbiAgICByZXR1cm4gQ29uZmlndXJlVmlld0NvbXBvbmVudDtcbn0oKSk7XG5leHBvcnQgeyBDb25maWd1cmVWaWV3Q29tcG9uZW50IH07XG5hbmd1bGFyLm1vZHVsZSgnZmlicmEuY29tcG9uZW50cy5jb25maWd1cmUnLCBbJ2ZpYnJhLnNlcnZpY2VzJ10pXG4gICAgLmNvbXBvbmVudCgnY29uZmlndXJlVmlldycsIG5ldyBDb25maWd1cmVWaWV3Q29tcG9uZW50KCkpO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGFwcC9jb21wb25lbnRzL2NvbmZpZ3VyZS12aWV3L2NvbmZpZ3VyZS12aWV3LWNvbXBvbmVudC50cyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),

/***/ "./app/components/construct-view/construct-view-component.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__services_sparql_tree_service__ = __webpack_require__(\"./app/services/sparql-tree-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__actions_types__ = __webpack_require__(\"./app/actions/types.ts\");\n/* unused harmony export ConstructViewComponentController */\n/* unused harmony export ConstructViewComponent */\n\n\n\n\n\n// class TreeViewConfiguration {\n//   constructor(public endpoint: string, public queryTemplate: string) {}\n// }\nvar ConstructViewComponentController = function () {\n    function ConstructViewComponentController(sparqlTreeService, projectService, fibraService, $ngRedux, $q) {\n        var _this = this;\n        this.sparqlTreeService = sparqlTreeService;\n        this.projectService = projectService;\n        this.fibraService = fibraService;\n        this.$ngRedux = $ngRedux;\n        this.$q = $q;\n        this.paletteDisplay = false;\n        this.limitFilter = '';\n        this.unsubscribe = $ngRedux.connect(this.mapStateToThis, __WEBPACK_IMPORTED_MODULE_2__actions_types__)(this);\n        var currentProject = projectService.getCurrentProject();\n        this.currentProjectSource = projectService.getProjectSources().find(function (ps) {\n            return ps.sparqlEndpoint === currentProject.source.sparqlEndpoint && ps.graph === currentProject.source.graph;\n        });\n        fibraService.on('change', function () {\n            var chosenTypes = fibraService.getState().construct.displayTypes;\n            _this.limitFilter = '';\n            chosenTypes.forEach(function (t) {\n                if (t) _this.limitFilter += '<' + t.id + '>' + ',';\n            });\n            if (_this.limitFilter.length !== 0) _this.limitFilter = 'FILTER (?groupId IN (' + _this.limitFilter.substring(0, _this.limitFilter.length - 1) + '))';\n            return _this.$q.resolve('ok');\n        });\n        this.classTreePromise = sparqlTreeService.getTree(this.fibraService.getState().project.endpoint, this.fibraService.getState().project.treeQuery);\n        this.classTreePromise.then(function (c) {\n            _this.classTree = c;\n            _this.clearTypes();\n            _this.traverseClassTree(c, function (n) {\n                return _this.types.types.indexOf(n) === -1 && n.children.length === 0;\n            }, function (n) {\n                return _this.addType(n);\n            });\n        });\n        this.fibraService.on('change', function () {\n            _this.classTreePromise = sparqlTreeService.getTree(_this.fibraService.getState().project.endpoint, __WEBPACK_IMPORTED_MODULE_0__services_sparql_tree_service__[\"a\" /* SparqlTreeService */].getClassTreeQuery);\n            return _this.classTreePromise.then(function (c) {\n                _this.classTree = c;\n                return 'ok';\n            });\n        });\n        this.fibraService.on('action', function () {\n            _this.state = fibraService.getState();\n            return _this.$q.resolve('ok');\n        });\n        this.state = fibraService.getState();\n    }\n    ConstructViewComponentController.prototype.createItem = function (item) {\n        // Is there a type on this item? If so, and it is not already in chosenTypes,\n        // add it.\n        var itemTypeKey = item.additionalInformation['type'][0] ? item.additionalInformation['type'][0].value : \"\";\n        var itemType = this.types.types.filter(function (t) {\n            return t.id === itemTypeKey;\n        })[0];\n        var chosenTypes = this.fibraService.getState().construct.displayTypes;\n        if (!chosenTypes[0] && itemType) {\n            this.setOrderedTypes([itemType]);\n        } else if (!chosenTypes[1] && itemType && chosenTypes[0] !== itemType) {\n            var newTypes = chosenTypes.concat([]);\n            newTypes.push(itemType);\n            this.setOrderedTypes(newTypes);\n        }\n        return this.fibraService.dispatchAction(this.fibraService.displayItem(item.ids[0]));\n    };\n    ConstructViewComponentController.prototype.downloadRDF = function () {\n        var currentConfig = this.fibraService.getState().project.graph;\n        var downloadlink = \"http://ldf.fi/fibra/sparql?graph=\" + currentConfig; // + \"&force-accept=application/rdf+xml\"\n        var request = new XMLHttpRequest();\n        request.open(\"GET\", downloadlink, true);\n        request.onload = function (e) {\n            if (request.readyState === 4) {\n                if (request.status === 200) {\n                    var data = request.responseText;\n                    var download = document.createElement(\"a\");\n                    download.href = \"data:application/rdf+xml;charset=utf-8,\" + data;\n                    download.download = \"fibra.ttl\";\n                    document.body.appendChild(download);\n                    download.click();\n                    document.body.removeChild(download);\n                } else {\n                    console.error(request.statusText);\n                }\n            }\n        };\n        request.send(null);\n    };\n    ConstructViewComponentController.prototype.$onDestroy = function () {\n        this.unsubscribe();\n    };\n    ConstructViewComponentController.prototype.mapStateToThis = function (state) {\n        return {\n            types: state.types\n        };\n    };\n    ConstructViewComponentController.prototype.traverseClassTree = function (nodes, test, onSuccess) {\n        var traverse = function (node) {\n            if (test(node)) {\n                onSuccess(node);\n                node.children.forEach(traverse);\n            }\n        };\n        nodes.forEach(traverse);\n    };\n    return ConstructViewComponentController;\n}();\n\nvar ConstructViewComponent = function () {\n    function ConstructViewComponent() {\n        this.controller = ConstructViewComponentController; // (new (...args: any[]) => angular.IController) = ConstructViewComponentController\n        this.template = __webpack_require__(\"./app/components/construct-view/construct-view.pug\")();\n    }\n    return ConstructViewComponent;\n}();\n\n__WEBPACK_IMPORTED_MODULE_1_angular__[\"module\"]('fibra.components.construct-view', ['fibra.services']).component('constructView', new ConstructViewComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9jb25zdHJ1Y3Qtdmlldy1jb21wb25lbnQudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL2NvbXBvbmVudHMvY29uc3RydWN0LXZpZXcvY29uc3RydWN0LXZpZXctY29tcG9uZW50LnRzPzZmODMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuaW1wb3J0IHsgU3BhcnFsVHJlZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9zcGFycWwtdHJlZS1zZXJ2aWNlJztcbmltcG9ydCAqIGFzIGFuZ3VsYXIgZnJvbSAnYW5ndWxhcic7XG5pbXBvcnQgKiBhcyBUeXBlQWN0aW9ucyBmcm9tICcuLi8uLi9hY3Rpb25zL3R5cGVzJztcbi8vIGNsYXNzIFRyZWVWaWV3Q29uZmlndXJhdGlvbiB7XG4vLyAgIGNvbnN0cnVjdG9yKHB1YmxpYyBlbmRwb2ludDogc3RyaW5nLCBwdWJsaWMgcXVlcnlUZW1wbGF0ZTogc3RyaW5nKSB7fVxuLy8gfVxudmFyIENvbnN0cnVjdFZpZXdDb21wb25lbnRDb250cm9sbGVyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBDb25zdHJ1Y3RWaWV3Q29tcG9uZW50Q29udHJvbGxlcihzcGFycWxUcmVlU2VydmljZSwgcHJvamVjdFNlcnZpY2UsIGZpYnJhU2VydmljZSwgJG5nUmVkdXgsICRxKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuc3BhcnFsVHJlZVNlcnZpY2UgPSBzcGFycWxUcmVlU2VydmljZTtcbiAgICAgICAgdGhpcy5wcm9qZWN0U2VydmljZSA9IHByb2plY3RTZXJ2aWNlO1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZSA9IGZpYnJhU2VydmljZTtcbiAgICAgICAgdGhpcy4kbmdSZWR1eCA9ICRuZ1JlZHV4O1xuICAgICAgICB0aGlzLiRxID0gJHE7XG4gICAgICAgIHRoaXMucGFsZXR0ZURpc3BsYXkgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5saW1pdEZpbHRlciA9ICcnO1xuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlID0gJG5nUmVkdXguY29ubmVjdCh0aGlzLm1hcFN0YXRlVG9UaGlzLCBUeXBlQWN0aW9ucykodGhpcyk7XG4gICAgICAgIHZhciBjdXJyZW50UHJvamVjdCA9IHByb2plY3RTZXJ2aWNlLmdldEN1cnJlbnRQcm9qZWN0KCk7XG4gICAgICAgIHRoaXMuY3VycmVudFByb2plY3RTb3VyY2UgPSBwcm9qZWN0U2VydmljZS5nZXRQcm9qZWN0U291cmNlcygpLmZpbmQoZnVuY3Rpb24gKHBzKSB7IHJldHVybiBwcy5zcGFycWxFbmRwb2ludCA9PT0gY3VycmVudFByb2plY3Quc291cmNlLnNwYXJxbEVuZHBvaW50ICYmIHBzLmdyYXBoID09PSBjdXJyZW50UHJvamVjdC5zb3VyY2UuZ3JhcGg7IH0pO1xuICAgICAgICBmaWJyYVNlcnZpY2Uub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBjaG9zZW5UeXBlcyA9IGZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLmNvbnN0cnVjdC5kaXNwbGF5VHlwZXM7XG4gICAgICAgICAgICBfdGhpcy5saW1pdEZpbHRlciA9ICcnO1xuICAgICAgICAgICAgY2hvc2VuVHlwZXMuZm9yRWFjaChmdW5jdGlvbiAodCkgeyBpZiAodClcbiAgICAgICAgICAgICAgICBfdGhpcy5saW1pdEZpbHRlciArPSAnPCcgKyB0LmlkICsgJz4nICsgJywnOyB9KTtcbiAgICAgICAgICAgIGlmIChfdGhpcy5saW1pdEZpbHRlci5sZW5ndGggIT09IDApXG4gICAgICAgICAgICAgICAgX3RoaXMubGltaXRGaWx0ZXIgPSAnRklMVEVSICg/Z3JvdXBJZCBJTiAoJyArIF90aGlzLmxpbWl0RmlsdGVyLnN1YnN0cmluZygwLCBfdGhpcy5saW1pdEZpbHRlci5sZW5ndGggLSAxKSArICcpKSc7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuJHEucmVzb2x2ZSgnb2snKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY2xhc3NUcmVlUHJvbWlzZSA9IHNwYXJxbFRyZWVTZXJ2aWNlLmdldFRyZWUodGhpcy5maWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5wcm9qZWN0LmVuZHBvaW50LCB0aGlzLmZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLnByb2plY3QudHJlZVF1ZXJ5KTtcbiAgICAgICAgdGhpcy5jbGFzc1RyZWVQcm9taXNlLnRoZW4oZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIF90aGlzLmNsYXNzVHJlZSA9IGM7XG4gICAgICAgICAgICBfdGhpcy5jbGVhclR5cGVzKCk7XG4gICAgICAgICAgICBfdGhpcy50cmF2ZXJzZUNsYXNzVHJlZShjLCBmdW5jdGlvbiAobikgeyByZXR1cm4gX3RoaXMudHlwZXMudHlwZXMuaW5kZXhPZihuKSA9PT0gLTEgJiYgbi5jaGlsZHJlbi5sZW5ndGggPT09IDA7IH0sIGZ1bmN0aW9uIChuKSB7IHJldHVybiBfdGhpcy5hZGRUeXBlKG4pOyB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZmlicmFTZXJ2aWNlLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdGhpcy5jbGFzc1RyZWVQcm9taXNlID0gc3BhcnFsVHJlZVNlcnZpY2UuZ2V0VHJlZShfdGhpcy5maWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5wcm9qZWN0LmVuZHBvaW50LCBTcGFycWxUcmVlU2VydmljZS5nZXRDbGFzc1RyZWVRdWVyeSk7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuY2xhc3NUcmVlUHJvbWlzZS50aGVuKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuY2xhc3NUcmVlID0gYztcbiAgICAgICAgICAgICAgICByZXR1cm4gJ29rJztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5maWJyYVNlcnZpY2Uub24oJ2FjdGlvbicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF90aGlzLnN0YXRlID0gZmlicmFTZXJ2aWNlLmdldFN0YXRlKCk7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuJHEucmVzb2x2ZSgnb2snKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc3RhdGUgPSBmaWJyYVNlcnZpY2UuZ2V0U3RhdGUoKTtcbiAgICB9XG4gICAgQ29uc3RydWN0Vmlld0NvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmNyZWF0ZUl0ZW0gPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAvLyBJcyB0aGVyZSBhIHR5cGUgb24gdGhpcyBpdGVtPyBJZiBzbywgYW5kIGl0IGlzIG5vdCBhbHJlYWR5IGluIGNob3NlblR5cGVzLFxuICAgICAgICAvLyBhZGQgaXQuXG4gICAgICAgIHZhciBpdGVtVHlwZUtleSA9IGl0ZW0uYWRkaXRpb25hbEluZm9ybWF0aW9uWyd0eXBlJ11bMF0gPyBpdGVtLmFkZGl0aW9uYWxJbmZvcm1hdGlvblsndHlwZSddWzBdLnZhbHVlIDogXCJcIjtcbiAgICAgICAgdmFyIGl0ZW1UeXBlID0gdGhpcy50eXBlcy50eXBlcy5maWx0ZXIoZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHQuaWQgPT09IGl0ZW1UeXBlS2V5OyB9KVswXTtcbiAgICAgICAgdmFyIGNob3NlblR5cGVzID0gdGhpcy5maWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5jb25zdHJ1Y3QuZGlzcGxheVR5cGVzO1xuICAgICAgICBpZiAoIWNob3NlblR5cGVzWzBdICYmIGl0ZW1UeXBlKSB7XG4gICAgICAgICAgICB0aGlzLnNldE9yZGVyZWRUeXBlcyhbaXRlbVR5cGVdKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICghY2hvc2VuVHlwZXNbMV0gJiYgaXRlbVR5cGUgJiYgKGNob3NlblR5cGVzWzBdICE9PSBpdGVtVHlwZSkpIHtcbiAgICAgICAgICAgIHZhciBuZXdUeXBlcyA9IGNob3NlblR5cGVzLmNvbmNhdChbXSk7XG4gICAgICAgICAgICBuZXdUeXBlcy5wdXNoKGl0ZW1UeXBlKTtcbiAgICAgICAgICAgIHRoaXMuc2V0T3JkZXJlZFR5cGVzKG5ld1R5cGVzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5maWJyYVNlcnZpY2UuZGlzcGF0Y2hBY3Rpb24odGhpcy5maWJyYVNlcnZpY2UuZGlzcGxheUl0ZW0oaXRlbS5pZHNbMF0pKTtcbiAgICB9O1xuICAgIENvbnN0cnVjdFZpZXdDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5kb3dubG9hZFJERiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGN1cnJlbnRDb25maWcgPSB0aGlzLmZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLnByb2plY3QuZ3JhcGg7XG4gICAgICAgIHZhciBkb3dubG9hZGxpbmsgPSBcImh0dHA6Ly9sZGYuZmkvZmlicmEvc3BhcnFsP2dyYXBoPVwiICsgY3VycmVudENvbmZpZzsgLy8gKyBcIiZmb3JjZS1hY2NlcHQ9YXBwbGljYXRpb24vcmRmK3htbFwiXG4gICAgICAgIHZhciByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgIHJlcXVlc3Qub3BlbihcIkdFVFwiLCBkb3dubG9hZGxpbmssIHRydWUpO1xuICAgICAgICByZXF1ZXN0Lm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBpZiAocmVxdWVzdC5yZWFkeVN0YXRlID09PSA0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlcXVlc3Quc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSByZXF1ZXN0LnJlc3BvbnNlVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRvd25sb2FkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XG4gICAgICAgICAgICAgICAgICAgIGRvd25sb2FkLmhyZWYgPSBcImRhdGE6YXBwbGljYXRpb24vcmRmK3htbDtjaGFyc2V0PXV0Zi04LFwiICsgZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgZG93bmxvYWQuZG93bmxvYWQgPSBcImZpYnJhLnR0bFwiO1xuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGRvd25sb2FkKTtcbiAgICAgICAgICAgICAgICAgICAgZG93bmxvYWQuY2xpY2soKTtcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChkb3dubG9hZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKHJlcXVlc3Quc3RhdHVzVGV4dCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXF1ZXN0LnNlbmQobnVsbCk7XG4gICAgfTtcbiAgICBDb25zdHJ1Y3RWaWV3Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuJG9uRGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy51bnN1YnNjcmliZSgpO1xuICAgIH07XG4gICAgQ29uc3RydWN0Vmlld0NvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLm1hcFN0YXRlVG9UaGlzID0gZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlczogc3RhdGUudHlwZXNcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIENvbnN0cnVjdFZpZXdDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS50cmF2ZXJzZUNsYXNzVHJlZSA9IGZ1bmN0aW9uIChub2RlcywgdGVzdCwgb25TdWNjZXNzKSB7XG4gICAgICAgIHZhciB0cmF2ZXJzZSA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICBpZiAodGVzdChub2RlKSkge1xuICAgICAgICAgICAgICAgIG9uU3VjY2Vzcyhub2RlKTtcbiAgICAgICAgICAgICAgICBub2RlLmNoaWxkcmVuLmZvckVhY2godHJhdmVyc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBub2Rlcy5mb3JFYWNoKHRyYXZlcnNlKTtcbiAgICB9O1xuICAgIHJldHVybiBDb25zdHJ1Y3RWaWV3Q29tcG9uZW50Q29udHJvbGxlcjtcbn0oKSk7XG5leHBvcnQgeyBDb25zdHJ1Y3RWaWV3Q29tcG9uZW50Q29udHJvbGxlciB9O1xudmFyIENvbnN0cnVjdFZpZXdDb21wb25lbnQgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIENvbnN0cnVjdFZpZXdDb21wb25lbnQoKSB7XG4gICAgICAgIHRoaXMuY29udHJvbGxlciA9IENvbnN0cnVjdFZpZXdDb21wb25lbnRDb250cm9sbGVyOyAvLyAobmV3ICguLi5hcmdzOiBhbnlbXSkgPT4gYW5ndWxhci5JQ29udHJvbGxlcikgPSBDb25zdHJ1Y3RWaWV3Q29tcG9uZW50Q29udHJvbGxlclxuICAgICAgICB0aGlzLnRlbXBsYXRlID0gcmVxdWlyZSgnLi9jb25zdHJ1Y3Qtdmlldy5wdWcnKSgpO1xuICAgIH1cbiAgICByZXR1cm4gQ29uc3RydWN0Vmlld0NvbXBvbmVudDtcbn0oKSk7XG5leHBvcnQgeyBDb25zdHJ1Y3RWaWV3Q29tcG9uZW50IH07XG5hbmd1bGFyLm1vZHVsZSgnZmlicmEuY29tcG9uZW50cy5jb25zdHJ1Y3QtdmlldycsIFsnZmlicmEuc2VydmljZXMnXSlcbiAgICAuY29tcG9uZW50KCdjb25zdHJ1Y3RWaWV3JywgbmV3IENvbnN0cnVjdFZpZXdDb21wb25lbnQoKSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL2NvbXBvbmVudHMvY29uc3RydWN0LXZpZXcvY29uc3RydWN0LXZpZXctY29tcG9uZW50LnRzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),

/***/ "./app/components/construct-view/explore-component.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__services_sparql_item_service__ = __webpack_require__(\"./app/services/sparql-item-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__sunburst__ = __webpack_require__(\"./app/components/construct-view/sunburst.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__property_popover__ = __webpack_require__(\"./app/components/construct-view/property-popover.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_d3__ = __webpack_require__(\"./app/bower_components/d3/d3.js\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_d3___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_d3__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__models_rdf__ = __webpack_require__(\"./app/models/rdf.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_5_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__actions_verify__ = __webpack_require__(\"./app/actions/verify.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__actions_types__ = __webpack_require__(\"./app/actions/types.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__actions_items__ = __webpack_require__(\"./app/actions/items.ts\");\n/* unused harmony export ExploreComponent */\n\n\n\n\n\n\n\n\n\n\n\nvar ExploreComponentController = function () {\n    function ExploreComponentController($element, $compile, $window, $scope, $timeout, sparqlItemService, fibraService, $ngRedux, $q) {\n        var _this = this;\n        this.$element = $element;\n        this.$compile = $compile;\n        this.$window = $window;\n        this.$scope = $scope;\n        this.$timeout = $timeout;\n        this.sparqlItemService = sparqlItemService;\n        this.fibraService = fibraService;\n        this.$ngRedux = $ngRedux;\n        this.$q = $q;\n        this.primaryItems = [];\n        this.secondaryItems = [];\n        this.tertiaryItems = [];\n        this.untypedItems = [];\n        this.removedUntypedItems = [];\n        this.allItems = [];\n        this.radiusInitial = 1;\n        this.radius = 8;\n        this.radiusBounce = 15;\n        this.gridOffset = 50; // Should be even\n        this.chargeForce = __WEBPACK_IMPORTED_MODULE_3_d3__[\"forceCollide\"](this.gridOffset / 1.5);\n        this.chargeForce2 = __WEBPACK_IMPORTED_MODULE_3_d3__[\"forceCollide\"](this.gridOffset / 1.5);\n        this.svgBackgroundColor = '#EEE';\n        this.lastClickX = 0;\n        this.lastClickY = 0;\n        var unsub1 = $ngRedux.connect(this.mapVerifyToThis, __WEBPACK_IMPORTED_MODULE_6__actions_verify__)(this);\n        var unsub2 = $ngRedux.connect(this.mapTypesToThis, __WEBPACK_IMPORTED_MODULE_7__actions_types__)(this);\n        var unsub3 = $ngRedux.connect(this.mapItemsToThis, __WEBPACK_IMPORTED_MODULE_8__actions_items__)(this);\n        this.unsubscribe = function () {\n            unsub1();\n            unsub2();\n        };\n        this.sunburst = new __WEBPACK_IMPORTED_MODULE_1__sunburst__[\"a\" /* Sunburst */]($element, $compile, $scope, sparqlItemService, fibraService);\n        this.propertyPopover = new __WEBPACK_IMPORTED_MODULE_2__property_popover__[\"a\" /* PropertyPopover */]($element, $scope, fibraService, $compile);\n        this.fibraService.on('change', function () {\n            // this.verifyItem = this.fibraService.getState().construct.verifyItem\n            return _this.queryAndBuild();\n        });\n        this.itemService = sparqlItemService;\n        this.links = [];\n        this.$scope.layout = {\n            'choice': 'force',\n            'links': 'hide'\n        };\n        this.$scope.$watch('layout.choice', this.updateExplore.bind(this, false));\n        this.$scope.$watch('layout.links', this.updateExplore.bind(this, false));\n    }\n    ExploreComponentController.prototype.$onChanges = function (chngsObj) {\n        if (this.svgSel) {\n            this.updateExplore(false, false);\n        }\n    };\n    ExploreComponentController.prototype.$postLink = function () {\n        var _this = this;\n        this.svgSel = __WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"](this.$element[0]).select('svg');\n        this.svgSel.append('rect').classed('background', true).style('fill', this.svgBackgroundColor).on('click', function () {\n            _this.lastClickX = __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].offsetX;\n            _this.lastClickY = __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].offsetY;\n            _this.fibraService.dispatchAction(_this.createDisplayItem());\n        });\n        // Create link g\n        this.svgSel.append('g').attr('class', 'links');\n        this.sunburst.addSunburstGroup(this.svgSel);\n        this.radius = 8;\n        this.tooltip = __WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"]('body').append('div').style('position', 'absolute').style('z-index', '20').style('background-color', 'gray').style('color', 'white').style('padding', '3px').style('border-radius', '2px').style('visibility', 'hidden');\n        this.edittip = __WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"]('body').append('div').attr('id', 'edittip').style('position', 'absolute').style('z-index', '40').style('background-color', 'white').style('color', 'gray').style('border', '1px solid gray').style('padding', '3px').style('border-radius', '2px').style('visibility', 'hidden');\n        this.updateSizing();\n        this.queryAndBuild();\n    };\n    // currently broken on deleting a link\n    ExploreComponentController.prototype.highlightLinks = function (d, i) {\n        __WEBPACK_IMPORTED_MODULE_3_d3__[\"selectAll\"]('line').classed('relevant', false);\n        for (var j = 0; j < this.links.length; j++) {\n            var linksource = this.links[j].source;\n            var linktarget = this.links[j].target;\n            if (linksource.index === i || linktarget.index === i) __WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"]('#link-' + j).classed('relevant', true);\n        }\n    };\n    ExploreComponentController.prototype.$onDestroy = function () {\n        this.unsubscribe();\n    };\n    ExploreComponentController.prototype.queryAndBuild = function () {\n        var _this = this;\n        var prom = this.sparqlItemService.getItems(this.fibraService.getState().construct.items, false).then(function (items) {\n            // If we are showing property popovers, hide 'em.\n            _this.propertyPopover.hidePopover();\n            // Lock previous items\n            _this.lockExisting(_this.primaryItems);\n            _this.lockExisting(_this.secondaryItems);\n            _this.lockExisting(_this.tertiaryItems);\n            var displayTypes = _this.types.displayTypes;\n            var currentUntyped = _this.filterItemsByType(items, __WEBPACK_IMPORTED_MODULE_4__models_rdf__[\"d\" /* OWL */].Thing.value);\n            _this.removedUntypedItems = _this.untypedItems.filter(function (it) {\n                return currentUntyped.indexOf(it) === -1;\n            });\n            _this.untypedItems = _this.mergeNodes(_this.untypedItems, _this.filterItemsByType(items, __WEBPACK_IMPORTED_MODULE_4__models_rdf__[\"d\" /* OWL */].Thing.value));\n            if (displayTypes[0]) _this.primaryItems = _this.mergeNodes(_this.primaryItems, _this.filterItemsByType(items, displayTypes[0].id));\n            if (displayTypes[1]) _this.secondaryItems = _this.mergeNodes(_this.secondaryItems, _this.filterItemsByType(items, displayTypes[1].id));\n            if (displayTypes[2]) _this.tertiaryItems = _this.mergeNodes(_this.tertiaryItems, _this.filterItemsByType(items, displayTypes[2].id));\n            _this.allItems = _this.primaryItems.concat(_this.secondaryItems).concat(_this.tertiaryItems).concat(_this.untypedItems);\n            _this.properties = [];\n            if (_this.primaryItems[0] && _this.primaryItems[0].localProperties) {\n                for (var _i = 0, _a = _this.primaryItems[0].localProperties; _i < _a.length; _i++) {\n                    var p = _a[_i];\n                    _this.properties.push({ key: p.toCanonical(), value: p.label });\n                }\n            }\n            _this.links = _this.mergeLinks(_this.links);\n            return 'ok';\n        }).then(function () {\n            return _this.updateExplore();\n        });\n        this.fibraService.dispatchAction(this.fibraService.placeHolderAction(prom));\n        return prom;\n    };\n    ExploreComponentController.prototype.lockExisting = function (nodes) {\n        nodes.forEach(function (node) {\n            node.fx = node.gx;\n            node.fy = node.gy;\n        });\n    };\n    ExploreComponentController.prototype.filterItemsByType = function (items, type) {\n        return items.filter(function (it) {\n            var typeProp = it.localProperties.concat(it.remoteProperties).filter(function (pr) {\n                return pr.value === 'http://www.w3.org/1999/02/22-rdf-syntax-ns#type';\n            });\n            if (typeProp[0]) {\n                return typeProp[0].values.map(function (v) {\n                    return v.value.value;\n                }).indexOf(type) !== -1;\n            } else {\n                return false;\n            }\n        });\n    };\n    ExploreComponentController.prototype.updateSizing = function () {\n        // allow item_info_tip to expand somehow\n        // add delete and alter ability to sparql-item.pug\n        // fix how links sit on top of nodes\n        var viewport_width = window.innerWidth;\n        var viewport_height = window.innerHeight;\n        this.exploreWidth = viewport_width;\n        this.exploreHeight = viewport_height - 36;\n        __WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"](this.$element[0]).select('#explorecontainer').style('height', this.exploreHeight + 'px');\n        // move table down so top is at bottom of viewport\n        __WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"](this.$element[0]).select('#exploretable').style('height', viewport_height - 50 + 'px');\n        this.svgSel.style('width', viewport_width + 'px').style('height', viewport_height - 36 + 'px');\n        this.svgSel.select('rect.background').style('width', viewport_width + 'px').style('height', viewport_height - 36 + 'px');\n        var svg_width = +this.svgSel.style('width').replace('px', '');\n        var svg_height = +this.svgSel.style('height').replace('px', '');\n    };\n    ExploreComponentController.prototype.appendNodes = function (enterSelection, className) {\n        var _this = this;\n        var appendSelection = enterSelection.append('g').attr('id', function (d, i) {\n            return 'node-' + i + '-' + className;\n        }).attr('class', 'node').classed(className, true).append('circle').classed('node-circle', true).classed(className, true).attr('id', function (d, i) {\n            return 'node-circle-' + i + '-' + className;\n        }).attr('r', this.radiusInitial + 'px').call(__WEBPACK_IMPORTED_MODULE_3_d3__[\"drag\"]().on('start', function (d, i) {\n            if (!_this.linkMode) {\n                d.fx = d.x;\n                d.fy = d.y;\n            } else {\n                _this.dragline = _this.svgSel.append('line').attr('class', 'dragLine');\n            }\n        }).on('drag', function (d, i, group) {\n            if (!_this.linkMode) {\n                __WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"](group[i]).classed('fixed', true);\n                d.x = __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].x;\n                d.y = __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].y;\n            } else {\n                _this.dragline.attr('x1', d.x).attr('y1', d.y).attr('x2', __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].x).attr('y2', __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].y);\n            }\n            _this.updateExplore(false, false);\n        }).on('end', function (d, i, group) {\n            if (!_this.linkMode) {\n                if (!__WEBPACK_IMPORTED_MODULE_3_d3__[\"select\"](group[i]).classed('fixed')) {\n                    d.fx = undefined;\n                    d.fy = undefined;\n                }\n            } else {\n                var lineX_1 = +_this.dragline.attr('x2');\n                var lineY_1 = +_this.dragline.attr('y2');\n                var nodeDrop_1 = false;\n                __WEBPACK_IMPORTED_MODULE_3_d3__[\"selectAll\"]('.node').each(function (f, j) {\n                    if (Math.abs(lineX_1 - f.x) < _this.radius && Math.abs(lineY_1 - f.y) < _this.radius) {\n                        nodeDrop_1 = true;\n                        _this.fibraService.dispatchAction(_this.itemProperty(f, [new __WEBPACK_IMPORTED_MODULE_0__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_4__models_rdf__[\"a\" /* SKOS */].related, __WEBPACK_IMPORTED_MODULE_4__models_rdf__[\"b\" /* DataFactory */].instance.nodeFromNode(d))], [])).then(function (state) {\n                            _this.dragline.remove();\n                            _this.queryAndBuild();\n                            return state;\n                        });\n                    }\n                });\n                if (!nodeDrop_1) {\n                    _this.dragline.remove();\n                }\n            }\n        })).on('mouseover', function (d, i) {\n            _this.highlightLinks(d, i);\n            _this.tooltip.style('top', __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].pageY - 10 + 'px').style('left', __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].pageX + 10 + 'px').style('visibility', 'visible').text(d.label);\n        }).on('mouseout', function (d, i) {\n            _this.svgSel.selectAll('line').classed('relevant', false);\n            _this.tooltip.style('visibility', 'hidden');\n        }).on('click', function (d, i, group) {\n            var localSelected = d.selected;\n            // Unselect everything\n            _this.svgSel.selectAll('.node').each(function (n) {\n                n.selected = false;\n            });\n            // Flip this one\n            d.selected = !localSelected;\n            _this.updateExplore(false);\n            if (d.selected) {\n                _this.svgSel.select('g.sunburst-overlay').datum(d).each(_this.sunburst.buildSunburst.bind(_this)).style('display', 'block');\n            } else {\n                _this.svgSel.select('.sunburst-overlay').style('display', 'none');\n            }\n            _this.highlightLinks(d, i);\n        });\n        appendSelection.transition().attr('r', this.radius + this.radiusBounce + 'px').transition().attr('r', this.radius + 'px');\n        return appendSelection;\n    };\n    ExploreComponentController.prototype.snapToGrid = function (x, y, primary) {\n        if (primary === void 0) {\n            primary = true;\n        }\n        var sx, sy;\n        // Snap to gridOffset with further offset for multiples\n        if (primary) {\n            sx = Math.round(x / this.gridOffset) * this.gridOffset;\n            sy = Math.round(y / this.gridOffset) * this.gridOffset;\n        } else {\n            sx = Math.round(x / this.gridOffset) * this.gridOffset - this.gridOffset / 2;\n            sy = Math.round(y / this.gridOffset) * this.gridOffset - this.gridOffset / 2;\n        }\n        return [sx, sy];\n    };\n    ExploreComponentController.prototype.tickTransformNodes = function (sel, primary) {\n        var _this = this;\n        if (primary === void 0) {\n            primary = true;\n        }\n        sel.attr('transform', function (d, i) {\n            var x = d.x,\n                y = d.y;\n            if (d.x < _this.radius) x = _this.radius;\n            if (d.y < _this.radius) y = _this.radius;\n            var _a = [x, y],\n                gx = _a[0],\n                gy = _a[1];\n            if (_this.$scope.layout.choice === 'forcegrid') {\n                _b = _this.snapToGrid(x, y, primary), gx = _b[0], gy = _b[1];\n            }\n            d.gx = gx;\n            d.gy = gy;\n            return 'translate(' + gx + ', ' + gy + ')';\n            var _b;\n        });\n        if (sel.filter(function (d) {\n            return d.selected;\n        }).node()) {\n            var sbFunc_1 = this.sunburst.buildSunburst;\n            var svgSel_1 = this.svgSel;\n            var tickSunburst = function (d, i, g) {\n                svgSel_1.select('g.sunburst-overlay').datum(d).each(sbFunc_1.bind(this));\n            };\n            sel.filter(function (d) {\n                return d.selected;\n            }).each(tickSunburst.bind(this));\n        }\n    };\n    ExploreComponentController.prototype.genericTick = function (primaryNodes, secondaryNodes, untypedNodes, linkLines, transition) {\n        if (transition === void 0) {\n            transition = false;\n        }\n        var lPrimaryNodes = primaryNodes;\n        var lSecondaryNodes = secondaryNodes;\n        var lUntypedNodes = untypedNodes;\n        var lLinkLines = linkLines;\n        if (transition) {\n            lPrimaryNodes = lPrimaryNodes.transition();\n            lSecondaryNodes = lSecondaryNodes.transition();\n            lUntypedNodes = lUntypedNodes.transition();\n            lLinkLines = lLinkLines.transition();\n        }\n        this.tickTransformNodes(lPrimaryNodes, true);\n        this.tickTransformNodes(lSecondaryNodes, false);\n        this.tickTransformNodes(lUntypedNodes, false);\n        this.svgSel.selectAll('.node-circle').classed('selected-circle', function (d) {\n            return d.selected;\n        }).style('cursor', this.linkMode ? 'crosshair' : 'initial');\n        this.svgSel.selectAll('.node-circle').classed('labeled', function (d) {\n            return d.label ? true : false;\n        }).classed('verified', function (d) {\n            return d.localProperties.filter(function (p) {\n                return p.value === 'http://www.w3.org/2002/07/owl#sameAs';\n            }).length > 0;\n        });\n        lLinkLines.attr('x1', function (d) {\n            return d.source.gx;\n        }).attr('y1', function (d) {\n            return d.source.gy;\n        }).attr('x2', function (d) {\n            return d.target.gx;\n        }).attr('y2', function (d) {\n            return d.target.gy;\n        });\n    };\n    ExploreComponentController.prototype.updateExplore = function (runSim, transition) {\n        var _this = this;\n        if (runSim === void 0) {\n            runSim = true;\n        }\n        if (transition === void 0) {\n            transition = false;\n        }\n        var untypedNodes = this.svgSel.selectAll('circle.untyped').data(this.untypedItems, function (d) {\n            return d.value;\n        });\n        var primaryNodes = this.svgSel.selectAll('circle.primary').data(this.primaryItems, function (d) {\n            return d.value;\n        });\n        var secondaryNodes = this.svgSel.selectAll('circle.secondary').data(this.secondaryItems, function (d) {\n            return d.value;\n        });\n        primaryNodes.exit().remove();\n        secondaryNodes.exit().remove();\n        untypedNodes.exit().remove();\n        // Untyped nodes should come in one at a time based on a user's click event. For these\n        // we also want append the user interface for setting type and label.\n        untypedNodes.enter().each(function (datum, i, g) {\n            datum.x = _this.lastClickX;\n            datum.y = _this.lastClickY;\n            datum.fx = _this.lastClickX;\n            datum.fy = _this.lastClickY;\n            datum.gx = _this.lastClickX;\n            datum.gy = _this.lastClickY;\n        }).each(this.propertyPopover.addPopover.bind(this, this.$scope, this.svgSel));\n        // If a node went from being untyped to being primary or secondary, bring along its position\n        // Also handle position getting set from a drop (pull position from state)\n        var applyOldPosition = function (datum) {\n            // Get position from state if it was set there.\n            datum.x = _this.fibraService.getState().construct.itemIndex[datum.value].x;\n            datum.y = _this.fibraService.getState().construct.itemIndex[datum.value].y;\n            datum.fx = _this.fibraService.getState().construct.itemIndex[datum.value].x;\n            datum.fy = _this.fibraService.getState().construct.itemIndex[datum.value].y;\n            datum.gx = _this.fibraService.getState().construct.itemIndex[datum.value].x;\n            datum.gx = _this.fibraService.getState().construct.itemIndex[datum.value].y;\n            // Or if node was already here, get position from old node\n            var oldNode = _this.removedUntypedItems.filter(function (it) {\n                return it.value === datum.value;\n            })[0];\n            if (oldNode) {\n                datum.x = oldNode.x;\n                datum.y = oldNode.y;\n                datum.fx = oldNode.fx;\n                datum.fy = oldNode.fy;\n                datum.gx = oldNode.gx;\n                datum.gy = oldNode.gy;\n            }\n        };\n        primaryNodes.enter().each(applyOldPosition);\n        secondaryNodes.enter().each(applyOldPosition);\n        primaryNodes = primaryNodes.merge(this.appendNodes(primaryNodes.enter(), 'primary'));\n        secondaryNodes = secondaryNodes.merge(this.appendNodes(secondaryNodes.enter(), 'secondary'));\n        untypedNodes = untypedNodes.merge(this.appendNodes(untypedNodes.enter(), 'untyped'));\n        var linkLines = this.svgSel.select('g.links').selectAll('line').data(this.links);\n        linkLines.exit().remove();\n        linkLines = linkLines.enter().append('line').attr('id', function (d, i) {\n            return 'link-' + i;\n        }).on('mouseover', function (d, i) {\n            _this.tooltip.style('top', __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].pageY - 10 + 'px').style('left', __WEBPACK_IMPORTED_MODULE_3_d3__[\"event\"].pageX + 10 + 'px').style('visibility', 'visible').text(d.property.label);\n        }).on('mouseout', function (d, i) {\n            _this.tooltip.style('visibility', 'hidden');\n        }).merge(linkLines).style('visibility', this.$scope.layout.links === 'show' ? 'visible' : 'hidden');\n        // Add sunburst again so it stays on top\n        this.sunburst.addSunburstGroup(this.svgSel);\n        this.genericTick(primaryNodes, secondaryNodes, untypedNodes, linkLines, transition);\n        return this.$q.resolve('ok');\n    };\n    ExploreComponentController.prototype.mapVerifyToThis = function (state) {\n        return {\n            verify: state.verify\n        };\n    };\n    ExploreComponentController.prototype.mapTypesToThis = function (state) {\n        return {\n            types: state.types\n        };\n    };\n    ExploreComponentController.prototype.mapItemsToThis = function (state) {\n        return {\n            items: state.items\n        };\n    };\n    ExploreComponentController.prototype.mergeNodes = function (oldNodes, nodes) {\n        var newNodes = [];\n        // Check if old nodes are still in the mix\n        for (var i = 0; i < oldNodes.length; i++) {\n            for (var j = 0; j < nodes.length; j++) {\n                if (oldNodes[i].toCanonical() === nodes[j].toCanonical()) {\n                    newNodes.push(oldNodes[i]);\n                    // We need to grab new node information like labels and props in case it's changed\n                    oldNodes[i].label = nodes[j].label;\n                    oldNodes[i].localProperties = nodes[j].localProperties;\n                }\n            }\n        }\n        // Add the new nodes\n        for (var i = 0; i < nodes.length; i++) {\n            var check = false;\n            for (var j = 0; j < newNodes.length; j++) {\n                if (newNodes[j].toCanonical() === nodes[i].toCanonical()) check = true;\n            }\n            if (!check) {\n                newNodes.push(nodes[i]);\n            }\n        }\n        return newNodes;\n    };\n    ExploreComponentController.prototype.mergeLinks = function (oldLinks) {\n        var newLinks = [];\n        var items = this.primaryItems.concat(this.secondaryItems);\n        var sameAs = new __WEBPACK_IMPORTED_MODULE_4__models_rdf__[\"e\" /* ENodeMap */]();\n        for (var _i = 0, items_1 = items; _i < items_1.length; _i++) {\n            var item = items_1[_i];\n            sameAs.set(item, item);\n            var sameAsProp = item.localProperties.filter(function (p) {\n                return __WEBPACK_IMPORTED_MODULE_4__models_rdf__[\"d\" /* OWL */].sameAs.equals(p);\n            })[0];\n            if (sameAsProp && sameAsProp.values) for (var _a = 0, _b = sameAsProp.values; _a < _b.length; _a++) {\n                var n = _b[_a];\n                sameAs.set(n.value, item);\n            }\n        }\n        // Iterate over item property values to see if they match the id of any\n        // of the items displayed. Also check if they match sameAs values...\n        for (var _c = 0, items_2 = items; _c < items_2.length; _c++) {\n            var item = items_2[_c];\n            for (var _d = 0, _e = item.localProperties; _d < _e.length; _d++) {\n                var p = _e[_d];\n                for (var _f = 0, _g = p.values; _f < _g.length; _f++) {\n                    var v = _g[_f];\n                    if (sameAs.has(v.value) && item !== sameAs.get(v.value) && items.indexOf(sameAs.get(v.value)) !== -1) {\n                        newLinks.push({\n                            source: item,\n                            target: sameAs.get(v.value),\n                            property: p\n                        });\n                    }\n                }\n            }\n        }\n        return newLinks;\n    };\n    return ExploreComponentController;\n}();\nvar ExploreComponent = function () {\n    function ExploreComponent() {\n        this.bindings = {\n            linkMode: '<'\n        };\n        this.controller = ExploreComponentController; // (new (...args: any[]) => angular.IController) = ExploreComponentController\n        this.template = __webpack_require__(\"./app/components/construct-view/explore.pug\")();\n    }\n    return ExploreComponent;\n}();\n\n__WEBPACK_IMPORTED_MODULE_5_angular__[\"module\"]('fibra.components.explore', ['fibra.services']).component('explore', new ExploreComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9leHBsb3JlLWNvbXBvbmVudC50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9leHBsb3JlLWNvbXBvbmVudC50cz85OTJjIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmltcG9ydCB7IFByb3BlcnR5QW5kVmFsdWUgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9zcGFycWwtaXRlbS1zZXJ2aWNlJztcbmltcG9ydCB7IFN1bmJ1cnN0IH0gZnJvbSAnLi9zdW5idXJzdCc7XG5pbXBvcnQgeyBQcm9wZXJ0eVBvcG92ZXIgfSBmcm9tICcuL3Byb3BlcnR5LXBvcG92ZXInO1xuaW1wb3J0ICogYXMgZDMgZnJvbSAnZDMnO1xuaW1wb3J0IHsgT1dMLCBTS09TLCBEYXRhRmFjdG9yeSwgRU5vZGVNYXAgfSBmcm9tICcuLi8uLi9tb2RlbHMvcmRmJztcbmltcG9ydCAqIGFzIGFuZ3VsYXIgZnJvbSAnYW5ndWxhcic7XG5pbXBvcnQgKiBhcyBWZXJpZnlBY3Rpb25zIGZyb20gJy4uLy4uL2FjdGlvbnMvdmVyaWZ5JztcbmltcG9ydCAqIGFzIFR5cGVBY3Rpb25zIGZyb20gJy4uLy4uL2FjdGlvbnMvdHlwZXMnO1xuaW1wb3J0ICogYXMgSXRlbUFjdGlvbnMgZnJvbSAnLi4vLi4vYWN0aW9ucy9pdGVtcyc7XG52YXIgRXhwbG9yZUNvbXBvbmVudENvbnRyb2xsZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyKCRlbGVtZW50LCAkY29tcGlsZSwgJHdpbmRvdywgJHNjb3BlLCAkdGltZW91dCwgc3BhcnFsSXRlbVNlcnZpY2UsIGZpYnJhU2VydmljZSwgJG5nUmVkdXgsICRxKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuJGVsZW1lbnQgPSAkZWxlbWVudDtcbiAgICAgICAgdGhpcy4kY29tcGlsZSA9ICRjb21waWxlO1xuICAgICAgICB0aGlzLiR3aW5kb3cgPSAkd2luZG93O1xuICAgICAgICB0aGlzLiRzY29wZSA9ICRzY29wZTtcbiAgICAgICAgdGhpcy4kdGltZW91dCA9ICR0aW1lb3V0O1xuICAgICAgICB0aGlzLnNwYXJxbEl0ZW1TZXJ2aWNlID0gc3BhcnFsSXRlbVNlcnZpY2U7XG4gICAgICAgIHRoaXMuZmlicmFTZXJ2aWNlID0gZmlicmFTZXJ2aWNlO1xuICAgICAgICB0aGlzLiRuZ1JlZHV4ID0gJG5nUmVkdXg7XG4gICAgICAgIHRoaXMuJHEgPSAkcTtcbiAgICAgICAgdGhpcy5wcmltYXJ5SXRlbXMgPSBbXTtcbiAgICAgICAgdGhpcy5zZWNvbmRhcnlJdGVtcyA9IFtdO1xuICAgICAgICB0aGlzLnRlcnRpYXJ5SXRlbXMgPSBbXTtcbiAgICAgICAgdGhpcy51bnR5cGVkSXRlbXMgPSBbXTtcbiAgICAgICAgdGhpcy5yZW1vdmVkVW50eXBlZEl0ZW1zID0gW107XG4gICAgICAgIHRoaXMuYWxsSXRlbXMgPSBbXTtcbiAgICAgICAgdGhpcy5yYWRpdXNJbml0aWFsID0gMTtcbiAgICAgICAgdGhpcy5yYWRpdXMgPSA4O1xuICAgICAgICB0aGlzLnJhZGl1c0JvdW5jZSA9IDE1O1xuICAgICAgICB0aGlzLmdyaWRPZmZzZXQgPSA1MDsgLy8gU2hvdWxkIGJlIGV2ZW5cbiAgICAgICAgdGhpcy5jaGFyZ2VGb3JjZSA9IGQzLmZvcmNlQ29sbGlkZSh0aGlzLmdyaWRPZmZzZXQgLyAxLjUpO1xuICAgICAgICB0aGlzLmNoYXJnZUZvcmNlMiA9IGQzLmZvcmNlQ29sbGlkZSh0aGlzLmdyaWRPZmZzZXQgLyAxLjUpO1xuICAgICAgICB0aGlzLnN2Z0JhY2tncm91bmRDb2xvciA9ICcjRUVFJztcbiAgICAgICAgdGhpcy5sYXN0Q2xpY2tYID0gMDtcbiAgICAgICAgdGhpcy5sYXN0Q2xpY2tZID0gMDtcbiAgICAgICAgdmFyIHVuc3ViMSA9ICRuZ1JlZHV4LmNvbm5lY3QodGhpcy5tYXBWZXJpZnlUb1RoaXMsIFZlcmlmeUFjdGlvbnMpKHRoaXMpO1xuICAgICAgICB2YXIgdW5zdWIyID0gJG5nUmVkdXguY29ubmVjdCh0aGlzLm1hcFR5cGVzVG9UaGlzLCBUeXBlQWN0aW9ucykodGhpcyk7XG4gICAgICAgIHZhciB1bnN1YjMgPSAkbmdSZWR1eC5jb25uZWN0KHRoaXMubWFwSXRlbXNUb1RoaXMsIEl0ZW1BY3Rpb25zKSh0aGlzKTtcbiAgICAgICAgdGhpcy51bnN1YnNjcmliZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHVuc3ViMSgpO1xuICAgICAgICAgICAgdW5zdWIyKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuc3VuYnVyc3QgPSBuZXcgU3VuYnVyc3QoJGVsZW1lbnQsICRjb21waWxlLCAkc2NvcGUsIHNwYXJxbEl0ZW1TZXJ2aWNlLCBmaWJyYVNlcnZpY2UpO1xuICAgICAgICB0aGlzLnByb3BlcnR5UG9wb3ZlciA9IG5ldyBQcm9wZXJ0eVBvcG92ZXIoJGVsZW1lbnQsICRzY29wZSwgZmlicmFTZXJ2aWNlLCAkY29tcGlsZSk7XG4gICAgICAgIHRoaXMuZmlicmFTZXJ2aWNlLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyB0aGlzLnZlcmlmeUl0ZW0gPSB0aGlzLmZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLmNvbnN0cnVjdC52ZXJpZnlJdGVtXG4gICAgICAgICAgICByZXR1cm4gX3RoaXMucXVlcnlBbmRCdWlsZCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5pdGVtU2VydmljZSA9IHNwYXJxbEl0ZW1TZXJ2aWNlO1xuICAgICAgICB0aGlzLmxpbmtzID0gW107XG4gICAgICAgIHRoaXMuJHNjb3BlLmxheW91dCA9IHtcbiAgICAgICAgICAgICdjaG9pY2UnOiAnZm9yY2UnLFxuICAgICAgICAgICAgJ2xpbmtzJzogJ2hpZGUnXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuJHNjb3BlLiR3YXRjaCgnbGF5b3V0LmNob2ljZScsIHRoaXMudXBkYXRlRXhwbG9yZS5iaW5kKHRoaXMsIGZhbHNlKSk7XG4gICAgICAgIHRoaXMuJHNjb3BlLiR3YXRjaCgnbGF5b3V0LmxpbmtzJywgdGhpcy51cGRhdGVFeHBsb3JlLmJpbmQodGhpcywgZmFsc2UpKTtcbiAgICB9XG4gICAgRXhwbG9yZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLiRvbkNoYW5nZXMgPSBmdW5jdGlvbiAoY2huZ3NPYmopIHtcbiAgICAgICAgaWYgKHRoaXMuc3ZnU2VsKSB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUV4cGxvcmUoZmFsc2UsIGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgRXhwbG9yZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLiRwb3N0TGluayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5zdmdTZWwgPSBkMy5zZWxlY3QodGhpcy4kZWxlbWVudFswXSkuc2VsZWN0KCdzdmcnKTtcbiAgICAgICAgdGhpcy5zdmdTZWwuYXBwZW5kKCdyZWN0JylcbiAgICAgICAgICAgIC5jbGFzc2VkKCdiYWNrZ3JvdW5kJywgdHJ1ZSlcbiAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsIHRoaXMuc3ZnQmFja2dyb3VuZENvbG9yKVxuICAgICAgICAgICAgLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF90aGlzLmxhc3RDbGlja1ggPSBkMy5ldmVudC5vZmZzZXRYO1xuICAgICAgICAgICAgX3RoaXMubGFzdENsaWNrWSA9IGQzLmV2ZW50Lm9mZnNldFk7XG4gICAgICAgICAgICBfdGhpcy5maWJyYVNlcnZpY2UuZGlzcGF0Y2hBY3Rpb24oX3RoaXMuY3JlYXRlRGlzcGxheUl0ZW0oKSk7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBDcmVhdGUgbGluayBnXG4gICAgICAgIHRoaXMuc3ZnU2VsLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ2xpbmtzJyk7XG4gICAgICAgIHRoaXMuc3VuYnVyc3QuYWRkU3VuYnVyc3RHcm91cCh0aGlzLnN2Z1NlbCk7XG4gICAgICAgIHRoaXMucmFkaXVzID0gODtcbiAgICAgICAgdGhpcy50b29sdGlwID0gZDMuc2VsZWN0KCdib2R5JykuYXBwZW5kKCdkaXYnKVxuICAgICAgICAgICAgLnN0eWxlKCdwb3NpdGlvbicsICdhYnNvbHV0ZScpXG4gICAgICAgICAgICAuc3R5bGUoJ3otaW5kZXgnLCAnMjAnKVxuICAgICAgICAgICAgLnN0eWxlKCdiYWNrZ3JvdW5kLWNvbG9yJywgJ2dyYXknKVxuICAgICAgICAgICAgLnN0eWxlKCdjb2xvcicsICd3aGl0ZScpXG4gICAgICAgICAgICAuc3R5bGUoJ3BhZGRpbmcnLCAnM3B4JylcbiAgICAgICAgICAgIC5zdHlsZSgnYm9yZGVyLXJhZGl1cycsICcycHgnKVxuICAgICAgICAgICAgLnN0eWxlKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xuICAgICAgICB0aGlzLmVkaXR0aXAgPSBkMy5zZWxlY3QoJ2JvZHknKS5hcHBlbmQoJ2RpdicpXG4gICAgICAgICAgICAuYXR0cignaWQnLCAnZWRpdHRpcCcpXG4gICAgICAgICAgICAuc3R5bGUoJ3Bvc2l0aW9uJywgJ2Fic29sdXRlJylcbiAgICAgICAgICAgIC5zdHlsZSgnei1pbmRleCcsICc0MCcpXG4gICAgICAgICAgICAuc3R5bGUoJ2JhY2tncm91bmQtY29sb3InLCAnd2hpdGUnKVxuICAgICAgICAgICAgLnN0eWxlKCdjb2xvcicsICdncmF5JylcbiAgICAgICAgICAgIC5zdHlsZSgnYm9yZGVyJywgJzFweCBzb2xpZCBncmF5JylcbiAgICAgICAgICAgIC5zdHlsZSgncGFkZGluZycsICczcHgnKVxuICAgICAgICAgICAgLnN0eWxlKCdib3JkZXItcmFkaXVzJywgJzJweCcpXG4gICAgICAgICAgICAuc3R5bGUoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgICAgIHRoaXMudXBkYXRlU2l6aW5nKCk7XG4gICAgICAgIHRoaXMucXVlcnlBbmRCdWlsZCgpO1xuICAgIH07XG4gICAgLy8gY3VycmVudGx5IGJyb2tlbiBvbiBkZWxldGluZyBhIGxpbmtcbiAgICBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuaGlnaGxpZ2h0TGlua3MgPSBmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgICBkMy5zZWxlY3RBbGwoJ2xpbmUnKS5jbGFzc2VkKCdyZWxldmFudCcsIGZhbHNlKTtcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLmxpbmtzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICB2YXIgbGlua3NvdXJjZSA9IHRoaXMubGlua3Nbal0uc291cmNlO1xuICAgICAgICAgICAgdmFyIGxpbmt0YXJnZXQgPSB0aGlzLmxpbmtzW2pdLnRhcmdldDtcbiAgICAgICAgICAgIGlmIChsaW5rc291cmNlLmluZGV4ID09PSBpIHx8IGxpbmt0YXJnZXQuaW5kZXggPT09IGkpXG4gICAgICAgICAgICAgICAgZDMuc2VsZWN0KCcjbGluay0nICsgaikuY2xhc3NlZCgncmVsZXZhbnQnLCB0cnVlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgRXhwbG9yZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLiRvbkRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudW5zdWJzY3JpYmUoKTtcbiAgICB9O1xuICAgIEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5xdWVyeUFuZEJ1aWxkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgcHJvbSA9IHRoaXMuc3BhcnFsSXRlbVNlcnZpY2UuZ2V0SXRlbXModGhpcy5maWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5jb25zdHJ1Y3QuaXRlbXMsIGZhbHNlKS50aGVuKGZ1bmN0aW9uIChpdGVtcykge1xuICAgICAgICAgICAgLy8gSWYgd2UgYXJlIHNob3dpbmcgcHJvcGVydHkgcG9wb3ZlcnMsIGhpZGUgJ2VtLlxuICAgICAgICAgICAgX3RoaXMucHJvcGVydHlQb3BvdmVyLmhpZGVQb3BvdmVyKCk7XG4gICAgICAgICAgICAvLyBMb2NrIHByZXZpb3VzIGl0ZW1zXG4gICAgICAgICAgICBfdGhpcy5sb2NrRXhpc3RpbmcoX3RoaXMucHJpbWFyeUl0ZW1zKTtcbiAgICAgICAgICAgIF90aGlzLmxvY2tFeGlzdGluZyhfdGhpcy5zZWNvbmRhcnlJdGVtcyk7XG4gICAgICAgICAgICBfdGhpcy5sb2NrRXhpc3RpbmcoX3RoaXMudGVydGlhcnlJdGVtcyk7XG4gICAgICAgICAgICB2YXIgZGlzcGxheVR5cGVzID0gX3RoaXMudHlwZXMuZGlzcGxheVR5cGVzO1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRVbnR5cGVkID0gX3RoaXMuZmlsdGVySXRlbXNCeVR5cGUoaXRlbXMsIE9XTC5UaGluZy52YWx1ZSk7XG4gICAgICAgICAgICBfdGhpcy5yZW1vdmVkVW50eXBlZEl0ZW1zID0gX3RoaXMudW50eXBlZEl0ZW1zLmZpbHRlcihmdW5jdGlvbiAoaXQpIHsgcmV0dXJuIGN1cnJlbnRVbnR5cGVkLmluZGV4T2YoaXQpID09PSAtMTsgfSk7XG4gICAgICAgICAgICBfdGhpcy51bnR5cGVkSXRlbXMgPSBfdGhpcy5tZXJnZU5vZGVzKF90aGlzLnVudHlwZWRJdGVtcywgX3RoaXMuZmlsdGVySXRlbXNCeVR5cGUoaXRlbXMsIE9XTC5UaGluZy52YWx1ZSkpO1xuICAgICAgICAgICAgaWYgKGRpc3BsYXlUeXBlc1swXSlcbiAgICAgICAgICAgICAgICBfdGhpcy5wcmltYXJ5SXRlbXMgPSBfdGhpcy5tZXJnZU5vZGVzKF90aGlzLnByaW1hcnlJdGVtcywgX3RoaXMuZmlsdGVySXRlbXNCeVR5cGUoaXRlbXMsIGRpc3BsYXlUeXBlc1swXS5pZCkpO1xuICAgICAgICAgICAgaWYgKGRpc3BsYXlUeXBlc1sxXSlcbiAgICAgICAgICAgICAgICBfdGhpcy5zZWNvbmRhcnlJdGVtcyA9IF90aGlzLm1lcmdlTm9kZXMoX3RoaXMuc2Vjb25kYXJ5SXRlbXMsIF90aGlzLmZpbHRlckl0ZW1zQnlUeXBlKGl0ZW1zLCBkaXNwbGF5VHlwZXNbMV0uaWQpKTtcbiAgICAgICAgICAgIGlmIChkaXNwbGF5VHlwZXNbMl0pXG4gICAgICAgICAgICAgICAgX3RoaXMudGVydGlhcnlJdGVtcyA9IF90aGlzLm1lcmdlTm9kZXMoX3RoaXMudGVydGlhcnlJdGVtcywgX3RoaXMuZmlsdGVySXRlbXNCeVR5cGUoaXRlbXMsIGRpc3BsYXlUeXBlc1syXS5pZCkpO1xuICAgICAgICAgICAgX3RoaXMuYWxsSXRlbXMgPSBfdGhpcy5wcmltYXJ5SXRlbXMuY29uY2F0KF90aGlzLnNlY29uZGFyeUl0ZW1zKS5jb25jYXQoX3RoaXMudGVydGlhcnlJdGVtcykuY29uY2F0KF90aGlzLnVudHlwZWRJdGVtcyk7XG4gICAgICAgICAgICBfdGhpcy5wcm9wZXJ0aWVzID0gW107XG4gICAgICAgICAgICBpZiAoX3RoaXMucHJpbWFyeUl0ZW1zWzBdICYmIF90aGlzLnByaW1hcnlJdGVtc1swXS5sb2NhbFByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gX3RoaXMucHJpbWFyeUl0ZW1zWzBdLmxvY2FsUHJvcGVydGllczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSBfYVtfaV07XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnByb3BlcnRpZXMucHVzaCh7IGtleTogcC50b0Nhbm9uaWNhbCgpLCB2YWx1ZTogcC5sYWJlbCB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBfdGhpcy5saW5rcyA9IF90aGlzLm1lcmdlTGlua3MoX3RoaXMubGlua3MpO1xuICAgICAgICAgICAgcmV0dXJuICdvayc7XG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMudXBkYXRlRXhwbG9yZSgpOyB9KTtcbiAgICAgICAgdGhpcy5maWJyYVNlcnZpY2UuZGlzcGF0Y2hBY3Rpb24odGhpcy5maWJyYVNlcnZpY2UucGxhY2VIb2xkZXJBY3Rpb24ocHJvbSkpO1xuICAgICAgICByZXR1cm4gcHJvbTtcbiAgICB9O1xuICAgIEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5sb2NrRXhpc3RpbmcgPSBmdW5jdGlvbiAobm9kZXMpIHtcbiAgICAgICAgbm9kZXMuZm9yRWFjaChmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgICAgbm9kZS5meCA9IG5vZGUuZ3g7XG4gICAgICAgICAgICBub2RlLmZ5ID0gbm9kZS5neTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuZmlsdGVySXRlbXNCeVR5cGUgPSBmdW5jdGlvbiAoaXRlbXMsIHR5cGUpIHtcbiAgICAgICAgcmV0dXJuIGl0ZW1zLmZpbHRlcihmdW5jdGlvbiAoaXQpIHtcbiAgICAgICAgICAgIHZhciB0eXBlUHJvcCA9IGl0LmxvY2FsUHJvcGVydGllcy5jb25jYXQoaXQucmVtb3RlUHJvcGVydGllcykuZmlsdGVyKGZ1bmN0aW9uIChwcikge1xuICAgICAgICAgICAgICAgIHJldHVybiBwci52YWx1ZSA9PT0gJ2h0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyN0eXBlJztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKHR5cGVQcm9wWzBdKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVQcm9wWzBdLnZhbHVlcy5tYXAoZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHYudmFsdWUudmFsdWU7IH0pLmluZGV4T2YodHlwZSkgIT09IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS51cGRhdGVTaXppbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIGFsbG93IGl0ZW1faW5mb190aXAgdG8gZXhwYW5kIHNvbWVob3dcbiAgICAgICAgLy8gYWRkIGRlbGV0ZSBhbmQgYWx0ZXIgYWJpbGl0eSB0byBzcGFycWwtaXRlbS5wdWdcbiAgICAgICAgLy8gZml4IGhvdyBsaW5rcyBzaXQgb24gdG9wIG9mIG5vZGVzXG4gICAgICAgIHZhciB2aWV3cG9ydF93aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgICAgICB2YXIgdmlld3BvcnRfaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuICAgICAgICB0aGlzLmV4cGxvcmVXaWR0aCA9IHZpZXdwb3J0X3dpZHRoO1xuICAgICAgICB0aGlzLmV4cGxvcmVIZWlnaHQgPSB2aWV3cG9ydF9oZWlnaHQgLSAzNjtcbiAgICAgICAgZDMuc2VsZWN0KHRoaXMuJGVsZW1lbnRbMF0pLnNlbGVjdCgnI2V4cGxvcmVjb250YWluZXInKVxuICAgICAgICAgICAgLnN0eWxlKCdoZWlnaHQnLCB0aGlzLmV4cGxvcmVIZWlnaHQgKyAncHgnKTtcbiAgICAgICAgLy8gbW92ZSB0YWJsZSBkb3duIHNvIHRvcCBpcyBhdCBib3R0b20gb2Ygdmlld3BvcnRcbiAgICAgICAgZDMuc2VsZWN0KHRoaXMuJGVsZW1lbnRbMF0pLnNlbGVjdCgnI2V4cGxvcmV0YWJsZScpXG4gICAgICAgICAgICAuc3R5bGUoJ2hlaWdodCcsIHZpZXdwb3J0X2hlaWdodCAtIDUwICsgJ3B4Jyk7XG4gICAgICAgIHRoaXMuc3ZnU2VsLnN0eWxlKCd3aWR0aCcsIHZpZXdwb3J0X3dpZHRoICsgJ3B4JylcbiAgICAgICAgICAgIC5zdHlsZSgnaGVpZ2h0Jywgdmlld3BvcnRfaGVpZ2h0IC0gMzYgKyAncHgnKTtcbiAgICAgICAgdGhpcy5zdmdTZWwuc2VsZWN0KCdyZWN0LmJhY2tncm91bmQnKVxuICAgICAgICAgICAgLnN0eWxlKCd3aWR0aCcsIHZpZXdwb3J0X3dpZHRoICsgJ3B4JylcbiAgICAgICAgICAgIC5zdHlsZSgnaGVpZ2h0Jywgdmlld3BvcnRfaGVpZ2h0IC0gMzYgKyAncHgnKTtcbiAgICAgICAgdmFyIHN2Z193aWR0aCA9ICt0aGlzLnN2Z1NlbC5zdHlsZSgnd2lkdGgnKS5yZXBsYWNlKCdweCcsICcnKTtcbiAgICAgICAgdmFyIHN2Z19oZWlnaHQgPSArdGhpcy5zdmdTZWwuc3R5bGUoJ2hlaWdodCcpLnJlcGxhY2UoJ3B4JywgJycpO1xuICAgIH07XG4gICAgRXhwbG9yZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmFwcGVuZE5vZGVzID0gZnVuY3Rpb24gKGVudGVyU2VsZWN0aW9uLCBjbGFzc05hbWUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIGFwcGVuZFNlbGVjdGlvbiA9IGVudGVyU2VsZWN0aW9uLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAuYXR0cignaWQnLCBmdW5jdGlvbiAoZCwgaSkgeyByZXR1cm4gJ25vZGUtJyArIGkgKyAnLScgKyBjbGFzc05hbWU7IH0pXG4gICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnbm9kZScpXG4gICAgICAgICAgICAuY2xhc3NlZChjbGFzc05hbWUsIHRydWUpXG4gICAgICAgICAgICAuYXBwZW5kKCdjaXJjbGUnKVxuICAgICAgICAgICAgLmNsYXNzZWQoJ25vZGUtY2lyY2xlJywgdHJ1ZSlcbiAgICAgICAgICAgIC5jbGFzc2VkKGNsYXNzTmFtZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5hdHRyKCdpZCcsIGZ1bmN0aW9uIChkLCBpKSB7IHJldHVybiAnbm9kZS1jaXJjbGUtJyArIGkgKyAnLScgKyBjbGFzc05hbWU7IH0pXG4gICAgICAgICAgICAuYXR0cigncicsIHRoaXMucmFkaXVzSW5pdGlhbCArICdweCcpXG4gICAgICAgICAgICAuY2FsbChkMy5kcmFnKClcbiAgICAgICAgICAgIC5vbignc3RhcnQnLCBmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgICAgICAgaWYgKCFfdGhpcy5saW5rTW9kZSkge1xuICAgICAgICAgICAgICAgIGQuZnggPSBkLng7XG4gICAgICAgICAgICAgICAgZC5meSA9IGQueTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIF90aGlzLmRyYWdsaW5lID0gX3RoaXMuc3ZnU2VsLmFwcGVuZCgnbGluZScpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdkcmFnTGluZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAgICAgLm9uKCdkcmFnJywgZnVuY3Rpb24gKGQsIGksIGdyb3VwKSB7XG4gICAgICAgICAgICBpZiAoIV90aGlzLmxpbmtNb2RlKSB7XG4gICAgICAgICAgICAgICAgZDMuc2VsZWN0KGdyb3VwW2ldKS5jbGFzc2VkKCdmaXhlZCcsIHRydWUpO1xuICAgICAgICAgICAgICAgIGQueCA9IGQzLmV2ZW50Lng7XG4gICAgICAgICAgICAgICAgZC55ID0gZDMuZXZlbnQueTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIF90aGlzLmRyYWdsaW5lLmF0dHIoJ3gxJywgZC54KVxuICAgICAgICAgICAgICAgICAgICAuYXR0cigneTEnLCBkLnkpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd4MicsIGQzLmV2ZW50LngpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd5MicsIGQzLmV2ZW50LnkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX3RoaXMudXBkYXRlRXhwbG9yZShmYWxzZSwgZmFsc2UpO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLm9uKCdlbmQnLCBmdW5jdGlvbiAoZCwgaSwgZ3JvdXApIHtcbiAgICAgICAgICAgIGlmICghX3RoaXMubGlua01vZGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWQzLnNlbGVjdChncm91cFtpXSkuY2xhc3NlZCgnZml4ZWQnKSkge1xuICAgICAgICAgICAgICAgICAgICBkLmZ4ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICBkLmZ5ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBsaW5lWF8xID0gK190aGlzLmRyYWdsaW5lLmF0dHIoJ3gyJyk7XG4gICAgICAgICAgICAgICAgdmFyIGxpbmVZXzEgPSArX3RoaXMuZHJhZ2xpbmUuYXR0cigneTInKTtcbiAgICAgICAgICAgICAgICB2YXIgbm9kZURyb3BfMSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGQzLnNlbGVjdEFsbCgnLm5vZGUnKVxuICAgICAgICAgICAgICAgICAgICAuZWFjaChmdW5jdGlvbiAoZiwgaikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMobGluZVhfMSAtIGYueCkgPCBfdGhpcy5yYWRpdXMgJiYgTWF0aC5hYnMobGluZVlfMSAtIGYueSkgPCBfdGhpcy5yYWRpdXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVEcm9wXzEgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZmlicmFTZXJ2aWNlLmRpc3BhdGNoQWN0aW9uKF90aGlzLml0ZW1Qcm9wZXJ0eShmLCBbbmV3IFByb3BlcnR5QW5kVmFsdWUoU0tPUy5yZWxhdGVkLCBEYXRhRmFjdG9yeS5pbnN0YW5jZS5ub2RlRnJvbU5vZGUoZCkpXSwgW10pKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmRyYWdsaW5lLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnF1ZXJ5QW5kQnVpbGQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmICghbm9kZURyb3BfMSkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5kcmFnbGluZS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKVxuICAgICAgICAgICAgLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgICAgICAgX3RoaXMuaGlnaGxpZ2h0TGlua3MoZCwgaSk7XG4gICAgICAgICAgICBfdGhpcy50b29sdGlwLnN0eWxlKCd0b3AnLCAoZDMuZXZlbnQucGFnZVkgLSAxMCkgKyAncHgnKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnbGVmdCcsIChkMy5ldmVudC5wYWdlWCArIDEwKSArICdweCcpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCd2aXNpYmlsaXR5JywgJ3Zpc2libGUnKVxuICAgICAgICAgICAgICAgIC50ZXh0KGQubGFiZWwpO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLm9uKCdtb3VzZW91dCcsIGZ1bmN0aW9uIChkLCBpKSB7XG4gICAgICAgICAgICBfdGhpcy5zdmdTZWwuc2VsZWN0QWxsKCdsaW5lJykuY2xhc3NlZCgncmVsZXZhbnQnLCBmYWxzZSk7XG4gICAgICAgICAgICBfdGhpcy50b29sdGlwLnN0eWxlKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLm9uKCdjbGljaycsIGZ1bmN0aW9uIChkLCBpLCBncm91cCkge1xuICAgICAgICAgICAgdmFyIGxvY2FsU2VsZWN0ZWQgPSBkLnNlbGVjdGVkO1xuICAgICAgICAgICAgLy8gVW5zZWxlY3QgZXZlcnl0aGluZ1xuICAgICAgICAgICAgX3RoaXMuc3ZnU2VsLnNlbGVjdEFsbCgnLm5vZGUnKVxuICAgICAgICAgICAgICAgIC5lYWNoKGZ1bmN0aW9uIChuKSB7IG4uc2VsZWN0ZWQgPSBmYWxzZTsgfSk7XG4gICAgICAgICAgICAvLyBGbGlwIHRoaXMgb25lXG4gICAgICAgICAgICBkLnNlbGVjdGVkID0gIWxvY2FsU2VsZWN0ZWQ7XG4gICAgICAgICAgICBfdGhpcy51cGRhdGVFeHBsb3JlKGZhbHNlKTtcbiAgICAgICAgICAgIGlmIChkLnNlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuc3ZnU2VsLnNlbGVjdCgnZy5zdW5idXJzdC1vdmVybGF5JylcbiAgICAgICAgICAgICAgICAgICAgLmRhdHVtKGQpXG4gICAgICAgICAgICAgICAgICAgIC5lYWNoKF90aGlzLnN1bmJ1cnN0LmJ1aWxkU3VuYnVyc3QuYmluZChfdGhpcykpXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZGlzcGxheScsICdibG9jaycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuc3ZnU2VsLnNlbGVjdCgnLnN1bmJ1cnN0LW92ZXJsYXknKS5zdHlsZSgnZGlzcGxheScsICdub25lJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBfdGhpcy5oaWdobGlnaHRMaW5rcyhkLCBpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGFwcGVuZFNlbGVjdGlvblxuICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgLmF0dHIoJ3InLCAodGhpcy5yYWRpdXMgKyB0aGlzLnJhZGl1c0JvdW5jZSkgKyAncHgnKVxuICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgLmF0dHIoJ3InLCB0aGlzLnJhZGl1cyArICdweCcpO1xuICAgICAgICByZXR1cm4gYXBwZW5kU2VsZWN0aW9uO1xuICAgIH07XG4gICAgRXhwbG9yZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLnNuYXBUb0dyaWQgPSBmdW5jdGlvbiAoeCwgeSwgcHJpbWFyeSkge1xuICAgICAgICBpZiAocHJpbWFyeSA9PT0gdm9pZCAwKSB7IHByaW1hcnkgPSB0cnVlOyB9XG4gICAgICAgIHZhciBzeCwgc3k7XG4gICAgICAgIC8vIFNuYXAgdG8gZ3JpZE9mZnNldCB3aXRoIGZ1cnRoZXIgb2Zmc2V0IGZvciBtdWx0aXBsZXNcbiAgICAgICAgaWYgKHByaW1hcnkpIHtcbiAgICAgICAgICAgIHN4ID0gTWF0aC5yb3VuZCh4IC8gdGhpcy5ncmlkT2Zmc2V0KSAqIHRoaXMuZ3JpZE9mZnNldDtcbiAgICAgICAgICAgIHN5ID0gTWF0aC5yb3VuZCh5IC8gdGhpcy5ncmlkT2Zmc2V0KSAqIHRoaXMuZ3JpZE9mZnNldDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHN4ID0gTWF0aC5yb3VuZCh4IC8gdGhpcy5ncmlkT2Zmc2V0KSAqIHRoaXMuZ3JpZE9mZnNldCAtIHRoaXMuZ3JpZE9mZnNldCAvIDI7XG4gICAgICAgICAgICBzeSA9IE1hdGgucm91bmQoeSAvIHRoaXMuZ3JpZE9mZnNldCkgKiB0aGlzLmdyaWRPZmZzZXQgLSB0aGlzLmdyaWRPZmZzZXQgLyAyO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbc3gsIHN5XTtcbiAgICB9O1xuICAgIEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS50aWNrVHJhbnNmb3JtTm9kZXMgPSBmdW5jdGlvbiAoc2VsLCBwcmltYXJ5KSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmIChwcmltYXJ5ID09PSB2b2lkIDApIHsgcHJpbWFyeSA9IHRydWU7IH1cbiAgICAgICAgc2VsLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uIChkLCBpKSB7XG4gICAgICAgICAgICB2YXIgeCA9IGQueCwgeSA9IGQueTtcbiAgICAgICAgICAgIGlmIChkLnggPCBfdGhpcy5yYWRpdXMpXG4gICAgICAgICAgICAgICAgeCA9IF90aGlzLnJhZGl1cztcbiAgICAgICAgICAgIGlmIChkLnkgPCBfdGhpcy5yYWRpdXMpXG4gICAgICAgICAgICAgICAgeSA9IF90aGlzLnJhZGl1cztcbiAgICAgICAgICAgIHZhciBfYSA9IFt4LCB5XSwgZ3ggPSBfYVswXSwgZ3kgPSBfYVsxXTtcbiAgICAgICAgICAgIGlmIChfdGhpcy4kc2NvcGUubGF5b3V0LmNob2ljZSA9PT0gJ2ZvcmNlZ3JpZCcpIHtcbiAgICAgICAgICAgICAgICBfYiA9IF90aGlzLnNuYXBUb0dyaWQoeCwgeSwgcHJpbWFyeSksIGd4ID0gX2JbMF0sIGd5ID0gX2JbMV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkLmd4ID0gZ3g7XG4gICAgICAgICAgICBkLmd5ID0gZ3k7XG4gICAgICAgICAgICByZXR1cm4gJ3RyYW5zbGF0ZSgnICsgZ3ggKyAnLCAnICsgZ3kgKyAnKSc7XG4gICAgICAgICAgICB2YXIgX2I7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoc2VsLmZpbHRlcihmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5zZWxlY3RlZDsgfSkubm9kZSgpKSB7XG4gICAgICAgICAgICB2YXIgc2JGdW5jXzEgPSB0aGlzLnN1bmJ1cnN0LmJ1aWxkU3VuYnVyc3Q7XG4gICAgICAgICAgICB2YXIgc3ZnU2VsXzEgPSB0aGlzLnN2Z1NlbDtcbiAgICAgICAgICAgIHZhciB0aWNrU3VuYnVyc3QgPSBmdW5jdGlvbiAoZCwgaSwgZykge1xuICAgICAgICAgICAgICAgIHN2Z1NlbF8xLnNlbGVjdCgnZy5zdW5idXJzdC1vdmVybGF5JykuZGF0dW0oZCkuZWFjaChzYkZ1bmNfMS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBzZWwuZmlsdGVyKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnNlbGVjdGVkOyB9KVxuICAgICAgICAgICAgICAgIC5lYWNoKHRpY2tTdW5idXJzdC5iaW5kKHRoaXMpKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgRXhwbG9yZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmdlbmVyaWNUaWNrID0gZnVuY3Rpb24gKHByaW1hcnlOb2Rlcywgc2Vjb25kYXJ5Tm9kZXMsIHVudHlwZWROb2RlcywgbGlua0xpbmVzLCB0cmFuc2l0aW9uKSB7XG4gICAgICAgIGlmICh0cmFuc2l0aW9uID09PSB2b2lkIDApIHsgdHJhbnNpdGlvbiA9IGZhbHNlOyB9XG4gICAgICAgIHZhciBsUHJpbWFyeU5vZGVzID0gcHJpbWFyeU5vZGVzO1xuICAgICAgICB2YXIgbFNlY29uZGFyeU5vZGVzID0gc2Vjb25kYXJ5Tm9kZXM7XG4gICAgICAgIHZhciBsVW50eXBlZE5vZGVzID0gdW50eXBlZE5vZGVzO1xuICAgICAgICB2YXIgbExpbmtMaW5lcyA9IGxpbmtMaW5lcztcbiAgICAgICAgaWYgKHRyYW5zaXRpb24pIHtcbiAgICAgICAgICAgIGxQcmltYXJ5Tm9kZXMgPSBsUHJpbWFyeU5vZGVzLnRyYW5zaXRpb24oKTtcbiAgICAgICAgICAgIGxTZWNvbmRhcnlOb2RlcyA9IGxTZWNvbmRhcnlOb2Rlcy50cmFuc2l0aW9uKCk7XG4gICAgICAgICAgICBsVW50eXBlZE5vZGVzID0gbFVudHlwZWROb2Rlcy50cmFuc2l0aW9uKCk7XG4gICAgICAgICAgICBsTGlua0xpbmVzID0gbExpbmtMaW5lcy50cmFuc2l0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50aWNrVHJhbnNmb3JtTm9kZXMobFByaW1hcnlOb2RlcywgdHJ1ZSk7XG4gICAgICAgIHRoaXMudGlja1RyYW5zZm9ybU5vZGVzKGxTZWNvbmRhcnlOb2RlcywgZmFsc2UpO1xuICAgICAgICB0aGlzLnRpY2tUcmFuc2Zvcm1Ob2RlcyhsVW50eXBlZE5vZGVzLCBmYWxzZSk7XG4gICAgICAgIHRoaXMuc3ZnU2VsLnNlbGVjdEFsbCgnLm5vZGUtY2lyY2xlJylcbiAgICAgICAgICAgIC5jbGFzc2VkKCdzZWxlY3RlZC1jaXJjbGUnLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5zZWxlY3RlZDsgfSlcbiAgICAgICAgICAgIC5zdHlsZSgnY3Vyc29yJywgdGhpcy5saW5rTW9kZSA/ICdjcm9zc2hhaXInIDogJ2luaXRpYWwnKTtcbiAgICAgICAgdGhpcy5zdmdTZWwuc2VsZWN0QWxsKCcubm9kZS1jaXJjbGUnKVxuICAgICAgICAgICAgLmNsYXNzZWQoJ2xhYmVsZWQnLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5sYWJlbCA/IHRydWUgOiBmYWxzZTsgfSlcbiAgICAgICAgICAgIC5jbGFzc2VkKCd2ZXJpZmllZCcsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmxvY2FsUHJvcGVydGllcy5maWx0ZXIoZnVuY3Rpb24gKHApIHsgcmV0dXJuIHAudmFsdWUgPT09ICdodHRwOi8vd3d3LnczLm9yZy8yMDAyLzA3L293bCNzYW1lQXMnOyB9KS5sZW5ndGggPiAwOyB9KTtcbiAgICAgICAgbExpbmtMaW5lc1xuICAgICAgICAgICAgLmF0dHIoJ3gxJywgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuc291cmNlLmd4OyB9KVxuICAgICAgICAgICAgLmF0dHIoJ3kxJywgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuc291cmNlLmd5OyB9KVxuICAgICAgICAgICAgLmF0dHIoJ3gyJywgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudGFyZ2V0Lmd4OyB9KVxuICAgICAgICAgICAgLmF0dHIoJ3kyJywgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudGFyZ2V0Lmd5OyB9KTtcbiAgICB9O1xuICAgIEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS51cGRhdGVFeHBsb3JlID0gZnVuY3Rpb24gKHJ1blNpbSwgdHJhbnNpdGlvbikge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAocnVuU2ltID09PSB2b2lkIDApIHsgcnVuU2ltID0gdHJ1ZTsgfVxuICAgICAgICBpZiAodHJhbnNpdGlvbiA9PT0gdm9pZCAwKSB7IHRyYW5zaXRpb24gPSBmYWxzZTsgfVxuICAgICAgICB2YXIgdW50eXBlZE5vZGVzID0gdGhpcy5zdmdTZWxcbiAgICAgICAgICAgIC5zZWxlY3RBbGwoJ2NpcmNsZS51bnR5cGVkJylcbiAgICAgICAgICAgIC5kYXRhKHRoaXMudW50eXBlZEl0ZW1zLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC52YWx1ZTsgfSk7XG4gICAgICAgIHZhciBwcmltYXJ5Tm9kZXMgPSB0aGlzLnN2Z1NlbFxuICAgICAgICAgICAgLnNlbGVjdEFsbCgnY2lyY2xlLnByaW1hcnknKVxuICAgICAgICAgICAgLmRhdGEodGhpcy5wcmltYXJ5SXRlbXMsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnZhbHVlOyB9KTtcbiAgICAgICAgdmFyIHNlY29uZGFyeU5vZGVzID0gdGhpcy5zdmdTZWxcbiAgICAgICAgICAgIC5zZWxlY3RBbGwoJ2NpcmNsZS5zZWNvbmRhcnknKVxuICAgICAgICAgICAgLmRhdGEodGhpcy5zZWNvbmRhcnlJdGVtcywgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudmFsdWU7IH0pO1xuICAgICAgICBwcmltYXJ5Tm9kZXMuZXhpdCgpLnJlbW92ZSgpO1xuICAgICAgICBzZWNvbmRhcnlOb2Rlcy5leGl0KCkucmVtb3ZlKCk7XG4gICAgICAgIHVudHlwZWROb2Rlcy5leGl0KCkucmVtb3ZlKCk7XG4gICAgICAgIC8vIFVudHlwZWQgbm9kZXMgc2hvdWxkIGNvbWUgaW4gb25lIGF0IGEgdGltZSBiYXNlZCBvbiBhIHVzZXIncyBjbGljayBldmVudC4gRm9yIHRoZXNlXG4gICAgICAgIC8vIHdlIGFsc28gd2FudCBhcHBlbmQgdGhlIHVzZXIgaW50ZXJmYWNlIGZvciBzZXR0aW5nIHR5cGUgYW5kIGxhYmVsLlxuICAgICAgICB1bnR5cGVkTm9kZXMuZW50ZXIoKS5lYWNoKGZ1bmN0aW9uIChkYXR1bSwgaSwgZykge1xuICAgICAgICAgICAgZGF0dW0ueCA9IF90aGlzLmxhc3RDbGlja1g7XG4gICAgICAgICAgICBkYXR1bS55ID0gX3RoaXMubGFzdENsaWNrWTtcbiAgICAgICAgICAgIGRhdHVtLmZ4ID0gX3RoaXMubGFzdENsaWNrWDtcbiAgICAgICAgICAgIGRhdHVtLmZ5ID0gX3RoaXMubGFzdENsaWNrWTtcbiAgICAgICAgICAgIGRhdHVtLmd4ID0gX3RoaXMubGFzdENsaWNrWDtcbiAgICAgICAgICAgIGRhdHVtLmd5ID0gX3RoaXMubGFzdENsaWNrWTtcbiAgICAgICAgfSkuZWFjaCh0aGlzLnByb3BlcnR5UG9wb3Zlci5hZGRQb3BvdmVyLmJpbmQodGhpcywgdGhpcy4kc2NvcGUsIHRoaXMuc3ZnU2VsKSk7XG4gICAgICAgIC8vIElmIGEgbm9kZSB3ZW50IGZyb20gYmVpbmcgdW50eXBlZCB0byBiZWluZyBwcmltYXJ5IG9yIHNlY29uZGFyeSwgYnJpbmcgYWxvbmcgaXRzIHBvc2l0aW9uXG4gICAgICAgIC8vIEFsc28gaGFuZGxlIHBvc2l0aW9uIGdldHRpbmcgc2V0IGZyb20gYSBkcm9wIChwdWxsIHBvc2l0aW9uIGZyb20gc3RhdGUpXG4gICAgICAgIHZhciBhcHBseU9sZFBvc2l0aW9uID0gZnVuY3Rpb24gKGRhdHVtKSB7XG4gICAgICAgICAgICAvLyBHZXQgcG9zaXRpb24gZnJvbSBzdGF0ZSBpZiBpdCB3YXMgc2V0IHRoZXJlLlxuICAgICAgICAgICAgZGF0dW0ueCA9IF90aGlzLmZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLmNvbnN0cnVjdC5pdGVtSW5kZXhbZGF0dW0udmFsdWVdLng7XG4gICAgICAgICAgICBkYXR1bS55ID0gX3RoaXMuZmlicmFTZXJ2aWNlLmdldFN0YXRlKCkuY29uc3RydWN0Lml0ZW1JbmRleFtkYXR1bS52YWx1ZV0ueTtcbiAgICAgICAgICAgIGRhdHVtLmZ4ID0gX3RoaXMuZmlicmFTZXJ2aWNlLmdldFN0YXRlKCkuY29uc3RydWN0Lml0ZW1JbmRleFtkYXR1bS52YWx1ZV0ueDtcbiAgICAgICAgICAgIGRhdHVtLmZ5ID0gX3RoaXMuZmlicmFTZXJ2aWNlLmdldFN0YXRlKCkuY29uc3RydWN0Lml0ZW1JbmRleFtkYXR1bS52YWx1ZV0ueTtcbiAgICAgICAgICAgIGRhdHVtLmd4ID0gX3RoaXMuZmlicmFTZXJ2aWNlLmdldFN0YXRlKCkuY29uc3RydWN0Lml0ZW1JbmRleFtkYXR1bS52YWx1ZV0ueDtcbiAgICAgICAgICAgIGRhdHVtLmd4ID0gX3RoaXMuZmlicmFTZXJ2aWNlLmdldFN0YXRlKCkuY29uc3RydWN0Lml0ZW1JbmRleFtkYXR1bS52YWx1ZV0ueTtcbiAgICAgICAgICAgIC8vIE9yIGlmIG5vZGUgd2FzIGFscmVhZHkgaGVyZSwgZ2V0IHBvc2l0aW9uIGZyb20gb2xkIG5vZGVcbiAgICAgICAgICAgIHZhciBvbGROb2RlID0gX3RoaXMucmVtb3ZlZFVudHlwZWRJdGVtcy5maWx0ZXIoZnVuY3Rpb24gKGl0KSB7IHJldHVybiBpdC52YWx1ZSA9PT0gZGF0dW0udmFsdWU7IH0pWzBdO1xuICAgICAgICAgICAgaWYgKG9sZE5vZGUpIHtcbiAgICAgICAgICAgICAgICBkYXR1bS54ID0gb2xkTm9kZS54O1xuICAgICAgICAgICAgICAgIGRhdHVtLnkgPSBvbGROb2RlLnk7XG4gICAgICAgICAgICAgICAgZGF0dW0uZnggPSBvbGROb2RlLmZ4O1xuICAgICAgICAgICAgICAgIGRhdHVtLmZ5ID0gb2xkTm9kZS5meTtcbiAgICAgICAgICAgICAgICBkYXR1bS5neCA9IG9sZE5vZGUuZ3g7XG4gICAgICAgICAgICAgICAgZGF0dW0uZ3kgPSBvbGROb2RlLmd5O1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBwcmltYXJ5Tm9kZXMuZW50ZXIoKS5lYWNoKGFwcGx5T2xkUG9zaXRpb24pO1xuICAgICAgICBzZWNvbmRhcnlOb2Rlcy5lbnRlcigpLmVhY2goYXBwbHlPbGRQb3NpdGlvbik7XG4gICAgICAgIHByaW1hcnlOb2RlcyA9IHByaW1hcnlOb2Rlcy5tZXJnZSh0aGlzLmFwcGVuZE5vZGVzKHByaW1hcnlOb2Rlcy5lbnRlcigpLCAncHJpbWFyeScpKTtcbiAgICAgICAgc2Vjb25kYXJ5Tm9kZXMgPSBzZWNvbmRhcnlOb2Rlcy5tZXJnZSh0aGlzLmFwcGVuZE5vZGVzKHNlY29uZGFyeU5vZGVzLmVudGVyKCksICdzZWNvbmRhcnknKSk7XG4gICAgICAgIHVudHlwZWROb2RlcyA9IHVudHlwZWROb2Rlcy5tZXJnZSh0aGlzLmFwcGVuZE5vZGVzKHVudHlwZWROb2Rlcy5lbnRlcigpLCAndW50eXBlZCcpKTtcbiAgICAgICAgdmFyIGxpbmtMaW5lcyA9IHRoaXMuc3ZnU2VsXG4gICAgICAgICAgICAuc2VsZWN0KCdnLmxpbmtzJylcbiAgICAgICAgICAgIC5zZWxlY3RBbGwoJ2xpbmUnKVxuICAgICAgICAgICAgLmRhdGEodGhpcy5saW5rcyk7XG4gICAgICAgIGxpbmtMaW5lcy5leGl0KCkucmVtb3ZlKCk7XG4gICAgICAgIGxpbmtMaW5lcyA9IGxpbmtMaW5lc1xuICAgICAgICAgICAgLmVudGVyKCkuYXBwZW5kKCdsaW5lJylcbiAgICAgICAgICAgIC5hdHRyKCdpZCcsIGZ1bmN0aW9uIChkLCBpKSB7IHJldHVybiAnbGluay0nICsgaTsgfSlcbiAgICAgICAgICAgIC5vbignbW91c2VvdmVyJywgZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgICAgIF90aGlzLnRvb2x0aXAuc3R5bGUoJ3RvcCcsIChkMy5ldmVudC5wYWdlWSAtIDEwKSArICdweCcpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdsZWZ0JywgKGQzLmV2ZW50LnBhZ2VYICsgMTApICsgJ3B4JylcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpXG4gICAgICAgICAgICAgICAgLnRleHQoZC5wcm9wZXJ0eS5sYWJlbCk7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAub24oJ21vdXNlb3V0JywgZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgICAgIF90aGlzLnRvb2x0aXAuc3R5bGUoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAubWVyZ2UobGlua0xpbmVzKVxuICAgICAgICAgICAgLnN0eWxlKCd2aXNpYmlsaXR5JywgdGhpcy4kc2NvcGUubGF5b3V0LmxpbmtzID09PSAnc2hvdycgPyAndmlzaWJsZScgOiAnaGlkZGVuJyk7XG4gICAgICAgIC8vIEFkZCBzdW5idXJzdCBhZ2FpbiBzbyBpdCBzdGF5cyBvbiB0b3BcbiAgICAgICAgdGhpcy5zdW5idXJzdC5hZGRTdW5idXJzdEdyb3VwKHRoaXMuc3ZnU2VsKTtcbiAgICAgICAgdGhpcy5nZW5lcmljVGljayhwcmltYXJ5Tm9kZXMsIHNlY29uZGFyeU5vZGVzLCB1bnR5cGVkTm9kZXMsIGxpbmtMaW5lcywgdHJhbnNpdGlvbik7XG4gICAgICAgIHJldHVybiB0aGlzLiRxLnJlc29sdmUoJ29rJyk7XG4gICAgfTtcbiAgICBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUubWFwVmVyaWZ5VG9UaGlzID0gZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB2ZXJpZnk6IHN0YXRlLnZlcmlmeVxuICAgICAgICB9O1xuICAgIH07XG4gICAgRXhwbG9yZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLm1hcFR5cGVzVG9UaGlzID0gZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlczogc3RhdGUudHlwZXNcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5tYXBJdGVtc1RvVGhpcyA9IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaXRlbXM6IHN0YXRlLml0ZW1zXG4gICAgICAgIH07XG4gICAgfTtcbiAgICBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUubWVyZ2VOb2RlcyA9IGZ1bmN0aW9uIChvbGROb2Rlcywgbm9kZXMpIHtcbiAgICAgICAgdmFyIG5ld05vZGVzID0gW107XG4gICAgICAgIC8vIENoZWNrIGlmIG9sZCBub2RlcyBhcmUgc3RpbGwgaW4gdGhlIG1peFxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9sZE5vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG5vZGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9sZE5vZGVzW2ldLnRvQ2Fub25pY2FsKCkgPT09IG5vZGVzW2pdLnRvQ2Fub25pY2FsKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3Tm9kZXMucHVzaChvbGROb2Rlc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gZ3JhYiBuZXcgbm9kZSBpbmZvcm1hdGlvbiBsaWtlIGxhYmVscyBhbmQgcHJvcHMgaW4gY2FzZSBpdCdzIGNoYW5nZWRcbiAgICAgICAgICAgICAgICAgICAgb2xkTm9kZXNbaV0ubGFiZWwgPSBub2Rlc1tqXS5sYWJlbDtcbiAgICAgICAgICAgICAgICAgICAgb2xkTm9kZXNbaV0ubG9jYWxQcm9wZXJ0aWVzID0gbm9kZXNbal0ubG9jYWxQcm9wZXJ0aWVzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBBZGQgdGhlIG5ldyBub2Rlc1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgY2hlY2sgPSBmYWxzZTtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbmV3Tm9kZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBpZiAobmV3Tm9kZXNbal0udG9DYW5vbmljYWwoKSA9PT0gbm9kZXNbaV0udG9DYW5vbmljYWwoKSlcbiAgICAgICAgICAgICAgICAgICAgY2hlY2sgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFjaGVjaykge1xuICAgICAgICAgICAgICAgIG5ld05vZGVzLnB1c2gobm9kZXNbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXdOb2RlcztcbiAgICB9O1xuICAgIEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5tZXJnZUxpbmtzID0gZnVuY3Rpb24gKG9sZExpbmtzKSB7XG4gICAgICAgIHZhciBuZXdMaW5rcyA9IFtdO1xuICAgICAgICB2YXIgaXRlbXMgPSB0aGlzLnByaW1hcnlJdGVtcy5jb25jYXQodGhpcy5zZWNvbmRhcnlJdGVtcyk7XG4gICAgICAgIHZhciBzYW1lQXMgPSBuZXcgRU5vZGVNYXAoKTtcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBpdGVtc18xID0gaXRlbXM7IF9pIDwgaXRlbXNfMS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgIHZhciBpdGVtID0gaXRlbXNfMVtfaV07XG4gICAgICAgICAgICBzYW1lQXMuc2V0KGl0ZW0sIGl0ZW0pO1xuICAgICAgICAgICAgdmFyIHNhbWVBc1Byb3AgPSBpdGVtLmxvY2FsUHJvcGVydGllcy5maWx0ZXIoZnVuY3Rpb24gKHApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gT1dMLnNhbWVBcy5lcXVhbHMocCk7XG4gICAgICAgICAgICB9KVswXTtcbiAgICAgICAgICAgIGlmIChzYW1lQXNQcm9wICYmIHNhbWVBc1Byb3AudmFsdWVzKVxuICAgICAgICAgICAgICAgIGZvciAodmFyIF9hID0gMCwgX2IgPSBzYW1lQXNQcm9wLnZhbHVlczsgX2EgPCBfYi5sZW5ndGg7IF9hKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSBfYltfYV07XG4gICAgICAgICAgICAgICAgICAgIHNhbWVBcy5zZXQobi52YWx1ZSwgaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIEl0ZXJhdGUgb3ZlciBpdGVtIHByb3BlcnR5IHZhbHVlcyB0byBzZWUgaWYgdGhleSBtYXRjaCB0aGUgaWQgb2YgYW55XG4gICAgICAgIC8vIG9mIHRoZSBpdGVtcyBkaXNwbGF5ZWQuIEFsc28gY2hlY2sgaWYgdGhleSBtYXRjaCBzYW1lQXMgdmFsdWVzLi4uXG4gICAgICAgIGZvciAodmFyIF9jID0gMCwgaXRlbXNfMiA9IGl0ZW1zOyBfYyA8IGl0ZW1zXzIubGVuZ3RoOyBfYysrKSB7XG4gICAgICAgICAgICB2YXIgaXRlbSA9IGl0ZW1zXzJbX2NdO1xuICAgICAgICAgICAgZm9yICh2YXIgX2QgPSAwLCBfZSA9IGl0ZW0ubG9jYWxQcm9wZXJ0aWVzOyBfZCA8IF9lLmxlbmd0aDsgX2QrKykge1xuICAgICAgICAgICAgICAgIHZhciBwID0gX2VbX2RdO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIF9mID0gMCwgX2cgPSBwLnZhbHVlczsgX2YgPCBfZy5sZW5ndGg7IF9mKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHYgPSBfZ1tfZl07XG4gICAgICAgICAgICAgICAgICAgIGlmIChzYW1lQXMuaGFzKHYudmFsdWUpICYmIGl0ZW0gIT09IHNhbWVBcy5nZXQodi52YWx1ZSkgJiYgaXRlbXMuaW5kZXhPZihzYW1lQXMuZ2V0KHYudmFsdWUpKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0xpbmtzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZTogaXRlbSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IHNhbWVBcy5nZXQodi52YWx1ZSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHk6IHBcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXdMaW5rcztcbiAgICB9O1xuICAgIHJldHVybiBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlcjtcbn0oKSk7XG52YXIgRXhwbG9yZUNvbXBvbmVudCA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRXhwbG9yZUNvbXBvbmVudCgpIHtcbiAgICAgICAgdGhpcy5iaW5kaW5ncyA9IHtcbiAgICAgICAgICAgIGxpbmtNb2RlOiAnPCcsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY29udHJvbGxlciA9IEV4cGxvcmVDb21wb25lbnRDb250cm9sbGVyOyAvLyAobmV3ICguLi5hcmdzOiBhbnlbXSkgPT4gYW5ndWxhci5JQ29udHJvbGxlcikgPSBFeHBsb3JlQ29tcG9uZW50Q29udHJvbGxlclxuICAgICAgICB0aGlzLnRlbXBsYXRlID0gcmVxdWlyZSgnLi9leHBsb3JlLnB1ZycpKCk7XG4gICAgfVxuICAgIHJldHVybiBFeHBsb3JlQ29tcG9uZW50O1xufSgpKTtcbmV4cG9ydCB7IEV4cGxvcmVDb21wb25lbnQgfTtcbmFuZ3VsYXIubW9kdWxlKCdmaWJyYS5jb21wb25lbnRzLmV4cGxvcmUnLCBbJ2ZpYnJhLnNlcnZpY2VzJ10pXG4gICAgLmNvbXBvbmVudCgnZXhwbG9yZScsIG5ldyBFeHBsb3JlQ29tcG9uZW50KCkpO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGFwcC9jb21wb25lbnRzL2NvbnN0cnVjdC12aWV3L2V4cGxvcmUtY29tcG9uZW50LnRzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFRQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUVBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQU1BO0FBQUE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUlBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFJQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUVBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFFQTtBQUFBO0FBQ0E7QUFFQTtBQUFBO0FBQ0E7QUFFQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUVBO0FBQUE7QUFFQTtBQUlBO0FBRUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),

/***/ "./app/components/construct-view/explore-table-component/explore-table-component.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__services_sparql_item_service__ = __webpack_require__(\"./app/services/sparql-item-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__models_rdf__ = __webpack_require__(\"./app/models/rdf.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__models_richnode__ = __webpack_require__(\"./app/models/richnode.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__actions_verify__ = __webpack_require__(\"./app/actions/verify.ts\");\n/* unused harmony export ExploreTableComponentController */\n/* unused harmony export ExploreTableComponent */\n\n\n\n\n\n\n\nvar ExploreTableComponentController = function () {\n    function ExploreTableComponentController(fibraService, $ngRedux, sparqlItemService) {\n        this.fibraService = fibraService;\n        this.$ngRedux = $ngRedux;\n        this.sparqlItemService = sparqlItemService;\n        // bindings\n        this.primaryItems = [];\n        this.secondaryItems = [];\n        this.tableTypes = ['primary', 'secondary'];\n        this.primary = {\n            properties: [],\n            items: []\n        };\n        this.secondary = {\n            properties: [],\n            items: []\n        };\n        this.removedProperties = [];\n        this.originalPropertiesMap = {};\n        this.fibraService = fibraService;\n        this.unsubscribe = $ngRedux.connect(this.mapStateToThis, __WEBPACK_IMPORTED_MODULE_4__actions_verify__)(this);\n    }\n    ExploreTableComponentController.prototype.$onDestroy = function () {\n        this.unsubscribe();\n    };\n    ExploreTableComponentController.prototype.$onChanges = function (chngsObj) {\n        this.primary.properties = [];\n        this.secondary.properties = [];\n        this.primary.items = this.primaryItems;\n        this.secondary.items = this.secondaryItems;\n        this.sortProperties();\n    };\n    ExploreTableComponentController.prototype.mapStateToThis = function (state) {\n        return {\n            verify: state.verify\n        };\n    };\n    ExploreTableComponentController.prototype.selectItem = function (item) {\n        this.editItem = item;\n        var origProps = item.localProperties.map(function (prop) {\n            var newProp = new __WEBPACK_IMPORTED_MODULE_0__services_sparql_item_service__[\"c\" /* PropertyToValues */](prop);\n            prop.values.filter(function (vl) {\n                return vl.value.termType === 'Literal';\n            }).forEach(function (vl) {\n                var literalNode = __WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"b\" /* DataFactory */].instance.literal(vl.value.value);\n                var snpl = new __WEBPACK_IMPORTED_MODULE_2__models_richnode__[\"c\" /* FullRichNodeFromNode */](literalNode, vl.value.label, undefined, undefined, vl.value.sourceEndpoints);\n                newProp.values.push(new __WEBPACK_IMPORTED_MODULE_0__services_sparql_item_service__[\"d\" /* RichPropertyValue */](snpl, vl.properties));\n            });\n            return newProp;\n        }).filter(function (prop) {\n            return prop.values.length > 0;\n        });\n        this.originalPropertiesMap[item.value] = origProps;\n    };\n    ExploreTableComponentController.prototype.itemVerified = function (item) {\n        return !!item.localProperties.filter(function (p) {\n            return p.value === __WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"d\" /* OWL */].sameAs.value;\n        })[0];\n    };\n    ExploreTableComponentController.prototype.saveItem = function (item) {\n        // Currently this just replaces all properties on the item. We should really only update\n        // properties that have changed.\n        var newProps = item.localProperties.map(function (prop) {\n            return prop.values.filter(function (vl) {\n                return vl.value.termType === 'Literal';\n            }).map(function (vl) {\n                return new __WEBPACK_IMPORTED_MODULE_0__services_sparql_item_service__[\"a\" /* PropertyAndValue */](prop, __WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"b\" /* DataFactory */].instance.literal(vl.value.value));\n            });\n        }).reduce(function (acc, val) {\n            return acc.concat(val);\n        }, []);\n        this.fibraService.dispatchAction(this.fibraService.itemProperty(item, newProps, this.originalPropertiesMap[item.value].map(function (v) {\n            return v.toPropertyAndValues(true);\n        }).reduce(function (acc, val) {\n            return acc.concat(val);\n        }, [])));\n    };\n    ExploreTableComponentController.prototype.hide = function (id) {\n        return this.fibraService.dispatchAction(this.fibraService.hideItem(id)).then(function () {\n            return 'ok';\n        });\n    };\n    ExploreTableComponentController.prototype.delete = function (id) {\n        return this.fibraService.dispatchAction(this.fibraService.deleteItem(id));\n    };\n    ExploreTableComponentController.prototype.sortProperties = function () {\n        var _this = this;\n        // fill in each property array with every property possessed by the associated objects\n        ['primary', 'secondary'].forEach(function (key) {\n            for (var i = 0; i < _this[key].items.length; i++) {\n                for (var p = 0; p < _this[key].items[i].localProperties.length; p++) {\n                    var duplicate = false;\n                    for (var j = 0; j < _this.removedProperties.length; j++) {\n                        if (_this.removedProperties[j] === _this[key].items[i].localProperties[p].value) duplicate = true;\n                    }\n                    for (var j = 0; j < _this[key].properties.length; j++) {\n                        if (_this[key].properties[j].value === _this[key].items[i].localProperties[p].value) {\n                            duplicate = true;\n                        }\n                    }\n                    if (!duplicate) {\n                        _this[key].properties.push(_this[key].items[i].localProperties[p]);\n                    }\n                }\n            }\n        });\n    };\n    ExploreTableComponentController.prototype.removeFromProperties = function (property) {\n        var _this = this;\n        ['primary', 'secondary'].forEach(function (key) {\n            for (var i = 0; i < _this[key].properties.length; i++) {\n                if (_this[key].properties[i].value === property.value) {\n                    _this[key].properties.splice(i, 1);\n                }\n            }\n        });\n        this.addToRemovedProperties(property.value);\n    };\n    ExploreTableComponentController.prototype.addToRemovedProperties = function (property) {\n        this.removedProperties.push(property);\n    };\n    ExploreTableComponentController.prototype.addFromRemovedProperties = function (property) {\n        for (var i = 0; i < this.removedProperties.length; i++) {\n            if (this.removedProperties[i] == property) this.removedProperties.splice(i, 1);\n        }\n        this.fibraService.dispatch('change');\n    };\n    // start of csv download capability\n    ExploreTableComponentController.prototype.downloadcsv = function () {\n        var table = this.primary.items;\n        var csv = \"data:text/csv;charset=utf-8,\";\n        for (var i = 0; i < this.primary.properties.length; i++) {\n            csv += this.primary.properties[i].label + ',';\n        }\n        csv += '\\n';\n        for (var i = 0; i < table.length; i++) {\n            for (var j = 0; j < table[i].localProperties.length; j++) {\n                csv += table[i].localProperties[j].values[0].value.value + ',';\n            }\n            csv += '\\n';\n        }\n        var encUri = encodeURI(csv);\n        window.open(encUri);\n    };\n    return ExploreTableComponentController;\n}();\n\nvar ExploreTableComponent = function () {\n    function ExploreTableComponent() {\n        this.template = __webpack_require__(\"./app/components/construct-view/explore-table-component/explore-table-component.pug\")();\n        this.controller = ExploreTableComponentController;\n        this.bindings = {\n            primaryItems: '<',\n            secondaryItems: '<'\n        };\n    }\n    return ExploreTableComponent;\n}();\n\n__WEBPACK_IMPORTED_MODULE_3_angular__[\"module\"]('fibra.components.explore-table', ['fibra.services']).component('exploreTable', new ExploreTableComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9leHBsb3JlLXRhYmxlLWNvbXBvbmVudC9leHBsb3JlLXRhYmxlLWNvbXBvbmVudC50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9leHBsb3JlLXRhYmxlLWNvbXBvbmVudC9leHBsb3JlLXRhYmxlLWNvbXBvbmVudC50cz80ZTBmIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmltcG9ydCB7IFByb3BlcnR5VG9WYWx1ZXMsIFJpY2hQcm9wZXJ0eVZhbHVlLCBQcm9wZXJ0eUFuZFZhbHVlIH0gZnJvbSAnLi4vLi4vLi4vc2VydmljZXMvc3BhcnFsLWl0ZW0tc2VydmljZSc7XG5pbXBvcnQgeyBEYXRhRmFjdG9yeSwgT1dMIH0gZnJvbSAnLi4vLi4vLi4vbW9kZWxzL3JkZic7XG5pbXBvcnQgeyBGdWxsUmljaE5vZGVGcm9tTm9kZSB9IGZyb20gJy4uLy4uLy4uL21vZGVscy9yaWNobm9kZSc7XG5pbXBvcnQgKiBhcyBhbmd1bGFyIGZyb20gJ2FuZ3VsYXInO1xuaW1wb3J0ICogYXMgVmVyaWZ5QWN0aW9ucyBmcm9tICcuLi8uLi8uLi9hY3Rpb25zL3ZlcmlmeSc7XG52YXIgRXhwbG9yZVRhYmxlQ29tcG9uZW50Q29udHJvbGxlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRXhwbG9yZVRhYmxlQ29tcG9uZW50Q29udHJvbGxlcihmaWJyYVNlcnZpY2UsICRuZ1JlZHV4LCBzcGFycWxJdGVtU2VydmljZSkge1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZSA9IGZpYnJhU2VydmljZTtcbiAgICAgICAgdGhpcy4kbmdSZWR1eCA9ICRuZ1JlZHV4O1xuICAgICAgICB0aGlzLnNwYXJxbEl0ZW1TZXJ2aWNlID0gc3BhcnFsSXRlbVNlcnZpY2U7XG4gICAgICAgIC8vIGJpbmRpbmdzXG4gICAgICAgIHRoaXMucHJpbWFyeUl0ZW1zID0gW107XG4gICAgICAgIHRoaXMuc2Vjb25kYXJ5SXRlbXMgPSBbXTtcbiAgICAgICAgdGhpcy50YWJsZVR5cGVzID0gWydwcmltYXJ5JywgJ3NlY29uZGFyeSddO1xuICAgICAgICB0aGlzLnByaW1hcnkgPSB7XG4gICAgICAgICAgICBwcm9wZXJ0aWVzOiBbXSxcbiAgICAgICAgICAgIGl0ZW1zOiBbXVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnNlY29uZGFyeSA9IHtcbiAgICAgICAgICAgIHByb3BlcnRpZXM6IFtdLFxuICAgICAgICAgICAgaXRlbXM6IFtdXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucmVtb3ZlZFByb3BlcnRpZXMgPSBbXTtcbiAgICAgICAgdGhpcy5vcmlnaW5hbFByb3BlcnRpZXNNYXAgPSB7fTtcbiAgICAgICAgdGhpcy5maWJyYVNlcnZpY2UgPSBmaWJyYVNlcnZpY2U7XG4gICAgICAgIHRoaXMudW5zdWJzY3JpYmUgPSAkbmdSZWR1eC5jb25uZWN0KHRoaXMubWFwU3RhdGVUb1RoaXMsIFZlcmlmeUFjdGlvbnMpKHRoaXMpO1xuICAgIH1cbiAgICBFeHBsb3JlVGFibGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS4kb25EZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlKCk7XG4gICAgfTtcbiAgICBFeHBsb3JlVGFibGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS4kb25DaGFuZ2VzID0gZnVuY3Rpb24gKGNobmdzT2JqKSB7XG4gICAgICAgIHRoaXMucHJpbWFyeS5wcm9wZXJ0aWVzID0gW107XG4gICAgICAgIHRoaXMuc2Vjb25kYXJ5LnByb3BlcnRpZXMgPSBbXTtcbiAgICAgICAgdGhpcy5wcmltYXJ5Lml0ZW1zID0gdGhpcy5wcmltYXJ5SXRlbXM7XG4gICAgICAgIHRoaXMuc2Vjb25kYXJ5Lml0ZW1zID0gdGhpcy5zZWNvbmRhcnlJdGVtcztcbiAgICAgICAgdGhpcy5zb3J0UHJvcGVydGllcygpO1xuICAgIH07XG4gICAgRXhwbG9yZVRhYmxlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUubWFwU3RhdGVUb1RoaXMgPSBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHZlcmlmeTogc3RhdGUudmVyaWZ5XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBFeHBsb3JlVGFibGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5zZWxlY3RJdGVtID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgdGhpcy5lZGl0SXRlbSA9IGl0ZW07XG4gICAgICAgIHZhciBvcmlnUHJvcHMgPSBpdGVtLmxvY2FsUHJvcGVydGllcy5tYXAoZnVuY3Rpb24gKHByb3ApIHtcbiAgICAgICAgICAgIHZhciBuZXdQcm9wID0gbmV3IFByb3BlcnR5VG9WYWx1ZXMocHJvcCk7XG4gICAgICAgICAgICBwcm9wLnZhbHVlc1xuICAgICAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKHZsKSB7IHJldHVybiB2bC52YWx1ZS50ZXJtVHlwZSA9PT0gJ0xpdGVyYWwnOyB9KVxuICAgICAgICAgICAgICAgIC5mb3JFYWNoKGZ1bmN0aW9uICh2bCkge1xuICAgICAgICAgICAgICAgIHZhciBsaXRlcmFsTm9kZSA9IERhdGFGYWN0b3J5Lmluc3RhbmNlLmxpdGVyYWwodmwudmFsdWUudmFsdWUpO1xuICAgICAgICAgICAgICAgIHZhciBzbnBsID0gbmV3IEZ1bGxSaWNoTm9kZUZyb21Ob2RlKGxpdGVyYWxOb2RlLCB2bC52YWx1ZS5sYWJlbCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHZsLnZhbHVlLnNvdXJjZUVuZHBvaW50cyk7XG4gICAgICAgICAgICAgICAgbmV3UHJvcC52YWx1ZXMucHVzaChuZXcgUmljaFByb3BlcnR5VmFsdWUoc25wbCwgdmwucHJvcGVydGllcykpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gbmV3UHJvcDtcbiAgICAgICAgfSkuZmlsdGVyKGZ1bmN0aW9uIChwcm9wKSB7IHJldHVybiBwcm9wLnZhbHVlcy5sZW5ndGggPiAwOyB9KTtcbiAgICAgICAgdGhpcy5vcmlnaW5hbFByb3BlcnRpZXNNYXBbaXRlbS52YWx1ZV0gPSBvcmlnUHJvcHM7XG4gICAgfTtcbiAgICBFeHBsb3JlVGFibGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5pdGVtVmVyaWZpZWQgPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICByZXR1cm4gISEoaXRlbS5sb2NhbFByb3BlcnRpZXMuZmlsdGVyKGZ1bmN0aW9uIChwKSB7IHJldHVybiBwLnZhbHVlID09PSBPV0wuc2FtZUFzLnZhbHVlOyB9KVswXSk7XG4gICAgfTtcbiAgICBFeHBsb3JlVGFibGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5zYXZlSXRlbSA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIC8vIEN1cnJlbnRseSB0aGlzIGp1c3QgcmVwbGFjZXMgYWxsIHByb3BlcnRpZXMgb24gdGhlIGl0ZW0uIFdlIHNob3VsZCByZWFsbHkgb25seSB1cGRhdGVcbiAgICAgICAgLy8gcHJvcGVydGllcyB0aGF0IGhhdmUgY2hhbmdlZC5cbiAgICAgICAgdmFyIG5ld1Byb3BzID0gaXRlbS5sb2NhbFByb3BlcnRpZXMubWFwKGZ1bmN0aW9uIChwcm9wKSB7XG4gICAgICAgICAgICByZXR1cm4gcHJvcC52YWx1ZXNcbiAgICAgICAgICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uICh2bCkgeyByZXR1cm4gdmwudmFsdWUudGVybVR5cGUgPT09ICdMaXRlcmFsJzsgfSlcbiAgICAgICAgICAgICAgICAubWFwKGZ1bmN0aW9uICh2bCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvcGVydHlBbmRWYWx1ZShwcm9wLCBEYXRhRmFjdG9yeS5pbnN0YW5jZS5saXRlcmFsKHZsLnZhbHVlLnZhbHVlKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSkucmVkdWNlKGZ1bmN0aW9uIChhY2MsIHZhbCkgeyByZXR1cm4gYWNjLmNvbmNhdCh2YWwpOyB9LCBbXSk7XG4gICAgICAgIHRoaXMuZmlicmFTZXJ2aWNlLmRpc3BhdGNoQWN0aW9uKHRoaXMuZmlicmFTZXJ2aWNlLml0ZW1Qcm9wZXJ0eShpdGVtLCBuZXdQcm9wcywgdGhpcy5vcmlnaW5hbFByb3BlcnRpZXNNYXBbaXRlbS52YWx1ZV0ubWFwKGZ1bmN0aW9uICh2KSB7IHJldHVybiB2LnRvUHJvcGVydHlBbmRWYWx1ZXModHJ1ZSk7IH0pLnJlZHVjZShmdW5jdGlvbiAoYWNjLCB2YWwpIHsgcmV0dXJuIGFjYy5jb25jYXQodmFsKTsgfSwgW10pKSk7XG4gICAgfTtcbiAgICBFeHBsb3JlVGFibGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZpYnJhU2VydmljZS5kaXNwYXRjaEFjdGlvbih0aGlzLmZpYnJhU2VydmljZS5oaWRlSXRlbShpZCkpLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gJ29rJzsgfSk7XG4gICAgfTtcbiAgICBFeHBsb3JlVGFibGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5kZWxldGUgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmlicmFTZXJ2aWNlLmRpc3BhdGNoQWN0aW9uKHRoaXMuZmlicmFTZXJ2aWNlLmRlbGV0ZUl0ZW0oaWQpKTtcbiAgICB9O1xuICAgIEV4cGxvcmVUYWJsZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLnNvcnRQcm9wZXJ0aWVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAvLyBmaWxsIGluIGVhY2ggcHJvcGVydHkgYXJyYXkgd2l0aCBldmVyeSBwcm9wZXJ0eSBwb3NzZXNzZWQgYnkgdGhlIGFzc29jaWF0ZWQgb2JqZWN0c1xuICAgICAgICBbJ3ByaW1hcnknLCAnc2Vjb25kYXJ5J10uZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IF90aGlzW2tleV0uaXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBwID0gMDsgcCA8IF90aGlzW2tleV0uaXRlbXNbaV0ubG9jYWxQcm9wZXJ0aWVzLmxlbmd0aDsgcCsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkdXBsaWNhdGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBfdGhpcy5yZW1vdmVkUHJvcGVydGllcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLnJlbW92ZWRQcm9wZXJ0aWVzW2pdID09PSBfdGhpc1trZXldLml0ZW1zW2ldLmxvY2FsUHJvcGVydGllc1twXS52YWx1ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXBsaWNhdGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgX3RoaXNba2V5XS5wcm9wZXJ0aWVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXNba2V5XS5wcm9wZXJ0aWVzW2pdLnZhbHVlID09PSBfdGhpc1trZXldLml0ZW1zW2ldLmxvY2FsUHJvcGVydGllc1twXS52YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1cGxpY2F0ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFkdXBsaWNhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzW2tleV0ucHJvcGVydGllcy5wdXNoKF90aGlzW2tleV0uaXRlbXNbaV0ubG9jYWxQcm9wZXJ0aWVzW3BdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBFeHBsb3JlVGFibGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5yZW1vdmVGcm9tUHJvcGVydGllcyA9IGZ1bmN0aW9uIChwcm9wZXJ0eSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBbJ3ByaW1hcnknLCAnc2Vjb25kYXJ5J10uZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IF90aGlzW2tleV0ucHJvcGVydGllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChfdGhpc1trZXldLnByb3BlcnRpZXNbaV0udmFsdWUgPT09IHByb3BlcnR5LnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzW2tleV0ucHJvcGVydGllcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5hZGRUb1JlbW92ZWRQcm9wZXJ0aWVzKHByb3BlcnR5LnZhbHVlKTtcbiAgICB9O1xuICAgIEV4cGxvcmVUYWJsZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmFkZFRvUmVtb3ZlZFByb3BlcnRpZXMgPSBmdW5jdGlvbiAocHJvcGVydHkpIHtcbiAgICAgICAgdGhpcy5yZW1vdmVkUHJvcGVydGllcy5wdXNoKHByb3BlcnR5KTtcbiAgICB9O1xuICAgIEV4cGxvcmVUYWJsZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmFkZEZyb21SZW1vdmVkUHJvcGVydGllcyA9IGZ1bmN0aW9uIChwcm9wZXJ0eSkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucmVtb3ZlZFByb3BlcnRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnJlbW92ZWRQcm9wZXJ0aWVzW2ldID09IHByb3BlcnR5KVxuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlZFByb3BlcnRpZXMuc3BsaWNlKGksIDEpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZmlicmFTZXJ2aWNlLmRpc3BhdGNoKCdjaGFuZ2UnKTtcbiAgICB9O1xuICAgIC8vIHN0YXJ0IG9mIGNzdiBkb3dubG9hZCBjYXBhYmlsaXR5XG4gICAgRXhwbG9yZVRhYmxlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuZG93bmxvYWRjc3YgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0YWJsZSA9IHRoaXMucHJpbWFyeS5pdGVtcztcbiAgICAgICAgdmFyIGNzdiA9IFwiZGF0YTp0ZXh0L2NzdjtjaGFyc2V0PXV0Zi04LFwiO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucHJpbWFyeS5wcm9wZXJ0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjc3YgKz0gdGhpcy5wcmltYXJ5LnByb3BlcnRpZXNbaV0ubGFiZWwgKyAnLCc7XG4gICAgICAgIH1cbiAgICAgICAgY3N2ICs9ICdcXG4nO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRhYmxlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRhYmxlW2ldLmxvY2FsUHJvcGVydGllcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIGNzdiArPSB0YWJsZVtpXS5sb2NhbFByb3BlcnRpZXNbal0udmFsdWVzWzBdLnZhbHVlLnZhbHVlICsgJywnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY3N2ICs9ICdcXG4nO1xuICAgICAgICB9XG4gICAgICAgIHZhciBlbmNVcmkgPSBlbmNvZGVVUkkoY3N2KTtcbiAgICAgICAgd2luZG93Lm9wZW4oZW5jVXJpKTtcbiAgICB9O1xuICAgIHJldHVybiBFeHBsb3JlVGFibGVDb21wb25lbnRDb250cm9sbGVyO1xufSgpKTtcbmV4cG9ydCB7IEV4cGxvcmVUYWJsZUNvbXBvbmVudENvbnRyb2xsZXIgfTtcbnZhciBFeHBsb3JlVGFibGVDb21wb25lbnQgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEV4cGxvcmVUYWJsZUNvbXBvbmVudCgpIHtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IHJlcXVpcmUoJy4vZXhwbG9yZS10YWJsZS1jb21wb25lbnQucHVnJykoKTtcbiAgICAgICAgdGhpcy5jb250cm9sbGVyID0gRXhwbG9yZVRhYmxlQ29tcG9uZW50Q29udHJvbGxlcjtcbiAgICAgICAgdGhpcy5iaW5kaW5ncyA9IHtcbiAgICAgICAgICAgIHByaW1hcnlJdGVtczogJzwnLFxuICAgICAgICAgICAgc2Vjb25kYXJ5SXRlbXM6ICc8J1xuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gRXhwbG9yZVRhYmxlQ29tcG9uZW50O1xufSgpKTtcbmV4cG9ydCB7IEV4cGxvcmVUYWJsZUNvbXBvbmVudCB9O1xuYW5ndWxhci5tb2R1bGUoJ2ZpYnJhLmNvbXBvbmVudHMuZXhwbG9yZS10YWJsZScsIFsnZmlicmEuc2VydmljZXMnXSlcbiAgICAuY29tcG9uZW50KCdleHBsb3JlVGFibGUnLCBuZXcgRXhwbG9yZVRhYmxlQ29tcG9uZW50KCkpO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGFwcC9jb21wb25lbnRzL2NvbnN0cnVjdC12aWV3L2V4cGxvcmUtdGFibGUtY29tcG9uZW50L2V4cGxvcmUtdGFibGUtY29tcG9uZW50LnRzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),

/***/ "./app/components/construct-view/explore-type-component/explore-type-component.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__actions_types__ = __webpack_require__(\"./app/actions/types.ts\");\n/* unused harmony export ExploreTypeComponentController */\n/* unused harmony export ExploreTypeComponent */\n\n\n\n\nvar ExploreTypeComponentController = function () {\n    function ExploreTypeComponentController(fibraService, $ngRedux) {\n        this.fibraService = fibraService;\n        this.$ngRedux = $ngRedux;\n        this.unsubscribe = $ngRedux.connect(this.mapStateToThis, __WEBPACK_IMPORTED_MODULE_1__actions_types__)(this);\n        this.fibraService = fibraService;\n    }\n    ExploreTypeComponentController.prototype.primaryClick = function (type) {\n        var newTypes = this.types.displayTypes.concat([]);\n        newTypes[0] = type;\n        this.setOrderedTypes(newTypes);\n        this.fibraService.dispatch('change');\n    };\n    ExploreTypeComponentController.prototype.secondaryClick = function (type) {\n        var newTypes = this.types.displayTypes.concat([]);\n        newTypes[1] = type;\n        this.setOrderedTypes(newTypes);\n        this.fibraService.dispatch('change');\n    };\n    ExploreTypeComponentController.prototype.tertiaryClick = function (type) {\n        var newTypes = this.types.displayTypes.concat([]);\n        newTypes[2] = type;\n        this.setOrderedTypes(newTypes);\n        this.fibraService.dispatch('change');\n    };\n    ExploreTypeComponentController.prototype.$onDestroy = function () {\n        this.unsubscribe();\n    };\n    ExploreTypeComponentController.prototype.mapStateToThis = function (state) {\n        return {\n            types: state.types\n        };\n    };\n    return ExploreTypeComponentController;\n}();\n\nvar ExploreTypeComponent = function () {\n    function ExploreTypeComponent() {\n        this.template = __webpack_require__(\"./app/components/construct-view/explore-type-component/explore-type-component.pug\")();\n        this.controller = ExploreTypeComponentController;\n    }\n    return ExploreTypeComponent;\n}();\n\n__WEBPACK_IMPORTED_MODULE_0_angular__[\"module\"]('fibra.components.explore-type', ['fibra.services']).component('exploreType', new ExploreTypeComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9leHBsb3JlLXR5cGUtY29tcG9uZW50L2V4cGxvcmUtdHlwZS1jb21wb25lbnQudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL2NvbXBvbmVudHMvY29uc3RydWN0LXZpZXcvZXhwbG9yZS10eXBlLWNvbXBvbmVudC9leHBsb3JlLXR5cGUtY29tcG9uZW50LnRzPzBhY2YiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuaW1wb3J0ICogYXMgYW5ndWxhciBmcm9tICdhbmd1bGFyJztcbmltcG9ydCAqIGFzIFR5cGVBY3Rpb25zIGZyb20gJy4uLy4uLy4uL2FjdGlvbnMvdHlwZXMnO1xudmFyIEV4cGxvcmVUeXBlQ29tcG9uZW50Q29udHJvbGxlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRXhwbG9yZVR5cGVDb21wb25lbnRDb250cm9sbGVyKGZpYnJhU2VydmljZSwgJG5nUmVkdXgpIHtcbiAgICAgICAgdGhpcy5maWJyYVNlcnZpY2UgPSBmaWJyYVNlcnZpY2U7XG4gICAgICAgIHRoaXMuJG5nUmVkdXggPSAkbmdSZWR1eDtcbiAgICAgICAgdGhpcy51bnN1YnNjcmliZSA9ICRuZ1JlZHV4LmNvbm5lY3QodGhpcy5tYXBTdGF0ZVRvVGhpcywgVHlwZUFjdGlvbnMpKHRoaXMpO1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZSA9IGZpYnJhU2VydmljZTtcbiAgICB9XG4gICAgRXhwbG9yZVR5cGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5wcmltYXJ5Q2xpY2sgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICB2YXIgbmV3VHlwZXMgPSB0aGlzLnR5cGVzLmRpc3BsYXlUeXBlcy5jb25jYXQoW10pO1xuICAgICAgICBuZXdUeXBlc1swXSA9IHR5cGU7XG4gICAgICAgIHRoaXMuc2V0T3JkZXJlZFR5cGVzKG5ld1R5cGVzKTtcbiAgICAgICAgdGhpcy5maWJyYVNlcnZpY2UuZGlzcGF0Y2goJ2NoYW5nZScpO1xuICAgIH07XG4gICAgRXhwbG9yZVR5cGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5zZWNvbmRhcnlDbGljayA9IGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICAgIHZhciBuZXdUeXBlcyA9IHRoaXMudHlwZXMuZGlzcGxheVR5cGVzLmNvbmNhdChbXSk7XG4gICAgICAgIG5ld1R5cGVzWzFdID0gdHlwZTtcbiAgICAgICAgdGhpcy5zZXRPcmRlcmVkVHlwZXMobmV3VHlwZXMpO1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZS5kaXNwYXRjaCgnY2hhbmdlJyk7XG4gICAgfTtcbiAgICBFeHBsb3JlVHlwZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLnRlcnRpYXJ5Q2xpY2sgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICB2YXIgbmV3VHlwZXMgPSB0aGlzLnR5cGVzLmRpc3BsYXlUeXBlcy5jb25jYXQoW10pO1xuICAgICAgICBuZXdUeXBlc1syXSA9IHR5cGU7XG4gICAgICAgIHRoaXMuc2V0T3JkZXJlZFR5cGVzKG5ld1R5cGVzKTtcbiAgICAgICAgdGhpcy5maWJyYVNlcnZpY2UuZGlzcGF0Y2goJ2NoYW5nZScpO1xuICAgIH07XG4gICAgRXhwbG9yZVR5cGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS4kb25EZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlKCk7XG4gICAgfTtcbiAgICBFeHBsb3JlVHlwZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLm1hcFN0YXRlVG9UaGlzID0gZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlczogc3RhdGUudHlwZXNcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIHJldHVybiBFeHBsb3JlVHlwZUNvbXBvbmVudENvbnRyb2xsZXI7XG59KCkpO1xuZXhwb3J0IHsgRXhwbG9yZVR5cGVDb21wb25lbnRDb250cm9sbGVyIH07XG52YXIgRXhwbG9yZVR5cGVDb21wb25lbnQgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEV4cGxvcmVUeXBlQ29tcG9uZW50KCkge1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gcmVxdWlyZSgnLi9leHBsb3JlLXR5cGUtY29tcG9uZW50LnB1ZycpKCk7XG4gICAgICAgIHRoaXMuY29udHJvbGxlciA9IEV4cGxvcmVUeXBlQ29tcG9uZW50Q29udHJvbGxlcjtcbiAgICB9XG4gICAgcmV0dXJuIEV4cGxvcmVUeXBlQ29tcG9uZW50O1xufSgpKTtcbmV4cG9ydCB7IEV4cGxvcmVUeXBlQ29tcG9uZW50IH07XG5hbmd1bGFyLm1vZHVsZSgnZmlicmEuY29tcG9uZW50cy5leHBsb3JlLXR5cGUnLCBbJ2ZpYnJhLnNlcnZpY2VzJ10pXG4gICAgLmNvbXBvbmVudCgnZXhwbG9yZVR5cGUnLCBuZXcgRXhwbG9yZVR5cGVDb21wb25lbnQoKSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL2NvbXBvbmVudHMvY29uc3RydWN0LXZpZXcvZXhwbG9yZS10eXBlLWNvbXBvbmVudC9leHBsb3JlLXR5cGUtY29tcG9uZW50LnRzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),

/***/ "./app/components/construct-view/explore-verify-component/explore-verify-component.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__services_sparql_item_service__ = __webpack_require__(\"./app/services/sparql-item-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__services_sparql_autocomplete_service__ = __webpack_require__(\"./app/services/sparql-autocomplete-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__models_rdf__ = __webpack_require__(\"./app/models/rdf.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__actions_verify__ = __webpack_require__(\"./app/actions/verify.ts\");\n/* unused harmony export ExploreVerifyComponentController */\n/* unused harmony export ExploreVerifyComponent */\n\n\n\n\n\n\n\nvar ExploreVerifyComponentController = function () {\n    function ExploreVerifyComponentController(fibraService, $ngRedux, $q, sparqlAutocompleteService) {\n        this.fibraService = fibraService;\n        this.$ngRedux = $ngRedux;\n        this.$q = $q;\n        this.sparqlAutocompleteService = sparqlAutocompleteService;\n        this.limitFilter = '';\n        this.queryString = '';\n        this.relevantTypes = [];\n        this.fibraService = fibraService;\n        this.canceller = $q.defer();\n        this.unsubscribe = $ngRedux.connect(this.mapStateToThis, __WEBPACK_IMPORTED_MODULE_4__actions_verify__)(this);\n    }\n    ExploreVerifyComponentController.prototype.$onDestroy = function () {\n        this.unsubscribe();\n    };\n    ExploreVerifyComponentController.prototype.$onChanges = function (chngsObj) {\n        if (this.node) {\n            this.queryString = this.node.label;\n            this.runQuery();\n        }\n    };\n    ExploreVerifyComponentController.prototype.mapStateToThis = function (state) {\n        return {\n            verify: state.verify\n        };\n    };\n    ExploreVerifyComponentController.prototype.runQuery = function () {\n        var _this = this;\n        this.canceller.resolve();\n        this.updateResults(new __WEBPACK_IMPORTED_MODULE_1__services_sparql_autocomplete_service__[\"b\" /* AutocompletionResults */]());\n        this.queryRunning = true;\n        this.error = false;\n        this.limitFilter = '';\n        this.canceller = this.$q.defer();\n        var nodeTypes = this.node.localProperties.filter(function (p) {\n            return p.value === 'http://www.w3.org/1999/02/22-rdf-syntax-ns#type';\n        })[0];\n        this.relevantTypes = nodeTypes ? nodeTypes.values.map(function (v) {\n            return v.value;\n        }) : [];\n        this.relevantTypes.forEach(function (t) {\n            if (t) _this.limitFilter += '<' + t.value + '>' + ',';\n        });\n        if (this.limitFilter.length !== 0) this.limitFilter = 'FILTER (?groupId IN (' + this.limitFilter.substring(0, this.limitFilter.length - 1) + '))';\n        this.sparqlAutocompleteService.autocomplete(this.queryString, 6, true, this.limitFilter, this.canceller.promise).then(function (results) {\n            console.log(\"Results in verify: \", results);\n            _this.queryRunning = false;\n            _this.updateResults(results);\n        }, function () {\n            console.log(\"Error in verify\");\n            _this.queryRunning = false;\n            _this.error = true;\n        }, function (update) {\n            console.log(\"Update in verify: \", update);\n            if (update.error) _this.error = true;else _this.updateResults(update.results);\n        });\n    };\n    ExploreVerifyComponentController.prototype.updateResults = function (results) {\n        console.log(this.relevantTypes);\n        var typeLabels = this.relevantTypes.map(function (t) {\n            return t.label;\n        });\n        // this.matchingResults = results.remoteResults.filter((r) => typeLabels.indexOf(r.label) !== -1)\n        this.matchingResults = results.remoteResults;\n        console.log(this.matchingResults);\n    };\n    ExploreVerifyComponentController.prototype.sourcesFromResult = function (result) {\n        return ' (Sources: ' + result.datasources.join(', ') + ')';\n    };\n    ExploreVerifyComponentController.prototype.verify = function (result) {\n        var _this = this;\n        var prop = result.ids.map(function (id) {\n            return new __WEBPACK_IMPORTED_MODULE_0__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"d\" /* OWL */].sameAs, id);\n        });\n        this.fibraService.dispatchAction(this.fibraService.itemProperty(this.node, prop)).then(function () {\n            _this.clear();\n        });\n    };\n    ExploreVerifyComponentController.prototype.clear = function () {\n        this.verifyItem(null);\n    };\n    return ExploreVerifyComponentController;\n}();\n\nvar ExploreVerifyComponent = function () {\n    function ExploreVerifyComponent() {\n        this.template = __webpack_require__(\"./app/components/construct-view/explore-verify-component/explore-verify-component.pug\")();\n        this.controller = ExploreVerifyComponentController;\n        this.bindings = {\n            node: '<'\n        };\n    }\n    return ExploreVerifyComponent;\n}();\n\n__WEBPACK_IMPORTED_MODULE_3_angular__[\"module\"]('fibra.components.verify', ['fibra.services']).component('verify', new ExploreVerifyComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9leHBsb3JlLXZlcmlmeS1jb21wb25lbnQvZXhwbG9yZS12ZXJpZnktY29tcG9uZW50LnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL2FwcC9jb21wb25lbnRzL2NvbnN0cnVjdC12aWV3L2V4cGxvcmUtdmVyaWZ5LWNvbXBvbmVudC9leHBsb3JlLXZlcmlmeS1jb21wb25lbnQudHM/YmY0NiJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5pbXBvcnQgeyBQcm9wZXJ0eUFuZFZhbHVlIH0gZnJvbSAnLi4vLi4vLi4vc2VydmljZXMvc3BhcnFsLWl0ZW0tc2VydmljZSc7XG5pbXBvcnQgeyBBdXRvY29tcGxldGlvblJlc3VsdHMgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9zcGFycWwtYXV0b2NvbXBsZXRlLXNlcnZpY2UnO1xuaW1wb3J0IHsgT1dMIH0gZnJvbSAnLi4vLi4vLi4vbW9kZWxzL3JkZic7XG5pbXBvcnQgKiBhcyBhbmd1bGFyIGZyb20gJ2FuZ3VsYXInO1xuaW1wb3J0ICogYXMgVmVyaWZ5QWN0aW9ucyBmcm9tICcuLi8uLi8uLi9hY3Rpb25zL3ZlcmlmeSc7XG52YXIgRXhwbG9yZVZlcmlmeUNvbXBvbmVudENvbnRyb2xsZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEV4cGxvcmVWZXJpZnlDb21wb25lbnRDb250cm9sbGVyKGZpYnJhU2VydmljZSwgJG5nUmVkdXgsICRxLCBzcGFycWxBdXRvY29tcGxldGVTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMuZmlicmFTZXJ2aWNlID0gZmlicmFTZXJ2aWNlO1xuICAgICAgICB0aGlzLiRuZ1JlZHV4ID0gJG5nUmVkdXg7XG4gICAgICAgIHRoaXMuJHEgPSAkcTtcbiAgICAgICAgdGhpcy5zcGFycWxBdXRvY29tcGxldGVTZXJ2aWNlID0gc3BhcnFsQXV0b2NvbXBsZXRlU2VydmljZTtcbiAgICAgICAgdGhpcy5saW1pdEZpbHRlciA9ICcnO1xuICAgICAgICB0aGlzLnF1ZXJ5U3RyaW5nID0gJyc7XG4gICAgICAgIHRoaXMucmVsZXZhbnRUeXBlcyA9IFtdO1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZSA9IGZpYnJhU2VydmljZTtcbiAgICAgICAgdGhpcy5jYW5jZWxsZXIgPSAkcS5kZWZlcigpO1xuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlID0gJG5nUmVkdXguY29ubmVjdCh0aGlzLm1hcFN0YXRlVG9UaGlzLCBWZXJpZnlBY3Rpb25zKSh0aGlzKTtcbiAgICB9XG4gICAgRXhwbG9yZVZlcmlmeUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLiRvbkRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudW5zdWJzY3JpYmUoKTtcbiAgICB9O1xuICAgIEV4cGxvcmVWZXJpZnlDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS4kb25DaGFuZ2VzID0gZnVuY3Rpb24gKGNobmdzT2JqKSB7XG4gICAgICAgIGlmICh0aGlzLm5vZGUpIHtcbiAgICAgICAgICAgIHRoaXMucXVlcnlTdHJpbmcgPSB0aGlzLm5vZGUubGFiZWw7XG4gICAgICAgICAgICB0aGlzLnJ1blF1ZXJ5KCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEV4cGxvcmVWZXJpZnlDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5tYXBTdGF0ZVRvVGhpcyA9IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdmVyaWZ5OiBzdGF0ZS52ZXJpZnlcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIEV4cGxvcmVWZXJpZnlDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5ydW5RdWVyeSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5jYW5jZWxsZXIucmVzb2x2ZSgpO1xuICAgICAgICB0aGlzLnVwZGF0ZVJlc3VsdHMobmV3IEF1dG9jb21wbGV0aW9uUmVzdWx0cygpKTtcbiAgICAgICAgdGhpcy5xdWVyeVJ1bm5pbmcgPSB0cnVlO1xuICAgICAgICB0aGlzLmVycm9yID0gZmFsc2U7XG4gICAgICAgIHRoaXMubGltaXRGaWx0ZXIgPSAnJztcbiAgICAgICAgdGhpcy5jYW5jZWxsZXIgPSB0aGlzLiRxLmRlZmVyKCk7XG4gICAgICAgIHZhciBub2RlVHlwZXMgPSB0aGlzLm5vZGUubG9jYWxQcm9wZXJ0aWVzLmZpbHRlcihmdW5jdGlvbiAocCkgeyByZXR1cm4gcC52YWx1ZSA9PT0gJ2h0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyN0eXBlJzsgfSlbMF07XG4gICAgICAgIHRoaXMucmVsZXZhbnRUeXBlcyA9IG5vZGVUeXBlcyA/IG5vZGVUeXBlcy52YWx1ZXMubWFwKGZ1bmN0aW9uICh2KSB7IHJldHVybiB2LnZhbHVlOyB9KSA6IFtdO1xuICAgICAgICB0aGlzLnJlbGV2YW50VHlwZXMuZm9yRWFjaChmdW5jdGlvbiAodCkgeyBpZiAodClcbiAgICAgICAgICAgIF90aGlzLmxpbWl0RmlsdGVyICs9ICc8JyArIHQudmFsdWUgKyAnPicgKyAnLCc7IH0pO1xuICAgICAgICBpZiAodGhpcy5saW1pdEZpbHRlci5sZW5ndGggIT09IDApXG4gICAgICAgICAgICB0aGlzLmxpbWl0RmlsdGVyID0gJ0ZJTFRFUiAoP2dyb3VwSWQgSU4gKCcgKyB0aGlzLmxpbWl0RmlsdGVyLnN1YnN0cmluZygwLCB0aGlzLmxpbWl0RmlsdGVyLmxlbmd0aCAtIDEpICsgJykpJztcbiAgICAgICAgdGhpcy5zcGFycWxBdXRvY29tcGxldGVTZXJ2aWNlLmF1dG9jb21wbGV0ZSh0aGlzLnF1ZXJ5U3RyaW5nLCA2LCB0cnVlLCB0aGlzLmxpbWl0RmlsdGVyLCB0aGlzLmNhbmNlbGxlci5wcm9taXNlKS50aGVuKGZ1bmN0aW9uIChyZXN1bHRzKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlJlc3VsdHMgaW4gdmVyaWZ5OiBcIiwgcmVzdWx0cyk7XG4gICAgICAgICAgICBfdGhpcy5xdWVyeVJ1bm5pbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIF90aGlzLnVwZGF0ZVJlc3VsdHMocmVzdWx0cyk7XG4gICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3IgaW4gdmVyaWZ5XCIpO1xuICAgICAgICAgICAgX3RoaXMucXVlcnlSdW5uaW5nID0gZmFsc2U7XG4gICAgICAgICAgICBfdGhpcy5lcnJvciA9IHRydWU7XG4gICAgICAgIH0sIGZ1bmN0aW9uICh1cGRhdGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVXBkYXRlIGluIHZlcmlmeTogXCIsIHVwZGF0ZSk7XG4gICAgICAgICAgICBpZiAodXBkYXRlLmVycm9yKVxuICAgICAgICAgICAgICAgIF90aGlzLmVycm9yID0gdHJ1ZTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBfdGhpcy51cGRhdGVSZXN1bHRzKHVwZGF0ZS5yZXN1bHRzKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBFeHBsb3JlVmVyaWZ5Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUudXBkYXRlUmVzdWx0cyA9IGZ1bmN0aW9uIChyZXN1bHRzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMucmVsZXZhbnRUeXBlcyk7XG4gICAgICAgIHZhciB0eXBlTGFiZWxzID0gdGhpcy5yZWxldmFudFR5cGVzLm1hcChmdW5jdGlvbiAodCkgeyByZXR1cm4gdC5sYWJlbDsgfSk7XG4gICAgICAgIC8vIHRoaXMubWF0Y2hpbmdSZXN1bHRzID0gcmVzdWx0cy5yZW1vdGVSZXN1bHRzLmZpbHRlcigocikgPT4gdHlwZUxhYmVscy5pbmRleE9mKHIubGFiZWwpICE9PSAtMSlcbiAgICAgICAgdGhpcy5tYXRjaGluZ1Jlc3VsdHMgPSByZXN1bHRzLnJlbW90ZVJlc3VsdHM7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMubWF0Y2hpbmdSZXN1bHRzKTtcbiAgICB9O1xuICAgIEV4cGxvcmVWZXJpZnlDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5zb3VyY2VzRnJvbVJlc3VsdCA9IGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgcmV0dXJuICcgKFNvdXJjZXM6ICcgKyByZXN1bHQuZGF0YXNvdXJjZXMuam9pbignLCAnKSArICcpJztcbiAgICB9O1xuICAgIEV4cGxvcmVWZXJpZnlDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS52ZXJpZnkgPSBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBwcm9wID0gcmVzdWx0Lmlkcy5tYXAoZnVuY3Rpb24gKGlkKSB7IHJldHVybiBuZXcgUHJvcGVydHlBbmRWYWx1ZShPV0wuc2FtZUFzLCBpZCk7IH0pO1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZS5kaXNwYXRjaEFjdGlvbih0aGlzLmZpYnJhU2VydmljZS5pdGVtUHJvcGVydHkodGhpcy5ub2RlLCBwcm9wKSlcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF90aGlzLmNsZWFyKCk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgRXhwbG9yZVZlcmlmeUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnZlcmlmeUl0ZW0obnVsbCk7XG4gICAgfTtcbiAgICByZXR1cm4gRXhwbG9yZVZlcmlmeUNvbXBvbmVudENvbnRyb2xsZXI7XG59KCkpO1xuZXhwb3J0IHsgRXhwbG9yZVZlcmlmeUNvbXBvbmVudENvbnRyb2xsZXIgfTtcbnZhciBFeHBsb3JlVmVyaWZ5Q29tcG9uZW50ID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBFeHBsb3JlVmVyaWZ5Q29tcG9uZW50KCkge1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gcmVxdWlyZSgnLi9leHBsb3JlLXZlcmlmeS1jb21wb25lbnQucHVnJykoKTtcbiAgICAgICAgdGhpcy5jb250cm9sbGVyID0gRXhwbG9yZVZlcmlmeUNvbXBvbmVudENvbnRyb2xsZXI7XG4gICAgICAgIHRoaXMuYmluZGluZ3MgPSB7XG4gICAgICAgICAgICBub2RlOiAnPCdcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIEV4cGxvcmVWZXJpZnlDb21wb25lbnQ7XG59KCkpO1xuZXhwb3J0IHsgRXhwbG9yZVZlcmlmeUNvbXBvbmVudCB9O1xuYW5ndWxhci5tb2R1bGUoJ2ZpYnJhLmNvbXBvbmVudHMudmVyaWZ5JywgWydmaWJyYS5zZXJ2aWNlcyddKVxuICAgIC5jb21wb25lbnQoJ3ZlcmlmeScsIG5ldyBFeHBsb3JlVmVyaWZ5Q29tcG9uZW50KCkpO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGFwcC9jb21wb25lbnRzL2NvbnN0cnVjdC12aWV3L2V4cGxvcmUtdmVyaWZ5LWNvbXBvbmVudC9leHBsb3JlLXZlcmlmeS1jb21wb25lbnQudHMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),

/***/ "./app/components/construct-view/palette-component/palette-component.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_d3__ = __webpack_require__(\"./app/bower_components/d3/d3.js\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_d3___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_d3__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__models_rdf__ = __webpack_require__(\"./app/models/rdf.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__actions_types__ = __webpack_require__(\"./app/actions/types.ts\");\n/* unused harmony export PaletteComponentController */\n/* unused harmony export PaletteComponent */\n\n\n\n\n\n\nvar PaletteComponentController = function () {\n    function PaletteComponentController(fibraService, $element, sparqlItemService, sparqlTreeService, $q, $ngRedux, FileSaver) {\n        this.fibraService = fibraService;\n        this.$element = $element;\n        this.sparqlItemService = sparqlItemService;\n        this.sparqlTreeService = sparqlTreeService;\n        this.$q = $q;\n        this.$ngRedux = $ngRedux;\n        this.FileSaver = FileSaver;\n        this.paletteSearchHeight = 40;\n        this.typeColorScale = __WEBPACK_IMPORTED_MODULE_0_d3__[\"scaleOrdinal\"](__WEBPACK_IMPORTED_MODULE_0_d3__[\"schemeCategory20c\"]);\n        this.labelFilter = '';\n        this.typeItemTree = __WEBPACK_IMPORTED_MODULE_0_d3__[\"map\"]();\n        this.unsubscribe = $ngRedux.connect(this.mapStateToThis, __WEBPACK_IMPORTED_MODULE_3__actions_types__)(this);\n        this.typeItemTree.set('', {\n            label: 'No type defined',\n            items: [],\n            expanded: false\n        });\n        this.query();\n    }\n    PaletteComponentController.prototype.$onDestroy = function () {\n        this.unsubscribe();\n    };\n    PaletteComponentController.prototype.query = function () {\n        var _this = this;\n        return this.typeItemTreePromise = this.sparqlItemService.getAllItems().then(function (items) {\n            return _this.mergeItems(_this.items, items);\n        });\n    };\n    PaletteComponentController.prototype.$postLink = function () {\n        var _this = this;\n        this.divSel = __WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"](this.$element[0]).select('div.palette');\n        this.nodeDrag = __WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"](this.$element[0]).select('.palette-node-drag');\n        this.nodeDrag.style('display', 'none');\n        this.nodeDrag.append('circle');\n        this.divSel.style('height', '100%').style('width', '100%');\n        this.tooltip = __WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"]('body').append('div').style('position', 'absolute').style('z-index', '20').style('background-color', 'gray').style('color', 'white').style('padding', '3px').style('border-radius', '2px').style('visibility', 'hidden');\n        var onChangeFunction = function () {\n            return _this.query().then(_this.build.bind(_this)).then(function () {\n                return 'Done';\n            });\n        };\n        this.fibraService.on('change', onChangeFunction);\n        this.typeItemTreePromise.then(function (itemTree) {\n            _this.build.bind(_this)(itemTree);\n        });\n    };\n    PaletteComponentController.prototype.addItem = function (item, coordinates) {\n        var _this = this;\n        var itemTypeKey = item.typeValue;\n        var itemType = this.types.types.filter(function (t) {\n            return t.id === itemTypeKey;\n        })[0];\n        var chosenTypes = this.types.displayTypes;\n        if (!chosenTypes[0] && itemType) {\n            this.setOrderedTypes([itemType]);\n        } else if (!chosenTypes[1] && itemType && chosenTypes[0] !== itemType) {\n            var newTypes = chosenTypes.concat([]);\n            newTypes.push(itemType);\n            this.setOrderedTypes(newTypes);\n        }\n        return this.fibraService.dispatchAction(this.fibraService.displayItem(item, coordinates)).then(function (state) {\n            _this.fibraService.dispatch('change');\n            return state;\n        });\n    };\n    PaletteComponentController.prototype.createItem = function (label) {\n        var _this = this;\n        var node = __WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"b\" /* DataFactory */].instance.namedNode(label);\n        this.fibraService.dispatchAction(this.fibraService.createItem(node)).then(function () {\n            _this.query().then(function (items) {\n                _this.build.bind(_this)(items);\n            });\n        });\n    };\n    PaletteComponentController.prototype.downloadCSV = function (datum) {\n        var blob = new Blob([__WEBPACK_IMPORTED_MODULE_0_d3__[\"csvFormat\"](datum.value.items.map(function (d) {\n            var sameAs = d.localProperties.filter(function (p) {\n                return p.value === __WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"d\" /* OWL */].sameAs.value;\n            })[0];\n            var prefLabel = d.localProperties.filter(function (p) {\n                return p.value === __WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"a\" /* SKOS */].prefLabel.value;\n            })[0];\n            return _a = {}, _a[__WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"a\" /* SKOS */].prefLabel.value] = prefLabel ? prefLabel.values[0].value.value : '', _a.FibraId = d.value, _a.Match = sameAs ? sameAs.values[0].value.value : '', _a;\n            var _a;\n        }), [__WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"a\" /* SKOS */].prefLabel.value, 'FibraId', 'Match'])], { type: 'application/csv;charset=utf-8' });\n        var filename = datum.value.label + '.csv';\n        this.FileSaver.saveAs(blob, filename);\n    };\n    PaletteComponentController.prototype.build = function (itemTree) {\n        var _this = this;\n        this.updateSizing();\n        console.log(itemTree.entries());\n        var itemTreeFiltered = itemTree.entries().filter(function (d) {\n            return d.key !== '';\n        });\n        var items = itemTreeFiltered.reduce(function (a, b) {\n            return a.concat(b.value.items);\n        }, []);\n        var padding = items.length > 300 ? items.length > 2000 ? 1 : 2 : 4;\n        var paletteHeightLessTypes = this.paletteHeight - itemTreeFiltered.length * 25;\n        var rawRadius = (Math.sqrt(this.paletteWidth * paletteHeightLessTypes / items.length) - padding) / 2;\n        var radius = rawRadius > 8 ? 8 : rawRadius;\n        var xOffset = radius * 2 + padding / 2;\n        var yOffset = radius * 2 + padding / 2;\n        var xDots = Math.floor(this.paletteWidth / xOffset) - 1;\n        // Bring the node drag SVG and the addItem function local\n        var nodeDrag = this.nodeDrag;\n        var addItem = this.addItem.bind(this);\n        var paletteWidth = this.paletteWidth;\n        this.typesD3 = this.divSel.selectAll('div.type').data(itemTreeFiltered, function (d) {\n            return d.key;\n        });\n        this.typesD3.exit().remove();\n        var typesDivsEnter = this.typesD3.enter().append('div').classed('type', true).classed('inverse-icon', true).text(function (d) {\n            return d.value.label;\n        });\n        typesDivsEnter.append('span').classed('glyphicon', true).classed('glyphicon-download', true).on('click', function (d) {\n            return _this.downloadCSV(d);\n        });\n        typesDivsEnter.append('span').classed('glyphicon', true).classed('expand-button', true).on('click', function (d) {\n            d.value.expanded = !d.value.expanded;\n            _this.typeItemTreePromise.then(_this.build.bind(_this));\n        });\n        typesDivsEnter.append('svg').attr('width', '100%');\n        this.typesD3 = typesDivsEnter.merge(this.typesD3);\n        this.typesD3.selectAll('.expand-button').classed('glyphicon-resize-small', function (d) {\n            return d.value.expanded;\n        }).classed('glyphicon-resize-full', function (d) {\n            return !d.value.expanded;\n        });\n        this.typesD3.selectAll('svg').style('display', function (d) {\n            return d.value.expanded ? 'block' : 'none';\n        });\n        var typeSvgs = this.typesD3.select('svg').attr('height', function (d) {\n            return (Math.ceil(d.value.items.length / xDots) + 1) * yOffset;\n        });\n        this.circles = typeSvgs.selectAll('circle.item').data(function (d) {\n            return d.value.items;\n        }, function (d) {\n            return d.value;\n        });\n        this.circles.exit().remove();\n        this.circles = this.circles.enter().append('circle').classed('item', true).attr('r', radius).on('mouseover', function (d, i) {\n            _this.tooltip.style('top', __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].pageY - 10 + 'px').style('left', __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].pageX + 10 + 'px').style('visibility', 'visible').text(d.label + ' (' + d.typeLabel + ')');\n        }).on('mouseout', function (d, i) {\n            _this.tooltip.style('visibility', 'hidden');\n        }).call(__WEBPACK_IMPORTED_MODULE_0_d3__[\"drag\"]().on('start', function (d) {\n            var thisCircle = __WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"](this);\n            nodeDrag.style('display', 'block');\n            nodeDrag.select('circle').classed('item', thisCircle.classed('item')).attr('r', thisCircle.attr('r')).attr('fill', thisCircle.attr('fill')).attr('transform', 'translate(8,8)');\n            nodeDrag.style('left', __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientX - 8).style('top', __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientY - 8);\n        }).on('drag', function (d) {\n            nodeDrag.style('left', __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientX - 8).style('top', __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientY - 8);\n        }).on('end', function (d) {\n            // If the cursor is on the canvas, display\n            var exploreContainer = __WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"]('#explorecontainer').node();\n            if (__WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientX > exploreContainer.getBoundingClientRect().left && __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientX < exploreContainer.getBoundingClientRect().right && __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientY > exploreContainer.getBoundingClientRect().top && __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientY < exploreContainer.getBoundingClientRect().bottom) {\n                addItem(__WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"](this).datum(), [__WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientX - exploreContainer.getBoundingClientRect().left, __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientY - exploreContainer.getBoundingClientRect().top]).then(function () {\n                    nodeDrag.style('display', 'none');\n                });\n            } else {\n                nodeDrag.style('display', 'none');\n            }\n        })).merge(this.circles).call(this.update.bind(this));\n        this.circles.transition().attr('fill', function (d) {\n            return _this.typeColorScale(d.typeValue);\n        }).attr('transform', function (d, i) {\n            return 'translate(' + (i % xDots + 1) * xOffset + ',' + (Math.floor(i / xDots) + 1) * yOffset + ')';\n        });\n    };\n    PaletteComponentController.prototype.update = function (circles) {\n        var _this = this;\n        var c = circles ? circles : this.circles;\n        c.classed('displayed', function (d) {\n            return _this.fibraService.getState().construct.itemIndex[d.value] ? true : false;\n        }).classed('filtered', function (d) {\n            return _this.labelFilter && !(d.label.toUpperCase().indexOf(_this.labelFilter.toUpperCase()) !== -1);\n        });\n    };\n    PaletteComponentController.prototype.mapStateToThis = function (state) {\n        return {\n            types: state.types\n        };\n    };\n    PaletteComponentController.prototype.updateSizing = function () {\n        this.paletteWidth = Math.round(window.innerWidth * 0.15); // this.svgSel.node().clientWidth\n        this.paletteHeight = Math.round(window.innerHeight) - this.paletteSearchHeight;\n        this.divSel.style('height', this.paletteHeight + 'px');\n    };\n    PaletteComponentController.prototype.mergeItems = function (oldItems, newItems) {\n        var _this = this;\n        // Wipe old items (bad, but temporary)\n        this.typeItemTree.values().forEach(function (v) {\n            v.items = [];\n        });\n        newItems.forEach(function (item) {\n            var typeProp = item.localProperties.filter(function (p) {\n                return p.value === __WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"c\" /* RDF */].type.value;\n            })[0];\n            if (typeProp && typeProp.values[0]) {\n                item.typeValue = typeProp.values[0].value.value;\n                item.typeLabel = typeProp.values[0].value.label;\n                // Add type to the type map\n                if (!_this.typeItemTree.has(item.typeValue)) {\n                    _this.typeItemTree.set(item.typeValue, {\n                        label: item.typeLabel,\n                        items: [item],\n                        expanded: true\n                    });\n                } else {\n                    _this.typeItemTree.get(item.typeValue).items.push(item);\n                }\n            } else {\n                item.typeValue = '';\n                item.typeLabel = 'No type defined';\n            }\n        });\n        // Sort by label\n        this.typeItemTree.values().forEach(function (v) {\n            v.items.sort(function (a, b) {\n                return a.label === b.label ? 0 : a.label > b.label ? 1 : -1;\n            });\n        });\n        return this.typeItemTree;\n    };\n    return PaletteComponentController;\n}();\n\nvar PaletteComponent = function () {\n    function PaletteComponent() {\n        this.template = __webpack_require__(\"./app/components/construct-view/palette-component/palette-component.pug\")();\n        this.controller = PaletteComponentController;\n    }\n    return PaletteComponent;\n}();\n\n__WEBPACK_IMPORTED_MODULE_2_angular__[\"module\"]('fibra.components.palette', ['fibra.services']).component('palette', new PaletteComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9wYWxldHRlLWNvbXBvbmVudC9wYWxldHRlLWNvbXBvbmVudC50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9wYWxldHRlLWNvbXBvbmVudC9wYWxldHRlLWNvbXBvbmVudC50cz83M2FiIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmltcG9ydCAqIGFzIGQzIGZyb20gJ2QzJztcbmltcG9ydCB7IERhdGFGYWN0b3J5LCBTS09TLCBPV0wsIFJERiB9IGZyb20gJy4uLy4uLy4uL21vZGVscy9yZGYnO1xuaW1wb3J0ICogYXMgYW5ndWxhciBmcm9tICdhbmd1bGFyJztcbmltcG9ydCAqIGFzIFR5cGVBY3Rpb25zIGZyb20gJy4uLy4uLy4uL2FjdGlvbnMvdHlwZXMnO1xudmFyIFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBQYWxldHRlQ29tcG9uZW50Q29udHJvbGxlcihmaWJyYVNlcnZpY2UsICRlbGVtZW50LCBzcGFycWxJdGVtU2VydmljZSwgc3BhcnFsVHJlZVNlcnZpY2UsICRxLCAkbmdSZWR1eCwgRmlsZVNhdmVyKSB7XG4gICAgICAgIHRoaXMuZmlicmFTZXJ2aWNlID0gZmlicmFTZXJ2aWNlO1xuICAgICAgICB0aGlzLiRlbGVtZW50ID0gJGVsZW1lbnQ7XG4gICAgICAgIHRoaXMuc3BhcnFsSXRlbVNlcnZpY2UgPSBzcGFycWxJdGVtU2VydmljZTtcbiAgICAgICAgdGhpcy5zcGFycWxUcmVlU2VydmljZSA9IHNwYXJxbFRyZWVTZXJ2aWNlO1xuICAgICAgICB0aGlzLiRxID0gJHE7XG4gICAgICAgIHRoaXMuJG5nUmVkdXggPSAkbmdSZWR1eDtcbiAgICAgICAgdGhpcy5GaWxlU2F2ZXIgPSBGaWxlU2F2ZXI7XG4gICAgICAgIHRoaXMucGFsZXR0ZVNlYXJjaEhlaWdodCA9IDQwO1xuICAgICAgICB0aGlzLnR5cGVDb2xvclNjYWxlID0gZDMuc2NhbGVPcmRpbmFsKGQzLnNjaGVtZUNhdGVnb3J5MjBjKTtcbiAgICAgICAgdGhpcy5sYWJlbEZpbHRlciA9ICcnO1xuICAgICAgICB0aGlzLnR5cGVJdGVtVHJlZSA9IGQzLm1hcCgpO1xuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlID0gJG5nUmVkdXguY29ubmVjdCh0aGlzLm1hcFN0YXRlVG9UaGlzLCBUeXBlQWN0aW9ucykodGhpcyk7XG4gICAgICAgIHRoaXMudHlwZUl0ZW1UcmVlLnNldCgnJywge1xuICAgICAgICAgICAgbGFiZWw6ICdObyB0eXBlIGRlZmluZWQnLFxuICAgICAgICAgICAgaXRlbXM6IFtdLFxuICAgICAgICAgICAgZXhwYW5kZWQ6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnF1ZXJ5KCk7XG4gICAgfVxuICAgIFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS4kb25EZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlKCk7XG4gICAgfTtcbiAgICBQYWxldHRlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUucXVlcnkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHJldHVybiB0aGlzLnR5cGVJdGVtVHJlZVByb21pc2UgPSB0aGlzLnNwYXJxbEl0ZW1TZXJ2aWNlLmdldEFsbEl0ZW1zKCkudGhlbihmdW5jdGlvbiAoaXRlbXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5tZXJnZUl0ZW1zKF90aGlzLml0ZW1zLCBpdGVtcyk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgUGFsZXR0ZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLiRwb3N0TGluayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5kaXZTZWwgPSBkMy5zZWxlY3QodGhpcy4kZWxlbWVudFswXSkuc2VsZWN0KCdkaXYucGFsZXR0ZScpO1xuICAgICAgICB0aGlzLm5vZGVEcmFnID0gZDMuc2VsZWN0KHRoaXMuJGVsZW1lbnRbMF0pLnNlbGVjdCgnLnBhbGV0dGUtbm9kZS1kcmFnJyk7XG4gICAgICAgIHRoaXMubm9kZURyYWcuc3R5bGUoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgICB0aGlzLm5vZGVEcmFnLmFwcGVuZCgnY2lyY2xlJyk7XG4gICAgICAgIHRoaXMuZGl2U2VsXG4gICAgICAgICAgICAuc3R5bGUoJ2hlaWdodCcsICcxMDAlJylcbiAgICAgICAgICAgIC5zdHlsZSgnd2lkdGgnLCAnMTAwJScpO1xuICAgICAgICB0aGlzLnRvb2x0aXAgPSBkMy5zZWxlY3QoJ2JvZHknKS5hcHBlbmQoJ2RpdicpXG4gICAgICAgICAgICAuc3R5bGUoJ3Bvc2l0aW9uJywgJ2Fic29sdXRlJylcbiAgICAgICAgICAgIC5zdHlsZSgnei1pbmRleCcsICcyMCcpXG4gICAgICAgICAgICAuc3R5bGUoJ2JhY2tncm91bmQtY29sb3InLCAnZ3JheScpXG4gICAgICAgICAgICAuc3R5bGUoJ2NvbG9yJywgJ3doaXRlJylcbiAgICAgICAgICAgIC5zdHlsZSgncGFkZGluZycsICczcHgnKVxuICAgICAgICAgICAgLnN0eWxlKCdib3JkZXItcmFkaXVzJywgJzJweCcpXG4gICAgICAgICAgICAuc3R5bGUoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgICAgIHZhciBvbkNoYW5nZUZ1bmN0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzLnF1ZXJ5KCkudGhlbihfdGhpcy5idWlsZC5iaW5kKF90aGlzKSkudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiAnRG9uZSc7IH0pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZS5vbignY2hhbmdlJywgb25DaGFuZ2VGdW5jdGlvbik7XG4gICAgICAgIHRoaXMudHlwZUl0ZW1UcmVlUHJvbWlzZS50aGVuKGZ1bmN0aW9uIChpdGVtVHJlZSkge1xuICAgICAgICAgICAgX3RoaXMuYnVpbGQuYmluZChfdGhpcykoaXRlbVRyZWUpO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5hZGRJdGVtID0gZnVuY3Rpb24gKGl0ZW0sIGNvb3JkaW5hdGVzKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBpdGVtVHlwZUtleSA9IGl0ZW0udHlwZVZhbHVlO1xuICAgICAgICB2YXIgaXRlbVR5cGUgPSB0aGlzLnR5cGVzLnR5cGVzLmZpbHRlcihmdW5jdGlvbiAodCkgeyByZXR1cm4gdC5pZCA9PT0gaXRlbVR5cGVLZXk7IH0pWzBdO1xuICAgICAgICB2YXIgY2hvc2VuVHlwZXMgPSB0aGlzLnR5cGVzLmRpc3BsYXlUeXBlcztcbiAgICAgICAgaWYgKCFjaG9zZW5UeXBlc1swXSAmJiBpdGVtVHlwZSkge1xuICAgICAgICAgICAgdGhpcy5zZXRPcmRlcmVkVHlwZXMoW2l0ZW1UeXBlXSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIWNob3NlblR5cGVzWzFdICYmIGl0ZW1UeXBlICYmIChjaG9zZW5UeXBlc1swXSAhPT0gaXRlbVR5cGUpKSB7XG4gICAgICAgICAgICB2YXIgbmV3VHlwZXMgPSBjaG9zZW5UeXBlcy5jb25jYXQoW10pO1xuICAgICAgICAgICAgbmV3VHlwZXMucHVzaChpdGVtVHlwZSk7XG4gICAgICAgICAgICB0aGlzLnNldE9yZGVyZWRUeXBlcyhuZXdUeXBlcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuZmlicmFTZXJ2aWNlLmRpc3BhdGNoQWN0aW9uKHRoaXMuZmlicmFTZXJ2aWNlLmRpc3BsYXlJdGVtKGl0ZW0sIGNvb3JkaW5hdGVzKSkudGhlbihmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgICAgIF90aGlzLmZpYnJhU2VydmljZS5kaXNwYXRjaCgnY2hhbmdlJyk7XG4gICAgICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgUGFsZXR0ZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmNyZWF0ZUl0ZW0gPSBmdW5jdGlvbiAobGFiZWwpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIG5vZGUgPSBEYXRhRmFjdG9yeS5pbnN0YW5jZS5uYW1lZE5vZGUobGFiZWwpO1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZS5kaXNwYXRjaEFjdGlvbih0aGlzLmZpYnJhU2VydmljZS5jcmVhdGVJdGVtKG5vZGUpKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF90aGlzLnF1ZXJ5KCkudGhlbihmdW5jdGlvbiAoaXRlbXMpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5idWlsZC5iaW5kKF90aGlzKShpdGVtcyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBQYWxldHRlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuZG93bmxvYWRDU1YgPSBmdW5jdGlvbiAoZGF0dW0pIHtcbiAgICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbZDMuY3N2Rm9ybWF0KGRhdHVtLnZhbHVlLml0ZW1zLm1hcChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgIHZhciBzYW1lQXMgPSBkLmxvY2FsUHJvcGVydGllcy5maWx0ZXIoZnVuY3Rpb24gKHApIHsgcmV0dXJuIHAudmFsdWUgPT09IE9XTC5zYW1lQXMudmFsdWU7IH0pWzBdO1xuICAgICAgICAgICAgICAgIHZhciBwcmVmTGFiZWwgPSBkLmxvY2FsUHJvcGVydGllcy5maWx0ZXIoZnVuY3Rpb24gKHApIHsgcmV0dXJuIHAudmFsdWUgPT09IFNLT1MucHJlZkxhYmVsLnZhbHVlOyB9KVswXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gX2EgPSB7fSxcbiAgICAgICAgICAgICAgICAgICAgX2FbU0tPUy5wcmVmTGFiZWwudmFsdWVdID0gcHJlZkxhYmVsID8gcHJlZkxhYmVsLnZhbHVlc1swXS52YWx1ZS52YWx1ZSA6ICcnLFxuICAgICAgICAgICAgICAgICAgICBfYS5GaWJyYUlkID0gZC52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgX2EuTWF0Y2ggPSBzYW1lQXMgPyBzYW1lQXMudmFsdWVzWzBdLnZhbHVlLnZhbHVlIDogJycsXG4gICAgICAgICAgICAgICAgICAgIF9hO1xuICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIH0pLCBbU0tPUy5wcmVmTGFiZWwudmFsdWUsICdGaWJyYUlkJywgJ01hdGNoJ10pXSwgeyB0eXBlOiAnYXBwbGljYXRpb24vY3N2O2NoYXJzZXQ9dXRmLTgnIH0pO1xuICAgICAgICB2YXIgZmlsZW5hbWUgPSBkYXR1bS52YWx1ZS5sYWJlbCArICcuY3N2JztcbiAgICAgICAgdGhpcy5GaWxlU2F2ZXIuc2F2ZUFzKGJsb2IsIGZpbGVuYW1lKTtcbiAgICB9O1xuICAgIFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5idWlsZCA9IGZ1bmN0aW9uIChpdGVtVHJlZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLnVwZGF0ZVNpemluZygpO1xuICAgICAgICBjb25zb2xlLmxvZyhpdGVtVHJlZS5lbnRyaWVzKCkpO1xuICAgICAgICB2YXIgaXRlbVRyZWVGaWx0ZXJlZCA9IGl0ZW1UcmVlLmVudHJpZXMoKS5maWx0ZXIoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQua2V5ICE9PSAnJzsgfSk7XG4gICAgICAgIHZhciBpdGVtcyA9IGl0ZW1UcmVlRmlsdGVyZWQucmVkdWNlKGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICByZXR1cm4gYS5jb25jYXQoYi52YWx1ZS5pdGVtcyk7XG4gICAgICAgIH0sIFtdKTtcbiAgICAgICAgdmFyIHBhZGRpbmcgPSBpdGVtcy5sZW5ndGggPiAzMDAgPyBpdGVtcy5sZW5ndGggPiAyMDAwID8gMSA6IDIgOiA0O1xuICAgICAgICB2YXIgcGFsZXR0ZUhlaWdodExlc3NUeXBlcyA9IHRoaXMucGFsZXR0ZUhlaWdodCAtIChpdGVtVHJlZUZpbHRlcmVkLmxlbmd0aCAqIDI1KTtcbiAgICAgICAgdmFyIHJhd1JhZGl1cyA9IChNYXRoLnNxcnQodGhpcy5wYWxldHRlV2lkdGggKiBwYWxldHRlSGVpZ2h0TGVzc1R5cGVzIC8gaXRlbXMubGVuZ3RoKSAtIHBhZGRpbmcpIC8gMjtcbiAgICAgICAgdmFyIHJhZGl1cyA9IHJhd1JhZGl1cyA+IDggPyA4IDogcmF3UmFkaXVzO1xuICAgICAgICB2YXIgeE9mZnNldCA9IHJhZGl1cyAqIDIgKyBwYWRkaW5nIC8gMjtcbiAgICAgICAgdmFyIHlPZmZzZXQgPSByYWRpdXMgKiAyICsgcGFkZGluZyAvIDI7XG4gICAgICAgIHZhciB4RG90cyA9IE1hdGguZmxvb3IoKHRoaXMucGFsZXR0ZVdpZHRoKSAvIHhPZmZzZXQpIC0gMTtcbiAgICAgICAgLy8gQnJpbmcgdGhlIG5vZGUgZHJhZyBTVkcgYW5kIHRoZSBhZGRJdGVtIGZ1bmN0aW9uIGxvY2FsXG4gICAgICAgIHZhciBub2RlRHJhZyA9IHRoaXMubm9kZURyYWc7XG4gICAgICAgIHZhciBhZGRJdGVtID0gdGhpcy5hZGRJdGVtLmJpbmQodGhpcyk7XG4gICAgICAgIHZhciBwYWxldHRlV2lkdGggPSB0aGlzLnBhbGV0dGVXaWR0aDtcbiAgICAgICAgdGhpcy50eXBlc0QzID0gdGhpcy5kaXZTZWxcbiAgICAgICAgICAgIC5zZWxlY3RBbGwoJ2Rpdi50eXBlJylcbiAgICAgICAgICAgIC5kYXRhKGl0ZW1UcmVlRmlsdGVyZWQsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmtleTsgfSk7XG4gICAgICAgIHRoaXMudHlwZXNEMy5leGl0KCkucmVtb3ZlKCk7XG4gICAgICAgIHZhciB0eXBlc0RpdnNFbnRlciA9IHRoaXMudHlwZXNEMy5lbnRlcigpXG4gICAgICAgICAgICAuYXBwZW5kKCdkaXYnKVxuICAgICAgICAgICAgLmNsYXNzZWQoJ3R5cGUnLCB0cnVlKVxuICAgICAgICAgICAgLmNsYXNzZWQoJ2ludmVyc2UtaWNvbicsIHRydWUpXG4gICAgICAgICAgICAudGV4dChmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC52YWx1ZS5sYWJlbDsgfSk7XG4gICAgICAgIHR5cGVzRGl2c0VudGVyXG4gICAgICAgICAgICAuYXBwZW5kKCdzcGFuJylcbiAgICAgICAgICAgIC5jbGFzc2VkKCdnbHlwaGljb24nLCB0cnVlKVxuICAgICAgICAgICAgLmNsYXNzZWQoJ2dseXBoaWNvbi1kb3dubG9hZCcsIHRydWUpXG4gICAgICAgICAgICAub24oJ2NsaWNrJywgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIF90aGlzLmRvd25sb2FkQ1NWKGQpOyB9KTtcbiAgICAgICAgdHlwZXNEaXZzRW50ZXJcbiAgICAgICAgICAgIC5hcHBlbmQoJ3NwYW4nKVxuICAgICAgICAgICAgLmNsYXNzZWQoJ2dseXBoaWNvbicsIHRydWUpXG4gICAgICAgICAgICAuY2xhc3NlZCgnZXhwYW5kLWJ1dHRvbicsIHRydWUpXG4gICAgICAgICAgICAub24oJ2NsaWNrJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIGQudmFsdWUuZXhwYW5kZWQgPSAhZC52YWx1ZS5leHBhbmRlZDtcbiAgICAgICAgICAgIF90aGlzLnR5cGVJdGVtVHJlZVByb21pc2UudGhlbihfdGhpcy5idWlsZC5iaW5kKF90aGlzKSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0eXBlc0RpdnNFbnRlclxuICAgICAgICAgICAgLmFwcGVuZCgnc3ZnJylcbiAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsICcxMDAlJyk7XG4gICAgICAgIHRoaXMudHlwZXNEMyA9IHR5cGVzRGl2c0VudGVyXG4gICAgICAgICAgICAubWVyZ2UodGhpcy50eXBlc0QzKTtcbiAgICAgICAgdGhpcy50eXBlc0QzLnNlbGVjdEFsbCgnLmV4cGFuZC1idXR0b24nKVxuICAgICAgICAgICAgLmNsYXNzZWQoJ2dseXBoaWNvbi1yZXNpemUtc21hbGwnLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC52YWx1ZS5leHBhbmRlZDsgfSlcbiAgICAgICAgICAgIC5jbGFzc2VkKCdnbHlwaGljb24tcmVzaXplLWZ1bGwnLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gIWQudmFsdWUuZXhwYW5kZWQ7IH0pO1xuICAgICAgICB0aGlzLnR5cGVzRDMuc2VsZWN0QWxsKCdzdmcnKVxuICAgICAgICAgICAgLnN0eWxlKCdkaXNwbGF5JywgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudmFsdWUuZXhwYW5kZWQgPyAnYmxvY2snIDogJ25vbmUnOyB9KTtcbiAgICAgICAgdmFyIHR5cGVTdmdzID0gdGhpcy50eXBlc0QzLnNlbGVjdCgnc3ZnJylcbiAgICAgICAgICAgIC5hdHRyKCdoZWlnaHQnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuIChNYXRoLmNlaWwoZC52YWx1ZS5pdGVtcy5sZW5ndGggLyB4RG90cykgKyAxKSAqIHlPZmZzZXQ7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmNpcmNsZXMgPSB0eXBlU3Znc1xuICAgICAgICAgICAgLnNlbGVjdEFsbCgnY2lyY2xlLml0ZW0nKVxuICAgICAgICAgICAgLmRhdGEoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudmFsdWUuaXRlbXM7IH0sIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnZhbHVlOyB9KTtcbiAgICAgICAgdGhpcy5jaXJjbGVzLmV4aXQoKS5yZW1vdmUoKTtcbiAgICAgICAgdGhpcy5jaXJjbGVzID0gdGhpcy5jaXJjbGVzLmVudGVyKClcbiAgICAgICAgICAgIC5hcHBlbmQoJ2NpcmNsZScpXG4gICAgICAgICAgICAuY2xhc3NlZCgnaXRlbScsIHRydWUpXG4gICAgICAgICAgICAuYXR0cigncicsIHJhZGl1cylcbiAgICAgICAgICAgIC5vbignbW91c2VvdmVyJywgZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgICAgIF90aGlzLnRvb2x0aXAuc3R5bGUoJ3RvcCcsIChkMy5ldmVudC5wYWdlWSAtIDEwKSArICdweCcpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdsZWZ0JywgKGQzLmV2ZW50LnBhZ2VYICsgMTApICsgJ3B4JylcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpXG4gICAgICAgICAgICAgICAgLnRleHQoZC5sYWJlbCArICcgKCcgKyBkLnR5cGVMYWJlbCArICcpJyk7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAub24oJ21vdXNlb3V0JywgZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgICAgIF90aGlzLnRvb2x0aXAuc3R5bGUoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAuY2FsbChkMy5kcmFnKClcbiAgICAgICAgICAgIC5vbignc3RhcnQnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgdmFyIHRoaXNDaXJjbGUgPSBkMy5zZWxlY3QodGhpcyk7XG4gICAgICAgICAgICBub2RlRHJhZ1xuICAgICAgICAgICAgICAgIC5zdHlsZSgnZGlzcGxheScsICdibG9jaycpO1xuICAgICAgICAgICAgbm9kZURyYWcuc2VsZWN0KCdjaXJjbGUnKVxuICAgICAgICAgICAgICAgIC5jbGFzc2VkKCdpdGVtJywgdGhpc0NpcmNsZS5jbGFzc2VkKCdpdGVtJykpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3InLCB0aGlzQ2lyY2xlLmF0dHIoJ3InKSlcbiAgICAgICAgICAgICAgICAuYXR0cignZmlsbCcsIHRoaXNDaXJjbGUuYXR0cignZmlsbCcpKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDgsOCknKTtcbiAgICAgICAgICAgIG5vZGVEcmFnXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdsZWZ0JywgZDMuZXZlbnQuc291cmNlRXZlbnQuY2xpZW50WCAtIDgpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCd0b3AnLCBkMy5ldmVudC5zb3VyY2VFdmVudC5jbGllbnRZIC0gOCk7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAub24oJ2RyYWcnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgbm9kZURyYWdcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2xlZnQnLCBkMy5ldmVudC5zb3VyY2VFdmVudC5jbGllbnRYIC0gOClcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ3RvcCcsIGQzLmV2ZW50LnNvdXJjZUV2ZW50LmNsaWVudFkgLSA4KTtcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC5vbignZW5kJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIC8vIElmIHRoZSBjdXJzb3IgaXMgb24gdGhlIGNhbnZhcywgZGlzcGxheVxuICAgICAgICAgICAgdmFyIGV4cGxvcmVDb250YWluZXIgPSBkMy5zZWxlY3QoJyNleHBsb3JlY29udGFpbmVyJykubm9kZSgpO1xuICAgICAgICAgICAgaWYgKGQzLmV2ZW50LnNvdXJjZUV2ZW50LmNsaWVudFggPiBleHBsb3JlQ29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQgJiZcbiAgICAgICAgICAgICAgICBkMy5ldmVudC5zb3VyY2VFdmVudC5jbGllbnRYIDwgZXhwbG9yZUNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5yaWdodCAmJlxuICAgICAgICAgICAgICAgIGQzLmV2ZW50LnNvdXJjZUV2ZW50LmNsaWVudFkgPiBleHBsb3JlQ29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCAmJlxuICAgICAgICAgICAgICAgIGQzLmV2ZW50LnNvdXJjZUV2ZW50LmNsaWVudFkgPCBleHBsb3JlQ29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmJvdHRvbSkge1xuICAgICAgICAgICAgICAgIGFkZEl0ZW0oZDMuc2VsZWN0KHRoaXMpLmRhdHVtKCksIFtcbiAgICAgICAgICAgICAgICAgICAgZDMuZXZlbnQuc291cmNlRXZlbnQuY2xpZW50WCAtIGV4cGxvcmVDb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCxcbiAgICAgICAgICAgICAgICAgICAgZDMuZXZlbnQuc291cmNlRXZlbnQuY2xpZW50WSAtIGV4cGxvcmVDb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wXG4gICAgICAgICAgICAgICAgXSkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGVEcmFnLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG5vZGVEcmFnLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpXG4gICAgICAgICAgICAubWVyZ2UodGhpcy5jaXJjbGVzKVxuICAgICAgICAgICAgLmNhbGwodGhpcy51cGRhdGUuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMuY2lyY2xlc1xuICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgLmF0dHIoJ2ZpbGwnLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gX3RoaXMudHlwZUNvbG9yU2NhbGUoZC50eXBlVmFsdWUpOyB9KVxuICAgICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uIChkLCBpKSB7IHJldHVybiAndHJhbnNsYXRlKCcgKyAoKGkgJSB4RG90cykgKyAxKSAqIHhPZmZzZXQgKyAnLCcgKyAoTWF0aC5mbG9vcihpIC8geERvdHMpICsgMSkgKiB5T2Zmc2V0ICsgJyknOyB9KTtcbiAgICB9O1xuICAgIFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoY2lyY2xlcykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgYyA9IGNpcmNsZXMgPyBjaXJjbGVzIDogdGhpcy5jaXJjbGVzO1xuICAgICAgICBjLmNsYXNzZWQoJ2Rpc3BsYXllZCcsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBfdGhpcy5maWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5jb25zdHJ1Y3QuaXRlbUluZGV4W2QudmFsdWVdID8gdHJ1ZSA6IGZhbHNlOyB9KVxuICAgICAgICAgICAgLmNsYXNzZWQoJ2ZpbHRlcmVkJywgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIF90aGlzLmxhYmVsRmlsdGVyICYmICEoZC5sYWJlbC50b1VwcGVyQ2FzZSgpLmluZGV4T2YoX3RoaXMubGFiZWxGaWx0ZXIudG9VcHBlckNhc2UoKSkgIT09IC0xKTsgfSk7XG4gICAgfTtcbiAgICBQYWxldHRlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUubWFwU3RhdGVUb1RoaXMgPSBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGVzOiBzdGF0ZS50eXBlc1xuICAgICAgICB9O1xuICAgIH07XG4gICAgUGFsZXR0ZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLnVwZGF0ZVNpemluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5wYWxldHRlV2lkdGggPSBNYXRoLnJvdW5kKHdpbmRvdy5pbm5lcldpZHRoICogMC4xNSk7IC8vIHRoaXMuc3ZnU2VsLm5vZGUoKS5jbGllbnRXaWR0aFxuICAgICAgICB0aGlzLnBhbGV0dGVIZWlnaHQgPSBNYXRoLnJvdW5kKHdpbmRvdy5pbm5lckhlaWdodCkgLSB0aGlzLnBhbGV0dGVTZWFyY2hIZWlnaHQ7XG4gICAgICAgIHRoaXMuZGl2U2VsLnN0eWxlKCdoZWlnaHQnLCB0aGlzLnBhbGV0dGVIZWlnaHQgKyAncHgnKTtcbiAgICB9O1xuICAgIFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5tZXJnZUl0ZW1zID0gZnVuY3Rpb24gKG9sZEl0ZW1zLCBuZXdJdGVtcykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAvLyBXaXBlIG9sZCBpdGVtcyAoYmFkLCBidXQgdGVtcG9yYXJ5KVxuICAgICAgICB0aGlzLnR5cGVJdGVtVHJlZS52YWx1ZXMoKS5mb3JFYWNoKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICB2Lml0ZW1zID0gW107XG4gICAgICAgIH0pO1xuICAgICAgICBuZXdJdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICB2YXIgdHlwZVByb3AgPSBpdGVtLmxvY2FsUHJvcGVydGllcy5maWx0ZXIoZnVuY3Rpb24gKHApIHsgcmV0dXJuIHAudmFsdWUgPT09IFJERi50eXBlLnZhbHVlOyB9KVswXTtcbiAgICAgICAgICAgIGlmICh0eXBlUHJvcCAmJiB0eXBlUHJvcC52YWx1ZXNbMF0pIHtcbiAgICAgICAgICAgICAgICBpdGVtLnR5cGVWYWx1ZSA9IHR5cGVQcm9wLnZhbHVlc1swXS52YWx1ZS52YWx1ZTtcbiAgICAgICAgICAgICAgICBpdGVtLnR5cGVMYWJlbCA9IHR5cGVQcm9wLnZhbHVlc1swXS52YWx1ZS5sYWJlbDtcbiAgICAgICAgICAgICAgICAvLyBBZGQgdHlwZSB0byB0aGUgdHlwZSBtYXBcbiAgICAgICAgICAgICAgICBpZiAoIV90aGlzLnR5cGVJdGVtVHJlZS5oYXMoaXRlbS50eXBlVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnR5cGVJdGVtVHJlZS5zZXQoaXRlbS50eXBlVmFsdWUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBpdGVtLnR5cGVMYWJlbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBbaXRlbV0sXG4gICAgICAgICAgICAgICAgICAgICAgICBleHBhbmRlZDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnR5cGVJdGVtVHJlZS5nZXQoaXRlbS50eXBlVmFsdWUpLml0ZW1zLnB1c2goaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaXRlbS50eXBlVmFsdWUgPSAnJztcbiAgICAgICAgICAgICAgICBpdGVtLnR5cGVMYWJlbCA9ICdObyB0eXBlIGRlZmluZWQnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gU29ydCBieSBsYWJlbFxuICAgICAgICB0aGlzLnR5cGVJdGVtVHJlZS52YWx1ZXMoKS5mb3JFYWNoKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICB2Lml0ZW1zLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIGEubGFiZWwgPT09IGIubGFiZWwgPyAwIDogYS5sYWJlbCA+IGIubGFiZWwgPyAxIDogLTE7IH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHlwZUl0ZW1UcmVlO1xuICAgIH07XG4gICAgcmV0dXJuIFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyO1xufSgpKTtcbmV4cG9ydCB7IFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyIH07XG52YXIgUGFsZXR0ZUNvbXBvbmVudCA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gUGFsZXR0ZUNvbXBvbmVudCgpIHtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IHJlcXVpcmUoJy4vcGFsZXR0ZS1jb21wb25lbnQucHVnJykoKTtcbiAgICAgICAgdGhpcy5jb250cm9sbGVyID0gUGFsZXR0ZUNvbXBvbmVudENvbnRyb2xsZXI7XG4gICAgfVxuICAgIHJldHVybiBQYWxldHRlQ29tcG9uZW50O1xufSgpKTtcbmV4cG9ydCB7IFBhbGV0dGVDb21wb25lbnQgfTtcbmFuZ3VsYXIubW9kdWxlKCdmaWJyYS5jb21wb25lbnRzLnBhbGV0dGUnLCBbJ2ZpYnJhLnNlcnZpY2VzJ10pXG4gICAgLmNvbXBvbmVudCgncGFsZXR0ZScsIG5ldyBQYWxldHRlQ29tcG9uZW50KCkpO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGFwcC9jb21wb25lbnRzL2NvbnN0cnVjdC12aWV3L3BhbGV0dGUtY29tcG9uZW50L3BhbGV0dGUtY29tcG9uZW50LnRzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQVFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQ0E7QUFDQTtBQUlBO0FBQUE7QUFDQTtBQUlBO0FBQUE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFLQTtBQUlBO0FBRUE7QUFDQTtBQUdBO0FBQ0E7QUFFQTtBQUtBO0FBR0E7QUFFQTtBQUdBO0FBRUE7QUFDQTtBQUNBO0FBSUE7QUFJQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFHQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),

/***/ "./app/components/construct-view/property-popover.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_d3__ = __webpack_require__(\"./app/bower_components/d3/d3.js\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_d3___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_d3__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__services_sparql_item_service__ = __webpack_require__(\"./app/services/sparql-item-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__models_rdf__ = __webpack_require__(\"./app/models/rdf.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__actions_types__ = __webpack_require__(\"./app/actions/types.ts\");\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return PropertyPopover; });\n/* unused harmony export PropertyPopoverComponent */\n/* unused harmony export PropertyPopoverComponentController */\n\n\n\n\n\n\n\nvar PropertyPopover = function () {\n    function PropertyPopover($element, $scope, fibraService, $compile) {\n        this.$element = $element;\n        this.$scope = $scope;\n        this.fibraService = fibraService;\n        this.$compile = $compile;\n        this.propertyPopover = __WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"]($element[0]).append('div').classed('property-popover', true);\n    }\n    PropertyPopover.prototype.addPopover = function ($scope, baseSVG, d, i, g) {\n        var propertyPopover = __WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"](baseSVG.node().parentElement.parentElement).select('div.property-popover');\n        propertyPopover.select('property-popover').remove();\n        propertyPopover.style('left', d.fx - 3 + 'px').style('top', d.fy + 12 + 'px');\n        var cscope = $scope.$new(true);\n        cscope['node'] = d;\n        cscope['close'] = function () {\n            propertyPopover.style('visibility', 'hidden');\n        };\n        propertyPopover.node().appendChild(this.$compile('<property-popover node=\"node\" types=\"types\" close=\"close\"></property-popover>')(cscope)[0]);\n        propertyPopover.style('visibility', 'visible');\n    };\n    PropertyPopover.prototype.hidePopover = function () {\n        this.propertyPopover.style('visibility', 'hidden');\n    };\n    return PropertyPopover;\n}();\n\nvar PropertyPopoverComponent = function () {\n    function PropertyPopoverComponent() {\n        this.bindings = {\n            node: '=',\n            close: '='\n        };\n        this.template = __webpack_require__(\"./app/components/construct-view/property-popover-component.pug\")();\n        this.controller = PropertyPopoverComponentController;\n    }\n    return PropertyPopoverComponent;\n}();\n\nvar PropertyPopoverComponentController = function () {\n    function PropertyPopoverComponentController(fibraService, sparqlItemService, $scope, $q, $ngRedux) {\n        var _this = this;\n        this.fibraService = fibraService;\n        this.sparqlItemService = sparqlItemService;\n        this.$scope = $scope;\n        this.$q = $q;\n        this.$ngRedux = $ngRedux;\n        this.thingType = __WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"d\" /* OWL */].Thing.value;\n        this.showTypeCreate = false;\n        this.typeQuery = '';\n        this.typeQueryGS = function (query) {\n            if (query !== undefined) {\n                _this.typeQuery = query;\n            }\n            return _this.typeQuery;\n        };\n        this.unsubscribe = $ngRedux.connect(this.mapStateToThis, __WEBPACK_IMPORTED_MODULE_4__actions_types__)(this);\n        this.getTypes = function () {\n            return _this.types.types.concat(_this.types.userTypes);\n        };\n    }\n    PropertyPopoverComponentController.prototype.$onDestroy = function () {\n        this.unsubscribe();\n    };\n    PropertyPopoverComponentController.prototype.$postLink = function () {\n        this.label = this.node.label;\n        var nodeType = this.node.localProperties.filter(function (p) {\n            return p.value === 'http://www.w3.org/1999/02/22-rdf-syntax-ns#type';\n        })[0].values[0].value.value;\n        this.chosenType = this.types.types.filter(function (t) {\n            return t.id === nodeType;\n        })[0];\n        if (this.chosenType) this.typeQuery = this.chosenType.label;\n    };\n    PropertyPopoverComponentController.prototype.typeCreate = function (label) {\n        var _this = this;\n        if (label && !this.types.types.filter(function (t) {\n            return t.label === label;\n        })[0]) {\n            // We have a string and no matching type is in scope.\n            this.createType(label, this.sparqlItemService).then(function () {\n                // Type should now show up in the list. Assign the type that was picked\n                var typePicked = _this.types.userTypes.filter(function (t) {\n                    return t.label === label;\n                })[0];\n                if (typePicked) return _this.typeChange(typePicked);else return _this.$q.resolve({});\n            });\n        }\n    };\n    PropertyPopoverComponentController.prototype.mapStateToThis = function (state) {\n        return {\n            types: state.types\n        };\n    };\n    PropertyPopoverComponentController.prototype.typeEvaluate = function (label) {\n        if (label && !this.getTypes().filter(function (t) {\n            return t.label === label;\n        })[0]) {\n            this.showTypeCreate = true;\n        } else {\n            // Does match an existing type, or is empty\n            this.showTypeCreate = false;\n        }\n    };\n    PropertyPopoverComponentController.prototype.typeChange = function (type) {\n        var _this = this;\n        this.chosenType = type;\n        var oldTypes = this.node.localProperties.filter(function (p) {\n            return p.value === __WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"c\" /* RDF */].type.value;\n        })[0].values.map(function (n) {\n            return new __WEBPACK_IMPORTED_MODULE_1__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"c\" /* RDF */].type, n.value);\n        });\n        var typeNode = new __WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"i\" /* NamedNode */](type.id);\n        this.showTypeCreate = false;\n        return this.fibraService.dispatchAction(this.fibraService.itemProperty(this.node, [new __WEBPACK_IMPORTED_MODULE_1__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"c\" /* RDF */].type, typeNode)], oldTypes)).then(function (state) {\n            // Update the type displayed in the construct interface if appropriate (duplicative)\n            var chosenTypes = _this.fibraService.getState().construct.displayTypes;\n            if (!chosenTypes[0] && type) {\n                return _this.setOrderedTypes([type]);\n            } else if (!chosenTypes[1] && type && chosenTypes[0] !== type) {\n                var newTypes = chosenTypes.concat([]);\n                newTypes.push(type);\n                return _this.setOrderedTypes(newTypes);\n            }\n        });\n    };\n    PropertyPopoverComponentController.prototype.labelChange = function () {\n        var oldLabels = this.node.localProperties.filter(function (p) {\n            return p.value === __WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"a\" /* SKOS */].prefLabel.value;\n        })[0].values.map(function (n) {\n            return new __WEBPACK_IMPORTED_MODULE_1__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"a\" /* SKOS */].prefLabel, n.value);\n        });\n        this.fibraService.dispatchAction(this.fibraService.itemProperty(this.node, [new __WEBPACK_IMPORTED_MODULE_1__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"a\" /* SKOS */].prefLabel, __WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"b\" /* DataFactory */].instance.literal(this.label))], oldLabels));\n    };\n    PropertyPopoverComponentController.prototype.deleteAndClose = function () {\n        var _this = this;\n        this.fibraService.dispatchAction(this.fibraService.deleteItem(this.node)).then(function () {\n            _this.fibraService.dispatch('change');\n            _this.close();\n        });\n    };\n    PropertyPopoverComponentController.prototype.closePopover = function () {\n        this.close();\n        this.fibraService.dispatch('change');\n    };\n    return PropertyPopoverComponentController;\n}();\n\n__WEBPACK_IMPORTED_MODULE_3_angular__[\"module\"]('fibra.components.property-popover', ['fibra.services', 'ui.bootstrap']).component('propertyPopover', new PropertyPopoverComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9wcm9wZXJ0eS1wb3BvdmVyLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL2FwcC9jb21wb25lbnRzL2NvbnN0cnVjdC12aWV3L3Byb3BlcnR5LXBvcG92ZXIudHM/Yjg5NiJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5pbXBvcnQgKiBhcyBkMyBmcm9tICdkMyc7XG5pbXBvcnQgeyBQcm9wZXJ0eUFuZFZhbHVlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvc3BhcnFsLWl0ZW0tc2VydmljZSc7XG5pbXBvcnQgeyBPV0wsIFJERiwgTmFtZWROb2RlLCBTS09TLCBEYXRhRmFjdG9yeSB9IGZyb20gJy4uLy4uL21vZGVscy9yZGYnO1xuaW1wb3J0ICogYXMgYW5ndWxhciBmcm9tICdhbmd1bGFyJztcbmltcG9ydCAqIGFzIFR5cGVBY3Rpb25zIGZyb20gJy4uLy4uL2FjdGlvbnMvdHlwZXMnO1xudmFyIFByb3BlcnR5UG9wb3ZlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gUHJvcGVydHlQb3BvdmVyKCRlbGVtZW50LCAkc2NvcGUsIGZpYnJhU2VydmljZSwgJGNvbXBpbGUpIHtcbiAgICAgICAgdGhpcy4kZWxlbWVudCA9ICRlbGVtZW50O1xuICAgICAgICB0aGlzLiRzY29wZSA9ICRzY29wZTtcbiAgICAgICAgdGhpcy5maWJyYVNlcnZpY2UgPSBmaWJyYVNlcnZpY2U7XG4gICAgICAgIHRoaXMuJGNvbXBpbGUgPSAkY29tcGlsZTtcbiAgICAgICAgdGhpcy5wcm9wZXJ0eVBvcG92ZXIgPSBkMy5zZWxlY3QoJGVsZW1lbnRbMF0pLmFwcGVuZCgnZGl2JylcbiAgICAgICAgICAgIC5jbGFzc2VkKCdwcm9wZXJ0eS1wb3BvdmVyJywgdHJ1ZSk7XG4gICAgfVxuICAgIFByb3BlcnR5UG9wb3Zlci5wcm90b3R5cGUuYWRkUG9wb3ZlciA9IGZ1bmN0aW9uICgkc2NvcGUsIGJhc2VTVkcsIGQsIGksIGcpIHtcbiAgICAgICAgdmFyIHByb3BlcnR5UG9wb3ZlciA9IGQzLnNlbGVjdChiYXNlU1ZHLm5vZGUoKS5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQpLnNlbGVjdCgnZGl2LnByb3BlcnR5LXBvcG92ZXInKTtcbiAgICAgICAgcHJvcGVydHlQb3BvdmVyLnNlbGVjdCgncHJvcGVydHktcG9wb3ZlcicpLnJlbW92ZSgpO1xuICAgICAgICBwcm9wZXJ0eVBvcG92ZXJcbiAgICAgICAgICAgIC5zdHlsZSgnbGVmdCcsIChkLmZ4IC0gMykgKyAncHgnKVxuICAgICAgICAgICAgLnN0eWxlKCd0b3AnLCAoZC5meSArIDEyKSArICdweCcpO1xuICAgICAgICB2YXIgY3Njb3BlID0gJHNjb3BlLiRuZXcodHJ1ZSk7XG4gICAgICAgIGNzY29wZVsnbm9kZSddID0gZDtcbiAgICAgICAgY3Njb3BlWydjbG9zZSddID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcHJvcGVydHlQb3BvdmVyLnN0eWxlKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xuICAgICAgICB9O1xuICAgICAgICBwcm9wZXJ0eVBvcG92ZXIubm9kZSgpLmFwcGVuZENoaWxkKHRoaXMuJGNvbXBpbGUoJzxwcm9wZXJ0eS1wb3BvdmVyIG5vZGU9XCJub2RlXCIgdHlwZXM9XCJ0eXBlc1wiIGNsb3NlPVwiY2xvc2VcIj48L3Byb3BlcnR5LXBvcG92ZXI+JykoY3Njb3BlKVswXSk7XG4gICAgICAgIHByb3BlcnR5UG9wb3Zlci5zdHlsZSgndmlzaWJpbGl0eScsICd2aXNpYmxlJyk7XG4gICAgfTtcbiAgICBQcm9wZXJ0eVBvcG92ZXIucHJvdG90eXBlLmhpZGVQb3BvdmVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnByb3BlcnR5UG9wb3Zlci5zdHlsZSgndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICB9O1xuICAgIHJldHVybiBQcm9wZXJ0eVBvcG92ZXI7XG59KCkpO1xuZXhwb3J0IHsgUHJvcGVydHlQb3BvdmVyIH07XG52YXIgUHJvcGVydHlQb3BvdmVyQ29tcG9uZW50ID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBQcm9wZXJ0eVBvcG92ZXJDb21wb25lbnQoKSB7XG4gICAgICAgIHRoaXMuYmluZGluZ3MgPSB7XG4gICAgICAgICAgICBub2RlOiAnPScsXG4gICAgICAgICAgICBjbG9zZTogJz0nXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSByZXF1aXJlKCcuL3Byb3BlcnR5LXBvcG92ZXItY29tcG9uZW50LnB1ZycpKCk7XG4gICAgICAgIHRoaXMuY29udHJvbGxlciA9IFByb3BlcnR5UG9wb3ZlckNvbXBvbmVudENvbnRyb2xsZXI7XG4gICAgfVxuICAgIHJldHVybiBQcm9wZXJ0eVBvcG92ZXJDb21wb25lbnQ7XG59KCkpO1xuZXhwb3J0IHsgUHJvcGVydHlQb3BvdmVyQ29tcG9uZW50IH07XG52YXIgUHJvcGVydHlQb3BvdmVyQ29tcG9uZW50Q29udHJvbGxlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gUHJvcGVydHlQb3BvdmVyQ29tcG9uZW50Q29udHJvbGxlcihmaWJyYVNlcnZpY2UsIHNwYXJxbEl0ZW1TZXJ2aWNlLCAkc2NvcGUsICRxLCAkbmdSZWR1eCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZSA9IGZpYnJhU2VydmljZTtcbiAgICAgICAgdGhpcy5zcGFycWxJdGVtU2VydmljZSA9IHNwYXJxbEl0ZW1TZXJ2aWNlO1xuICAgICAgICB0aGlzLiRzY29wZSA9ICRzY29wZTtcbiAgICAgICAgdGhpcy4kcSA9ICRxO1xuICAgICAgICB0aGlzLiRuZ1JlZHV4ID0gJG5nUmVkdXg7XG4gICAgICAgIHRoaXMudGhpbmdUeXBlID0gT1dMLlRoaW5nLnZhbHVlO1xuICAgICAgICB0aGlzLnNob3dUeXBlQ3JlYXRlID0gZmFsc2U7XG4gICAgICAgIHRoaXMudHlwZVF1ZXJ5ID0gJyc7XG4gICAgICAgIHRoaXMudHlwZVF1ZXJ5R1MgPSBmdW5jdGlvbiAocXVlcnkpIHtcbiAgICAgICAgICAgIGlmIChxdWVyeSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMudHlwZVF1ZXJ5ID0gcXVlcnk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMudHlwZVF1ZXJ5O1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlID0gJG5nUmVkdXguY29ubmVjdCh0aGlzLm1hcFN0YXRlVG9UaGlzLCBUeXBlQWN0aW9ucykodGhpcyk7XG4gICAgICAgIHRoaXMuZ2V0VHlwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMudHlwZXMudHlwZXMuY29uY2F0KF90aGlzLnR5cGVzLnVzZXJUeXBlcyk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIFByb3BlcnR5UG9wb3ZlckNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLiRvbkRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudW5zdWJzY3JpYmUoKTtcbiAgICB9O1xuICAgIFByb3BlcnR5UG9wb3ZlckNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLiRwb3N0TGluayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5sYWJlbCA9IHRoaXMubm9kZS5sYWJlbDtcbiAgICAgICAgdmFyIG5vZGVUeXBlID0gdGhpcy5ub2RlLmxvY2FsUHJvcGVydGllcy5maWx0ZXIoZnVuY3Rpb24gKHApIHtcbiAgICAgICAgICAgIHJldHVybiBwLnZhbHVlID09PSAnaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zI3R5cGUnO1xuICAgICAgICB9KVswXS52YWx1ZXNbMF0udmFsdWUudmFsdWU7XG4gICAgICAgIHRoaXMuY2hvc2VuVHlwZSA9IHRoaXMudHlwZXMudHlwZXMuZmlsdGVyKGZ1bmN0aW9uICh0KSB7IHJldHVybiB0LmlkID09PSBub2RlVHlwZTsgfSlbMF07XG4gICAgICAgIGlmICh0aGlzLmNob3NlblR5cGUpXG4gICAgICAgICAgICB0aGlzLnR5cGVRdWVyeSA9IHRoaXMuY2hvc2VuVHlwZS5sYWJlbDtcbiAgICB9O1xuICAgIFByb3BlcnR5UG9wb3ZlckNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLnR5cGVDcmVhdGUgPSBmdW5jdGlvbiAobGFiZWwpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgaWYgKGxhYmVsICYmICF0aGlzLnR5cGVzLnR5cGVzLmZpbHRlcihmdW5jdGlvbiAodCkgeyByZXR1cm4gdC5sYWJlbCA9PT0gbGFiZWw7IH0pWzBdKSB7XG4gICAgICAgICAgICAvLyBXZSBoYXZlIGEgc3RyaW5nIGFuZCBubyBtYXRjaGluZyB0eXBlIGlzIGluIHNjb3BlLlxuICAgICAgICAgICAgdGhpcy5jcmVhdGVUeXBlKGxhYmVsLCB0aGlzLnNwYXJxbEl0ZW1TZXJ2aWNlKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAvLyBUeXBlIHNob3VsZCBub3cgc2hvdyB1cCBpbiB0aGUgbGlzdC4gQXNzaWduIHRoZSB0eXBlIHRoYXQgd2FzIHBpY2tlZFxuICAgICAgICAgICAgICAgIHZhciB0eXBlUGlja2VkID0gX3RoaXMudHlwZXMudXNlclR5cGVzLmZpbHRlcihmdW5jdGlvbiAodCkgeyByZXR1cm4gdC5sYWJlbCA9PT0gbGFiZWw7IH0pWzBdO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlUGlja2VkKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMudHlwZUNoYW5nZSh0eXBlUGlja2VkKTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy4kcS5yZXNvbHZlKHt9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBQcm9wZXJ0eVBvcG92ZXJDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5tYXBTdGF0ZVRvVGhpcyA9IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZXM6IHN0YXRlLnR5cGVzXG4gICAgICAgIH07XG4gICAgfTtcbiAgICBQcm9wZXJ0eVBvcG92ZXJDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS50eXBlRXZhbHVhdGUgPSBmdW5jdGlvbiAobGFiZWwpIHtcbiAgICAgICAgaWYgKGxhYmVsICYmICF0aGlzLmdldFR5cGVzKCkuZmlsdGVyKGZ1bmN0aW9uICh0KSB7IHJldHVybiB0LmxhYmVsID09PSBsYWJlbDsgfSlbMF0pIHtcbiAgICAgICAgICAgIHRoaXMuc2hvd1R5cGVDcmVhdGUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gRG9lcyBtYXRjaCBhbiBleGlzdGluZyB0eXBlLCBvciBpcyBlbXB0eVxuICAgICAgICAgICAgdGhpcy5zaG93VHlwZUNyZWF0ZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBQcm9wZXJ0eVBvcG92ZXJDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS50eXBlQ2hhbmdlID0gZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5jaG9zZW5UeXBlID0gdHlwZTtcbiAgICAgICAgdmFyIG9sZFR5cGVzID0gdGhpcy5ub2RlLmxvY2FsUHJvcGVydGllcy5maWx0ZXIoZnVuY3Rpb24gKHApIHsgcmV0dXJuIHAudmFsdWUgPT09IFJERi50eXBlLnZhbHVlOyB9KVswXS52YWx1ZXMubWFwKGZ1bmN0aW9uIChuKSB7IHJldHVybiBuZXcgUHJvcGVydHlBbmRWYWx1ZShSREYudHlwZSwgbi52YWx1ZSk7IH0pO1xuICAgICAgICB2YXIgdHlwZU5vZGUgPSBuZXcgTmFtZWROb2RlKHR5cGUuaWQpO1xuICAgICAgICB0aGlzLnNob3dUeXBlQ3JlYXRlID0gZmFsc2U7XG4gICAgICAgIHJldHVybiB0aGlzLmZpYnJhU2VydmljZS5kaXNwYXRjaEFjdGlvbih0aGlzLmZpYnJhU2VydmljZS5pdGVtUHJvcGVydHkodGhpcy5ub2RlLCBbbmV3IFByb3BlcnR5QW5kVmFsdWUoUkRGLnR5cGUsIHR5cGVOb2RlKV0sIG9sZFR5cGVzKSkudGhlbihmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgdHlwZSBkaXNwbGF5ZWQgaW4gdGhlIGNvbnN0cnVjdCBpbnRlcmZhY2UgaWYgYXBwcm9wcmlhdGUgKGR1cGxpY2F0aXZlKVxuICAgICAgICAgICAgdmFyIGNob3NlblR5cGVzID0gX3RoaXMuZmlicmFTZXJ2aWNlLmdldFN0YXRlKCkuY29uc3RydWN0LmRpc3BsYXlUeXBlcztcbiAgICAgICAgICAgIGlmICghY2hvc2VuVHlwZXNbMF0gJiYgdHlwZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5zZXRPcmRlcmVkVHlwZXMoW3R5cGVdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFjaG9zZW5UeXBlc1sxXSAmJiB0eXBlICYmIChjaG9zZW5UeXBlc1swXSAhPT0gdHlwZSkpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmV3VHlwZXMgPSBjaG9zZW5UeXBlcy5jb25jYXQoW10pO1xuICAgICAgICAgICAgICAgIG5ld1R5cGVzLnB1c2godHlwZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnNldE9yZGVyZWRUeXBlcyhuZXdUeXBlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgUHJvcGVydHlQb3BvdmVyQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUubGFiZWxDaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBvbGRMYWJlbHMgPSB0aGlzLm5vZGUubG9jYWxQcm9wZXJ0aWVzLmZpbHRlcihmdW5jdGlvbiAocCkgeyByZXR1cm4gcC52YWx1ZSA9PT0gU0tPUy5wcmVmTGFiZWwudmFsdWU7IH0pWzBdLnZhbHVlcy5tYXAoZnVuY3Rpb24gKG4pIHsgcmV0dXJuIG5ldyBQcm9wZXJ0eUFuZFZhbHVlKFNLT1MucHJlZkxhYmVsLCBuLnZhbHVlKTsgfSk7XG4gICAgICAgIHRoaXMuZmlicmFTZXJ2aWNlLmRpc3BhdGNoQWN0aW9uKHRoaXMuZmlicmFTZXJ2aWNlLml0ZW1Qcm9wZXJ0eSh0aGlzLm5vZGUsIFtuZXcgUHJvcGVydHlBbmRWYWx1ZShTS09TLnByZWZMYWJlbCwgRGF0YUZhY3RvcnkuaW5zdGFuY2UubGl0ZXJhbCh0aGlzLmxhYmVsKSldLCBvbGRMYWJlbHMpKTtcbiAgICB9O1xuICAgIFByb3BlcnR5UG9wb3ZlckNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLmRlbGV0ZUFuZENsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZS5kaXNwYXRjaEFjdGlvbih0aGlzLmZpYnJhU2VydmljZS5kZWxldGVJdGVtKHRoaXMubm9kZSkpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdGhpcy5maWJyYVNlcnZpY2UuZGlzcGF0Y2goJ2NoYW5nZScpO1xuICAgICAgICAgICAgX3RoaXMuY2xvc2UoKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBQcm9wZXJ0eVBvcG92ZXJDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5jbG9zZVBvcG92ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgdGhpcy5maWJyYVNlcnZpY2UuZGlzcGF0Y2goJ2NoYW5nZScpO1xuICAgIH07XG4gICAgcmV0dXJuIFByb3BlcnR5UG9wb3ZlckNvbXBvbmVudENvbnRyb2xsZXI7XG59KCkpO1xuZXhwb3J0IHsgUHJvcGVydHlQb3BvdmVyQ29tcG9uZW50Q29udHJvbGxlciB9O1xuYW5ndWxhci5tb2R1bGUoJ2ZpYnJhLmNvbXBvbmVudHMucHJvcGVydHktcG9wb3ZlcicsIFsnZmlicmEuc2VydmljZXMnLCAndWkuYm9vdHN0cmFwJ10pXG4gICAgLmNvbXBvbmVudCgncHJvcGVydHlQb3BvdmVyJywgbmV3IFByb3BlcnR5UG9wb3ZlckNvbXBvbmVudCgpKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBhcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9wcm9wZXJ0eS1wb3BvdmVyLnRzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),

/***/ "./app/components/construct-view/sunburst.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_d3__ = __webpack_require__(\"./app/bower_components/d3/d3.js\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_d3___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_d3__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Sunburst; });\n\n\n\nvar Sunburst = function () {\n    function Sunburst($element, $compile, $scope, sparqlItemService, fibraService) {\n        var _this = this;\n        this.$element = $element;\n        this.$compile = $compile;\n        this.$scope = $scope;\n        this.sparqlItemService = sparqlItemService;\n        this.fibraService = fibraService;\n        this.sbRadius = 200;\n        this.lessRadius = this.sbRadius * this.sbRadius / 3 - 12 * 12;\n        this.sbArc = __WEBPACK_IMPORTED_MODULE_0_d3__[\"arc\"]().startAngle(function (d) {\n            return d.x0;\n        }).endAngle(function (d) {\n            return d.x1;\n        }).innerRadius(function (d) {\n            return Math.sqrt(d.y0 - _this.lessRadius);\n        }).outerRadius(function (d) {\n            return Math.sqrt(d.y1 - _this.lessRadius);\n        });\n        this.sbPart = __WEBPACK_IMPORTED_MODULE_0_d3__[\"partition\"]().size([2 * Math.PI, this.sbRadius * this.sbRadius]);\n        this.item_info_tip_displayed = false;\n        this.sbTooltip = __WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"]('body').append('div').style('position', 'absolute').style('z-index', '20').style('background-color', 'gray').style('color', 'white').style('padding', '3px').style('border-radius', '2px').style('visibility', 'hidden');\n        this.item_info_tip = __WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"]('body').append('div').attr('id', 'item_info_tip').style('position', 'absolute').style('z-index', '20').style('background-color', 'white').style('padding', '3px').style('visibility', 'hidden');\n        // Typescript messes with `this` depending on caller. Override.\n        this.buildSunburst = this.buildSunburst.bind(this);\n    }\n    Sunburst.prototype.addSunburstGroup = function (sel) {\n        var _this = this;\n        this.sel = sel;\n        if (this.sbGroup) this.sbGroup.remove();\n        this.sbGroup = sel.append('g').classed('sunburst-overlay', true);\n        // Handle info overlay\n        this.sel.on('click', function () {\n            if (_this.item_info_tip_displayed) {\n                _this.item_info_tip.style('visibility', 'hidden');\n                _this.item_info_tip_displayed = false;\n            }\n        });\n    };\n    Sunburst.prototype.buildSunburst = function (d, i, g) {\n        var _this = this;\n        this.original_data = d;\n        this.sbGroup.attr('transform', function (d) {\n            return 'translate(' + d.gx + ',' + d.gy + ')';\n        });\n        // Group by property type -> property value\n        var hier = __WEBPACK_IMPORTED_MODULE_0_d3__[\"hierarchy\"](d, function (node) {\n            if (node.localProperties) {\n                // Root node\n                return node.localProperties.concat(node.remoteProperties);\n            } else {\n                // Property node\n                return node.values ? node.values.map(function (n) {\n                    return n.value;\n                }) : undefined;\n            }\n        });\n        hier.sum(function (d) {\n            return d.values === undefined && d.localProperties === undefined ? 1 : 0;\n        });\n        var part = this.sbPart(hier);\n        var paths = this.sbGroup.selectAll(\"path\").data(hier.descendants(), function (d) {\n            return d.data;\n        });\n        paths.exit().remove();\n        paths.enter().filter(function (d) {\n            return d.depth > 0;\n        }).append(\"path\").classed(\"sunburst-cell\", true).on('mouseover', function (d, i) {\n            _this.sbTooltip.style('top', __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].pageY - 10 + 'px').style('left', __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].pageX + 10 + 'px').style('visibility', 'visible').text(d.depth === 2 ? d.data.label + \" (click to add)\" : d.data.label + \" (click to add all children)\");\n        }).on('mouseout', function () {\n            _this.sbTooltip.style('visibility', 'hidden');\n        }).on('click', function (d, i) {\n            if (d.depth === 2) {\n                // Leaf\n                _this.fibraService.dispatchAction(_this.fibraService.displayItem(d.data));\n            } else {\n                // Property\n                _this.fibraService.dispatchAction(_this.fibraService.displayItems(d.children.map(function (hn) {\n                    return hn.data;\n                })));\n            }\n            _this.original_data.selected = false;\n            _this.sbTooltip.style('visibility', 'hidden');\n            _this.sbGroup.remove();\n        }).merge(paths).attr(\"d\", this.sbArc).style(\"stroke\", \"#fff\");\n    };\n    Sunburst.prototype.selectItem = function (id) {\n        this.selectedItem = id;\n    };\n    return Sunburst;\n}();\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9zdW5idXJzdC50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9zdW5idXJzdC50cz82ZWQxIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmltcG9ydCAqIGFzIGQzIGZyb20gJ2QzJztcbnZhciBTdW5idXJzdCA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gU3VuYnVyc3QoJGVsZW1lbnQsICRjb21waWxlLCAkc2NvcGUsIHNwYXJxbEl0ZW1TZXJ2aWNlLCBmaWJyYVNlcnZpY2UpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy4kZWxlbWVudCA9ICRlbGVtZW50O1xuICAgICAgICB0aGlzLiRjb21waWxlID0gJGNvbXBpbGU7XG4gICAgICAgIHRoaXMuJHNjb3BlID0gJHNjb3BlO1xuICAgICAgICB0aGlzLnNwYXJxbEl0ZW1TZXJ2aWNlID0gc3BhcnFsSXRlbVNlcnZpY2U7XG4gICAgICAgIHRoaXMuZmlicmFTZXJ2aWNlID0gZmlicmFTZXJ2aWNlO1xuICAgICAgICB0aGlzLnNiUmFkaXVzID0gMjAwO1xuICAgICAgICB0aGlzLmxlc3NSYWRpdXMgPSB0aGlzLnNiUmFkaXVzICogdGhpcy5zYlJhZGl1cyAvIDMgLSAxMiAqIDEyO1xuICAgICAgICB0aGlzLnNiQXJjID0gZDMuYXJjKClcbiAgICAgICAgICAgIC5zdGFydEFuZ2xlKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLngwOyB9KVxuICAgICAgICAgICAgLmVuZEFuZ2xlKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLngxOyB9KVxuICAgICAgICAgICAgLmlubmVyUmFkaXVzKGZ1bmN0aW9uIChkKSB7IHJldHVybiBNYXRoLnNxcnQoZC55MCAtIF90aGlzLmxlc3NSYWRpdXMpOyB9KVxuICAgICAgICAgICAgLm91dGVyUmFkaXVzKGZ1bmN0aW9uIChkKSB7IHJldHVybiBNYXRoLnNxcnQoZC55MSAtIF90aGlzLmxlc3NSYWRpdXMpOyB9KTtcbiAgICAgICAgdGhpcy5zYlBhcnQgPSBkMy5wYXJ0aXRpb24oKVxuICAgICAgICAgICAgLnNpemUoWzIgKiBNYXRoLlBJLCB0aGlzLnNiUmFkaXVzICogdGhpcy5zYlJhZGl1c10pO1xuICAgICAgICB0aGlzLml0ZW1faW5mb190aXBfZGlzcGxheWVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2JUb29sdGlwID0gZDMuc2VsZWN0KCdib2R5JykuYXBwZW5kKCdkaXYnKVxuICAgICAgICAgICAgLnN0eWxlKCdwb3NpdGlvbicsICdhYnNvbHV0ZScpXG4gICAgICAgICAgICAuc3R5bGUoJ3otaW5kZXgnLCAnMjAnKVxuICAgICAgICAgICAgLnN0eWxlKCdiYWNrZ3JvdW5kLWNvbG9yJywgJ2dyYXknKVxuICAgICAgICAgICAgLnN0eWxlKCdjb2xvcicsICd3aGl0ZScpXG4gICAgICAgICAgICAuc3R5bGUoJ3BhZGRpbmcnLCAnM3B4JylcbiAgICAgICAgICAgIC5zdHlsZSgnYm9yZGVyLXJhZGl1cycsICcycHgnKVxuICAgICAgICAgICAgLnN0eWxlKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xuICAgICAgICB0aGlzLml0ZW1faW5mb190aXAgPSBkMy5zZWxlY3QoJ2JvZHknKS5hcHBlbmQoJ2RpdicpXG4gICAgICAgICAgICAuYXR0cignaWQnLCAnaXRlbV9pbmZvX3RpcCcpXG4gICAgICAgICAgICAuc3R5bGUoJ3Bvc2l0aW9uJywgJ2Fic29sdXRlJylcbiAgICAgICAgICAgIC5zdHlsZSgnei1pbmRleCcsICcyMCcpXG4gICAgICAgICAgICAuc3R5bGUoJ2JhY2tncm91bmQtY29sb3InLCAnd2hpdGUnKVxuICAgICAgICAgICAgLnN0eWxlKCdwYWRkaW5nJywgJzNweCcpXG4gICAgICAgICAgICAuc3R5bGUoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgICAgIC8vIFR5cGVzY3JpcHQgbWVzc2VzIHdpdGggYHRoaXNgIGRlcGVuZGluZyBvbiBjYWxsZXIuIE92ZXJyaWRlLlxuICAgICAgICB0aGlzLmJ1aWxkU3VuYnVyc3QgPSB0aGlzLmJ1aWxkU3VuYnVyc3QuYmluZCh0aGlzKTtcbiAgICB9XG4gICAgU3VuYnVyc3QucHJvdG90eXBlLmFkZFN1bmJ1cnN0R3JvdXAgPSBmdW5jdGlvbiAoc2VsKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuc2VsID0gc2VsO1xuICAgICAgICBpZiAodGhpcy5zYkdyb3VwKVxuICAgICAgICAgICAgdGhpcy5zYkdyb3VwLnJlbW92ZSgpO1xuICAgICAgICB0aGlzLnNiR3JvdXAgPSBzZWwuYXBwZW5kKCdnJylcbiAgICAgICAgICAgIC5jbGFzc2VkKCdzdW5idXJzdC1vdmVybGF5JywgdHJ1ZSk7XG4gICAgICAgIC8vIEhhbmRsZSBpbmZvIG92ZXJsYXlcbiAgICAgICAgdGhpcy5zZWwub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKF90aGlzLml0ZW1faW5mb190aXBfZGlzcGxheWVkKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuaXRlbV9pbmZvX3RpcC5zdHlsZSgndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICAgICAgICAgICAgICBfdGhpcy5pdGVtX2luZm9fdGlwX2Rpc3BsYXllZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFN1bmJ1cnN0LnByb3RvdHlwZS5idWlsZFN1bmJ1cnN0ID0gZnVuY3Rpb24gKGQsIGksIGcpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5vcmlnaW5hbF9kYXRhID0gZDtcbiAgICAgICAgdGhpcy5zYkdyb3VwLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uIChkKSB7IHJldHVybiAndHJhbnNsYXRlKCcgKyBkLmd4ICsgJywnICsgZC5neSArICcpJzsgfSk7XG4gICAgICAgIC8vIEdyb3VwIGJ5IHByb3BlcnR5IHR5cGUgLT4gcHJvcGVydHkgdmFsdWVcbiAgICAgICAgdmFyIGhpZXIgPSBkMy5oaWVyYXJjaHkoZCwgZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgIGlmIChub2RlLmxvY2FsUHJvcGVydGllcykge1xuICAgICAgICAgICAgICAgIC8vIFJvb3Qgbm9kZVxuICAgICAgICAgICAgICAgIHJldHVybiBub2RlLmxvY2FsUHJvcGVydGllcy5jb25jYXQobm9kZS5yZW1vdGVQcm9wZXJ0aWVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFByb3BlcnR5IG5vZGVcbiAgICAgICAgICAgICAgICByZXR1cm4gbm9kZS52YWx1ZXMgPyBub2RlLnZhbHVlcy5tYXAoZnVuY3Rpb24gKG4pIHsgcmV0dXJuIG4udmFsdWU7IH0pIDogdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaGllci5zdW0oZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudmFsdWVzID09PSB1bmRlZmluZWQgJiYgZC5sb2NhbFByb3BlcnRpZXMgPT09IHVuZGVmaW5lZCA/IDEgOiAwOyB9KTtcbiAgICAgICAgdmFyIHBhcnQgPSB0aGlzLnNiUGFydChoaWVyKTtcbiAgICAgICAgdmFyIHBhdGhzID0gdGhpcy5zYkdyb3VwLnNlbGVjdEFsbChcInBhdGhcIilcbiAgICAgICAgICAgIC5kYXRhKGhpZXIuZGVzY2VuZGFudHMoKSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuZGF0YTsgfSk7XG4gICAgICAgIHBhdGhzLmV4aXQoKS5yZW1vdmUoKTtcbiAgICAgICAgcGF0aHMuZW50ZXIoKVxuICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5kZXB0aCA+IDA7IH0pXG4gICAgICAgICAgICAuYXBwZW5kKFwicGF0aFwiKVxuICAgICAgICAgICAgLmNsYXNzZWQoXCJzdW5idXJzdC1jZWxsXCIsIHRydWUpXG4gICAgICAgICAgICAub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uIChkLCBpKSB7XG4gICAgICAgICAgICBfdGhpcy5zYlRvb2x0aXAuc3R5bGUoJ3RvcCcsIChkMy5ldmVudC5wYWdlWSAtIDEwKSArICdweCcpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdsZWZ0JywgKGQzLmV2ZW50LnBhZ2VYICsgMTApICsgJ3B4JylcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpXG4gICAgICAgICAgICAgICAgLnRleHQoZC5kZXB0aCA9PT0gMiA/XG4gICAgICAgICAgICAgICAgKGQuZGF0YS5sYWJlbCArIFwiIChjbGljayB0byBhZGQpXCIpIDpcbiAgICAgICAgICAgICAgICAoZC5kYXRhLmxhYmVsICsgXCIgKGNsaWNrIHRvIGFkZCBhbGwgY2hpbGRyZW4pXCIpKTtcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC5vbignbW91c2VvdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdGhpcy5zYlRvb2x0aXAuc3R5bGUoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAub24oJ2NsaWNrJywgZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgICAgIGlmIChkLmRlcHRoID09PSAyKSB7XG4gICAgICAgICAgICAgICAgLy8gTGVhZlxuICAgICAgICAgICAgICAgIF90aGlzLmZpYnJhU2VydmljZS5kaXNwYXRjaEFjdGlvbihfdGhpcy5maWJyYVNlcnZpY2UuZGlzcGxheUl0ZW0oZC5kYXRhKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBQcm9wZXJ0eVxuICAgICAgICAgICAgICAgIF90aGlzLmZpYnJhU2VydmljZS5kaXNwYXRjaEFjdGlvbihfdGhpcy5maWJyYVNlcnZpY2UuZGlzcGxheUl0ZW1zKGQuY2hpbGRyZW4ubWFwKGZ1bmN0aW9uIChobikgeyByZXR1cm4gaG4uZGF0YTsgfSkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF90aGlzLm9yaWdpbmFsX2RhdGEuc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIF90aGlzLnNiVG9vbHRpcC5zdHlsZSgndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICAgICAgICAgIF90aGlzLnNiR3JvdXAucmVtb3ZlKCk7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAubWVyZ2UocGF0aHMpXG4gICAgICAgICAgICAuYXR0cihcImRcIiwgdGhpcy5zYkFyYylcbiAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZVwiLCBcIiNmZmZcIik7XG4gICAgfTtcbiAgICBTdW5idXJzdC5wcm90b3R5cGUuc2VsZWN0SXRlbSA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbSA9IGlkO1xuICAgIH07XG4gICAgcmV0dXJuIFN1bmJ1cnN0O1xufSgpKTtcbmV4cG9ydCB7IFN1bmJ1cnN0IH07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL2NvbXBvbmVudHMvY29uc3RydWN0LXZpZXcvc3VuYnVyc3QudHMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBUUE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFJQTtBQU1BO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),

/***/ "./app/components/edit-primary-endpoint-configuration-view/edit-primary-endpoint-configuration-view-component.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__citable_editor_citable_editor_component__ = __webpack_require__(\"./app/components/citable-editor/citable-editor-component.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__services_project_service_primary_endpoint_configuration__ = __webpack_require__(\"./app/services/project-service/primary-endpoint-configuration.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__models_rdf__ = __webpack_require__(\"./app/models/rdf.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_angular__);\n/* unused harmony export EditPrimaryEndpointConfigurationViewComponentController */\n/* unused harmony export EditPrimaryEndpointConfigurationViewComponent */\n\n\nvar __extends = this && this.__extends || function () {\n    var extendStatics = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (d, b) {\n        d.__proto__ = b;\n    } || function (d, b) {\n        for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() {\n            this.constructor = d;\n        }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n}();\n\n\n\n\nvar EditPrimaryEndpointConfigurationViewComponentController = function (_super) {\n    __extends(EditPrimaryEndpointConfigurationViewComponentController, _super);\n    function EditPrimaryEndpointConfigurationViewComponentController($stateParams, fibraService, projectService, toastr) {\n        var _this = _super.call(this, $stateParams.sourceId, projectService, toastr) || this;\n        if ($stateParams.id) projectService.loadPrimaryEndpointConfiguration(_this.projectSource, $stateParams.id).then(function (ps) {\n            return _this.c = ps;\n        });else {\n            _this.c = new __WEBPACK_IMPORTED_MODULE_1__services_project_service_primary_endpoint_configuration__[\"a\" /* PrimaryEndpointConfiguration */]();\n            _this.c.id = $stateParams.id;\n            _this.c.labels = [__WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"b\" /* DataFactory */].literal('', fibraService.getState().language)];\n            _this.c.descriptions = [__WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"b\" /* DataFactory */].literal('', fibraService.getState().language)];\n        }\n        return _this;\n    }\n    EditPrimaryEndpointConfigurationViewComponentController.prototype.addCompatibleEndpoint = function () {\n        this.c.compatibleEndpoints.push('');\n    };\n    EditPrimaryEndpointConfigurationViewComponentController.prototype.removeCompatibleEndpoint = function (index) {\n        this.c.compatibleEndpoints.splice(index, 1);\n    };\n    return EditPrimaryEndpointConfigurationViewComponentController;\n}(__WEBPACK_IMPORTED_MODULE_0__citable_editor_citable_editor_component__[\"a\" /* EditCitableComponentController */]);\n\nvar EditPrimaryEndpointConfigurationViewComponent = function () {\n    function EditPrimaryEndpointConfigurationViewComponent() {\n        this.controller = EditPrimaryEndpointConfigurationViewComponentController;\n        this.template = __webpack_require__(\"./app/components/edit-primary-endpoint-configuration-view/edit-primary-endpoint-configuration-view.pug\")();\n    }\n    return EditPrimaryEndpointConfigurationViewComponent;\n}();\n\n__WEBPACK_IMPORTED_MODULE_3_angular__[\"module\"]('fibra.components.edit-primary-endpoint-configuration', ['fibra.services']).component('editPrimaryEndpointConfigurationView', new EditPrimaryEndpointConfigurationViewComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9lZGl0LXByaW1hcnktZW5kcG9pbnQtY29uZmlndXJhdGlvbi12aWV3L2VkaXQtcHJpbWFyeS1lbmRwb2ludC1jb25maWd1cmF0aW9uLXZpZXctY29tcG9uZW50LnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL2FwcC9jb21wb25lbnRzL2VkaXQtcHJpbWFyeS1lbmRwb2ludC1jb25maWd1cmF0aW9uLXZpZXcvZWRpdC1wcmltYXJ5LWVuZHBvaW50LWNvbmZpZ3VyYXRpb24tdmlldy1jb21wb25lbnQudHM/ZjFhMiJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbmltcG9ydCB7IEVkaXRDaXRhYmxlQ29tcG9uZW50Q29udHJvbGxlciB9IGZyb20gJy4uL2NpdGFibGUtZWRpdG9yL2NpdGFibGUtZWRpdG9yLWNvbXBvbmVudCc7XG5pbXBvcnQgeyBQcmltYXJ5RW5kcG9pbnRDb25maWd1cmF0aW9uIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvcHJvamVjdC1zZXJ2aWNlL3ByaW1hcnktZW5kcG9pbnQtY29uZmlndXJhdGlvbic7XG5pbXBvcnQgeyBEYXRhRmFjdG9yeSB9IGZyb20gJy4uLy4uL21vZGVscy9yZGYnO1xuaW1wb3J0ICogYXMgYW5ndWxhciBmcm9tICdhbmd1bGFyJztcbnZhciBFZGl0UHJpbWFyeUVuZHBvaW50Q29uZmlndXJhdGlvblZpZXdDb21wb25lbnRDb250cm9sbGVyID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoRWRpdFByaW1hcnlFbmRwb2ludENvbmZpZ3VyYXRpb25WaWV3Q29tcG9uZW50Q29udHJvbGxlciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBFZGl0UHJpbWFyeUVuZHBvaW50Q29uZmlndXJhdGlvblZpZXdDb21wb25lbnRDb250cm9sbGVyKCRzdGF0ZVBhcmFtcywgZmlicmFTZXJ2aWNlLCBwcm9qZWN0U2VydmljZSwgdG9hc3RyKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsICRzdGF0ZVBhcmFtcy5zb3VyY2VJZCwgcHJvamVjdFNlcnZpY2UsIHRvYXN0cikgfHwgdGhpcztcbiAgICAgICAgaWYgKCRzdGF0ZVBhcmFtcy5pZClcbiAgICAgICAgICAgIHByb2plY3RTZXJ2aWNlLmxvYWRQcmltYXJ5RW5kcG9pbnRDb25maWd1cmF0aW9uKF90aGlzLnByb2plY3RTb3VyY2UsICRzdGF0ZVBhcmFtcy5pZCkudGhlbihmdW5jdGlvbiAocHMpIHsgcmV0dXJuIF90aGlzLmMgPSBwczsgfSk7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgX3RoaXMuYyA9IG5ldyBQcmltYXJ5RW5kcG9pbnRDb25maWd1cmF0aW9uKCk7XG4gICAgICAgICAgICBfdGhpcy5jLmlkID0gJHN0YXRlUGFyYW1zLmlkO1xuICAgICAgICAgICAgX3RoaXMuYy5sYWJlbHMgPSBbRGF0YUZhY3RvcnkubGl0ZXJhbCgnJywgZmlicmFTZXJ2aWNlLmdldFN0YXRlKCkubGFuZ3VhZ2UpXTtcbiAgICAgICAgICAgIF90aGlzLmMuZGVzY3JpcHRpb25zID0gW0RhdGFGYWN0b3J5LmxpdGVyYWwoJycsIGZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLmxhbmd1YWdlKV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBFZGl0UHJpbWFyeUVuZHBvaW50Q29uZmlndXJhdGlvblZpZXdDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5hZGRDb21wYXRpYmxlRW5kcG9pbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuYy5jb21wYXRpYmxlRW5kcG9pbnRzLnB1c2goJycpO1xuICAgIH07XG4gICAgRWRpdFByaW1hcnlFbmRwb2ludENvbmZpZ3VyYXRpb25WaWV3Q29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUucmVtb3ZlQ29tcGF0aWJsZUVuZHBvaW50ID0gZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgIHRoaXMuYy5jb21wYXRpYmxlRW5kcG9pbnRzLnNwbGljZShpbmRleCwgMSk7XG4gICAgfTtcbiAgICByZXR1cm4gRWRpdFByaW1hcnlFbmRwb2ludENvbmZpZ3VyYXRpb25WaWV3Q29tcG9uZW50Q29udHJvbGxlcjtcbn0oRWRpdENpdGFibGVDb21wb25lbnRDb250cm9sbGVyKSk7XG5leHBvcnQgeyBFZGl0UHJpbWFyeUVuZHBvaW50Q29uZmlndXJhdGlvblZpZXdDb21wb25lbnRDb250cm9sbGVyIH07XG52YXIgRWRpdFByaW1hcnlFbmRwb2ludENvbmZpZ3VyYXRpb25WaWV3Q29tcG9uZW50ID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBFZGl0UHJpbWFyeUVuZHBvaW50Q29uZmlndXJhdGlvblZpZXdDb21wb25lbnQoKSB7XG4gICAgICAgIHRoaXMuY29udHJvbGxlciA9IEVkaXRQcmltYXJ5RW5kcG9pbnRDb25maWd1cmF0aW9uVmlld0NvbXBvbmVudENvbnRyb2xsZXI7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSByZXF1aXJlKCcuL2VkaXQtcHJpbWFyeS1lbmRwb2ludC1jb25maWd1cmF0aW9uLXZpZXcucHVnJykoKTtcbiAgICB9XG4gICAgcmV0dXJuIEVkaXRQcmltYXJ5RW5kcG9pbnRDb25maWd1cmF0aW9uVmlld0NvbXBvbmVudDtcbn0oKSk7XG5leHBvcnQgeyBFZGl0UHJpbWFyeUVuZHBvaW50Q29uZmlndXJhdGlvblZpZXdDb21wb25lbnQgfTtcbmFuZ3VsYXIubW9kdWxlKCdmaWJyYS5jb21wb25lbnRzLmVkaXQtcHJpbWFyeS1lbmRwb2ludC1jb25maWd1cmF0aW9uJywgWydmaWJyYS5zZXJ2aWNlcyddKVxuICAgIC5jb21wb25lbnQoJ2VkaXRQcmltYXJ5RW5kcG9pbnRDb25maWd1cmF0aW9uVmlldycsIG5ldyBFZGl0UHJpbWFyeUVuZHBvaW50Q29uZmlndXJhdGlvblZpZXdDb21wb25lbnQoKSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL2NvbXBvbmVudHMvZWRpdC1wcmltYXJ5LWVuZHBvaW50LWNvbmZpZ3VyYXRpb24tdmlldy9lZGl0LXByaW1hcnktZW5kcG9pbnQtY29uZmlndXJhdGlvbi12aWV3LWNvbXBvbmVudC50cyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),

/***/ "./app/components/edit-remote-endpoint-configuration-view/edit-remote-endpoint-configuration-view-component.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__citable_editor_citable_editor_component__ = __webpack_require__(\"./app/components/citable-editor/citable-editor-component.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__services_project_service_remote_endpoint_configuration__ = __webpack_require__(\"./app/services/project-service/remote-endpoint-configuration.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__models_rdf__ = __webpack_require__(\"./app/models/rdf.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_angular__);\n/* unused harmony export EditRemoteEndpointConfigurationViewComponentController */\n/* unused harmony export EditRemoteEndpointConfigurationViewComponent */\n\n\nvar __extends = this && this.__extends || function () {\n    var extendStatics = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (d, b) {\n        d.__proto__ = b;\n    } || function (d, b) {\n        for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() {\n            this.constructor = d;\n        }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n}();\n\n\n\n\nvar EditRemoteEndpointConfigurationViewComponentController = function (_super) {\n    __extends(EditRemoteEndpointConfigurationViewComponentController, _super);\n    function EditRemoteEndpointConfigurationViewComponentController($stateParams, fibraService, projectService, toastr) {\n        var _this = _super.call(this, $stateParams.sourceId, projectService, toastr) || this;\n        if ($stateParams.id) projectService.loadRemoteEndpointConfiguration(_this.projectSource, $stateParams.id).then(function (ps) {\n            return _this.c = ps;\n        });else {\n            _this.c = new __WEBPACK_IMPORTED_MODULE_1__services_project_service_remote_endpoint_configuration__[\"a\" /* RemoteEndpointConfiguration */]();\n            _this.c.labels = [__WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"b\" /* DataFactory */].literal('', fibraService.getState().language)];\n            _this.c.descriptions = [__WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"b\" /* DataFactory */].literal('', fibraService.getState().language)];\n        }\n        return _this;\n    }\n    return EditRemoteEndpointConfigurationViewComponentController;\n}(__WEBPACK_IMPORTED_MODULE_0__citable_editor_citable_editor_component__[\"a\" /* EditCitableComponentController */]);\n\nvar EditRemoteEndpointConfigurationViewComponent = function () {\n    function EditRemoteEndpointConfigurationViewComponent() {\n        this.controller = EditRemoteEndpointConfigurationViewComponentController;\n        this.template = __webpack_require__(\"./app/components/edit-remote-endpoint-configuration-view/edit-remote-endpoint-configuration-view.pug\")();\n    }\n    return EditRemoteEndpointConfigurationViewComponent;\n}();\n\n__WEBPACK_IMPORTED_MODULE_3_angular__[\"module\"]('fibra.components.edit-remote-endpoint-configuration', ['fibra.services']).component('editRemoteEndpointConfigurationView', new EditRemoteEndpointConfigurationViewComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9lZGl0LXJlbW90ZS1lbmRwb2ludC1jb25maWd1cmF0aW9uLXZpZXcvZWRpdC1yZW1vdGUtZW5kcG9pbnQtY29uZmlndXJhdGlvbi12aWV3LWNvbXBvbmVudC50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hcHAvY29tcG9uZW50cy9lZGl0LXJlbW90ZS1lbmRwb2ludC1jb25maWd1cmF0aW9uLXZpZXcvZWRpdC1yZW1vdGUtZW5kcG9pbnQtY29uZmlndXJhdGlvbi12aWV3LWNvbXBvbmVudC50cz81YjUwIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuaW1wb3J0IHsgRWRpdENpdGFibGVDb21wb25lbnRDb250cm9sbGVyIH0gZnJvbSAnLi4vY2l0YWJsZS1lZGl0b3IvY2l0YWJsZS1lZGl0b3ItY29tcG9uZW50JztcbmltcG9ydCB7IFJlbW90ZUVuZHBvaW50Q29uZmlndXJhdGlvbiB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3Byb2plY3Qtc2VydmljZS9yZW1vdGUtZW5kcG9pbnQtY29uZmlndXJhdGlvbic7XG5pbXBvcnQgeyBEYXRhRmFjdG9yeSB9IGZyb20gJy4uLy4uL21vZGVscy9yZGYnO1xuaW1wb3J0ICogYXMgYW5ndWxhciBmcm9tICdhbmd1bGFyJztcbnZhciBFZGl0UmVtb3RlRW5kcG9pbnRDb25maWd1cmF0aW9uVmlld0NvbXBvbmVudENvbnRyb2xsZXIgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhFZGl0UmVtb3RlRW5kcG9pbnRDb25maWd1cmF0aW9uVmlld0NvbXBvbmVudENvbnRyb2xsZXIsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gRWRpdFJlbW90ZUVuZHBvaW50Q29uZmlndXJhdGlvblZpZXdDb21wb25lbnRDb250cm9sbGVyKCRzdGF0ZVBhcmFtcywgZmlicmFTZXJ2aWNlLCBwcm9qZWN0U2VydmljZSwgdG9hc3RyKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsICRzdGF0ZVBhcmFtcy5zb3VyY2VJZCwgcHJvamVjdFNlcnZpY2UsIHRvYXN0cikgfHwgdGhpcztcbiAgICAgICAgaWYgKCRzdGF0ZVBhcmFtcy5pZClcbiAgICAgICAgICAgIHByb2plY3RTZXJ2aWNlLmxvYWRSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb24oX3RoaXMucHJvamVjdFNvdXJjZSwgJHN0YXRlUGFyYW1zLmlkKS50aGVuKGZ1bmN0aW9uIChwcykgeyByZXR1cm4gX3RoaXMuYyA9IHBzOyB9KTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBfdGhpcy5jID0gbmV3IFJlbW90ZUVuZHBvaW50Q29uZmlndXJhdGlvbigpO1xuICAgICAgICAgICAgX3RoaXMuYy5sYWJlbHMgPSBbRGF0YUZhY3RvcnkubGl0ZXJhbCgnJywgZmlicmFTZXJ2aWNlLmdldFN0YXRlKCkubGFuZ3VhZ2UpXTtcbiAgICAgICAgICAgIF90aGlzLmMuZGVzY3JpcHRpb25zID0gW0RhdGFGYWN0b3J5LmxpdGVyYWwoJycsIGZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLmxhbmd1YWdlKV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gRWRpdFJlbW90ZUVuZHBvaW50Q29uZmlndXJhdGlvblZpZXdDb21wb25lbnRDb250cm9sbGVyO1xufShFZGl0Q2l0YWJsZUNvbXBvbmVudENvbnRyb2xsZXIpKTtcbmV4cG9ydCB7IEVkaXRSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb25WaWV3Q29tcG9uZW50Q29udHJvbGxlciB9O1xudmFyIEVkaXRSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb25WaWV3Q29tcG9uZW50ID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBFZGl0UmVtb3RlRW5kcG9pbnRDb25maWd1cmF0aW9uVmlld0NvbXBvbmVudCgpIHtcbiAgICAgICAgdGhpcy5jb250cm9sbGVyID0gRWRpdFJlbW90ZUVuZHBvaW50Q29uZmlndXJhdGlvblZpZXdDb21wb25lbnRDb250cm9sbGVyO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gcmVxdWlyZSgnLi9lZGl0LXJlbW90ZS1lbmRwb2ludC1jb25maWd1cmF0aW9uLXZpZXcucHVnJykoKTtcbiAgICB9XG4gICAgcmV0dXJuIEVkaXRSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb25WaWV3Q29tcG9uZW50O1xufSgpKTtcbmV4cG9ydCB7IEVkaXRSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb25WaWV3Q29tcG9uZW50IH07XG5hbmd1bGFyLm1vZHVsZSgnZmlicmEuY29tcG9uZW50cy5lZGl0LXJlbW90ZS1lbmRwb2ludC1jb25maWd1cmF0aW9uJywgWydmaWJyYS5zZXJ2aWNlcyddKVxuICAgIC5jb21wb25lbnQoJ2VkaXRSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb25WaWV3JywgbmV3IEVkaXRSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb25WaWV3Q29tcG9uZW50KCkpO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGFwcC9jb21wb25lbnRzL2VkaXQtcmVtb3RlLWVuZHBvaW50LWNvbmZpZ3VyYXRpb24tdmlldy9lZGl0LXJlbW90ZS1lbmRwb2ludC1jb25maWd1cmF0aW9uLXZpZXctY29tcG9uZW50LnRzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),

/***/ "./app/components/edit-schema-view/edit-schema-view-component.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__citable_editor_citable_editor_component__ = __webpack_require__(\"./app/components/citable-editor/citable-editor-component.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__services_project_service_schema__ = __webpack_require__(\"./app/services/project-service/schema.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__models_rdf__ = __webpack_require__(\"./app/models/rdf.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_angular__);\n/* unused harmony export EditSchemaViewComponentController */\n/* unused harmony export EditSchemaViewComponent */\n\n\nvar __extends = this && this.__extends || function () {\n    var extendStatics = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (d, b) {\n        d.__proto__ = b;\n    } || function (d, b) {\n        for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() {\n            this.constructor = d;\n        }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n}();\n\n\n\n\nvar EditSchemaViewComponentController = function (_super) {\n    __extends(EditSchemaViewComponentController, _super);\n    function EditSchemaViewComponentController($stateParams, fibraService, projectService, toastr) {\n        var _this = _super.call(this, $stateParams.sourceId, projectService, toastr) || this;\n        if ($stateParams.id) projectService.loadSchema(_this.projectSource, $stateParams.id).then(function (ps) {\n            return _this.c = ps;\n        });else {\n            _this.c = new __WEBPACK_IMPORTED_MODULE_1__services_project_service_schema__[\"a\" /* Schema */]();\n            _this.c.labels = [__WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"b\" /* DataFactory */].literal('', fibraService.getState().language)];\n            _this.c.descriptions = [__WEBPACK_IMPORTED_MODULE_2__models_rdf__[\"b\" /* DataFactory */].literal('', fibraService.getState().language)];\n            _this.c.endpoint = _this.projectSource.sparqlEndpoint;\n        }\n        return _this;\n    }\n    return EditSchemaViewComponentController;\n}(__WEBPACK_IMPORTED_MODULE_0__citable_editor_citable_editor_component__[\"a\" /* EditCitableComponentController */]);\n\nvar EditSchemaViewComponent = function () {\n    function EditSchemaViewComponent() {\n        this.controller = EditSchemaViewComponentController;\n        this.template = __webpack_require__(\"./app/components/edit-schema-view/edit-schema-view.pug\");\n    }\n    return EditSchemaViewComponent;\n}();\n\n__WEBPACK_IMPORTED_MODULE_3_angular__[\"module\"]('fibra.components.edit-schema-view', ['fibra.services']).component('editSchemaView', new EditSchemaViewComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9lZGl0LXNjaGVtYS12aWV3L2VkaXQtc2NoZW1hLXZpZXctY29tcG9uZW50LnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL2FwcC9jb21wb25lbnRzL2VkaXQtc2NoZW1hLXZpZXcvZWRpdC1zY2hlbWEtdmlldy1jb21wb25lbnQudHM/NTI4MiJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbmltcG9ydCB7IEVkaXRDaXRhYmxlQ29tcG9uZW50Q29udHJvbGxlciB9IGZyb20gJy4uL2NpdGFibGUtZWRpdG9yL2NpdGFibGUtZWRpdG9yLWNvbXBvbmVudCc7XG5pbXBvcnQgeyBTY2hlbWEgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9wcm9qZWN0LXNlcnZpY2Uvc2NoZW1hJztcbmltcG9ydCB7IERhdGFGYWN0b3J5IH0gZnJvbSAnLi4vLi4vbW9kZWxzL3JkZic7XG5pbXBvcnQgKiBhcyBhbmd1bGFyIGZyb20gJ2FuZ3VsYXInO1xudmFyIEVkaXRTY2hlbWFWaWV3Q29tcG9uZW50Q29udHJvbGxlciA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEVkaXRTY2hlbWFWaWV3Q29tcG9uZW50Q29udHJvbGxlciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBFZGl0U2NoZW1hVmlld0NvbXBvbmVudENvbnRyb2xsZXIoJHN0YXRlUGFyYW1zLCBmaWJyYVNlcnZpY2UsIHByb2plY3RTZXJ2aWNlLCB0b2FzdHIpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgJHN0YXRlUGFyYW1zLnNvdXJjZUlkLCBwcm9qZWN0U2VydmljZSwgdG9hc3RyKSB8fCB0aGlzO1xuICAgICAgICBpZiAoJHN0YXRlUGFyYW1zLmlkKVxuICAgICAgICAgICAgcHJvamVjdFNlcnZpY2UubG9hZFNjaGVtYShfdGhpcy5wcm9qZWN0U291cmNlLCAkc3RhdGVQYXJhbXMuaWQpLnRoZW4oZnVuY3Rpb24gKHBzKSB7IHJldHVybiBfdGhpcy5jID0gcHM7IH0pO1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIF90aGlzLmMgPSBuZXcgU2NoZW1hKCk7XG4gICAgICAgICAgICBfdGhpcy5jLmxhYmVscyA9IFtEYXRhRmFjdG9yeS5saXRlcmFsKCcnLCBmaWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5sYW5ndWFnZSldO1xuICAgICAgICAgICAgX3RoaXMuYy5kZXNjcmlwdGlvbnMgPSBbRGF0YUZhY3RvcnkubGl0ZXJhbCgnJywgZmlicmFTZXJ2aWNlLmdldFN0YXRlKCkubGFuZ3VhZ2UpXTtcbiAgICAgICAgICAgIF90aGlzLmMuZW5kcG9pbnQgPSBfdGhpcy5wcm9qZWN0U291cmNlLnNwYXJxbEVuZHBvaW50O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIEVkaXRTY2hlbWFWaWV3Q29tcG9uZW50Q29udHJvbGxlcjtcbn0oRWRpdENpdGFibGVDb21wb25lbnRDb250cm9sbGVyKSk7XG5leHBvcnQgeyBFZGl0U2NoZW1hVmlld0NvbXBvbmVudENvbnRyb2xsZXIgfTtcbnZhciBFZGl0U2NoZW1hVmlld0NvbXBvbmVudCA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRWRpdFNjaGVtYVZpZXdDb21wb25lbnQoKSB7XG4gICAgICAgIHRoaXMuY29udHJvbGxlciA9IEVkaXRTY2hlbWFWaWV3Q29tcG9uZW50Q29udHJvbGxlcjtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IHJlcXVpcmUoJy4vZWRpdC1zY2hlbWEtdmlldy5wdWcnKTtcbiAgICB9XG4gICAgcmV0dXJuIEVkaXRTY2hlbWFWaWV3Q29tcG9uZW50O1xufSgpKTtcbmV4cG9ydCB7IEVkaXRTY2hlbWFWaWV3Q29tcG9uZW50IH07XG5hbmd1bGFyLm1vZHVsZSgnZmlicmEuY29tcG9uZW50cy5lZGl0LXNjaGVtYS12aWV3JywgWydmaWJyYS5zZXJ2aWNlcyddKVxuICAgIC5jb21wb25lbnQoJ2VkaXRTY2hlbWFWaWV3JywgbmV3IEVkaXRTY2hlbWFWaWV3Q29tcG9uZW50KCkpO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGFwcC9jb21wb25lbnRzL2VkaXQtc2NoZW1hLXZpZXcvZWRpdC1zY2hlbWEtdmlldy1jb21wb25lbnQudHMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),

/***/ "./app/components/upload/upload-component.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_d3__ = __webpack_require__(\"./app/bower_components/d3/d3.js\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_d3___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_d3__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__services_sparql_item_service__ = __webpack_require__(\"./app/services/sparql-item-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__models_rdf__ = __webpack_require__(\"./app/models/rdf.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__actions_types__ = __webpack_require__(\"./app/actions/types.ts\");\n/* unused harmony export UploadComponentController */\n/* unused harmony export UploadComponent */\n\n\n\n\n\n\n\nvar UploadComponentController = function () {\n    function UploadComponentController(fibraService, $ngRedux, $q, $scope) {\n        this.fibraService = fibraService;\n        this.$ngRedux = $ngRedux;\n        this.$q = $q;\n        this.$scope = $scope;\n        this.classSelect = null;\n        this.unsubscribe = $ngRedux.connect(this.mapStateToThis, __WEBPACK_IMPORTED_MODULE_4__actions_types__)(this);\n        this.fibraService = fibraService;\n        $scope.registerFile = this.registerFile.bind(this);\n    }\n    UploadComponentController.prototype.mapStateToThis = function (state) {\n        return {\n            types: state.types\n        };\n    };\n    UploadComponentController.prototype.registerFile = function (file) {\n        this.fileInput = file;\n    };\n    UploadComponentController.prototype.uploadFile = function () {\n        var _this = this;\n        console.log(this.fileInput, this.types.types.filter(function (t) {\n            return t.id === _this.classSelect;\n        })[0]);\n        var selectedClass = this.types.types.filter(function (t) {\n            return t.id === _this.classSelect;\n        })[0];\n        // Notes: column headers we should handle\n        //  - 'FibraId' - this will be the matching Fibra identifier. In this case we should not createItem\n        //              but rather update an existing item if necessary\n        //  - SKOS.prefLabel.value - Will be the label to use\n        //  - 'Match' - will be the Recon matched value and should go to OWL.sameAs property\n        //  - 'Notes' - will do onto a notes property?\n        // Just uses the first column of the file as labels\n        var reader = new FileReader();\n        reader.onload = function () {\n            var parsedCSV = __WEBPACK_IMPORTED_MODULE_1_d3__[\"csvParse\"](reader.result);\n            var newRows = parsedCSV.filter(function (row) {\n                return !row['FibraId']; // Not an update\n            });\n            var labelColumnKey = parsedCSV.columns[0];\n            console.log(parsedCSV, labelColumnKey);\n            var proms = [newRows.length > 0 ? _this.fibraService.dispatchAction(_this.fibraService.createItems(newRows.map(function (row) {\n                var node = __WEBPACK_IMPORTED_MODULE_3__models_rdf__[\"b\" /* DataFactory */].instance.namedNode(row[labelColumnKey]);\n                return node;\n            }), selectedClass.id)) : _this.$q.resolve(_this.fibraService.getState()), _this.$q.all(parsedCSV.filter(function (row) {\n                return !!row['FibraId'];\n            }).map(function (row) {\n                if (row['Match'] && !row[__WEBPACK_IMPORTED_MODULE_3__models_rdf__[\"d\" /* OWL */].sameAs.value]) {\n                    row[__WEBPACK_IMPORTED_MODULE_3__models_rdf__[\"d\" /* OWL */].sameAs.value] = row['Match'];\n                    delete row['Match'];\n                }\n                var entries = __WEBPACK_IMPORTED_MODULE_1_d3__[\"entries\"](row);\n                var props = entries.filter(function (entry) {\n                    return entry.key !== 'FibraId' && entry.value && entry.key !== __WEBPACK_IMPORTED_MODULE_3__models_rdf__[\"d\" /* OWL */].sameAs.value && entry.key !== 'Notes' && entry.key !== 'Match';\n                }).map(function (entry) {\n                    return new __WEBPACK_IMPORTED_MODULE_2__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_3__models_rdf__[\"b\" /* DataFactory */].instance.namedNode(entry.key), entry.value.indexOf('http://') === 0 ? __WEBPACK_IMPORTED_MODULE_3__models_rdf__[\"b\" /* DataFactory */].instance.namedNode(entry.value) : __WEBPACK_IMPORTED_MODULE_3__models_rdf__[\"b\" /* DataFactory */].instance.literal(entry.value));\n                });\n                // Handle OWL.sameAs\n                entries.filter(function (entry) {\n                    return entry.key === __WEBPACK_IMPORTED_MODULE_3__models_rdf__[\"d\" /* OWL */].sameAs.value && entry.value;\n                }).forEach(function (entry) {\n                    return props.push(new __WEBPACK_IMPORTED_MODULE_2__services_sparql_item_service__[\"a\" /* PropertyAndValue */](__WEBPACK_IMPORTED_MODULE_3__models_rdf__[\"d\" /* OWL */].sameAs, __WEBPACK_IMPORTED_MODULE_3__models_rdf__[\"b\" /* DataFactory */].instance.namedNode(entry.value)));\n                });\n                return _this.fibraService.dispatchAction(_this.fibraService.itemProperty(new __WEBPACK_IMPORTED_MODULE_3__models_rdf__[\"i\" /* NamedNode */](row['FibraId']), props));\n            })).then(function (states) {\n                return states[states.length - 1];\n            })];\n            _this.$q.all(proms).then(function () {\n                _this.fibraService.dispatch('change');\n            });\n        };\n        reader.readAsText(this.fileInput.files[0]);\n        // We need to clear the input so that we pick up future uploads. This is *not*\n        // cross-browser-compatible.\n        this.fileInput.value = null;\n        this.onUpload();\n    };\n    return UploadComponentController;\n}();\n\nvar UploadComponent = function () {\n    function UploadComponent() {\n        this.controller = UploadComponentController; // (new (...args: any[]) => angular.IController) = SelectViewComponentController\n        this.template = __webpack_require__(\"./app/components/upload/upload.pug\")();\n        this.bindings = {\n            onUpload: '&'\n        };\n    }\n    return UploadComponent;\n}();\n\n__WEBPACK_IMPORTED_MODULE_0_angular__[\"module\"]('fibra.components.upload', []).component('upload', new UploadComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy91cGxvYWQvdXBsb2FkLWNvbXBvbmVudC50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hcHAvY29tcG9uZW50cy91cGxvYWQvdXBsb2FkLWNvbXBvbmVudC50cz8xMTE4Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmltcG9ydCAqIGFzIGFuZ3VsYXIgZnJvbSAnYW5ndWxhcic7XG5pbXBvcnQgKiBhcyBkMyBmcm9tICdkMyc7XG5pbXBvcnQgeyBQcm9wZXJ0eUFuZFZhbHVlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvc3BhcnFsLWl0ZW0tc2VydmljZSc7XG5pbXBvcnQgeyBEYXRhRmFjdG9yeSwgT1dMLCBOYW1lZE5vZGUgfSBmcm9tICcuLi8uLi9tb2RlbHMvcmRmJztcbmltcG9ydCAqIGFzIFR5cGVBY3Rpb25zIGZyb20gJy4uLy4uL2FjdGlvbnMvdHlwZXMnO1xudmFyIFVwbG9hZENvbXBvbmVudENvbnRyb2xsZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFVwbG9hZENvbXBvbmVudENvbnRyb2xsZXIoZmlicmFTZXJ2aWNlLCAkbmdSZWR1eCwgJHEsICRzY29wZSkge1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZSA9IGZpYnJhU2VydmljZTtcbiAgICAgICAgdGhpcy4kbmdSZWR1eCA9ICRuZ1JlZHV4O1xuICAgICAgICB0aGlzLiRxID0gJHE7XG4gICAgICAgIHRoaXMuJHNjb3BlID0gJHNjb3BlO1xuICAgICAgICB0aGlzLmNsYXNzU2VsZWN0ID0gbnVsbDtcbiAgICAgICAgdGhpcy51bnN1YnNjcmliZSA9ICRuZ1JlZHV4LmNvbm5lY3QodGhpcy5tYXBTdGF0ZVRvVGhpcywgVHlwZUFjdGlvbnMpKHRoaXMpO1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZSA9IGZpYnJhU2VydmljZTtcbiAgICAgICAgJHNjb3BlLnJlZ2lzdGVyRmlsZSA9IHRoaXMucmVnaXN0ZXJGaWxlLmJpbmQodGhpcyk7XG4gICAgfVxuICAgIFVwbG9hZENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLm1hcFN0YXRlVG9UaGlzID0gZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlczogc3RhdGUudHlwZXNcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIFVwbG9hZENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLnJlZ2lzdGVyRmlsZSA9IGZ1bmN0aW9uIChmaWxlKSB7XG4gICAgICAgIHRoaXMuZmlsZUlucHV0ID0gZmlsZTtcbiAgICB9O1xuICAgIFVwbG9hZENvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLnVwbG9hZEZpbGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuZmlsZUlucHV0LCB0aGlzLnR5cGVzLnR5cGVzLmZpbHRlcihmdW5jdGlvbiAodCkgeyByZXR1cm4gdC5pZCA9PT0gX3RoaXMuY2xhc3NTZWxlY3Q7IH0pWzBdKTtcbiAgICAgICAgdmFyIHNlbGVjdGVkQ2xhc3MgPSB0aGlzLnR5cGVzLnR5cGVzLmZpbHRlcihmdW5jdGlvbiAodCkgeyByZXR1cm4gdC5pZCA9PT0gX3RoaXMuY2xhc3NTZWxlY3Q7IH0pWzBdO1xuICAgICAgICAvLyBOb3RlczogY29sdW1uIGhlYWRlcnMgd2Ugc2hvdWxkIGhhbmRsZVxuICAgICAgICAvLyAgLSAnRmlicmFJZCcgLSB0aGlzIHdpbGwgYmUgdGhlIG1hdGNoaW5nIEZpYnJhIGlkZW50aWZpZXIuIEluIHRoaXMgY2FzZSB3ZSBzaG91bGQgbm90IGNyZWF0ZUl0ZW1cbiAgICAgICAgLy8gICAgICAgICAgICAgIGJ1dCByYXRoZXIgdXBkYXRlIGFuIGV4aXN0aW5nIGl0ZW0gaWYgbmVjZXNzYXJ5XG4gICAgICAgIC8vICAtIFNLT1MucHJlZkxhYmVsLnZhbHVlIC0gV2lsbCBiZSB0aGUgbGFiZWwgdG8gdXNlXG4gICAgICAgIC8vICAtICdNYXRjaCcgLSB3aWxsIGJlIHRoZSBSZWNvbiBtYXRjaGVkIHZhbHVlIGFuZCBzaG91bGQgZ28gdG8gT1dMLnNhbWVBcyBwcm9wZXJ0eVxuICAgICAgICAvLyAgLSAnTm90ZXMnIC0gd2lsbCBkbyBvbnRvIGEgbm90ZXMgcHJvcGVydHk/XG4gICAgICAgIC8vIEp1c3QgdXNlcyB0aGUgZmlyc3QgY29sdW1uIG9mIHRoZSBmaWxlIGFzIGxhYmVsc1xuICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBwYXJzZWRDU1YgPSBkMy5jc3ZQYXJzZShyZWFkZXIucmVzdWx0KTtcbiAgICAgICAgICAgIHZhciBuZXdSb3dzID0gcGFyc2VkQ1NWLmZpbHRlcihmdW5jdGlvbiAocm93KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICFyb3dbJ0ZpYnJhSWQnXTsgLy8gTm90IGFuIHVwZGF0ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgbGFiZWxDb2x1bW5LZXkgPSBwYXJzZWRDU1YuY29sdW1uc1swXTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHBhcnNlZENTViwgbGFiZWxDb2x1bW5LZXkpO1xuICAgICAgICAgICAgdmFyIHByb21zID0gW1xuICAgICAgICAgICAgICAgIG5ld1Jvd3MubGVuZ3RoID4gMCA/IF90aGlzLmZpYnJhU2VydmljZS5kaXNwYXRjaEFjdGlvbihfdGhpcy5maWJyYVNlcnZpY2UuY3JlYXRlSXRlbXMobmV3Um93cy5tYXAoZnVuY3Rpb24gKHJvdykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IERhdGFGYWN0b3J5Lmluc3RhbmNlLm5hbWVkTm9kZShyb3dbbGFiZWxDb2x1bW5LZXldKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vZGU7XG4gICAgICAgICAgICAgICAgfSksIHNlbGVjdGVkQ2xhc3MuaWQpKSA6IF90aGlzLiRxLnJlc29sdmUoX3RoaXMuZmlicmFTZXJ2aWNlLmdldFN0YXRlKCkpLFxuICAgICAgICAgICAgICAgIF90aGlzLiRxLmFsbChwYXJzZWRDU1YuZmlsdGVyKGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEhcm93WydGaWJyYUlkJ107XG4gICAgICAgICAgICAgICAgfSkubWFwKGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJvd1snTWF0Y2gnXSAmJiAhcm93W09XTC5zYW1lQXMudmFsdWVdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByb3dbT1dMLnNhbWVBcy52YWx1ZV0gPSByb3dbJ01hdGNoJ107XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgcm93WydNYXRjaCddO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbnRyaWVzID0gZDMuZW50cmllcyhyb3cpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcHJvcHMgPSBlbnRyaWVzXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChlbnRyeSkgeyByZXR1cm4gZW50cnkua2V5ICE9PSAnRmlicmFJZCdcbiAgICAgICAgICAgICAgICAgICAgICAgICYmIGVudHJ5LnZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgICAmJiBlbnRyeS5rZXkgIT09IE9XTC5zYW1lQXMudmFsdWVcbiAgICAgICAgICAgICAgICAgICAgICAgICYmIGVudHJ5LmtleSAhPT0gJ05vdGVzJ1xuICAgICAgICAgICAgICAgICAgICAgICAgJiYgZW50cnkua2V5ICE9PSAnTWF0Y2gnOyB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoZW50cnkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvcGVydHlBbmRWYWx1ZShEYXRhRmFjdG9yeS5pbnN0YW5jZS5uYW1lZE5vZGUoZW50cnkua2V5KSwgZW50cnkudmFsdWUuaW5kZXhPZignaHR0cDovLycpID09PSAwID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRhRmFjdG9yeS5pbnN0YW5jZS5uYW1lZE5vZGUoZW50cnkudmFsdWUpIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRhRmFjdG9yeS5pbnN0YW5jZS5saXRlcmFsKGVudHJ5LnZhbHVlKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgT1dMLnNhbWVBc1xuICAgICAgICAgICAgICAgICAgICBlbnRyaWVzXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChlbnRyeSkgeyByZXR1cm4gZW50cnkua2V5ID09PSBPV0wuc2FtZUFzLnZhbHVlICYmIGVudHJ5LnZhbHVlOyB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZvckVhY2goZnVuY3Rpb24gKGVudHJ5KSB7IHJldHVybiBwcm9wcy5wdXNoKG5ldyBQcm9wZXJ0eUFuZFZhbHVlKE9XTC5zYW1lQXMsIERhdGFGYWN0b3J5Lmluc3RhbmNlLm5hbWVkTm9kZShlbnRyeS52YWx1ZSkpKTsgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5maWJyYVNlcnZpY2UuZGlzcGF0Y2hBY3Rpb24oX3RoaXMuZmlicmFTZXJ2aWNlLml0ZW1Qcm9wZXJ0eShuZXcgTmFtZWROb2RlKHJvd1snRmlicmFJZCddKSwgcHJvcHMpKTtcbiAgICAgICAgICAgICAgICB9KSkudGhlbihmdW5jdGlvbiAoc3RhdGVzKSB7IHJldHVybiBzdGF0ZXNbc3RhdGVzLmxlbmd0aCAtIDFdOyB9KVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIF90aGlzLiRxLmFsbChwcm9tcykudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuZmlicmFTZXJ2aWNlLmRpc3BhdGNoKCdjaGFuZ2UnKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICByZWFkZXIucmVhZEFzVGV4dCh0aGlzLmZpbGVJbnB1dC5maWxlc1swXSk7XG4gICAgICAgIC8vIFdlIG5lZWQgdG8gY2xlYXIgdGhlIGlucHV0IHNvIHRoYXQgd2UgcGljayB1cCBmdXR1cmUgdXBsb2Fkcy4gVGhpcyBpcyAqbm90KlxuICAgICAgICAvLyBjcm9zcy1icm93c2VyLWNvbXBhdGlibGUuXG4gICAgICAgIHRoaXMuZmlsZUlucHV0LnZhbHVlID0gbnVsbDtcbiAgICAgICAgdGhpcy5vblVwbG9hZCgpO1xuICAgIH07XG4gICAgcmV0dXJuIFVwbG9hZENvbXBvbmVudENvbnRyb2xsZXI7XG59KCkpO1xuZXhwb3J0IHsgVXBsb2FkQ29tcG9uZW50Q29udHJvbGxlciB9O1xudmFyIFVwbG9hZENvbXBvbmVudCA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gVXBsb2FkQ29tcG9uZW50KCkge1xuICAgICAgICB0aGlzLmNvbnRyb2xsZXIgPSBVcGxvYWRDb21wb25lbnRDb250cm9sbGVyOyAvLyAobmV3ICguLi5hcmdzOiBhbnlbXSkgPT4gYW5ndWxhci5JQ29udHJvbGxlcikgPSBTZWxlY3RWaWV3Q29tcG9uZW50Q29udHJvbGxlclxuICAgICAgICB0aGlzLnRlbXBsYXRlID0gcmVxdWlyZSgnLi91cGxvYWQucHVnJykoKTtcbiAgICAgICAgdGhpcy5iaW5kaW5ncyA9IHtcbiAgICAgICAgICAgIG9uVXBsb2FkOiAnJidcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIFVwbG9hZENvbXBvbmVudDtcbn0oKSk7XG5leHBvcnQgeyBVcGxvYWRDb21wb25lbnQgfTtcbmFuZ3VsYXIubW9kdWxlKCdmaWJyYS5jb21wb25lbnRzLnVwbG9hZCcsIFtdKVxuICAgIC5jb21wb25lbnQoJ3VwbG9hZCcsIG5ldyBVcGxvYWRDb21wb25lbnQoKSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL2NvbXBvbmVudHMvdXBsb2FkL3VwbG9hZC1jb21wb25lbnQudHMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUVBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),

/***/ "./app/filters/citable-filter.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__preferred_language_filter__ = __webpack_require__(\"./app/filters/preferred-language-filter.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_angular__);\n\n\n\n\n__WEBPACK_IMPORTED_MODULE_1_angular__[\"module\"]('fibra.filters.citable', []).filter('citable', function (fibraService) {\n    return function (obj) {\n        var prefLang = fibraService.getState().language;\n        var ret = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0__preferred_language_filter__[\"a\" /* getPrefLangString */])(obj.labels, prefLang);\n        if (obj.rightsHolders.length > 0) {\n            ret += ' (';\n            obj.rightsHolders.forEach(function (rh) {\n                return ret += __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0__preferred_language_filter__[\"a\" /* getPrefLangString */])(rh.labels, prefLang) + ', ';\n            });\n            ret = ret.substring(0, ret.length - 2) + ')';\n        }\n        return ret;\n    };\n});//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvZmlsdGVycy9jaXRhYmxlLWZpbHRlci50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hcHAvZmlsdGVycy9jaXRhYmxlLWZpbHRlci50cz8zMzA1Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmltcG9ydCB7IGdldFByZWZMYW5nU3RyaW5nIH0gZnJvbSAnLi9wcmVmZXJyZWQtbGFuZ3VhZ2UtZmlsdGVyJztcbmltcG9ydCAqIGFzIGFuZ3VsYXIgZnJvbSAnYW5ndWxhcic7XG5hbmd1bGFyLm1vZHVsZSgnZmlicmEuZmlsdGVycy5jaXRhYmxlJywgW10pXG4gICAgLmZpbHRlcignY2l0YWJsZScsIGZ1bmN0aW9uIChmaWJyYVNlcnZpY2UpIHsgcmV0dXJuIGZ1bmN0aW9uIChvYmopIHtcbiAgICB2YXIgcHJlZkxhbmcgPSBmaWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5sYW5ndWFnZTtcbiAgICB2YXIgcmV0ID0gZ2V0UHJlZkxhbmdTdHJpbmcob2JqLmxhYmVscywgcHJlZkxhbmcpO1xuICAgIGlmIChvYmoucmlnaHRzSG9sZGVycy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJldCArPSAnICgnO1xuICAgICAgICBvYmoucmlnaHRzSG9sZGVycy5mb3JFYWNoKGZ1bmN0aW9uIChyaCkgeyByZXR1cm4gcmV0ICs9IGdldFByZWZMYW5nU3RyaW5nKHJoLmxhYmVscywgcHJlZkxhbmcpICsgJywgJzsgfSk7XG4gICAgICAgIHJldCA9IHJldC5zdWJzdHJpbmcoMCwgcmV0Lmxlbmd0aCAtIDIpICsgJyknO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufTsgfSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL2ZpbHRlcnMvY2l0YWJsZS1maWx0ZXIudHMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),

/***/ "./app/filters/preferred-language-filter.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_angular__);\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = getPrefLangString;\n\n\n\nfunction getPrefLangString(literals, prefLang) {\n    var dl = null;\n    var al = null;\n    var cl = literals.find(function (l) {\n        if (l.language === '') dl = l.value;else al = l.value;\n        return l.language === prefLang;\n    });\n    if (cl) return cl.value;\n    if (dl) return dl;\n    return al;\n}\n__WEBPACK_IMPORTED_MODULE_0_angular__[\"module\"]('fibra.filters.pref-lang', []).filter('prefLang', function (fibraService) {\n    return function (literals) {\n        return getPrefLangString(literals, fibraService.getState().language);\n    };\n});//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvZmlsdGVycy9wcmVmZXJyZWQtbGFuZ3VhZ2UtZmlsdGVyLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL2FwcC9maWx0ZXJzL3ByZWZlcnJlZC1sYW5ndWFnZS1maWx0ZXIudHM/YTExZCJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5pbXBvcnQgKiBhcyBhbmd1bGFyIGZyb20gJ2FuZ3VsYXInO1xuZXhwb3J0IGZ1bmN0aW9uIGdldFByZWZMYW5nU3RyaW5nKGxpdGVyYWxzLCBwcmVmTGFuZykge1xuICAgIHZhciBkbCA9IG51bGw7XG4gICAgdmFyIGFsID0gbnVsbDtcbiAgICB2YXIgY2wgPSBsaXRlcmFscy5maW5kKGZ1bmN0aW9uIChsKSB7XG4gICAgICAgIGlmIChsLmxhbmd1YWdlID09PSAnJylcbiAgICAgICAgICAgIGRsID0gbC52YWx1ZTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgYWwgPSBsLnZhbHVlO1xuICAgICAgICByZXR1cm4gbC5sYW5ndWFnZSA9PT0gcHJlZkxhbmc7XG4gICAgfSk7XG4gICAgaWYgKGNsKVxuICAgICAgICByZXR1cm4gY2wudmFsdWU7XG4gICAgaWYgKGRsKVxuICAgICAgICByZXR1cm4gZGw7XG4gICAgcmV0dXJuIGFsO1xufVxuYW5ndWxhci5tb2R1bGUoJ2ZpYnJhLmZpbHRlcnMucHJlZi1sYW5nJywgW10pXG4gICAgLmZpbHRlcigncHJlZkxhbmcnLCBmdW5jdGlvbiAoZmlicmFTZXJ2aWNlKSB7IHJldHVybiBmdW5jdGlvbiAobGl0ZXJhbHMpIHtcbiAgICByZXR1cm4gZ2V0UHJlZkxhbmdTdHJpbmcobGl0ZXJhbHMsIGZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLmxhbmd1YWdlKTtcbn07IH0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGFwcC9maWx0ZXJzL3ByZWZlcnJlZC1sYW5ndWFnZS1maWx0ZXIudHMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),

/***/ "./app/services/fibra-service.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__worker_service_worker_service__ = __webpack_require__(\"./app/services/worker-service/worker-service.ts\");\n/* unused harmony export CommonState */\n/* unused harmony export ConstructState */\n/* unused harmony export UIState */\n/* unused harmony export FibraService */\n\n\nvar __extends = this && this.__extends || function () {\n    var extendStatics = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (d, b) {\n        d.__proto__ = b;\n    } || function (d, b) {\n        for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() {\n            this.constructor = d;\n        }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n}();\n\n\nvar CommonState = function () {\n    function CommonState(project, language) {\n        if (project === void 0) {\n            project = null;\n        }\n        if (language === void 0) {\n            language = 'en';\n        }\n        this.project = project;\n        this.language = language;\n    }\n    return CommonState;\n}();\n\nvar ConstructState = function () {\n    function ConstructState() {\n        this.types = [];\n        this.userTypes = [];\n        this.displayTypes = [];\n        this.items = [];\n        this.itemIndex = {};\n        this.localItems = [];\n    }\n    return ConstructState;\n}();\n\nvar UIState = function (_super) {\n    __extends(UIState, _super);\n    function UIState() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.construct = new ConstructState();\n        _this.actionsRunning = 0;\n        return _this;\n    }\n    UIState.prototype.toCommonState = function () {\n        return new CommonState(this.project, this.language);\n    };\n    return UIState;\n}(CommonState);\n\nvar PLACEHOLDER = 'PLACEHOLDER';\n// const CREATE_TYPE: string = 'CREATE_TYPE'\n// const CREATE_ITEMS: string = 'CREATE_ITEMS'\n// const CREATE_DISPLAY_ITEMS: string = 'CREATE_DISPLAY_ITEMS'\n// const DELETE_ITEMS: string = 'DELETE_ITEMS'\n// const CLEAR_TYPES: string = 'CLEAR_TYPES'\n// const DISPLAY_ITEMS: string = 'DISPLAY_ITEMS'\n// const HIDE_ITEM: string = 'HIDE_ITEM'\n// const CREATE_LOCAL_ITEM: string = 'CREATE_LOCAL_ITEM'\n// const ITEM_PROPERTIES: string = 'ITEM_PROPERTIES'\n// const SET_ORDERED_TYPES: string = 'SET_ORDERED_TYPES'\nvar SET_LANGUAGE = 'SET_LANGUAGE';\nvar SET_PROJECT = 'SET_PROJECT';\nvar INITIAL_STATE = new UIState();\nvar DEFAULT_ACTION = { type: '', payload: null };\nvar FibraService = function () {\n    function FibraService($q, workerService, sparqlItemService, sparqlTreeService) {\n        this.$q = $q;\n        this.workerService = workerService;\n        this.sparqlItemService = sparqlItemService;\n        this.sparqlTreeService = sparqlTreeService;\n        // Event model - Based on d3.event\n        this.callbacks = {};\n        this.createState();\n    }\n    // Returns a function that can be called to remove the callback\n    FibraService.prototype.on = function (evnt, callback) {\n        var _this = this;\n        if (this.callbacks[evnt] === undefined) this.callbacks[evnt] = Array();\n        this.callbacks[evnt].push(callback);\n        return function () {\n            if (_this.callbacks[evnt].indexOf(callback) !== -1) _this.callbacks[evnt].splice(_this.callbacks[evnt].indexOf(callback), 1);\n        };\n    };\n    FibraService.prototype.dispatch = function (evnt) {\n        if (this.callbacks[evnt] === undefined) this.callbacks[evnt] = Array();\n        var proms = this.callbacks[evnt].map(function (cb) {\n            return cb();\n        });\n        return this.$q.all(proms);\n    };\n    FibraService.prototype.createState = function () {\n        this.state = INITIAL_STATE;\n        if (!this.store) {\n            this.createStore();\n        }\n    };\n    FibraService.prototype.createStore = function () {\n        this.store = [this.state];\n    };\n    // Action creators\n    FibraService.prototype.placeHolderAction = function (prom) {\n        return {\n            type: PLACEHOLDER,\n            payload: prom\n        };\n    };\n    FibraService.prototype.setLanguage = function (language) {\n        return { type: SET_LANGUAGE, payload: language };\n    };\n    FibraService.prototype.setProject = function (project) {\n        return { type: SET_PROJECT, payload: project };\n    };\n    // public createLocalItem(item: ITerm): Action {\n    //   return {\n    //     type: CREATE_LOCAL_ITEM,\n    //     payload: item\n    //   }\n    // }\n    // public displayItem(item: ITerm, coordinates?: [number]): Action {\n    //   return {\n    //     type: DISPLAY_ITEMS,\n    //     payload: {\n    //       items: [item],\n    //       coordinates: [coordinates]\n    //     }\n    //   }\n    // }\n    // public displayItems(items: ITerm[], coordinates?: [number][]): Action {\n    //   return {\n    //     type: DISPLAY_ITEMS,\n    //     payload: {\n    //       items: items,\n    //       coordinates: coordinates\n    //     }\n    //   }\n    // }\n    // public hideItem(item: ITerm): Action {\n    //   return {\n    //     type: HIDE_ITEM,\n    //     payload: item\n    //   }\n    // }\n    // public itemProperty(item: INode, propertiesToAdd: IPropertyAndValue[], propertiesToRemove?: IPropertyAndValue[]) {\n    //   return {\n    //     type: ITEM_PROPERTIES,\n    //     payload: {\n    //       item: item,\n    //       propertiesToAdd: propertiesToAdd,\n    //       propertiesToRemove: propertiesToRemove\n    //     }\n    //   }\n    // }\n    // public createItem(item?: INode, typ?: string):Action {\n    //   return {\n    //     type: CREATE_ITEMS,\n    //     payload: {\n    //       items: [item],\n    //       type: typ\n    //     }\n    //   }\n    // }\n    // public createItems(items: INode[], typ?: string): Action {\n    //   return {\n    //     type: CREATE_ITEMS,\n    //     payload: {\n    //       items: items,\n    //       type: typ\n    //     }\n    //   }\n    // }\n    // public createDisplayItem(item?: INode, typ?: string): Action {\n    //   return {\n    //     type: CREATE_DISPLAY_ITEMS,\n    //     payload: {\n    //       items: [item],\n    //       type: typ\n    //     }\n    //   }\n    // }\n    // public createDisplayItems(items: INode[], typ?: string): Action {\n    //   return {\n    //     type: CREATE_DISPLAY_ITEMS,\n    //     payload: {\n    //       items: items,\n    //       type: typ\n    //     }\n    //   }\n    // }\n    // public deleteItem(item: INode): Action {\n    //   return {\n    //     type: DELETE_ITEMS,\n    //     payload: [item]\n    //   }\n    // }\n    // public clearTypes(): Action {\n    //   return {\n    //     type: CLEAR_TYPES,\n    //     payload: undefined\n    //   }\n    // }\n    // public setOrderedTypes(types: TreeNode[]): Action {\n    //   return {\n    //     type: SET_ORDERED_TYPES,\n    //     payload: types\n    //   }\n    // }\n    // public createType(label: string): Action {\n    //   return {\n    //     type: CREATE_TYPE,\n    //     payload: label\n    //   }\n    // }\n    // Reducers\n    FibraService.prototype.itemReducer = function (state, action) {\n        if (state === void 0) {\n            state = INITIAL_STATE;\n        }\n        if (action === void 0) {\n            action = DEFAULT_ACTION;\n        }\n        switch (action.type) {\n            // case DISPLAY_ITEMS:\n            //   action.payload.items.forEach((item, i) => {\n            //     if(!state.construct.itemIndex[item.value]) {\n            //       state.construct.items.push(item)\n            //       state.construct.itemIndex[item.value] = item\n            //       // If coordinates are provided, apply them\n            //       if(action.payload.coordinates && action.payload.coordinates[i] && action.payload.coordinates[i][0] && action.payload.coordinates[i][1]) {\n            //         state.construct.itemIndex[item.value].x = action.payload.coordinates[i][0]\n            //         state.construct.itemIndex[item.value].y = action.payload.coordinates[i][1]\n            //       }\n            //     }\n            //   })\n            //   this.dispatch('change')\n            //   return this.$q.resolve(state)\n            // case HIDE_ITEM:\n            //   let it = state.construct.itemIndex[action.payload.value]\n            //   if(it) {\n            //     state.construct.items.splice(state.construct.items.indexOf(it), 1)\n            //     delete state.construct.itemIndex[action.payload.value]\n            //   }\n            //   this.dispatch('change')\n            //   return this.$q.resolve(state)\n            // case CREATE_LOCAL_ITEM:\n            //   let item: IGridNode = action.payload\n            //   state.construct.localItems.push(item)\n            //   return this.$q.resolve(state)\n            // case CREATE_ITEMS:\n            //   return this.createItemsInternal(action, state).then((nodes) => {\n            //     return state\n            //   })\n            // case CREATE_DISPLAY_ITEMS:\n            //   return this.createItemsInternal(action, state).then((nodes) => {\n            //     return this.dispatchAction(this.displayItems(nodes))\n            //   })\n            // case DELETE_ITEMS:\n            //   return this.$q.all(action.payload.map((item: INode) => {\n            //     return this.sparqlItemService.deleteItem(item)\n            //   })).then(() => {\n            //     this.dispatch('change')\n            //     return this.state\n            //   })\n            // case ITEM_PROPERTIES:\n            //   return this.sparqlItemService.alterItem(action.payload.item, action.payload.propertiesToAdd, action.payload.propertiesToRemove).then((str) => {\n            //     return this.state\n            //   })\n            default:\n                return this.$q.resolve(state);\n        }\n    };\n    FibraService.prototype.sessionReducer = function (state, action) {\n        if (state === void 0) {\n            state = INITIAL_STATE;\n        }\n        if (action === void 0) {\n            action = DEFAULT_ACTION;\n        }\n        switch (action.type) {\n            case SET_LANGUAGE:\n                state.language = action.payload;\n                return this.$q.resolve(state);\n            case SET_PROJECT:\n                state.project = action.payload;\n                return this.$q.resolve(state);\n            default:\n                return this.$q.resolve(state);\n        }\n    };\n    FibraService.prototype.constructReducer = function (state, action) {\n        if (state === void 0) {\n            state = INITIAL_STATE;\n        }\n        if (action === void 0) {\n            action = DEFAULT_ACTION;\n        }\n        switch (action.type) {\n            case PLACEHOLDER:\n                return action.payload.then(function () {\n                    return state;\n                });\n            // case CLEAR_TYPES:\n            //   state.construct.types = []\n            //   return this.$q.resolve(state)\n            // case SET_ORDERED_TYPES:\n            //   state.construct.displayTypes = action.payload\n            //   return this.$q.resolve(state)\n            // case CREATE_TYPE:\n            //   return this.sparqlItemService.createNewItem([new PropertyAndValue(SKOS.prefLabel, DataFactory.instance.literal(action.payload)), new PropertyAndValue(RDF.type, OWL.Class)]).then((node) => {\n            //     let tn: TreeNode = new TreeNode(node.value, action.payload)\n            //     this.state.construct.userTypes.push(tn)\n            //     return this.state\n            //   })\n            default:\n                return this.$q.resolve(state);\n        }\n    };\n    // private createItemsInternal(action, state): angular.IPromise<INode[]> {\n    //   let items: Item[] = action.payload.items\n    //   let typeNode: INamedNode = action.payload.type ? DataFactory.instance.namedNode(action.payload.type) : OWL.Thing\n    //   if (items[0]) {\n    //     let proms = items.map((node) => {\n    //       if (node.value) {\n    //         return this.sparqlItemService.createNewItem([new PropertyAndValue(SKOS.prefLabel, DataFactory.instance.literal(node.value)), new PropertyAndValue(RDF.type, typeNode)])\n    //       } else {\n    //         return this.sparqlItemService.createNewItem([new PropertyAndValue(RDF.type, typeNode)])\n    //       }\n    //       // return this.sparqlItemService.getItem(node).then((item) => {\n    //       //   let prefLabelProp = item.localProperties.concat(item.remoteProperties).filter((pr) => {\n    //       //     return pr.value === 'http://www.w3.org/2004/02/skos/core#prefLabel'\n    //       //   })\n    //       //   let type: PropertyToValues<INode> = new PropertyToValues(RDF.type)\n    //       //   let typeProp = item.localProperties.concat(item.remoteProperties).filter((pr) => {\n    //       //     return pr.value === 'http://www.w3.org/1999/02/22-rdf-syntax-ns#type'\n    //       //   })\n    //       //   if(typeProp[0]) {\n    //       //     let typeWithLabel: INodePlusLabel = new SourcedNodePlusLabel(typeProp[0])\n    //       //     type.values.push(typeWithLabel)\n    //       //   }\n    //       //   return this.sparqlItemService.createNewItem([item], [type, prefLabelProp[0]])\n    //       // }).then((node) => {\n    //       //   // Display the item\n    //       //   return this.dispatchAction(this.displayItem(node))\n    //       // })\n    //     })\n    //     return this.$q.all(proms)\n    //   } else {\n    //     return this.sparqlItemService.createNewItem([new PropertyAndValue(RDF.type, typeNode), new PropertyAndValue(SKOS.prefLabel, DataFactory.instance.literal(''))]).then((node) => {\n    //       return [node]\n    //     })\n    //   }\n    // }\n    // Public API\n    FibraService.prototype.dispatchAction = function (action) {\n        var _this = this;\n        this.state.actionsRunning = this.state.actionsRunning + 1;\n        console.log(action.type, this.state.actionsRunning);\n        this.dispatch('action');\n        var oldCommonState = this.state.toCommonState();\n        return this.constructReducer(this.state, action).then(function (state) {\n            return _this.itemReducer(state, action);\n        }).then(function (state) {\n            return _this.sessionReducer(state, action);\n        }).then(function (state) {\n            if (state.language !== oldCommonState.language || state.project !== oldCommonState.project) {\n                var wstate = state.toCommonState();\n                __WEBPACK_IMPORTED_MODULE_1__worker_service_worker_service__[\"b\" /* WorkerService */].savePrototypes(wstate);\n                _this.workerService.callAll('stateWorkerService', 'setState', [wstate]);\n            }\n            _this.state = state;\n            _this.state.actionsRunning = _this.state.actionsRunning - 1;\n            return state;\n        });\n    };\n    FibraService.prototype.getState = function () {\n        return this.state;\n    };\n    FibraService.prototype.undo = function () {};\n    return FibraService;\n}();\n\n__WEBPACK_IMPORTED_MODULE_0_angular__[\"module\"]('fibra.services.fibra-service', []).config(function ($provide) {\n    $provide.service('fibraService', FibraService);\n});//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvc2VydmljZXMvZmlicmEtc2VydmljZS50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hcHAvc2VydmljZXMvZmlicmEtc2VydmljZS50cz82ZWY5Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuaW1wb3J0ICogYXMgYW5ndWxhciBmcm9tICdhbmd1bGFyJztcbmltcG9ydCB7IFdvcmtlclNlcnZpY2UgfSBmcm9tICcuL3dvcmtlci1zZXJ2aWNlL3dvcmtlci1zZXJ2aWNlJztcbnZhciBDb21tb25TdGF0ZSA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQ29tbW9uU3RhdGUocHJvamVjdCwgbGFuZ3VhZ2UpIHtcbiAgICAgICAgaWYgKHByb2plY3QgPT09IHZvaWQgMCkgeyBwcm9qZWN0ID0gbnVsbDsgfVxuICAgICAgICBpZiAobGFuZ3VhZ2UgPT09IHZvaWQgMCkgeyBsYW5ndWFnZSA9ICdlbic7IH1cbiAgICAgICAgdGhpcy5wcm9qZWN0ID0gcHJvamVjdDtcbiAgICAgICAgdGhpcy5sYW5ndWFnZSA9IGxhbmd1YWdlO1xuICAgIH1cbiAgICByZXR1cm4gQ29tbW9uU3RhdGU7XG59KCkpO1xuZXhwb3J0IHsgQ29tbW9uU3RhdGUgfTtcbnZhciBDb25zdHJ1Y3RTdGF0ZSA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQ29uc3RydWN0U3RhdGUoKSB7XG4gICAgICAgIHRoaXMudHlwZXMgPSBbXTtcbiAgICAgICAgdGhpcy51c2VyVHlwZXMgPSBbXTtcbiAgICAgICAgdGhpcy5kaXNwbGF5VHlwZXMgPSBbXTtcbiAgICAgICAgdGhpcy5pdGVtcyA9IFtdO1xuICAgICAgICB0aGlzLml0ZW1JbmRleCA9IHt9O1xuICAgICAgICB0aGlzLmxvY2FsSXRlbXMgPSBbXTtcbiAgICB9XG4gICAgcmV0dXJuIENvbnN0cnVjdFN0YXRlO1xufSgpKTtcbmV4cG9ydCB7IENvbnN0cnVjdFN0YXRlIH07XG52YXIgVUlTdGF0ZSA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFVJU3RhdGUsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gVUlTdGF0ZSgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLmNvbnN0cnVjdCA9IG5ldyBDb25zdHJ1Y3RTdGF0ZSgpO1xuICAgICAgICBfdGhpcy5hY3Rpb25zUnVubmluZyA9IDA7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgVUlTdGF0ZS5wcm90b3R5cGUudG9Db21tb25TdGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBDb21tb25TdGF0ZSh0aGlzLnByb2plY3QsIHRoaXMubGFuZ3VhZ2UpO1xuICAgIH07XG4gICAgcmV0dXJuIFVJU3RhdGU7XG59KENvbW1vblN0YXRlKSk7XG5leHBvcnQgeyBVSVN0YXRlIH07XG52YXIgUExBQ0VIT0xERVIgPSAnUExBQ0VIT0xERVInO1xuLy8gY29uc3QgQ1JFQVRFX1RZUEU6IHN0cmluZyA9ICdDUkVBVEVfVFlQRSdcbi8vIGNvbnN0IENSRUFURV9JVEVNUzogc3RyaW5nID0gJ0NSRUFURV9JVEVNUydcbi8vIGNvbnN0IENSRUFURV9ESVNQTEFZX0lURU1TOiBzdHJpbmcgPSAnQ1JFQVRFX0RJU1BMQVlfSVRFTVMnXG4vLyBjb25zdCBERUxFVEVfSVRFTVM6IHN0cmluZyA9ICdERUxFVEVfSVRFTVMnXG4vLyBjb25zdCBDTEVBUl9UWVBFUzogc3RyaW5nID0gJ0NMRUFSX1RZUEVTJ1xuLy8gY29uc3QgRElTUExBWV9JVEVNUzogc3RyaW5nID0gJ0RJU1BMQVlfSVRFTVMnXG4vLyBjb25zdCBISURFX0lURU06IHN0cmluZyA9ICdISURFX0lURU0nXG4vLyBjb25zdCBDUkVBVEVfTE9DQUxfSVRFTTogc3RyaW5nID0gJ0NSRUFURV9MT0NBTF9JVEVNJ1xuLy8gY29uc3QgSVRFTV9QUk9QRVJUSUVTOiBzdHJpbmcgPSAnSVRFTV9QUk9QRVJUSUVTJ1xuLy8gY29uc3QgU0VUX09SREVSRURfVFlQRVM6IHN0cmluZyA9ICdTRVRfT1JERVJFRF9UWVBFUydcbnZhciBTRVRfTEFOR1VBR0UgPSAnU0VUX0xBTkdVQUdFJztcbnZhciBTRVRfUFJPSkVDVCA9ICdTRVRfUFJPSkVDVCc7XG52YXIgSU5JVElBTF9TVEFURSA9IG5ldyBVSVN0YXRlKCk7XG52YXIgREVGQVVMVF9BQ1RJT04gPSB7IHR5cGU6ICcnLCBwYXlsb2FkOiBudWxsIH07XG52YXIgRmlicmFTZXJ2aWNlID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBGaWJyYVNlcnZpY2UoJHEsIHdvcmtlclNlcnZpY2UsIHNwYXJxbEl0ZW1TZXJ2aWNlLCBzcGFycWxUcmVlU2VydmljZSkge1xuICAgICAgICB0aGlzLiRxID0gJHE7XG4gICAgICAgIHRoaXMud29ya2VyU2VydmljZSA9IHdvcmtlclNlcnZpY2U7XG4gICAgICAgIHRoaXMuc3BhcnFsSXRlbVNlcnZpY2UgPSBzcGFycWxJdGVtU2VydmljZTtcbiAgICAgICAgdGhpcy5zcGFycWxUcmVlU2VydmljZSA9IHNwYXJxbFRyZWVTZXJ2aWNlO1xuICAgICAgICAvLyBFdmVudCBtb2RlbCAtIEJhc2VkIG9uIGQzLmV2ZW50XG4gICAgICAgIHRoaXMuY2FsbGJhY2tzID0ge307XG4gICAgICAgIHRoaXMuY3JlYXRlU3RhdGUoKTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgY2FuIGJlIGNhbGxlZCB0byByZW1vdmUgdGhlIGNhbGxiYWNrXG4gICAgRmlicmFTZXJ2aWNlLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uIChldm50LCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodGhpcy5jYWxsYmFja3NbZXZudF0gPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgIHRoaXMuY2FsbGJhY2tzW2V2bnRdID0gQXJyYXkoKTtcbiAgICAgICAgdGhpcy5jYWxsYmFja3NbZXZudF0ucHVzaChjYWxsYmFjayk7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoX3RoaXMuY2FsbGJhY2tzW2V2bnRdLmluZGV4T2YoY2FsbGJhY2spICE9PSAtMSlcbiAgICAgICAgICAgICAgICBfdGhpcy5jYWxsYmFja3NbZXZudF0uc3BsaWNlKF90aGlzLmNhbGxiYWNrc1tldm50XS5pbmRleE9mKGNhbGxiYWNrKSwgMSk7XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBGaWJyYVNlcnZpY2UucHJvdG90eXBlLmRpc3BhdGNoID0gZnVuY3Rpb24gKGV2bnQpIHtcbiAgICAgICAgaWYgKHRoaXMuY2FsbGJhY2tzW2V2bnRdID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICB0aGlzLmNhbGxiYWNrc1tldm50XSA9IEFycmF5KCk7XG4gICAgICAgIHZhciBwcm9tcyA9IHRoaXMuY2FsbGJhY2tzW2V2bnRdLm1hcChmdW5jdGlvbiAoY2IpIHsgcmV0dXJuIGNiKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy4kcS5hbGwocHJvbXMpO1xuICAgIH07XG4gICAgRmlicmFTZXJ2aWNlLnByb3RvdHlwZS5jcmVhdGVTdGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IElOSVRJQUxfU1RBVEU7XG4gICAgICAgIGlmICghdGhpcy5zdG9yZSkge1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVTdG9yZSgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBGaWJyYVNlcnZpY2UucHJvdG90eXBlLmNyZWF0ZVN0b3JlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnN0b3JlID0gW3RoaXMuc3RhdGVdO1xuICAgIH07XG4gICAgLy8gQWN0aW9uIGNyZWF0b3JzXG4gICAgRmlicmFTZXJ2aWNlLnByb3RvdHlwZS5wbGFjZUhvbGRlckFjdGlvbiA9IGZ1bmN0aW9uIChwcm9tKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiBQTEFDRUhPTERFUixcbiAgICAgICAgICAgIHBheWxvYWQ6IHByb21cbiAgICAgICAgfTtcbiAgICB9O1xuICAgIEZpYnJhU2VydmljZS5wcm90b3R5cGUuc2V0TGFuZ3VhZ2UgPSBmdW5jdGlvbiAobGFuZ3VhZ2UpIHsgcmV0dXJuIHsgdHlwZTogU0VUX0xBTkdVQUdFLCBwYXlsb2FkOiBsYW5ndWFnZSB9OyB9O1xuICAgIEZpYnJhU2VydmljZS5wcm90b3R5cGUuc2V0UHJvamVjdCA9IGZ1bmN0aW9uIChwcm9qZWN0KSB7IHJldHVybiB7IHR5cGU6IFNFVF9QUk9KRUNULCBwYXlsb2FkOiBwcm9qZWN0IH07IH07XG4gICAgLy8gcHVibGljIGNyZWF0ZUxvY2FsSXRlbShpdGVtOiBJVGVybSk6IEFjdGlvbiB7XG4gICAgLy8gICByZXR1cm4ge1xuICAgIC8vICAgICB0eXBlOiBDUkVBVEVfTE9DQUxfSVRFTSxcbiAgICAvLyAgICAgcGF5bG9hZDogaXRlbVxuICAgIC8vICAgfVxuICAgIC8vIH1cbiAgICAvLyBwdWJsaWMgZGlzcGxheUl0ZW0oaXRlbTogSVRlcm0sIGNvb3JkaW5hdGVzPzogW251bWJlcl0pOiBBY3Rpb24ge1xuICAgIC8vICAgcmV0dXJuIHtcbiAgICAvLyAgICAgdHlwZTogRElTUExBWV9JVEVNUyxcbiAgICAvLyAgICAgcGF5bG9hZDoge1xuICAgIC8vICAgICAgIGl0ZW1zOiBbaXRlbV0sXG4gICAgLy8gICAgICAgY29vcmRpbmF0ZXM6IFtjb29yZGluYXRlc11cbiAgICAvLyAgICAgfVxuICAgIC8vICAgfVxuICAgIC8vIH1cbiAgICAvLyBwdWJsaWMgZGlzcGxheUl0ZW1zKGl0ZW1zOiBJVGVybVtdLCBjb29yZGluYXRlcz86IFtudW1iZXJdW10pOiBBY3Rpb24ge1xuICAgIC8vICAgcmV0dXJuIHtcbiAgICAvLyAgICAgdHlwZTogRElTUExBWV9JVEVNUyxcbiAgICAvLyAgICAgcGF5bG9hZDoge1xuICAgIC8vICAgICAgIGl0ZW1zOiBpdGVtcyxcbiAgICAvLyAgICAgICBjb29yZGluYXRlczogY29vcmRpbmF0ZXNcbiAgICAvLyAgICAgfVxuICAgIC8vICAgfVxuICAgIC8vIH1cbiAgICAvLyBwdWJsaWMgaGlkZUl0ZW0oaXRlbTogSVRlcm0pOiBBY3Rpb24ge1xuICAgIC8vICAgcmV0dXJuIHtcbiAgICAvLyAgICAgdHlwZTogSElERV9JVEVNLFxuICAgIC8vICAgICBwYXlsb2FkOiBpdGVtXG4gICAgLy8gICB9XG4gICAgLy8gfVxuICAgIC8vIHB1YmxpYyBpdGVtUHJvcGVydHkoaXRlbTogSU5vZGUsIHByb3BlcnRpZXNUb0FkZDogSVByb3BlcnR5QW5kVmFsdWVbXSwgcHJvcGVydGllc1RvUmVtb3ZlPzogSVByb3BlcnR5QW5kVmFsdWVbXSkge1xuICAgIC8vICAgcmV0dXJuIHtcbiAgICAvLyAgICAgdHlwZTogSVRFTV9QUk9QRVJUSUVTLFxuICAgIC8vICAgICBwYXlsb2FkOiB7XG4gICAgLy8gICAgICAgaXRlbTogaXRlbSxcbiAgICAvLyAgICAgICBwcm9wZXJ0aWVzVG9BZGQ6IHByb3BlcnRpZXNUb0FkZCxcbiAgICAvLyAgICAgICBwcm9wZXJ0aWVzVG9SZW1vdmU6IHByb3BlcnRpZXNUb1JlbW92ZVxuICAgIC8vICAgICB9XG4gICAgLy8gICB9XG4gICAgLy8gfVxuICAgIC8vIHB1YmxpYyBjcmVhdGVJdGVtKGl0ZW0/OiBJTm9kZSwgdHlwPzogc3RyaW5nKTpBY3Rpb24ge1xuICAgIC8vICAgcmV0dXJuIHtcbiAgICAvLyAgICAgdHlwZTogQ1JFQVRFX0lURU1TLFxuICAgIC8vICAgICBwYXlsb2FkOiB7XG4gICAgLy8gICAgICAgaXRlbXM6IFtpdGVtXSxcbiAgICAvLyAgICAgICB0eXBlOiB0eXBcbiAgICAvLyAgICAgfVxuICAgIC8vICAgfVxuICAgIC8vIH1cbiAgICAvLyBwdWJsaWMgY3JlYXRlSXRlbXMoaXRlbXM6IElOb2RlW10sIHR5cD86IHN0cmluZyk6IEFjdGlvbiB7XG4gICAgLy8gICByZXR1cm4ge1xuICAgIC8vICAgICB0eXBlOiBDUkVBVEVfSVRFTVMsXG4gICAgLy8gICAgIHBheWxvYWQ6IHtcbiAgICAvLyAgICAgICBpdGVtczogaXRlbXMsXG4gICAgLy8gICAgICAgdHlwZTogdHlwXG4gICAgLy8gICAgIH1cbiAgICAvLyAgIH1cbiAgICAvLyB9XG4gICAgLy8gcHVibGljIGNyZWF0ZURpc3BsYXlJdGVtKGl0ZW0/OiBJTm9kZSwgdHlwPzogc3RyaW5nKTogQWN0aW9uIHtcbiAgICAvLyAgIHJldHVybiB7XG4gICAgLy8gICAgIHR5cGU6IENSRUFURV9ESVNQTEFZX0lURU1TLFxuICAgIC8vICAgICBwYXlsb2FkOiB7XG4gICAgLy8gICAgICAgaXRlbXM6IFtpdGVtXSxcbiAgICAvLyAgICAgICB0eXBlOiB0eXBcbiAgICAvLyAgICAgfVxuICAgIC8vICAgfVxuICAgIC8vIH1cbiAgICAvLyBwdWJsaWMgY3JlYXRlRGlzcGxheUl0ZW1zKGl0ZW1zOiBJTm9kZVtdLCB0eXA/OiBzdHJpbmcpOiBBY3Rpb24ge1xuICAgIC8vICAgcmV0dXJuIHtcbiAgICAvLyAgICAgdHlwZTogQ1JFQVRFX0RJU1BMQVlfSVRFTVMsXG4gICAgLy8gICAgIHBheWxvYWQ6IHtcbiAgICAvLyAgICAgICBpdGVtczogaXRlbXMsXG4gICAgLy8gICAgICAgdHlwZTogdHlwXG4gICAgLy8gICAgIH1cbiAgICAvLyAgIH1cbiAgICAvLyB9XG4gICAgLy8gcHVibGljIGRlbGV0ZUl0ZW0oaXRlbTogSU5vZGUpOiBBY3Rpb24ge1xuICAgIC8vICAgcmV0dXJuIHtcbiAgICAvLyAgICAgdHlwZTogREVMRVRFX0lURU1TLFxuICAgIC8vICAgICBwYXlsb2FkOiBbaXRlbV1cbiAgICAvLyAgIH1cbiAgICAvLyB9XG4gICAgLy8gcHVibGljIGNsZWFyVHlwZXMoKTogQWN0aW9uIHtcbiAgICAvLyAgIHJldHVybiB7XG4gICAgLy8gICAgIHR5cGU6IENMRUFSX1RZUEVTLFxuICAgIC8vICAgICBwYXlsb2FkOiB1bmRlZmluZWRcbiAgICAvLyAgIH1cbiAgICAvLyB9XG4gICAgLy8gcHVibGljIHNldE9yZGVyZWRUeXBlcyh0eXBlczogVHJlZU5vZGVbXSk6IEFjdGlvbiB7XG4gICAgLy8gICByZXR1cm4ge1xuICAgIC8vICAgICB0eXBlOiBTRVRfT1JERVJFRF9UWVBFUyxcbiAgICAvLyAgICAgcGF5bG9hZDogdHlwZXNcbiAgICAvLyAgIH1cbiAgICAvLyB9XG4gICAgLy8gcHVibGljIGNyZWF0ZVR5cGUobGFiZWw6IHN0cmluZyk6IEFjdGlvbiB7XG4gICAgLy8gICByZXR1cm4ge1xuICAgIC8vICAgICB0eXBlOiBDUkVBVEVfVFlQRSxcbiAgICAvLyAgICAgcGF5bG9hZDogbGFiZWxcbiAgICAvLyAgIH1cbiAgICAvLyB9XG4gICAgLy8gUmVkdWNlcnNcbiAgICBGaWJyYVNlcnZpY2UucHJvdG90eXBlLml0ZW1SZWR1Y2VyID0gZnVuY3Rpb24gKHN0YXRlLCBhY3Rpb24pIHtcbiAgICAgICAgaWYgKHN0YXRlID09PSB2b2lkIDApIHsgc3RhdGUgPSBJTklUSUFMX1NUQVRFOyB9XG4gICAgICAgIGlmIChhY3Rpb24gPT09IHZvaWQgMCkgeyBhY3Rpb24gPSBERUZBVUxUX0FDVElPTjsgfVxuICAgICAgICBzd2l0Y2ggKGFjdGlvbi50eXBlKSB7XG4gICAgICAgICAgICAvLyBjYXNlIERJU1BMQVlfSVRFTVM6XG4gICAgICAgICAgICAvLyAgIGFjdGlvbi5wYXlsb2FkLml0ZW1zLmZvckVhY2goKGl0ZW0sIGkpID0+IHtcbiAgICAgICAgICAgIC8vICAgICBpZighc3RhdGUuY29uc3RydWN0Lml0ZW1JbmRleFtpdGVtLnZhbHVlXSkge1xuICAgICAgICAgICAgLy8gICAgICAgc3RhdGUuY29uc3RydWN0Lml0ZW1zLnB1c2goaXRlbSlcbiAgICAgICAgICAgIC8vICAgICAgIHN0YXRlLmNvbnN0cnVjdC5pdGVtSW5kZXhbaXRlbS52YWx1ZV0gPSBpdGVtXG4gICAgICAgICAgICAvLyAgICAgICAvLyBJZiBjb29yZGluYXRlcyBhcmUgcHJvdmlkZWQsIGFwcGx5IHRoZW1cbiAgICAgICAgICAgIC8vICAgICAgIGlmKGFjdGlvbi5wYXlsb2FkLmNvb3JkaW5hdGVzICYmIGFjdGlvbi5wYXlsb2FkLmNvb3JkaW5hdGVzW2ldICYmIGFjdGlvbi5wYXlsb2FkLmNvb3JkaW5hdGVzW2ldWzBdICYmIGFjdGlvbi5wYXlsb2FkLmNvb3JkaW5hdGVzW2ldWzFdKSB7XG4gICAgICAgICAgICAvLyAgICAgICAgIHN0YXRlLmNvbnN0cnVjdC5pdGVtSW5kZXhbaXRlbS52YWx1ZV0ueCA9IGFjdGlvbi5wYXlsb2FkLmNvb3JkaW5hdGVzW2ldWzBdXG4gICAgICAgICAgICAvLyAgICAgICAgIHN0YXRlLmNvbnN0cnVjdC5pdGVtSW5kZXhbaXRlbS52YWx1ZV0ueSA9IGFjdGlvbi5wYXlsb2FkLmNvb3JkaW5hdGVzW2ldWzFdXG4gICAgICAgICAgICAvLyAgICAgICB9XG4gICAgICAgICAgICAvLyAgICAgfVxuICAgICAgICAgICAgLy8gICB9KVxuICAgICAgICAgICAgLy8gICB0aGlzLmRpc3BhdGNoKCdjaGFuZ2UnKVxuICAgICAgICAgICAgLy8gICByZXR1cm4gdGhpcy4kcS5yZXNvbHZlKHN0YXRlKVxuICAgICAgICAgICAgLy8gY2FzZSBISURFX0lURU06XG4gICAgICAgICAgICAvLyAgIGxldCBpdCA9IHN0YXRlLmNvbnN0cnVjdC5pdGVtSW5kZXhbYWN0aW9uLnBheWxvYWQudmFsdWVdXG4gICAgICAgICAgICAvLyAgIGlmKGl0KSB7XG4gICAgICAgICAgICAvLyAgICAgc3RhdGUuY29uc3RydWN0Lml0ZW1zLnNwbGljZShzdGF0ZS5jb25zdHJ1Y3QuaXRlbXMuaW5kZXhPZihpdCksIDEpXG4gICAgICAgICAgICAvLyAgICAgZGVsZXRlIHN0YXRlLmNvbnN0cnVjdC5pdGVtSW5kZXhbYWN0aW9uLnBheWxvYWQudmFsdWVdXG4gICAgICAgICAgICAvLyAgIH1cbiAgICAgICAgICAgIC8vICAgdGhpcy5kaXNwYXRjaCgnY2hhbmdlJylcbiAgICAgICAgICAgIC8vICAgcmV0dXJuIHRoaXMuJHEucmVzb2x2ZShzdGF0ZSlcbiAgICAgICAgICAgIC8vIGNhc2UgQ1JFQVRFX0xPQ0FMX0lURU06XG4gICAgICAgICAgICAvLyAgIGxldCBpdGVtOiBJR3JpZE5vZGUgPSBhY3Rpb24ucGF5bG9hZFxuICAgICAgICAgICAgLy8gICBzdGF0ZS5jb25zdHJ1Y3QubG9jYWxJdGVtcy5wdXNoKGl0ZW0pXG4gICAgICAgICAgICAvLyAgIHJldHVybiB0aGlzLiRxLnJlc29sdmUoc3RhdGUpXG4gICAgICAgICAgICAvLyBjYXNlIENSRUFURV9JVEVNUzpcbiAgICAgICAgICAgIC8vICAgcmV0dXJuIHRoaXMuY3JlYXRlSXRlbXNJbnRlcm5hbChhY3Rpb24sIHN0YXRlKS50aGVuKChub2RlcykgPT4ge1xuICAgICAgICAgICAgLy8gICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAgICAgLy8gICB9KVxuICAgICAgICAgICAgLy8gY2FzZSBDUkVBVEVfRElTUExBWV9JVEVNUzpcbiAgICAgICAgICAgIC8vICAgcmV0dXJuIHRoaXMuY3JlYXRlSXRlbXNJbnRlcm5hbChhY3Rpb24sIHN0YXRlKS50aGVuKChub2RlcykgPT4ge1xuICAgICAgICAgICAgLy8gICAgIHJldHVybiB0aGlzLmRpc3BhdGNoQWN0aW9uKHRoaXMuZGlzcGxheUl0ZW1zKG5vZGVzKSlcbiAgICAgICAgICAgIC8vICAgfSlcbiAgICAgICAgICAgIC8vIGNhc2UgREVMRVRFX0lURU1TOlxuICAgICAgICAgICAgLy8gICByZXR1cm4gdGhpcy4kcS5hbGwoYWN0aW9uLnBheWxvYWQubWFwKChpdGVtOiBJTm9kZSkgPT4ge1xuICAgICAgICAgICAgLy8gICAgIHJldHVybiB0aGlzLnNwYXJxbEl0ZW1TZXJ2aWNlLmRlbGV0ZUl0ZW0oaXRlbSlcbiAgICAgICAgICAgIC8vICAgfSkpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgLy8gICAgIHRoaXMuZGlzcGF0Y2goJ2NoYW5nZScpXG4gICAgICAgICAgICAvLyAgICAgcmV0dXJuIHRoaXMuc3RhdGVcbiAgICAgICAgICAgIC8vICAgfSlcbiAgICAgICAgICAgIC8vIGNhc2UgSVRFTV9QUk9QRVJUSUVTOlxuICAgICAgICAgICAgLy8gICByZXR1cm4gdGhpcy5zcGFycWxJdGVtU2VydmljZS5hbHRlckl0ZW0oYWN0aW9uLnBheWxvYWQuaXRlbSwgYWN0aW9uLnBheWxvYWQucHJvcGVydGllc1RvQWRkLCBhY3Rpb24ucGF5bG9hZC5wcm9wZXJ0aWVzVG9SZW1vdmUpLnRoZW4oKHN0cikgPT4ge1xuICAgICAgICAgICAgLy8gICAgIHJldHVybiB0aGlzLnN0YXRlXG4gICAgICAgICAgICAvLyAgIH0pXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRxLnJlc29sdmUoc3RhdGUpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBGaWJyYVNlcnZpY2UucHJvdG90eXBlLnNlc3Npb25SZWR1Y2VyID0gZnVuY3Rpb24gKHN0YXRlLCBhY3Rpb24pIHtcbiAgICAgICAgaWYgKHN0YXRlID09PSB2b2lkIDApIHsgc3RhdGUgPSBJTklUSUFMX1NUQVRFOyB9XG4gICAgICAgIGlmIChhY3Rpb24gPT09IHZvaWQgMCkgeyBhY3Rpb24gPSBERUZBVUxUX0FDVElPTjsgfVxuICAgICAgICBzd2l0Y2ggKGFjdGlvbi50eXBlKSB7XG4gICAgICAgICAgICBjYXNlIFNFVF9MQU5HVUFHRTpcbiAgICAgICAgICAgICAgICBzdGF0ZS5sYW5ndWFnZSA9IGFjdGlvbi5wYXlsb2FkO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRxLnJlc29sdmUoc3RhdGUpO1xuICAgICAgICAgICAgY2FzZSBTRVRfUFJPSkVDVDpcbiAgICAgICAgICAgICAgICBzdGF0ZS5wcm9qZWN0ID0gYWN0aW9uLnBheWxvYWQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHEucmVzb2x2ZShzdGF0ZSk7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRxLnJlc29sdmUoc3RhdGUpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBGaWJyYVNlcnZpY2UucHJvdG90eXBlLmNvbnN0cnVjdFJlZHVjZXIgPSBmdW5jdGlvbiAoc3RhdGUsIGFjdGlvbikge1xuICAgICAgICBpZiAoc3RhdGUgPT09IHZvaWQgMCkgeyBzdGF0ZSA9IElOSVRJQUxfU1RBVEU7IH1cbiAgICAgICAgaWYgKGFjdGlvbiA9PT0gdm9pZCAwKSB7IGFjdGlvbiA9IERFRkFVTFRfQUNUSU9OOyB9XG4gICAgICAgIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgUExBQ0VIT0xERVI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbi5wYXlsb2FkLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBjYXNlIENMRUFSX1RZUEVTOlxuICAgICAgICAgICAgLy8gICBzdGF0ZS5jb25zdHJ1Y3QudHlwZXMgPSBbXVxuICAgICAgICAgICAgLy8gICByZXR1cm4gdGhpcy4kcS5yZXNvbHZlKHN0YXRlKVxuICAgICAgICAgICAgLy8gY2FzZSBTRVRfT1JERVJFRF9UWVBFUzpcbiAgICAgICAgICAgIC8vICAgc3RhdGUuY29uc3RydWN0LmRpc3BsYXlUeXBlcyA9IGFjdGlvbi5wYXlsb2FkXG4gICAgICAgICAgICAvLyAgIHJldHVybiB0aGlzLiRxLnJlc29sdmUoc3RhdGUpXG4gICAgICAgICAgICAvLyBjYXNlIENSRUFURV9UWVBFOlxuICAgICAgICAgICAgLy8gICByZXR1cm4gdGhpcy5zcGFycWxJdGVtU2VydmljZS5jcmVhdGVOZXdJdGVtKFtuZXcgUHJvcGVydHlBbmRWYWx1ZShTS09TLnByZWZMYWJlbCwgRGF0YUZhY3RvcnkuaW5zdGFuY2UubGl0ZXJhbChhY3Rpb24ucGF5bG9hZCkpLCBuZXcgUHJvcGVydHlBbmRWYWx1ZShSREYudHlwZSwgT1dMLkNsYXNzKV0pLnRoZW4oKG5vZGUpID0+IHtcbiAgICAgICAgICAgIC8vICAgICBsZXQgdG46IFRyZWVOb2RlID0gbmV3IFRyZWVOb2RlKG5vZGUudmFsdWUsIGFjdGlvbi5wYXlsb2FkKVxuICAgICAgICAgICAgLy8gICAgIHRoaXMuc3RhdGUuY29uc3RydWN0LnVzZXJUeXBlcy5wdXNoKHRuKVxuICAgICAgICAgICAgLy8gICAgIHJldHVybiB0aGlzLnN0YXRlXG4gICAgICAgICAgICAvLyAgIH0pXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRxLnJlc29sdmUoc3RhdGUpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvLyBwcml2YXRlIGNyZWF0ZUl0ZW1zSW50ZXJuYWwoYWN0aW9uLCBzdGF0ZSk6IGFuZ3VsYXIuSVByb21pc2U8SU5vZGVbXT4ge1xuICAgIC8vICAgbGV0IGl0ZW1zOiBJdGVtW10gPSBhY3Rpb24ucGF5bG9hZC5pdGVtc1xuICAgIC8vICAgbGV0IHR5cGVOb2RlOiBJTmFtZWROb2RlID0gYWN0aW9uLnBheWxvYWQudHlwZSA/IERhdGFGYWN0b3J5Lmluc3RhbmNlLm5hbWVkTm9kZShhY3Rpb24ucGF5bG9hZC50eXBlKSA6IE9XTC5UaGluZ1xuICAgIC8vICAgaWYgKGl0ZW1zWzBdKSB7XG4gICAgLy8gICAgIGxldCBwcm9tcyA9IGl0ZW1zLm1hcCgobm9kZSkgPT4ge1xuICAgIC8vICAgICAgIGlmIChub2RlLnZhbHVlKSB7XG4gICAgLy8gICAgICAgICByZXR1cm4gdGhpcy5zcGFycWxJdGVtU2VydmljZS5jcmVhdGVOZXdJdGVtKFtuZXcgUHJvcGVydHlBbmRWYWx1ZShTS09TLnByZWZMYWJlbCwgRGF0YUZhY3RvcnkuaW5zdGFuY2UubGl0ZXJhbChub2RlLnZhbHVlKSksIG5ldyBQcm9wZXJ0eUFuZFZhbHVlKFJERi50eXBlLCB0eXBlTm9kZSldKVxuICAgIC8vICAgICAgIH0gZWxzZSB7XG4gICAgLy8gICAgICAgICByZXR1cm4gdGhpcy5zcGFycWxJdGVtU2VydmljZS5jcmVhdGVOZXdJdGVtKFtuZXcgUHJvcGVydHlBbmRWYWx1ZShSREYudHlwZSwgdHlwZU5vZGUpXSlcbiAgICAvLyAgICAgICB9XG4gICAgLy8gICAgICAgLy8gcmV0dXJuIHRoaXMuc3BhcnFsSXRlbVNlcnZpY2UuZ2V0SXRlbShub2RlKS50aGVuKChpdGVtKSA9PiB7XG4gICAgLy8gICAgICAgLy8gICBsZXQgcHJlZkxhYmVsUHJvcCA9IGl0ZW0ubG9jYWxQcm9wZXJ0aWVzLmNvbmNhdChpdGVtLnJlbW90ZVByb3BlcnRpZXMpLmZpbHRlcigocHIpID0+IHtcbiAgICAvLyAgICAgICAvLyAgICAgcmV0dXJuIHByLnZhbHVlID09PSAnaHR0cDovL3d3dy53My5vcmcvMjAwNC8wMi9za29zL2NvcmUjcHJlZkxhYmVsJ1xuICAgIC8vICAgICAgIC8vICAgfSlcbiAgICAvLyAgICAgICAvLyAgIGxldCB0eXBlOiBQcm9wZXJ0eVRvVmFsdWVzPElOb2RlPiA9IG5ldyBQcm9wZXJ0eVRvVmFsdWVzKFJERi50eXBlKVxuICAgIC8vICAgICAgIC8vICAgbGV0IHR5cGVQcm9wID0gaXRlbS5sb2NhbFByb3BlcnRpZXMuY29uY2F0KGl0ZW0ucmVtb3RlUHJvcGVydGllcykuZmlsdGVyKChwcikgPT4ge1xuICAgIC8vICAgICAgIC8vICAgICByZXR1cm4gcHIudmFsdWUgPT09ICdodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjdHlwZSdcbiAgICAvLyAgICAgICAvLyAgIH0pXG4gICAgLy8gICAgICAgLy8gICBpZih0eXBlUHJvcFswXSkge1xuICAgIC8vICAgICAgIC8vICAgICBsZXQgdHlwZVdpdGhMYWJlbDogSU5vZGVQbHVzTGFiZWwgPSBuZXcgU291cmNlZE5vZGVQbHVzTGFiZWwodHlwZVByb3BbMF0pXG4gICAgLy8gICAgICAgLy8gICAgIHR5cGUudmFsdWVzLnB1c2godHlwZVdpdGhMYWJlbClcbiAgICAvLyAgICAgICAvLyAgIH1cbiAgICAvLyAgICAgICAvLyAgIHJldHVybiB0aGlzLnNwYXJxbEl0ZW1TZXJ2aWNlLmNyZWF0ZU5ld0l0ZW0oW2l0ZW1dLCBbdHlwZSwgcHJlZkxhYmVsUHJvcFswXV0pXG4gICAgLy8gICAgICAgLy8gfSkudGhlbigobm9kZSkgPT4ge1xuICAgIC8vICAgICAgIC8vICAgLy8gRGlzcGxheSB0aGUgaXRlbVxuICAgIC8vICAgICAgIC8vICAgcmV0dXJuIHRoaXMuZGlzcGF0Y2hBY3Rpb24odGhpcy5kaXNwbGF5SXRlbShub2RlKSlcbiAgICAvLyAgICAgICAvLyB9KVxuICAgIC8vICAgICB9KVxuICAgIC8vICAgICByZXR1cm4gdGhpcy4kcS5hbGwocHJvbXMpXG4gICAgLy8gICB9IGVsc2Uge1xuICAgIC8vICAgICByZXR1cm4gdGhpcy5zcGFycWxJdGVtU2VydmljZS5jcmVhdGVOZXdJdGVtKFtuZXcgUHJvcGVydHlBbmRWYWx1ZShSREYudHlwZSwgdHlwZU5vZGUpLCBuZXcgUHJvcGVydHlBbmRWYWx1ZShTS09TLnByZWZMYWJlbCwgRGF0YUZhY3RvcnkuaW5zdGFuY2UubGl0ZXJhbCgnJykpXSkudGhlbigobm9kZSkgPT4ge1xuICAgIC8vICAgICAgIHJldHVybiBbbm9kZV1cbiAgICAvLyAgICAgfSlcbiAgICAvLyAgIH1cbiAgICAvLyB9XG4gICAgLy8gUHVibGljIEFQSVxuICAgIEZpYnJhU2VydmljZS5wcm90b3R5cGUuZGlzcGF0Y2hBY3Rpb24gPSBmdW5jdGlvbiAoYWN0aW9uKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuc3RhdGUuYWN0aW9uc1J1bm5pbmcgPSB0aGlzLnN0YXRlLmFjdGlvbnNSdW5uaW5nICsgMTtcbiAgICAgICAgY29uc29sZS5sb2coYWN0aW9uLnR5cGUsIHRoaXMuc3RhdGUuYWN0aW9uc1J1bm5pbmcpO1xuICAgICAgICB0aGlzLmRpc3BhdGNoKCdhY3Rpb24nKTtcbiAgICAgICAgdmFyIG9sZENvbW1vblN0YXRlID0gdGhpcy5zdGF0ZS50b0NvbW1vblN0YXRlKCk7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdFJlZHVjZXIodGhpcy5zdGF0ZSwgYWN0aW9uKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHN0YXRlKSB7IHJldHVybiBfdGhpcy5pdGVtUmVkdWNlcihzdGF0ZSwgYWN0aW9uKTsgfSlcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChzdGF0ZSkgeyByZXR1cm4gX3RoaXMuc2Vzc2lvblJlZHVjZXIoc3RhdGUsIGFjdGlvbik7IH0pXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgICAgIGlmIChzdGF0ZS5sYW5ndWFnZSAhPT0gb2xkQ29tbW9uU3RhdGUubGFuZ3VhZ2UgfHwgc3RhdGUucHJvamVjdCAhPT0gb2xkQ29tbW9uU3RhdGUucHJvamVjdCkge1xuICAgICAgICAgICAgICAgIHZhciB3c3RhdGUgPSBzdGF0ZS50b0NvbW1vblN0YXRlKCk7XG4gICAgICAgICAgICAgICAgV29ya2VyU2VydmljZS5zYXZlUHJvdG90eXBlcyh3c3RhdGUpO1xuICAgICAgICAgICAgICAgIF90aGlzLndvcmtlclNlcnZpY2UuY2FsbEFsbCgnc3RhdGVXb3JrZXJTZXJ2aWNlJywgJ3NldFN0YXRlJywgW3dzdGF0ZV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX3RoaXMuc3RhdGUgPSBzdGF0ZTtcbiAgICAgICAgICAgIF90aGlzLnN0YXRlLmFjdGlvbnNSdW5uaW5nID0gX3RoaXMuc3RhdGUuYWN0aW9uc1J1bm5pbmcgLSAxO1xuICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIEZpYnJhU2VydmljZS5wcm90b3R5cGUuZ2V0U3RhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXRlO1xuICAgIH07XG4gICAgRmlicmFTZXJ2aWNlLnByb3RvdHlwZS51bmRvID0gZnVuY3Rpb24gKCkge1xuICAgIH07XG4gICAgcmV0dXJuIEZpYnJhU2VydmljZTtcbn0oKSk7XG5leHBvcnQgeyBGaWJyYVNlcnZpY2UgfTtcbmFuZ3VsYXIubW9kdWxlKCdmaWJyYS5zZXJ2aWNlcy5maWJyYS1zZXJ2aWNlJywgW10pXG4gICAgLmNvbmZpZyhmdW5jdGlvbiAoJHByb3ZpZGUpIHtcbiAgICAkcHJvdmlkZS5zZXJ2aWNlKCdmaWJyYVNlcnZpY2UnLCBGaWJyYVNlcnZpY2UpO1xufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL3NlcnZpY2VzL2ZpYnJhLXNlcnZpY2UudHMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUEvQ0E7QUFpREE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBVUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBbEJBO0FBb0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),

/***/ "./app/services/index.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__social_auth_service__ = __webpack_require__(\"./app/services/social-auth-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__worker_service_worker_service__ = __webpack_require__(\"./app/services/worker-service/worker-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__project_service_project_service__ = __webpack_require__(\"./app/services/project-service/project-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__fibra_service__ = __webpack_require__(\"./app/services/fibra-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__fibra_sparql_service__ = __webpack_require__(\"./app/services/fibra-sparql-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__sparql_item_service__ = __webpack_require__(\"./app/services/sparql-item-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__sparql_tree_service__ = __webpack_require__(\"./app/services/sparql-tree-service.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__sparql_autocomplete_service__ = __webpack_require__(\"./app/services/sparql-autocomplete-service.ts\");\n\n\n\n\n\n\n\n\n\n\n\n__WEBPACK_IMPORTED_MODULE_0_angular__[\"module\"]('fibra.services', ['fibra.services.social-auth-service', 'fibra.services.worker-service', 'fibra.services.project-service', 'fibra.services.fibra-service', 'fibra.services.fibra-sparql-service', 'fibra.services.sparql-item-service', 'fibra.services.sparql-tree-service', 'fibra.services.sparql-autocomplete-service']);//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvc2VydmljZXMvaW5kZXgudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3NlcnZpY2VzL2luZGV4LnRzPzgxNmQiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuaW1wb3J0ICogYXMgYW5ndWxhciBmcm9tICdhbmd1bGFyJztcbmltcG9ydCAnLi9zb2NpYWwtYXV0aC1zZXJ2aWNlJztcbmltcG9ydCAnLi93b3JrZXItc2VydmljZS93b3JrZXItc2VydmljZSc7XG5pbXBvcnQgJy4vcHJvamVjdC1zZXJ2aWNlL3Byb2plY3Qtc2VydmljZSc7XG5pbXBvcnQgJy4vZmlicmEtc2VydmljZSc7XG5pbXBvcnQgJy4vZmlicmEtc3BhcnFsLXNlcnZpY2UnO1xuaW1wb3J0ICcuL3NwYXJxbC1pdGVtLXNlcnZpY2UnO1xuaW1wb3J0ICcuL3NwYXJxbC10cmVlLXNlcnZpY2UnO1xuaW1wb3J0ICcuL3NwYXJxbC1hdXRvY29tcGxldGUtc2VydmljZSc7XG5hbmd1bGFyLm1vZHVsZSgnZmlicmEuc2VydmljZXMnLCBbXG4gICAgJ2ZpYnJhLnNlcnZpY2VzLnNvY2lhbC1hdXRoLXNlcnZpY2UnLFxuICAgICdmaWJyYS5zZXJ2aWNlcy53b3JrZXItc2VydmljZScsXG4gICAgJ2ZpYnJhLnNlcnZpY2VzLnByb2plY3Qtc2VydmljZScsXG4gICAgJ2ZpYnJhLnNlcnZpY2VzLmZpYnJhLXNlcnZpY2UnLFxuICAgICdmaWJyYS5zZXJ2aWNlcy5maWJyYS1zcGFycWwtc2VydmljZScsXG4gICAgJ2ZpYnJhLnNlcnZpY2VzLnNwYXJxbC1pdGVtLXNlcnZpY2UnLFxuICAgICdmaWJyYS5zZXJ2aWNlcy5zcGFycWwtdHJlZS1zZXJ2aWNlJyxcbiAgICAnZmlicmEuc2VydmljZXMuc3BhcnFsLWF1dG9jb21wbGV0ZS1zZXJ2aWNlJ1xuXSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL3NlcnZpY2VzL2luZGV4LnRzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),

/***/ "./app/services/project-service/project-service.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__models_citable__ = __webpack_require__(\"./app/models/citable.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__project__ = __webpack_require__(\"./app/services/project-service/project.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__primary_endpoint_configuration__ = __webpack_require__(\"./app/services/project-service/primary-endpoint-configuration.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__remote_endpoint_configuration__ = __webpack_require__(\"./app/services/project-service/remote-endpoint-configuration.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__schema__ = __webpack_require__(\"./app/services/project-service/schema.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__components_collection_utils__ = __webpack_require__(\"./app/components/collection-utils.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__components_misc_utils__ = __webpack_require__(\"./app/components/misc-utils.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__models_rdf__ = __webpack_require__(\"./app/models/rdf.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_9__data_model__ = __webpack_require__(\"./app/services/project-service/data-model.ts\");\n/* unused harmony export ProjectService */\n/* unused harmony export ProjectWorkerService */\n\n\n\n\n\n\n\n\n\n\n\n\nvar s = fi.seco.sparql;\nvar ProjectService = function () {\n    function ProjectService(workerService, fibraService, fibraSparqlService, $localStorage) {\n        this.workerService = workerService;\n        this.fibraService = fibraService;\n        this.fibraSparqlService = fibraSparqlService;\n        this.$localStorage = $localStorage;\n        if (!$localStorage.projectSources) $localStorage.projectSources = [];else $localStorage.projectSources.forEach(function (ps) {\n            if (!ps.sparqlEndpoint) {\n                ps.sparqlEndpoint = ps['endpoint'];\n                ps.updateEndpoint = ps['endpoint'];\n                ps.graphStoreEndpoint = ps['endpoint'];\n            }\n        });\n    }\n    ProjectService.orderCitables = function (citables) {\n        citables.sort(function (a, b) {\n            return (a['order'] ? a['order'] : Number.MAX_VALUE) - (b['order'] ? b['order'] : Number.MAX_VALUE);\n        });\n        citables.forEach(function (rh) {\n            return delete rh['order'];\n        });\n    };\n    ProjectService.prototype.getCurrentProject = function () {\n        return this.fibraService.getState().project;\n    };\n    ProjectService.prototype.setCurrentProject = function (project) {\n        return this.fibraService.dispatchAction(this.fibraService.setProject(project));\n    };\n    ProjectService.prototype.getProjectSources = function () {\n        return this.$localStorage.projectSources;\n    };\n    ProjectService.prototype.listPrimaryEndpointConfigurations = function (source) {\n        return this.workerService.call('projectWorkerService', 'listPrimaryEndpointConfigurations', [source]);\n    };\n    ProjectService.prototype.loadPrimaryEndpointConfiguration = function (source, templateId) {\n        return this.workerService.call('projectWorkerService', 'loadPrimaryEndpointConfiguration', [source, templateId]);\n    };\n    ProjectService.prototype.listArchiveEndpointConfigurations = function (source) {\n        return this.workerService.call('projectWorkerService', 'listArchiveEndpointConfigurations', [source]);\n    };\n    ProjectService.prototype.listAuthorityEndpointConfigurations = function (source) {\n        return this.workerService.call('projectWorkerService', 'listAuthorityEndpointConfigurations', [source]);\n    };\n    ProjectService.prototype.loadRemoteEndpointConfiguration = function (source, templateId) {\n        return this.workerService.call('projectWorkerService', 'loadRemoteEndpointConfiguration', [source, templateId]);\n    };\n    ProjectService.prototype.listSchemas = function (source) {\n        return this.workerService.call('projectWorkerService', 'listSchemas', [source]);\n    };\n    ProjectService.prototype.loadSchema = function (source, id) {\n        return this.workerService.call('projectWorkerService', 'loadSchema', [source, id]);\n    };\n    ProjectService.prototype.listProjects = function (source) {\n        return this.workerService.call('projectWorkerService', 'listProjects', [source]);\n    };\n    ProjectService.prototype.loadProject = function (source, projectId, loadFull) {\n        return this.workerService.call('projectWorkerService', 'loadProject', [source, projectId, loadFull]);\n    };\n    ProjectService.prototype.deleteCitable = function (updateEndpoint, citable) {\n        return this.deleteObject(updateEndpoint, citable.id, citable.source.graph);\n    };\n    ProjectService.prototype.deleteObjects = function (updateEndpoint, ids, graph) {\n        var dq = graph ? ProjectService.deleteQuery.replace(/# STARTGRAPH/g, 'GRAPH <' + graph + '> {').replace(/# ENDGRAPH/g, '}') : ProjectService.deleteQuery.replace(/.*# STARTGRAPH\\n/g, '').replace(/.*# ENDGRAPH\\n/g, '');\n        dq = dq.replace(/# PATTERNS/g, ids.reduce(function (acc, id, index) {\n            return acc + ' <' + id + '> ?p' + index + ' ?o' + index + ' .';\n        }, ''));\n        return this.fibraSparqlService.update(updateEndpoint, dq);\n    };\n    ProjectService.prototype.deleteObject = function (updateEndpoint, id, graph) {\n        return this.deleteObjects(updateEndpoint, [id], graph);\n    };\n    ProjectService.prototype.saveCitable = function (updateEndpoint, graphStoreEndpoint, ps) {\n        var _this = this;\n        var m = new __WEBPACK_IMPORTED_MODULE_6__components_collection_utils__[\"c\" /* Map */]();\n        var prefixes = {};\n        ps.toTurtle(m, prefixes);\n        return this.deleteObjects(updateEndpoint, m.keys(), ps.source.graph).then(function () {\n            return _this.fibraSparqlService.post(graphStoreEndpoint, __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_7__components_misc_utils__[\"c\" /* toTurtle */])(prefixes, m), ps.source.graph);\n        });\n    };\n    return ProjectService;\n}();\n\nProjectService.deleteQuery = \"DELETE {\\n# STARTGRAPH\\n  # PATTERNS\\n# ENDGRAPH\\n}\\nWHERE {\\n# STARTGRAPH\\n  # PATTERNS\\n# ENDGRAPH\\n}\";\nvar ProjectWorkerService = function () {\n    function ProjectWorkerService(fibraSparqlService, $q) {\n        this.fibraSparqlService = fibraSparqlService;\n        this.$q = $q;\n    }\n    ProjectWorkerService.prototype.loadPrimaryEndpointConfiguration = function (source, templateId) {\n        return this.runSingleQuery(source, __WEBPACK_IMPORTED_MODULE_3__primary_endpoint_configuration__[\"a\" /* PrimaryEndpointConfiguration */].primaryEndpointConfigurationQuery, templateId, new __WEBPACK_IMPORTED_MODULE_3__primary_endpoint_configuration__[\"a\" /* PrimaryEndpointConfiguration */](templateId, source));\n    };\n    ProjectWorkerService.prototype.listPrimaryEndpointConfigurations = function (source) {\n        return this.runListQuery(source, __WEBPACK_IMPORTED_MODULE_3__primary_endpoint_configuration__[\"a\" /* PrimaryEndpointConfiguration */].listPrimaryEndpointConfigurationsQuery, function (id) {\n            return new __WEBPACK_IMPORTED_MODULE_3__primary_endpoint_configuration__[\"a\" /* PrimaryEndpointConfiguration */](id, source);\n        });\n    };\n    ProjectWorkerService.prototype.loadRemoteEndpointConfiguration = function (source, templateId) {\n        return this.runSingleQuery(source, __WEBPACK_IMPORTED_MODULE_4__remote_endpoint_configuration__[\"a\" /* RemoteEndpointConfiguration */].remoteEndpointConfigurationQuery, templateId, new __WEBPACK_IMPORTED_MODULE_4__remote_endpoint_configuration__[\"a\" /* RemoteEndpointConfiguration */](templateId, source));\n    };\n    ProjectWorkerService.prototype.listArchiveEndpointConfigurations = function (source) {\n        return this.runListQuery(source, __WEBPACK_IMPORTED_MODULE_4__remote_endpoint_configuration__[\"a\" /* RemoteEndpointConfiguration */].listArchiveEndpointConfigurationsQuery, function (id) {\n            return new __WEBPACK_IMPORTED_MODULE_4__remote_endpoint_configuration__[\"a\" /* RemoteEndpointConfiguration */](id, source);\n        });\n    };\n    ProjectWorkerService.prototype.listAuthorityEndpointConfigurations = function (source) {\n        return this.runListQuery(source, __WEBPACK_IMPORTED_MODULE_4__remote_endpoint_configuration__[\"a\" /* RemoteEndpointConfiguration */].listAuthorityEndpointConfigurationsQuery, function (id) {\n            return new __WEBPACK_IMPORTED_MODULE_4__remote_endpoint_configuration__[\"a\" /* RemoteEndpointConfiguration */](id, source);\n        });\n    };\n    ProjectWorkerService.prototype.listProjects = function (source) {\n        return this.runListQuery(source, __WEBPACK_IMPORTED_MODULE_2__project__[\"a\" /* Project */].listProjectsQuery, function (id) {\n            return new __WEBPACK_IMPORTED_MODULE_2__project__[\"a\" /* Project */](id, source);\n        });\n    };\n    ProjectWorkerService.prototype.listSchemas = function (source) {\n        return this.runListQuery(source, __WEBPACK_IMPORTED_MODULE_5__schema__[\"a\" /* Schema */].listSchemasQuery, function (id) {\n            return new __WEBPACK_IMPORTED_MODULE_5__schema__[\"a\" /* Schema */](id, source);\n        });\n    };\n    ProjectWorkerService.prototype.loadSchema = function (source, id) {\n        return this.runSingleQuery(source, __WEBPACK_IMPORTED_MODULE_5__schema__[\"a\" /* Schema */].schemaQuery, id, new __WEBPACK_IMPORTED_MODULE_5__schema__[\"a\" /* Schema */](id, source));\n    };\n    ProjectWorkerService.prototype.loadDataModel = function (schemas) {\n        var _this = this;\n        var dataModel = new __WEBPACK_IMPORTED_MODULE_9__data_model__[\"c\" /* DataModel */]();\n        var classes = new __WEBPACK_IMPORTED_MODULE_6__components_collection_utils__[\"a\" /* EMap */](function (id) {\n            var cl = new __WEBPACK_IMPORTED_MODULE_9__data_model__[\"a\" /* Class */](__WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].namedNode(id));\n            dataModel.classMap.set(id, cl);\n            return cl;\n        });\n        var properties = new __WEBPACK_IMPORTED_MODULE_6__components_collection_utils__[\"a\" /* EMap */](function (id) {\n            var pr = new __WEBPACK_IMPORTED_MODULE_9__data_model__[\"b\" /* Property */](__WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].namedNode(id));\n            dataModel.propertyMap.set(id, pr);\n            return pr;\n        });\n        var promises = [];\n        schemas.forEach(function (schema) {\n            promises.push(_this.fibraSparqlService.query(schema.endpoint, schema.classQuery).then(function (response) {\n                var conf = {\n                    bindingTypes: { types: 'uniqueArray' },\n                    bindingConverters: {\n                        superClasses: function (binding) {\n                            return classes.goc(binding.value);\n                        },\n                        subClasses: function (binding) {\n                            return classes.goc(binding.value);\n                        },\n                        types: function (binding) {\n                            return classes.goc(binding.value);\n                        },\n                        labels: function (binding) {\n                            return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                        },\n                        descriptions: function (binding) {\n                            return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                        }\n                    }\n                };\n                var tracker = new s.UniqueObjectTracker();\n                response.results.bindings.forEach(function (binding) {\n                    return s.SparqlService.bindingsToObject(binding, classes.goc(binding['id'].value), conf, tracker);\n                });\n            }));\n            promises.push(_this.fibraSparqlService.query(schema.endpoint, schema.propertyQuery).then(function (response) {\n                var conf = {\n                    bindingTypes: { types: 'uniqueArray' },\n                    bindingConverters: {\n                        superProperties: function (binding) {\n                            return properties.goc(binding.value);\n                        },\n                        subProperties: function (binding) {\n                            return properties.goc(binding.value);\n                        },\n                        inverseProperty: function (binding) {\n                            return properties.goc(binding.value);\n                        },\n                        types: function (binding) {\n                            return classes.goc(binding.value);\n                        },\n                        domains: function (binding) {\n                            return classes.goc(binding.value);\n                        },\n                        ranges: function (binding) {\n                            return classes.goc(binding.value);\n                        },\n                        labels: function (binding) {\n                            return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                        },\n                        descriptions: function (binding) {\n                            return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                        }\n                    }\n                };\n                var tracker = new s.UniqueObjectTracker();\n                response.results.bindings.forEach(function (binding) {\n                    return s.SparqlService.bindingsToObject(binding, properties.goc(binding['id'].value), conf, tracker);\n                });\n            }));\n        });\n        return this.$q.all(promises).then(function () {\n            classes.values().forEach(function (cl) {\n                cl.buildAsNodes();\n                cl.superClasses.filter(function (spr) {\n                    return !spr.subClasses.find(function (opr) {\n                        return opr === cl;\n                    });\n                }).forEach(function (spr) {\n                    return spr.subClasses.push(cl);\n                });\n                cl.subClasses.filter(function (spr) {\n                    return !spr.superClasses.find(function (opr) {\n                        return opr === cl;\n                    });\n                }).forEach(function (spr) {\n                    return spr.superClasses.push(cl);\n                });\n            });\n            classes.values().forEach(function (cl) {\n                if (cl.superClasses.length === 0) dataModel.rootClasses.push(cl);\n            });\n            properties.values().forEach(function (pr) {\n                pr.buildAsNodes();\n                if (pr.inverseProperty) pr.inverseProperty.inverseProperty = pr;\n                pr.superProperties.filter(function (spr) {\n                    return !spr.subProperties.find(function (opr) {\n                        return opr === pr;\n                    });\n                }).forEach(function (spr) {\n                    return spr.subProperties.push(pr);\n                });\n                pr.subProperties.filter(function (spr) {\n                    return !spr.superProperties.find(function (opr) {\n                        return opr === pr;\n                    });\n                }).forEach(function (spr) {\n                    return spr.superProperties.push(pr);\n                });\n                pr.domains.forEach(function (dc) {\n                    return dc.properties.push(pr);\n                });\n                pr.ranges.forEach(function (rc) {\n                    return rc.inverseProperties.push(pr);\n                });\n            });\n            properties.values().forEach(function (pr) {\n                if (pr.superProperties.length === 0) dataModel.rootProperties.push(pr);\n            });\n            return dataModel;\n        });\n    };\n    ProjectWorkerService.prototype.loadProject = function (source, id, loadFull) {\n        var _this = this;\n        var q = this.runSingleQuery(source, __WEBPACK_IMPORTED_MODULE_2__project__[\"a\" /* Project */].projectQuery, id, new __WEBPACK_IMPORTED_MODULE_2__project__[\"a\" /* Project */](id, source));\n        if (!loadFull) return q;else return q.then(function (p) {\n            var promises = [];\n            promises.push(_this.$q.all(p.schemas.map(function (schema) {\n                return _this.loadSchema(schema.source, schema.id);\n            })).then(function (schemas) {\n                p.schemas = schemas;\n                return _this.loadDataModel(schemas).then(function (dm) {\n                    return p.dataModel = dm;\n                });\n            }));\n            var narche = [];\n            var nauthe = [];\n            p.archiveEndpoints.forEach(function (ae) {\n                return promises.push(_this.loadRemoteEndpointConfiguration(ae.source, ae.id).then(function (ae2) {\n                    return narche.push(ae2);\n                }));\n            });\n            p.authorityEndpoints.forEach(function (ae) {\n                return promises.push(_this.loadRemoteEndpointConfiguration(ae.source, ae.id).then(function (ae2) {\n                    return nauthe.push(ae2);\n                }));\n            });\n            return _this.$q.all(promises).then(function () {\n                p.archiveEndpoints = narche;\n                p.authorityEndpoints = nauthe;\n                return p;\n            });\n        });\n    };\n    ProjectWorkerService.prototype.runSingleQuery = function (source, tq, id, ps) {\n        tq = source.graph ? tq.replace(/# STARTGRAPH/g, 'GRAPH <' + source.graph + '> {').replace(/# ENDGRAPH/g, '}') : tq.replace(/.*# STARTGRAPH\\n/g, '').replace(/.*# ENDGRAPH\\n/g, '');\n        tq = tq.replace(/<ID>/g, '<' + id + '>');\n        var deferred = this.$q.defer();\n        this.fibraSparqlService.query(source.sparqlEndpoint, tq).then(function (response) {\n            var conf = {\n                bindingTypes: { rightsHolders: 'uniqueArray', schemas: 'uniqueArray', authorityEndpoints: 'uniqueArray', archiveEndpoints: 'uniqueArray' },\n                bindingConverters: {\n                    types: function (binding) {\n                        return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                    },\n                    labels: function (binding) {\n                        return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                    },\n                    descriptions: function (binding) {\n                        return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                    },\n                    schemas: function (binding) {\n                        return new __WEBPACK_IMPORTED_MODULE_5__schema__[\"a\" /* Schema */](binding.value, __WEBPACK_IMPORTED_MODULE_1__models_citable__[\"b\" /* CitableSource */].clone(source));\n                    },\n                    authorityEndpoints: function (binding) {\n                        return new __WEBPACK_IMPORTED_MODULE_4__remote_endpoint_configuration__[\"a\" /* RemoteEndpointConfiguration */](binding.value, __WEBPACK_IMPORTED_MODULE_1__models_citable__[\"b\" /* CitableSource */].clone(source));\n                    },\n                    archiveEndpoints: function (binding) {\n                        return new __WEBPACK_IMPORTED_MODULE_4__remote_endpoint_configuration__[\"a\" /* RemoteEndpointConfiguration */](binding.value, __WEBPACK_IMPORTED_MODULE_1__models_citable__[\"b\" /* CitableSource */].clone(source));\n                    },\n                    rightsHolders_labels: function (binding) {\n                        return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                    },\n                    rightsHolders_descriptions: function (binding) {\n                        return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                    },\n                    rightsHolders: function (binding) {\n                        return new __WEBPACK_IMPORTED_MODULE_1__models_citable__[\"a\" /* Citable */](binding.value, source);\n                    }\n                }\n            };\n            var tracker = new s.UniqueObjectTracker();\n            response.results.bindings.forEach(function (b) {\n                return s.SparqlService.bindingsToObject(b, ps, conf, tracker);\n            });\n            ProjectService.orderCitables(ps.rightsHolders);\n            deferred.resolve(ps);\n        });\n        return deferred.promise;\n    };\n    ProjectWorkerService.prototype.runListQuery = function (source, lq, oc) {\n        lq = source.graph ? lq.replace(/# STARTGRAPH/g, 'GRAPH <' + source.graph + '> {').replace(/# ENDGRAPH/g, '}') : lq.replace(/.*# STARTGRAPH\\n/g, '').replace(/.*# ENDGRAPH\\n/g, '');\n        return this.fibraSparqlService.query(source.sparqlEndpoint, lq).then(function (response) {\n            var projects = new __WEBPACK_IMPORTED_MODULE_6__components_collection_utils__[\"a\" /* EMap */](oc);\n            var conf = {\n                bindingTypes: { rightsHolders: 'uniqueArray', schemas: 'uniqueArray', authorityEndpoints: 'uniqueArray', archiveEndpoints: 'uniqueArray' },\n                bindingConverters: {\n                    types: function (binding) {\n                        return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                    },\n                    labels: function (binding) {\n                        return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                    },\n                    descriptions: function (binding) {\n                        return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                    },\n                    schemas: function (binding) {\n                        return new __WEBPACK_IMPORTED_MODULE_5__schema__[\"a\" /* Schema */](binding.value, __WEBPACK_IMPORTED_MODULE_1__models_citable__[\"b\" /* CitableSource */].clone(source));\n                    },\n                    authorityEndpoints: function (binding) {\n                        return new __WEBPACK_IMPORTED_MODULE_4__remote_endpoint_configuration__[\"a\" /* RemoteEndpointConfiguration */](binding.value, __WEBPACK_IMPORTED_MODULE_1__models_citable__[\"b\" /* CitableSource */].clone(source));\n                    },\n                    archiveEndpoints: function (binding) {\n                        return new __WEBPACK_IMPORTED_MODULE_4__remote_endpoint_configuration__[\"a\" /* RemoteEndpointConfiguration */](binding.value, __WEBPACK_IMPORTED_MODULE_1__models_citable__[\"b\" /* CitableSource */].clone(source));\n                    },\n                    rightsHolders_labels: function (binding) {\n                        return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                    },\n                    rightsHolders_descriptions: function (binding) {\n                        return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                    },\n                    rightsHolders: function (binding) {\n                        return new __WEBPACK_IMPORTED_MODULE_1__models_citable__[\"a\" /* Citable */](binding.value, source);\n                    }\n                }\n            };\n            var tracker = new s.UniqueObjectTracker();\n            response.results.bindings.forEach(function (binding) {\n                return s.SparqlService.bindingsToObject(binding, projects.goc(binding['id'].value), conf, tracker);\n            });\n            projects.values().forEach(function (p) {\n                return ProjectService.orderCitables(p.rightsHolders);\n            });\n            return projects.values();\n        });\n    };\n    return ProjectWorkerService;\n}();\n\n__WEBPACK_IMPORTED_MODULE_0_angular__[\"module\"]('fibra.services.project-service', ['fibra.services.fibra-service', 'fibra.services.fibra-sparql-service']).config(function ($provide) {\n    $provide.service('projectService', ProjectService);\n    $provide.service('projectWorkerService', ProjectWorkerService);\n});//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvc2VydmljZXMvcHJvamVjdC1zZXJ2aWNlL3Byb2plY3Qtc2VydmljZS50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hcHAvc2VydmljZXMvcHJvamVjdC1zZXJ2aWNlL3Byb2plY3Qtc2VydmljZS50cz8xZTcwIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmltcG9ydCAqIGFzIGFuZ3VsYXIgZnJvbSAnYW5ndWxhcic7XG5pbXBvcnQgeyBDaXRhYmxlU291cmNlLCBDaXRhYmxlIH0gZnJvbSAnLi4vLi4vbW9kZWxzL2NpdGFibGUnO1xuaW1wb3J0IHsgUHJvamVjdCB9IGZyb20gJy4vcHJvamVjdCc7XG5pbXBvcnQgeyBQcmltYXJ5RW5kcG9pbnRDb25maWd1cmF0aW9uIH0gZnJvbSAnLi9wcmltYXJ5LWVuZHBvaW50LWNvbmZpZ3VyYXRpb24nO1xuaW1wb3J0IHsgUmVtb3RlRW5kcG9pbnRDb25maWd1cmF0aW9uIH0gZnJvbSAnLi9yZW1vdGUtZW5kcG9pbnQtY29uZmlndXJhdGlvbic7XG5pbXBvcnQgeyBTY2hlbWEgfSBmcm9tICcuL3NjaGVtYSc7XG5pbXBvcnQgeyBNYXAsIEVNYXAgfSBmcm9tICcuLi8uLi9jb21wb25lbnRzL2NvbGxlY3Rpb24tdXRpbHMnO1xuaW1wb3J0IHsgdG9UdXJ0bGUgfSBmcm9tICcuLi8uLi9jb21wb25lbnRzL21pc2MtdXRpbHMnO1xuaW1wb3J0IHsgRGF0YUZhY3RvcnkgfSBmcm9tICcuLi8uLi9tb2RlbHMvcmRmJztcbmltcG9ydCB7IERhdGFNb2RlbCwgQ2xhc3MsIFByb3BlcnR5IH0gZnJvbSAnLi9kYXRhLW1vZGVsJztcbnZhciBzID0gZmkuc2Vjby5zcGFycWw7XG52YXIgUHJvamVjdFNlcnZpY2UgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFByb2plY3RTZXJ2aWNlKHdvcmtlclNlcnZpY2UsIGZpYnJhU2VydmljZSwgZmlicmFTcGFycWxTZXJ2aWNlLCAkbG9jYWxTdG9yYWdlKSB7XG4gICAgICAgIHRoaXMud29ya2VyU2VydmljZSA9IHdvcmtlclNlcnZpY2U7XG4gICAgICAgIHRoaXMuZmlicmFTZXJ2aWNlID0gZmlicmFTZXJ2aWNlO1xuICAgICAgICB0aGlzLmZpYnJhU3BhcnFsU2VydmljZSA9IGZpYnJhU3BhcnFsU2VydmljZTtcbiAgICAgICAgdGhpcy4kbG9jYWxTdG9yYWdlID0gJGxvY2FsU3RvcmFnZTtcbiAgICAgICAgaWYgKCEkbG9jYWxTdG9yYWdlLnByb2plY3RTb3VyY2VzKVxuICAgICAgICAgICAgJGxvY2FsU3RvcmFnZS5wcm9qZWN0U291cmNlcyA9IFtdO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICAkbG9jYWxTdG9yYWdlLnByb2plY3RTb3VyY2VzLmZvckVhY2goZnVuY3Rpb24gKHBzKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFwcy5zcGFycWxFbmRwb2ludCkge1xuICAgICAgICAgICAgICAgICAgICBwcy5zcGFycWxFbmRwb2ludCA9IHBzWydlbmRwb2ludCddO1xuICAgICAgICAgICAgICAgICAgICBwcy51cGRhdGVFbmRwb2ludCA9IHBzWydlbmRwb2ludCddO1xuICAgICAgICAgICAgICAgICAgICBwcy5ncmFwaFN0b3JlRW5kcG9pbnQgPSBwc1snZW5kcG9pbnQnXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICB9XG4gICAgUHJvamVjdFNlcnZpY2Uub3JkZXJDaXRhYmxlcyA9IGZ1bmN0aW9uIChjaXRhYmxlcykge1xuICAgICAgICBjaXRhYmxlcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiAoYVsnb3JkZXInXSA/IGFbJ29yZGVyJ10gOiBOdW1iZXIuTUFYX1ZBTFVFKSAtIChiWydvcmRlciddID8gYlsnb3JkZXInXSA6IE51bWJlci5NQVhfVkFMVUUpOyB9KTtcbiAgICAgICAgY2l0YWJsZXMuZm9yRWFjaChmdW5jdGlvbiAocmgpIHsgcmV0dXJuIGRlbGV0ZSByaFsnb3JkZXInXTsgfSk7XG4gICAgfTtcbiAgICBQcm9qZWN0U2VydmljZS5wcm90b3R5cGUuZ2V0Q3VycmVudFByb2plY3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLnByb2plY3Q7XG4gICAgfTtcbiAgICBQcm9qZWN0U2VydmljZS5wcm90b3R5cGUuc2V0Q3VycmVudFByb2plY3QgPSBmdW5jdGlvbiAocHJvamVjdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5maWJyYVNlcnZpY2UuZGlzcGF0Y2hBY3Rpb24odGhpcy5maWJyYVNlcnZpY2Uuc2V0UHJvamVjdChwcm9qZWN0KSk7XG4gICAgfTtcbiAgICBQcm9qZWN0U2VydmljZS5wcm90b3R5cGUuZ2V0UHJvamVjdFNvdXJjZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRsb2NhbFN0b3JhZ2UucHJvamVjdFNvdXJjZXM7XG4gICAgfTtcbiAgICBQcm9qZWN0U2VydmljZS5wcm90b3R5cGUubGlzdFByaW1hcnlFbmRwb2ludENvbmZpZ3VyYXRpb25zID0gZnVuY3Rpb24gKHNvdXJjZSkge1xuICAgICAgICByZXR1cm4gdGhpcy53b3JrZXJTZXJ2aWNlLmNhbGwoJ3Byb2plY3RXb3JrZXJTZXJ2aWNlJywgJ2xpc3RQcmltYXJ5RW5kcG9pbnRDb25maWd1cmF0aW9ucycsIFtzb3VyY2VdKTtcbiAgICB9O1xuICAgIFByb2plY3RTZXJ2aWNlLnByb3RvdHlwZS5sb2FkUHJpbWFyeUVuZHBvaW50Q29uZmlndXJhdGlvbiA9IGZ1bmN0aW9uIChzb3VyY2UsIHRlbXBsYXRlSWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud29ya2VyU2VydmljZS5jYWxsKCdwcm9qZWN0V29ya2VyU2VydmljZScsICdsb2FkUHJpbWFyeUVuZHBvaW50Q29uZmlndXJhdGlvbicsIFtzb3VyY2UsIHRlbXBsYXRlSWRdKTtcbiAgICB9O1xuICAgIFByb2plY3RTZXJ2aWNlLnByb3RvdHlwZS5saXN0QXJjaGl2ZUVuZHBvaW50Q29uZmlndXJhdGlvbnMgPSBmdW5jdGlvbiAoc291cmNlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLndvcmtlclNlcnZpY2UuY2FsbCgncHJvamVjdFdvcmtlclNlcnZpY2UnLCAnbGlzdEFyY2hpdmVFbmRwb2ludENvbmZpZ3VyYXRpb25zJywgW3NvdXJjZV0pO1xuICAgIH07XG4gICAgUHJvamVjdFNlcnZpY2UucHJvdG90eXBlLmxpc3RBdXRob3JpdHlFbmRwb2ludENvbmZpZ3VyYXRpb25zID0gZnVuY3Rpb24gKHNvdXJjZSkge1xuICAgICAgICByZXR1cm4gdGhpcy53b3JrZXJTZXJ2aWNlLmNhbGwoJ3Byb2plY3RXb3JrZXJTZXJ2aWNlJywgJ2xpc3RBdXRob3JpdHlFbmRwb2ludENvbmZpZ3VyYXRpb25zJywgW3NvdXJjZV0pO1xuICAgIH07XG4gICAgUHJvamVjdFNlcnZpY2UucHJvdG90eXBlLmxvYWRSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb24gPSBmdW5jdGlvbiAoc291cmNlLCB0ZW1wbGF0ZUlkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLndvcmtlclNlcnZpY2UuY2FsbCgncHJvamVjdFdvcmtlclNlcnZpY2UnLCAnbG9hZFJlbW90ZUVuZHBvaW50Q29uZmlndXJhdGlvbicsIFtzb3VyY2UsIHRlbXBsYXRlSWRdKTtcbiAgICB9O1xuICAgIFByb2plY3RTZXJ2aWNlLnByb3RvdHlwZS5saXN0U2NoZW1hcyA9IGZ1bmN0aW9uIChzb3VyY2UpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud29ya2VyU2VydmljZS5jYWxsKCdwcm9qZWN0V29ya2VyU2VydmljZScsICdsaXN0U2NoZW1hcycsIFtzb3VyY2VdKTtcbiAgICB9O1xuICAgIFByb2plY3RTZXJ2aWNlLnByb3RvdHlwZS5sb2FkU2NoZW1hID0gZnVuY3Rpb24gKHNvdXJjZSwgaWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud29ya2VyU2VydmljZS5jYWxsKCdwcm9qZWN0V29ya2VyU2VydmljZScsICdsb2FkU2NoZW1hJywgW3NvdXJjZSwgaWRdKTtcbiAgICB9O1xuICAgIFByb2plY3RTZXJ2aWNlLnByb3RvdHlwZS5saXN0UHJvamVjdHMgPSBmdW5jdGlvbiAoc291cmNlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLndvcmtlclNlcnZpY2UuY2FsbCgncHJvamVjdFdvcmtlclNlcnZpY2UnLCAnbGlzdFByb2plY3RzJywgW3NvdXJjZV0pO1xuICAgIH07XG4gICAgUHJvamVjdFNlcnZpY2UucHJvdG90eXBlLmxvYWRQcm9qZWN0ID0gZnVuY3Rpb24gKHNvdXJjZSwgcHJvamVjdElkLCBsb2FkRnVsbCkge1xuICAgICAgICByZXR1cm4gdGhpcy53b3JrZXJTZXJ2aWNlLmNhbGwoJ3Byb2plY3RXb3JrZXJTZXJ2aWNlJywgJ2xvYWRQcm9qZWN0JywgW3NvdXJjZSwgcHJvamVjdElkLCBsb2FkRnVsbF0pO1xuICAgIH07XG4gICAgUHJvamVjdFNlcnZpY2UucHJvdG90eXBlLmRlbGV0ZUNpdGFibGUgPSBmdW5jdGlvbiAodXBkYXRlRW5kcG9pbnQsIGNpdGFibGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVsZXRlT2JqZWN0KHVwZGF0ZUVuZHBvaW50LCBjaXRhYmxlLmlkLCBjaXRhYmxlLnNvdXJjZS5ncmFwaCk7XG4gICAgfTtcbiAgICBQcm9qZWN0U2VydmljZS5wcm90b3R5cGUuZGVsZXRlT2JqZWN0cyA9IGZ1bmN0aW9uICh1cGRhdGVFbmRwb2ludCwgaWRzLCBncmFwaCkge1xuICAgICAgICB2YXIgZHEgPSBncmFwaCA/IFByb2plY3RTZXJ2aWNlLmRlbGV0ZVF1ZXJ5LnJlcGxhY2UoLyMgU1RBUlRHUkFQSC9nLCAnR1JBUEggPCcgKyBncmFwaCArICc+IHsnKS5yZXBsYWNlKC8jIEVOREdSQVBIL2csICd9JykgOiBQcm9qZWN0U2VydmljZS5kZWxldGVRdWVyeS5yZXBsYWNlKC8uKiMgU1RBUlRHUkFQSFxcbi9nLCAnJykucmVwbGFjZSgvLiojIEVOREdSQVBIXFxuL2csICcnKTtcbiAgICAgICAgZHEgPSBkcS5yZXBsYWNlKC8jIFBBVFRFUk5TL2csIGlkcy5yZWR1Y2UoZnVuY3Rpb24gKGFjYywgaWQsIGluZGV4KSB7IHJldHVybiBhY2MgKyAnIDwnICsgaWQgKyAnPiA/cCcgKyBpbmRleCArICcgP28nICsgaW5kZXggKyAnIC4nOyB9LCAnJykpO1xuICAgICAgICByZXR1cm4gdGhpcy5maWJyYVNwYXJxbFNlcnZpY2UudXBkYXRlKHVwZGF0ZUVuZHBvaW50LCBkcSk7XG4gICAgfTtcbiAgICBQcm9qZWN0U2VydmljZS5wcm90b3R5cGUuZGVsZXRlT2JqZWN0ID0gZnVuY3Rpb24gKHVwZGF0ZUVuZHBvaW50LCBpZCwgZ3JhcGgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVsZXRlT2JqZWN0cyh1cGRhdGVFbmRwb2ludCwgW2lkXSwgZ3JhcGgpO1xuICAgIH07XG4gICAgUHJvamVjdFNlcnZpY2UucHJvdG90eXBlLnNhdmVDaXRhYmxlID0gZnVuY3Rpb24gKHVwZGF0ZUVuZHBvaW50LCBncmFwaFN0b3JlRW5kcG9pbnQsIHBzKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBtID0gbmV3IE1hcCgpO1xuICAgICAgICB2YXIgcHJlZml4ZXMgPSB7fTtcbiAgICAgICAgcHMudG9UdXJ0bGUobSwgcHJlZml4ZXMpO1xuICAgICAgICByZXR1cm4gdGhpcy5kZWxldGVPYmplY3RzKHVwZGF0ZUVuZHBvaW50LCBtLmtleXMoKSwgcHMuc291cmNlLmdyYXBoKS50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmZpYnJhU3BhcnFsU2VydmljZS5wb3N0KGdyYXBoU3RvcmVFbmRwb2ludCwgdG9UdXJ0bGUocHJlZml4ZXMsIG0pLCBwcy5zb3VyY2UuZ3JhcGgpOyB9KTtcbiAgICB9O1xuICAgIHJldHVybiBQcm9qZWN0U2VydmljZTtcbn0oKSk7XG5leHBvcnQgeyBQcm9qZWN0U2VydmljZSB9O1xuUHJvamVjdFNlcnZpY2UuZGVsZXRlUXVlcnkgPSBcIkRFTEVURSB7XFxuIyBTVEFSVEdSQVBIXFxuICAjIFBBVFRFUk5TXFxuIyBFTkRHUkFQSFxcbn1cXG5XSEVSRSB7XFxuIyBTVEFSVEdSQVBIXFxuICAjIFBBVFRFUk5TXFxuIyBFTkRHUkFQSFxcbn1cIjtcbnZhciBQcm9qZWN0V29ya2VyU2VydmljZSA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gUHJvamVjdFdvcmtlclNlcnZpY2UoZmlicmFTcGFycWxTZXJ2aWNlLCAkcSkge1xuICAgICAgICB0aGlzLmZpYnJhU3BhcnFsU2VydmljZSA9IGZpYnJhU3BhcnFsU2VydmljZTtcbiAgICAgICAgdGhpcy4kcSA9ICRxO1xuICAgIH1cbiAgICBQcm9qZWN0V29ya2VyU2VydmljZS5wcm90b3R5cGUubG9hZFByaW1hcnlFbmRwb2ludENvbmZpZ3VyYXRpb24gPSBmdW5jdGlvbiAoc291cmNlLCB0ZW1wbGF0ZUlkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJ1blNpbmdsZVF1ZXJ5KHNvdXJjZSwgUHJpbWFyeUVuZHBvaW50Q29uZmlndXJhdGlvbi5wcmltYXJ5RW5kcG9pbnRDb25maWd1cmF0aW9uUXVlcnksIHRlbXBsYXRlSWQsIG5ldyBQcmltYXJ5RW5kcG9pbnRDb25maWd1cmF0aW9uKHRlbXBsYXRlSWQsIHNvdXJjZSkpO1xuICAgIH07XG4gICAgUHJvamVjdFdvcmtlclNlcnZpY2UucHJvdG90eXBlLmxpc3RQcmltYXJ5RW5kcG9pbnRDb25maWd1cmF0aW9ucyA9IGZ1bmN0aW9uIChzb3VyY2UpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucnVuTGlzdFF1ZXJ5KHNvdXJjZSwgUHJpbWFyeUVuZHBvaW50Q29uZmlndXJhdGlvbi5saXN0UHJpbWFyeUVuZHBvaW50Q29uZmlndXJhdGlvbnNRdWVyeSwgZnVuY3Rpb24gKGlkKSB7IHJldHVybiBuZXcgUHJpbWFyeUVuZHBvaW50Q29uZmlndXJhdGlvbihpZCwgc291cmNlKTsgfSk7XG4gICAgfTtcbiAgICBQcm9qZWN0V29ya2VyU2VydmljZS5wcm90b3R5cGUubG9hZFJlbW90ZUVuZHBvaW50Q29uZmlndXJhdGlvbiA9IGZ1bmN0aW9uIChzb3VyY2UsIHRlbXBsYXRlSWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucnVuU2luZ2xlUXVlcnkoc291cmNlLCBSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb24ucmVtb3RlRW5kcG9pbnRDb25maWd1cmF0aW9uUXVlcnksIHRlbXBsYXRlSWQsIG5ldyBSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb24odGVtcGxhdGVJZCwgc291cmNlKSk7XG4gICAgfTtcbiAgICBQcm9qZWN0V29ya2VyU2VydmljZS5wcm90b3R5cGUubGlzdEFyY2hpdmVFbmRwb2ludENvbmZpZ3VyYXRpb25zID0gZnVuY3Rpb24gKHNvdXJjZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5ydW5MaXN0UXVlcnkoc291cmNlLCBSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb24ubGlzdEFyY2hpdmVFbmRwb2ludENvbmZpZ3VyYXRpb25zUXVlcnksIGZ1bmN0aW9uIChpZCkgeyByZXR1cm4gbmV3IFJlbW90ZUVuZHBvaW50Q29uZmlndXJhdGlvbihpZCwgc291cmNlKTsgfSk7XG4gICAgfTtcbiAgICBQcm9qZWN0V29ya2VyU2VydmljZS5wcm90b3R5cGUubGlzdEF1dGhvcml0eUVuZHBvaW50Q29uZmlndXJhdGlvbnMgPSBmdW5jdGlvbiAoc291cmNlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJ1bkxpc3RRdWVyeShzb3VyY2UsIFJlbW90ZUVuZHBvaW50Q29uZmlndXJhdGlvbi5saXN0QXV0aG9yaXR5RW5kcG9pbnRDb25maWd1cmF0aW9uc1F1ZXJ5LCBmdW5jdGlvbiAoaWQpIHsgcmV0dXJuIG5ldyBSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb24oaWQsIHNvdXJjZSk7IH0pO1xuICAgIH07XG4gICAgUHJvamVjdFdvcmtlclNlcnZpY2UucHJvdG90eXBlLmxpc3RQcm9qZWN0cyA9IGZ1bmN0aW9uIChzb3VyY2UpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucnVuTGlzdFF1ZXJ5KHNvdXJjZSwgUHJvamVjdC5saXN0UHJvamVjdHNRdWVyeSwgZnVuY3Rpb24gKGlkKSB7IHJldHVybiBuZXcgUHJvamVjdChpZCwgc291cmNlKTsgfSk7XG4gICAgfTtcbiAgICBQcm9qZWN0V29ya2VyU2VydmljZS5wcm90b3R5cGUubGlzdFNjaGVtYXMgPSBmdW5jdGlvbiAoc291cmNlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJ1bkxpc3RRdWVyeShzb3VyY2UsIFNjaGVtYS5saXN0U2NoZW1hc1F1ZXJ5LCBmdW5jdGlvbiAoaWQpIHsgcmV0dXJuIG5ldyBTY2hlbWEoaWQsIHNvdXJjZSk7IH0pO1xuICAgIH07XG4gICAgUHJvamVjdFdvcmtlclNlcnZpY2UucHJvdG90eXBlLmxvYWRTY2hlbWEgPSBmdW5jdGlvbiAoc291cmNlLCBpZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ydW5TaW5nbGVRdWVyeShzb3VyY2UsIFNjaGVtYS5zY2hlbWFRdWVyeSwgaWQsIG5ldyBTY2hlbWEoaWQsIHNvdXJjZSkpO1xuICAgIH07XG4gICAgUHJvamVjdFdvcmtlclNlcnZpY2UucHJvdG90eXBlLmxvYWREYXRhTW9kZWwgPSBmdW5jdGlvbiAoc2NoZW1hcykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgZGF0YU1vZGVsID0gbmV3IERhdGFNb2RlbCgpO1xuICAgICAgICB2YXIgY2xhc3NlcyA9IG5ldyBFTWFwKGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgdmFyIGNsID0gbmV3IENsYXNzKERhdGFGYWN0b3J5Lm5hbWVkTm9kZShpZCkpO1xuICAgICAgICAgICAgZGF0YU1vZGVsLmNsYXNzTWFwLnNldChpZCwgY2wpO1xuICAgICAgICAgICAgcmV0dXJuIGNsO1xuICAgICAgICB9KTtcbiAgICAgICAgdmFyIHByb3BlcnRpZXMgPSBuZXcgRU1hcChmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIHZhciBwciA9IG5ldyBQcm9wZXJ0eShEYXRhRmFjdG9yeS5uYW1lZE5vZGUoaWQpKTtcbiAgICAgICAgICAgIGRhdGFNb2RlbC5wcm9wZXJ0eU1hcC5zZXQoaWQsIHByKTtcbiAgICAgICAgICAgIHJldHVybiBwcjtcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBwcm9taXNlcyA9IFtdO1xuICAgICAgICBzY2hlbWFzLmZvckVhY2goZnVuY3Rpb24gKHNjaGVtYSkge1xuICAgICAgICAgICAgcHJvbWlzZXMucHVzaChfdGhpcy5maWJyYVNwYXJxbFNlcnZpY2UucXVlcnkoc2NoZW1hLmVuZHBvaW50LCBzY2hlbWEuY2xhc3NRdWVyeSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29uZiA9IHtcbiAgICAgICAgICAgICAgICAgICAgYmluZGluZ1R5cGVzOiB7IHR5cGVzOiAndW5pcXVlQXJyYXknIH0sXG4gICAgICAgICAgICAgICAgICAgIGJpbmRpbmdDb252ZXJ0ZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdXBlckNsYXNzZXM6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBjbGFzc2VzLmdvYyhiaW5kaW5nLnZhbHVlKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1YkNsYXNzZXM6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBjbGFzc2VzLmdvYyhiaW5kaW5nLnZhbHVlKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVzOiBmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gY2xhc3Nlcy5nb2MoYmluZGluZy52YWx1ZSk7IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbHM6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBEYXRhRmFjdG9yeS5ub2RlRnJvbUJpbmRpbmcoYmluZGluZyk7IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbnM6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBEYXRhRmFjdG9yeS5ub2RlRnJvbUJpbmRpbmcoYmluZGluZyk7IH0sXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHZhciB0cmFja2VyID0gbmV3IHMuVW5pcXVlT2JqZWN0VHJhY2tlcigpO1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlLnJlc3VsdHMuYmluZGluZ3MuZm9yRWFjaChmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gcy5TcGFycWxTZXJ2aWNlLmJpbmRpbmdzVG9PYmplY3QoYmluZGluZywgY2xhc3Nlcy5nb2MoYmluZGluZ1snaWQnXS52YWx1ZSksIGNvbmYsIHRyYWNrZXIpOyB9KTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIHByb21pc2VzLnB1c2goX3RoaXMuZmlicmFTcGFycWxTZXJ2aWNlLnF1ZXJ5KHNjaGVtYS5lbmRwb2ludCwgc2NoZW1hLnByb3BlcnR5UXVlcnkpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbmYgPSB7XG4gICAgICAgICAgICAgICAgICAgIGJpbmRpbmdUeXBlczogeyB0eXBlczogJ3VuaXF1ZUFycmF5JyB9LFxuICAgICAgICAgICAgICAgICAgICBiaW5kaW5nQ29udmVydGVyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3VwZXJQcm9wZXJ0aWVzOiBmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gcHJvcGVydGllcy5nb2MoYmluZGluZy52YWx1ZSk7IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBzdWJQcm9wZXJ0aWVzOiBmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gcHJvcGVydGllcy5nb2MoYmluZGluZy52YWx1ZSk7IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnZlcnNlUHJvcGVydHk6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBwcm9wZXJ0aWVzLmdvYyhiaW5kaW5nLnZhbHVlKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVzOiBmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gY2xhc3Nlcy5nb2MoYmluZGluZy52YWx1ZSk7IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBkb21haW5zOiBmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gY2xhc3Nlcy5nb2MoYmluZGluZy52YWx1ZSk7IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICByYW5nZXM6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBjbGFzc2VzLmdvYyhiaW5kaW5nLnZhbHVlKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsczogZnVuY3Rpb24gKGJpbmRpbmcpIHsgcmV0dXJuIERhdGFGYWN0b3J5Lm5vZGVGcm9tQmluZGluZyhiaW5kaW5nKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uczogZnVuY3Rpb24gKGJpbmRpbmcpIHsgcmV0dXJuIERhdGFGYWN0b3J5Lm5vZGVGcm9tQmluZGluZyhiaW5kaW5nKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdmFyIHRyYWNrZXIgPSBuZXcgcy5VbmlxdWVPYmplY3RUcmFja2VyKCk7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UucmVzdWx0cy5iaW5kaW5ncy5mb3JFYWNoKGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBzLlNwYXJxbFNlcnZpY2UuYmluZGluZ3NUb09iamVjdChiaW5kaW5nLCBwcm9wZXJ0aWVzLmdvYyhiaW5kaW5nWydpZCddLnZhbHVlKSwgY29uZiwgdHJhY2tlcik7IH0pO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHEuYWxsKHByb21pc2VzKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNsYXNzZXMudmFsdWVzKCkuZm9yRWFjaChmdW5jdGlvbiAoY2wpIHtcbiAgICAgICAgICAgICAgICBjbC5idWlsZEFzTm9kZXMoKTtcbiAgICAgICAgICAgICAgICBjbC5zdXBlckNsYXNzZXMuZmlsdGVyKGZ1bmN0aW9uIChzcHIpIHsgcmV0dXJuICFzcHIuc3ViQ2xhc3Nlcy5maW5kKGZ1bmN0aW9uIChvcHIpIHsgcmV0dXJuIG9wciA9PT0gY2w7IH0pOyB9KS5mb3JFYWNoKGZ1bmN0aW9uIChzcHIpIHsgcmV0dXJuIHNwci5zdWJDbGFzc2VzLnB1c2goY2wpOyB9KTtcbiAgICAgICAgICAgICAgICBjbC5zdWJDbGFzc2VzLmZpbHRlcihmdW5jdGlvbiAoc3ByKSB7IHJldHVybiAhc3ByLnN1cGVyQ2xhc3Nlcy5maW5kKGZ1bmN0aW9uIChvcHIpIHsgcmV0dXJuIG9wciA9PT0gY2w7IH0pOyB9KS5mb3JFYWNoKGZ1bmN0aW9uIChzcHIpIHsgcmV0dXJuIHNwci5zdXBlckNsYXNzZXMucHVzaChjbCk7IH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjbGFzc2VzLnZhbHVlcygpLmZvckVhY2goZnVuY3Rpb24gKGNsKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNsLnN1cGVyQ2xhc3Nlcy5sZW5ndGggPT09IDApXG4gICAgICAgICAgICAgICAgICAgIGRhdGFNb2RlbC5yb290Q2xhc3Nlcy5wdXNoKGNsKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcHJvcGVydGllcy52YWx1ZXMoKS5mb3JFYWNoKGZ1bmN0aW9uIChwcikge1xuICAgICAgICAgICAgICAgIHByLmJ1aWxkQXNOb2RlcygpO1xuICAgICAgICAgICAgICAgIGlmIChwci5pbnZlcnNlUHJvcGVydHkpXG4gICAgICAgICAgICAgICAgICAgIHByLmludmVyc2VQcm9wZXJ0eS5pbnZlcnNlUHJvcGVydHkgPSBwcjtcbiAgICAgICAgICAgICAgICBwci5zdXBlclByb3BlcnRpZXMuZmlsdGVyKGZ1bmN0aW9uIChzcHIpIHsgcmV0dXJuICFzcHIuc3ViUHJvcGVydGllcy5maW5kKGZ1bmN0aW9uIChvcHIpIHsgcmV0dXJuIG9wciA9PT0gcHI7IH0pOyB9KS5mb3JFYWNoKGZ1bmN0aW9uIChzcHIpIHsgcmV0dXJuIHNwci5zdWJQcm9wZXJ0aWVzLnB1c2gocHIpOyB9KTtcbiAgICAgICAgICAgICAgICBwci5zdWJQcm9wZXJ0aWVzLmZpbHRlcihmdW5jdGlvbiAoc3ByKSB7IHJldHVybiAhc3ByLnN1cGVyUHJvcGVydGllcy5maW5kKGZ1bmN0aW9uIChvcHIpIHsgcmV0dXJuIG9wciA9PT0gcHI7IH0pOyB9KS5mb3JFYWNoKGZ1bmN0aW9uIChzcHIpIHsgcmV0dXJuIHNwci5zdXBlclByb3BlcnRpZXMucHVzaChwcik7IH0pO1xuICAgICAgICAgICAgICAgIHByLmRvbWFpbnMuZm9yRWFjaChmdW5jdGlvbiAoZGMpIHsgcmV0dXJuIGRjLnByb3BlcnRpZXMucHVzaChwcik7IH0pO1xuICAgICAgICAgICAgICAgIHByLnJhbmdlcy5mb3JFYWNoKGZ1bmN0aW9uIChyYykgeyByZXR1cm4gcmMuaW52ZXJzZVByb3BlcnRpZXMucHVzaChwcik7IH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBwcm9wZXJ0aWVzLnZhbHVlcygpLmZvckVhY2goZnVuY3Rpb24gKHByKSB7XG4gICAgICAgICAgICAgICAgaWYgKHByLnN1cGVyUHJvcGVydGllcy5sZW5ndGggPT09IDApXG4gICAgICAgICAgICAgICAgICAgIGRhdGFNb2RlbC5yb290UHJvcGVydGllcy5wdXNoKHByKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGFNb2RlbDtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBQcm9qZWN0V29ya2VyU2VydmljZS5wcm90b3R5cGUubG9hZFByb2plY3QgPSBmdW5jdGlvbiAoc291cmNlLCBpZCwgbG9hZEZ1bGwpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIHEgPSB0aGlzLnJ1blNpbmdsZVF1ZXJ5KHNvdXJjZSwgUHJvamVjdC5wcm9qZWN0UXVlcnksIGlkLCBuZXcgUHJvamVjdChpZCwgc291cmNlKSk7XG4gICAgICAgIGlmICghbG9hZEZ1bGwpXG4gICAgICAgICAgICByZXR1cm4gcTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIHEudGhlbihmdW5jdGlvbiAocCkge1xuICAgICAgICAgICAgICAgIHZhciBwcm9taXNlcyA9IFtdO1xuICAgICAgICAgICAgICAgIHByb21pc2VzLnB1c2goX3RoaXMuJHEuYWxsKHAuc2NoZW1hcy5tYXAoZnVuY3Rpb24gKHNjaGVtYSkgeyByZXR1cm4gX3RoaXMubG9hZFNjaGVtYShzY2hlbWEuc291cmNlLCBzY2hlbWEuaWQpOyB9KSkudGhlbihmdW5jdGlvbiAoc2NoZW1hcykge1xuICAgICAgICAgICAgICAgICAgICBwLnNjaGVtYXMgPSBzY2hlbWFzO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMubG9hZERhdGFNb2RlbChzY2hlbWFzKS50aGVuKGZ1bmN0aW9uIChkbSkgeyByZXR1cm4gcC5kYXRhTW9kZWwgPSBkbTsgfSk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIHZhciBuYXJjaGUgPSBbXTtcbiAgICAgICAgICAgICAgICB2YXIgbmF1dGhlID0gW107XG4gICAgICAgICAgICAgICAgcC5hcmNoaXZlRW5kcG9pbnRzLmZvckVhY2goZnVuY3Rpb24gKGFlKSB7IHJldHVybiBwcm9taXNlcy5wdXNoKF90aGlzLmxvYWRSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb24oYWUuc291cmNlLCBhZS5pZCkudGhlbihmdW5jdGlvbiAoYWUyKSB7IHJldHVybiBuYXJjaGUucHVzaChhZTIpOyB9KSk7IH0pO1xuICAgICAgICAgICAgICAgIHAuYXV0aG9yaXR5RW5kcG9pbnRzLmZvckVhY2goZnVuY3Rpb24gKGFlKSB7IHJldHVybiBwcm9taXNlcy5wdXNoKF90aGlzLmxvYWRSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb24oYWUuc291cmNlLCBhZS5pZCkudGhlbihmdW5jdGlvbiAoYWUyKSB7IHJldHVybiBuYXV0aGUucHVzaChhZTIpOyB9KSk7IH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy4kcS5hbGwocHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBwLmFyY2hpdmVFbmRwb2ludHMgPSBuYXJjaGU7XG4gICAgICAgICAgICAgICAgICAgIHAuYXV0aG9yaXR5RW5kcG9pbnRzID0gbmF1dGhlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgIH07XG4gICAgUHJvamVjdFdvcmtlclNlcnZpY2UucHJvdG90eXBlLnJ1blNpbmdsZVF1ZXJ5ID0gZnVuY3Rpb24gKHNvdXJjZSwgdHEsIGlkLCBwcykge1xuICAgICAgICB0cSA9IHNvdXJjZS5ncmFwaCA/IHRxLnJlcGxhY2UoLyMgU1RBUlRHUkFQSC9nLCAnR1JBUEggPCcgKyBzb3VyY2UuZ3JhcGggKyAnPiB7JykucmVwbGFjZSgvIyBFTkRHUkFQSC9nLCAnfScpIDogdHEucmVwbGFjZSgvLiojIFNUQVJUR1JBUEhcXG4vZywgJycpLnJlcGxhY2UoLy4qIyBFTkRHUkFQSFxcbi9nLCAnJyk7XG4gICAgICAgIHRxID0gdHEucmVwbGFjZSgvPElEPi9nLCAnPCcgKyBpZCArICc+Jyk7XG4gICAgICAgIHZhciBkZWZlcnJlZCA9IHRoaXMuJHEuZGVmZXIoKTtcbiAgICAgICAgdGhpcy5maWJyYVNwYXJxbFNlcnZpY2UucXVlcnkoc291cmNlLnNwYXJxbEVuZHBvaW50LCB0cSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHZhciBjb25mID0ge1xuICAgICAgICAgICAgICAgIGJpbmRpbmdUeXBlczogeyByaWdodHNIb2xkZXJzOiAndW5pcXVlQXJyYXknLCBzY2hlbWFzOiAndW5pcXVlQXJyYXknLCBhdXRob3JpdHlFbmRwb2ludHM6ICd1bmlxdWVBcnJheScsIGFyY2hpdmVFbmRwb2ludHM6ICd1bmlxdWVBcnJheScgfSxcbiAgICAgICAgICAgICAgICBiaW5kaW5nQ29udmVydGVyczoge1xuICAgICAgICAgICAgICAgICAgICB0eXBlczogZnVuY3Rpb24gKGJpbmRpbmcpIHsgcmV0dXJuIERhdGFGYWN0b3J5Lm5vZGVGcm9tQmluZGluZyhiaW5kaW5nKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgbGFiZWxzOiBmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gRGF0YUZhY3Rvcnkubm9kZUZyb21CaW5kaW5nKGJpbmRpbmcpOyB9LFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbnM6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBEYXRhRmFjdG9yeS5ub2RlRnJvbUJpbmRpbmcoYmluZGluZyk7IH0sXG4gICAgICAgICAgICAgICAgICAgIHNjaGVtYXM6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBuZXcgU2NoZW1hKGJpbmRpbmcudmFsdWUsIENpdGFibGVTb3VyY2UuY2xvbmUoc291cmNlKSk7IH0sXG4gICAgICAgICAgICAgICAgICAgIGF1dGhvcml0eUVuZHBvaW50czogZnVuY3Rpb24gKGJpbmRpbmcpIHsgcmV0dXJuIG5ldyBSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb24oYmluZGluZy52YWx1ZSwgQ2l0YWJsZVNvdXJjZS5jbG9uZShzb3VyY2UpKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgYXJjaGl2ZUVuZHBvaW50czogZnVuY3Rpb24gKGJpbmRpbmcpIHsgcmV0dXJuIG5ldyBSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb24oYmluZGluZy52YWx1ZSwgQ2l0YWJsZVNvdXJjZS5jbG9uZShzb3VyY2UpKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgcmlnaHRzSG9sZGVyc19sYWJlbHM6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBEYXRhRmFjdG9yeS5ub2RlRnJvbUJpbmRpbmcoYmluZGluZyk7IH0sXG4gICAgICAgICAgICAgICAgICAgIHJpZ2h0c0hvbGRlcnNfZGVzY3JpcHRpb25zOiBmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gRGF0YUZhY3Rvcnkubm9kZUZyb21CaW5kaW5nKGJpbmRpbmcpOyB9LFxuICAgICAgICAgICAgICAgICAgICByaWdodHNIb2xkZXJzOiBmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gbmV3IENpdGFibGUoYmluZGluZy52YWx1ZSwgc291cmNlKTsgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgdHJhY2tlciA9IG5ldyBzLlVuaXF1ZU9iamVjdFRyYWNrZXIoKTtcbiAgICAgICAgICAgIHJlc3BvbnNlLnJlc3VsdHMuYmluZGluZ3MuZm9yRWFjaChmdW5jdGlvbiAoYikgeyByZXR1cm4gcy5TcGFycWxTZXJ2aWNlLmJpbmRpbmdzVG9PYmplY3QoYiwgcHMsIGNvbmYsIHRyYWNrZXIpOyB9KTtcbiAgICAgICAgICAgIFByb2plY3RTZXJ2aWNlLm9yZGVyQ2l0YWJsZXMocHMucmlnaHRzSG9sZGVycyk7XG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHBzKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH07XG4gICAgUHJvamVjdFdvcmtlclNlcnZpY2UucHJvdG90eXBlLnJ1bkxpc3RRdWVyeSA9IGZ1bmN0aW9uIChzb3VyY2UsIGxxLCBvYykge1xuICAgICAgICBscSA9IHNvdXJjZS5ncmFwaCA/IGxxLnJlcGxhY2UoLyMgU1RBUlRHUkFQSC9nLCAnR1JBUEggPCcgKyBzb3VyY2UuZ3JhcGggKyAnPiB7JykucmVwbGFjZSgvIyBFTkRHUkFQSC9nLCAnfScpIDogbHEucmVwbGFjZSgvLiojIFNUQVJUR1JBUEhcXG4vZywgJycpLnJlcGxhY2UoLy4qIyBFTkRHUkFQSFxcbi9nLCAnJyk7XG4gICAgICAgIHJldHVybiB0aGlzLmZpYnJhU3BhcnFsU2VydmljZS5xdWVyeShzb3VyY2Uuc3BhcnFsRW5kcG9pbnQsIGxxKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgdmFyIHByb2plY3RzID0gbmV3IEVNYXAob2MpO1xuICAgICAgICAgICAgdmFyIGNvbmYgPSB7XG4gICAgICAgICAgICAgICAgYmluZGluZ1R5cGVzOiB7IHJpZ2h0c0hvbGRlcnM6ICd1bmlxdWVBcnJheScsIHNjaGVtYXM6ICd1bmlxdWVBcnJheScsIGF1dGhvcml0eUVuZHBvaW50czogJ3VuaXF1ZUFycmF5JywgYXJjaGl2ZUVuZHBvaW50czogJ3VuaXF1ZUFycmF5JyB9LFxuICAgICAgICAgICAgICAgIGJpbmRpbmdDb252ZXJ0ZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGVzOiBmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gRGF0YUZhY3Rvcnkubm9kZUZyb21CaW5kaW5nKGJpbmRpbmcpOyB9LFxuICAgICAgICAgICAgICAgICAgICBsYWJlbHM6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBEYXRhRmFjdG9yeS5ub2RlRnJvbUJpbmRpbmcoYmluZGluZyk7IH0sXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uczogZnVuY3Rpb24gKGJpbmRpbmcpIHsgcmV0dXJuIERhdGFGYWN0b3J5Lm5vZGVGcm9tQmluZGluZyhiaW5kaW5nKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgc2NoZW1hczogZnVuY3Rpb24gKGJpbmRpbmcpIHsgcmV0dXJuIG5ldyBTY2hlbWEoYmluZGluZy52YWx1ZSwgQ2l0YWJsZVNvdXJjZS5jbG9uZShzb3VyY2UpKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgYXV0aG9yaXR5RW5kcG9pbnRzOiBmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gbmV3IFJlbW90ZUVuZHBvaW50Q29uZmlndXJhdGlvbihiaW5kaW5nLnZhbHVlLCBDaXRhYmxlU291cmNlLmNsb25lKHNvdXJjZSkpOyB9LFxuICAgICAgICAgICAgICAgICAgICBhcmNoaXZlRW5kcG9pbnRzOiBmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gbmV3IFJlbW90ZUVuZHBvaW50Q29uZmlndXJhdGlvbihiaW5kaW5nLnZhbHVlLCBDaXRhYmxlU291cmNlLmNsb25lKHNvdXJjZSkpOyB9LFxuICAgICAgICAgICAgICAgICAgICByaWdodHNIb2xkZXJzX2xhYmVsczogZnVuY3Rpb24gKGJpbmRpbmcpIHsgcmV0dXJuIERhdGFGYWN0b3J5Lm5vZGVGcm9tQmluZGluZyhiaW5kaW5nKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgcmlnaHRzSG9sZGVyc19kZXNjcmlwdGlvbnM6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBEYXRhRmFjdG9yeS5ub2RlRnJvbUJpbmRpbmcoYmluZGluZyk7IH0sXG4gICAgICAgICAgICAgICAgICAgIHJpZ2h0c0hvbGRlcnM6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBuZXcgQ2l0YWJsZShiaW5kaW5nLnZhbHVlLCBzb3VyY2UpOyB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciB0cmFja2VyID0gbmV3IHMuVW5pcXVlT2JqZWN0VHJhY2tlcigpO1xuICAgICAgICAgICAgcmVzcG9uc2UucmVzdWx0cy5iaW5kaW5ncy5mb3JFYWNoKGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBzLlNwYXJxbFNlcnZpY2UuYmluZGluZ3NUb09iamVjdChiaW5kaW5nLCBwcm9qZWN0cy5nb2MoYmluZGluZ1snaWQnXS52YWx1ZSksIGNvbmYsIHRyYWNrZXIpOyB9KTtcbiAgICAgICAgICAgIHByb2plY3RzLnZhbHVlcygpLmZvckVhY2goZnVuY3Rpb24gKHApIHsgcmV0dXJuIFByb2plY3RTZXJ2aWNlLm9yZGVyQ2l0YWJsZXMocC5yaWdodHNIb2xkZXJzKTsgfSk7XG4gICAgICAgICAgICByZXR1cm4gcHJvamVjdHMudmFsdWVzKCk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcmV0dXJuIFByb2plY3RXb3JrZXJTZXJ2aWNlO1xufSgpKTtcbmV4cG9ydCB7IFByb2plY3RXb3JrZXJTZXJ2aWNlIH07XG5hbmd1bGFyLm1vZHVsZSgnZmlicmEuc2VydmljZXMucHJvamVjdC1zZXJ2aWNlJywgW1xuICAgICdmaWJyYS5zZXJ2aWNlcy5maWJyYS1zZXJ2aWNlJyxcbiAgICAnZmlicmEuc2VydmljZXMuZmlicmEtc3BhcnFsLXNlcnZpY2UnXG5dKVxuICAgIC5jb25maWcoZnVuY3Rpb24gKCRwcm92aWRlKSB7XG4gICAgJHByb3ZpZGUuc2VydmljZSgncHJvamVjdFNlcnZpY2UnLCBQcm9qZWN0U2VydmljZSk7XG4gICAgJHByb3ZpZGUuc2VydmljZSgncHJvamVjdFdvcmtlclNlcnZpY2UnLCBQcm9qZWN0V29ya2VyU2VydmljZSk7XG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBhcHAvc2VydmljZXMvcHJvamVjdC1zZXJ2aWNlL3Byb2plY3Qtc2VydmljZS50cyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBTEE7QUFGQTtBQVVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQVJBO0FBRkE7QUFhQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQVRBO0FBRkE7QUFjQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQVRBO0FBRkE7QUFjQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),

/***/ "./app/services/worker-service/worker-service.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__prototype_mapping_configuration__ = __webpack_require__(\"./app/services/worker-service/prototype-mapping-configuration.ts\");\n/* unused harmony export WorkerServiceConfiguration */\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"b\", function() { return WorkerService; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return WorkerWorkerService; });\n/* unused harmony export StateWorkerService */\n\n\n\n\nvar WorkerServiceConfiguration = function () {\n    function WorkerServiceConfiguration(appName, workerThreads, importScripts) {\n        this.appName = appName;\n        this.workerThreads = workerThreads;\n        this.importScripts = importScripts;\n    }\n    return WorkerServiceConfiguration;\n}();\n\nvar WorkerService = function () {\n    function WorkerService(workerServiceConfiguration, workerServicePrototypeMappingConfiguration, $rootScope, $window, $q) {\n        var _this = this;\n        this.workerServicePrototypeMappingConfiguration = workerServicePrototypeMappingConfiguration;\n        this.$q = $q;\n        this.currentWorker = 0;\n        this.deferreds = [];\n        var path = $window.location.protocol + '//' + $window.location.host;\n        var importScripts = workerServiceConfiguration.importScripts.map(function (s) {\n            return s.indexOf('http') !== 0 ? path + (s.indexOf('/') !== 0 ? $window.location.pathname : '') + s : s;\n        });\n        var blobURL = $window.URL.createObjectURL(new Blob([WorkerService.workerTemplate.replace(/<APP_NAME>/g, workerServiceConfiguration.appName).replace(/<IMPORT_SCRIPTS>/g, importScripts.join('\\',\\''))], { type: 'application/javascript' }));\n        this.workers = [];\n        for (var i = 0; i < workerServiceConfiguration.workerThreads; i++) {\n            this.workers.push(new Worker(blobURL));\n            this.workers[i].addEventListener('message', function (e) {\n                var eventId = e.data.event;\n                if (eventId === 'broadcast') {\n                    $rootScope.$broadcast(e.data.name, _this.restorePrototypes(e.data.args));\n                    $rootScope.$apply();\n                } else {\n                    var deferred = _this.deferreds[e.data.id];\n                    if (deferred) {\n                        if (eventId === 'success') {\n                            delete _this.deferreds[e.data.id];\n                            deferred.resolve(_this.restorePrototypes(e.data.data));\n                        } else if (eventId === 'failure') {\n                            delete _this.deferreds[e.data.id];\n                            deferred.reject(_this.restorePrototypes(e.data.data));\n                        } else deferred.notify(_this.restorePrototypes(e.data.data));\n                    }\n                }\n            });\n        }\n    }\n    WorkerService.stripMarks = function (args) {\n        if (!args || !args.__mark || typeof args !== 'object') return;\n        delete args.__mark;\n        if (args instanceof Array) args.forEach(function (arg) {\n            return WorkerService.stripMarks(arg);\n        });else {\n            for (var key in args) if (args.hasOwnProperty(key)) WorkerService.stripMarks(args[key]);\n        }\n    };\n    WorkerService.stripPrototypes = function (args) {\n        if (!args || !args.__className || typeof args !== 'object') return;\n        delete args.__className;\n        if (args instanceof Array) args.forEach(function (arg) {\n            return WorkerService.stripPrototypes(arg);\n        });else {\n            for (var key in args) if (args.hasOwnProperty(key)) WorkerService.stripPrototypes(args[key]);\n        }\n    };\n    WorkerService.savePrototypes = function (args) {\n        WorkerService.stripPrototypes(args);\n        this.savePrototypesInternal(args);\n        return args;\n    };\n    WorkerService.savePrototypesInternal = function (args) {\n        if (!args || args.__className || typeof args !== 'object') return;\n        if (args instanceof Array) args.forEach(function (arg) {\n            return WorkerService.savePrototypesInternal(arg);\n        });else {\n            if (args.constructor.__name || args.constructor.name !== 'Object') {\n                var currentPrototype = Object.getPrototypeOf(args);\n                out: while (currentPrototype !== Object.prototype) {\n                    for (var _i = 0, _a = Object.getOwnPropertyNames(currentPrototype); _i < _a.length; _i++) {\n                        var prop = _a[_i];\n                        if (prop !== 'constructor' && typeof args.__proto__[prop] === 'function') {\n                            args.__className = args.constructor.__name ? args.constructor.__name : args.constructor.name;\n                            break out;\n                        }\n                    }\n                    currentPrototype = Object.getPrototypeOf(currentPrototype);\n                }\n                if (!args.__className) args.__className = 'Object';\n            }\n            for (var key in args) if (args.hasOwnProperty(key)) WorkerService.savePrototypesInternal(args[key]);\n        }\n    };\n    WorkerService.prototype.$broadcast = function (name, args) {\n        this.workers.forEach(function (w) {\n            return w.postMessage({ name: name, args: WorkerService.savePrototypes(args) });\n        });\n    };\n    WorkerService.prototype.callAll = function (service, method, args, canceller) {\n        var _this = this;\n        if (args === void 0) {\n            args = [];\n        }\n        var deferred = this.$q.defer();\n        this.deferreds.push(deferred);\n        var id = this.deferreds.length - 1;\n        var message = {\n            id: id,\n            service: service,\n            method: method,\n            args: WorkerService.savePrototypes(args)\n        };\n        if (canceller) canceller.then(function () {\n            _this.workers.forEach(function (worker) {\n                return worker.postMessage({\n                    id: id,\n                    cancel: true\n                });\n            });\n            delete _this.deferreds[id];\n        });\n        this.workers.forEach(function (worker) {\n            return worker.postMessage(message);\n        });\n        return deferred.promise;\n    };\n    WorkerService.prototype.call = function (service, method, args, canceller) {\n        var _this = this;\n        if (args === void 0) {\n            args = [];\n        }\n        var deferred = this.$q.defer();\n        this.deferreds.push(deferred);\n        var id = this.deferreds.length - 1;\n        var worker = this.workers[this.currentWorker];\n        this.currentWorker = (this.currentWorker + 1) % this.workers.length;\n        if (canceller) canceller.then(function () {\n            worker.postMessage({\n                id: id,\n                cancel: true\n            });\n            delete _this.deferreds[id];\n        });\n        worker.postMessage({\n            id: id,\n            service: service,\n            method: method,\n            args: WorkerService.savePrototypes(args)\n        });\n        return deferred.promise;\n    };\n    WorkerService.prototype.restorePrototypes = function (args) {\n        this.restorePrototypesInternal(args);\n        WorkerService.stripMarks(args);\n        return args;\n    };\n    WorkerService.prototype.restorePrototypesInternal = function (args) {\n        var _this = this;\n        if (!args || args.__mark || typeof args !== 'object') return;\n        args.__mark = true;\n        if (args instanceof Array) args.forEach(function (arg) {\n            return _this.restorePrototypesInternal(arg);\n        });else {\n            if (args.__className) {\n                var prototype = this.workerServicePrototypeMappingConfiguration[args.__className];\n                if (!prototype) throw 'Unknown prototype ' + args.__className;\n                args.__proto__ = prototype;\n                delete args.__className;\n            }\n            for (var key in args) if (args.hasOwnProperty(key)) this.restorePrototypesInternal(args[key]);\n        }\n    };\n    return WorkerService;\n}();\n\nWorkerService.workerTemplate = \"\\n    var window = self\\n    window.history = {}\\n    window.Node = function () {}\\n    //self.setImmediate = function(fn) { return window.setTimeout(fn, 0) }\\n    window.document = {\\n      readyState: 'complete',\\n      cookie: '',\\n      querySelector: function (selector) {\\n        if (selector=='html') return { innerHTML: '', getAttribute: function() {}} // angular-hot-loader patch\\n      },\\n      addEventListener: function() {},\\n      createElement: function() {\\n        return {\\n          pathname: '',\\n          setAttribute: function(key, value) {}\\n        };\\n      },\\n    };\\n    importScripts('<IMPORT_SCRIPTS>')\\n    window.angular.module('<APP_NAME>').run(['workerWorkerService', function(workerWorkerService) {\\n      self.addEventListener('message', function(e) { workerWorkerService.onMessage(e.data) })\\n    }])\\n    window.angular.bootstrap(null, ['<APP_NAME>'])\\n    window = undefined\\n    self.history = undefined\\n    self.Node = undefined\\n    setTimeout(function() { // angular init needs this\\n      self.document = undefined\\n    }, 0)\\n  \";\nvar WorkerWorkerService = function () {\n    function WorkerWorkerService(workerServicePrototypeMappingConfiguration, $injector, $q, $rootScope) {\n        this.workerServicePrototypeMappingConfiguration = workerServicePrototypeMappingConfiguration;\n        this.$injector = $injector;\n        this.$q = $q;\n        this.$rootScope = $rootScope;\n        this.cancellers = [];\n    }\n    WorkerWorkerService.stripFunctions = function (obj) {\n        var ret = {};\n        for (var key in obj) if (typeof obj[key] === 'object') ret[key] = WorkerWorkerService.stripFunctions(obj[key]);else if (typeof obj[key] !== 'function') ret[key] = obj[key];\n        return ret;\n    };\n    WorkerWorkerService.prototype.$broadcast = function (name, args) {\n        try {\n            self.postMessage({ event: 'broadcast', name: name, args: WorkerService.savePrototypes(args) });\n        } catch (e) {\n            console.log(args, e);\n            throw e;\n        }\n    };\n    WorkerWorkerService.prototype.onMessage = function (message) {\n        var _this = this;\n        if (message.id === undefined) {\n            this.$rootScope.$broadcast(message.name, this.restorePrototypes(message.args));\n            this.$rootScope.$apply();\n        } else if (message.cancel) {\n            var canceller = this.cancellers[message.id];\n            delete this.cancellers[message.id];\n            if (canceller) canceller.resolve();\n        } else {\n            var service = this.$injector.get(message.service);\n            var canceller = this.$q.defer();\n            this.cancellers[message.id] = canceller;\n            var promise = service[message.method].apply(service, this.restorePrototypes(message.args).concat(canceller.promise));\n            if (!promise || !promise.then) {\n                var deferred = this.$q.defer();\n                deferred.resolve(promise);\n                promise = deferred.promise;\n            }\n            promise.then(function (success) {\n                delete _this.cancellers[message.id];\n                self.postMessage({ event: 'success', id: message.id, data: WorkerService.savePrototypes(success) });\n            }, function (error) {\n                delete _this.cancellers[message.id];\n                if (error instanceof Error) {\n                    self.postMessage({ event: 'failure', id: message.id, data: { name: error.name, message: error.message, stack: error.stack } });\n                    throw error;\n                }\n                self.postMessage({ event: 'failure', id: message.id, data: WorkerService.savePrototypes(WorkerWorkerService.stripFunctions(error)) });\n            }, function (update) {\n                return self.postMessage({ event: 'update', id: message.id, data: WorkerService.savePrototypes(update) });\n            });\n        }\n    };\n    WorkerWorkerService.prototype.restorePrototypes = function (args) {\n        this.restorePrototypesInternal(args);\n        WorkerService.stripMarks(args);\n        return args;\n    };\n    WorkerWorkerService.prototype.restorePrototypesInternal = function (args) {\n        var _this = this;\n        if (!args || args.__mark || typeof args !== 'object') return;\n        args.__mark = true;\n        if (args instanceof Array) args.forEach(function (arg) {\n            return _this.restorePrototypesInternal(arg);\n        });else {\n            if (args.__className) {\n                var prototype = this.workerServicePrototypeMappingConfiguration[args.__className];\n                if (!prototype) throw 'Unknown prototype ' + args.__className;\n                args.__proto__ = prototype;\n                delete args.__className;\n            }\n            for (var key in args) if (args.hasOwnProperty(key)) this.restorePrototypesInternal(args[key]);\n        }\n    };\n    return WorkerWorkerService;\n}();\n\nvar StateWorkerService = function () {\n    function StateWorkerService() {}\n    StateWorkerService.prototype.setState = function (state) {\n        this.state = state;\n    };\n    return StateWorkerService;\n}();\n\n__WEBPACK_IMPORTED_MODULE_0_angular__[\"module\"]('fibra.services.worker-service', ['fibra.services.worker-service-prototype-mapping-configuration']).config(function ($provide) {\n    $provide.service('stateWorkerService', StateWorkerService);\n    $provide.service('workerService', WorkerService);\n    $provide.service('workerWorkerService', WorkerWorkerService);\n});//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvc2VydmljZXMvd29ya2VyLXNlcnZpY2Uvd29ya2VyLXNlcnZpY2UudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3NlcnZpY2VzL3dvcmtlci1zZXJ2aWNlL3dvcmtlci1zZXJ2aWNlLnRzP2U2OWYiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuaW1wb3J0ICogYXMgYW5ndWxhciBmcm9tICdhbmd1bGFyJztcbmltcG9ydCAnLi9wcm90b3R5cGUtbWFwcGluZy1jb25maWd1cmF0aW9uJztcbnZhciBXb3JrZXJTZXJ2aWNlQ29uZmlndXJhdGlvbiA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gV29ya2VyU2VydmljZUNvbmZpZ3VyYXRpb24oYXBwTmFtZSwgd29ya2VyVGhyZWFkcywgaW1wb3J0U2NyaXB0cykge1xuICAgICAgICB0aGlzLmFwcE5hbWUgPSBhcHBOYW1lO1xuICAgICAgICB0aGlzLndvcmtlclRocmVhZHMgPSB3b3JrZXJUaHJlYWRzO1xuICAgICAgICB0aGlzLmltcG9ydFNjcmlwdHMgPSBpbXBvcnRTY3JpcHRzO1xuICAgIH1cbiAgICByZXR1cm4gV29ya2VyU2VydmljZUNvbmZpZ3VyYXRpb247XG59KCkpO1xuZXhwb3J0IHsgV29ya2VyU2VydmljZUNvbmZpZ3VyYXRpb24gfTtcbnZhciBXb3JrZXJTZXJ2aWNlID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBXb3JrZXJTZXJ2aWNlKHdvcmtlclNlcnZpY2VDb25maWd1cmF0aW9uLCB3b3JrZXJTZXJ2aWNlUHJvdG90eXBlTWFwcGluZ0NvbmZpZ3VyYXRpb24sICRyb290U2NvcGUsICR3aW5kb3csICRxKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMud29ya2VyU2VydmljZVByb3RvdHlwZU1hcHBpbmdDb25maWd1cmF0aW9uID0gd29ya2VyU2VydmljZVByb3RvdHlwZU1hcHBpbmdDb25maWd1cmF0aW9uO1xuICAgICAgICB0aGlzLiRxID0gJHE7XG4gICAgICAgIHRoaXMuY3VycmVudFdvcmtlciA9IDA7XG4gICAgICAgIHRoaXMuZGVmZXJyZWRzID0gW107XG4gICAgICAgIHZhciBwYXRoID0gJHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyAkd2luZG93LmxvY2F0aW9uLmhvc3Q7XG4gICAgICAgIHZhciBpbXBvcnRTY3JpcHRzID0gd29ya2VyU2VydmljZUNvbmZpZ3VyYXRpb24uaW1wb3J0U2NyaXB0cy5tYXAoZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgICAgIHJldHVybiBzLmluZGV4T2YoJ2h0dHAnKSAhPT0gMCA/IHBhdGggKyAocy5pbmRleE9mKCcvJykgIT09IDAgPyAkd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lIDogJycpICsgcyA6IHM7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgYmxvYlVSTCA9ICgkd2luZG93LlVSTCkuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtXb3JrZXJTZXJ2aWNlLndvcmtlclRlbXBsYXRlLnJlcGxhY2UoLzxBUFBfTkFNRT4vZywgd29ya2VyU2VydmljZUNvbmZpZ3VyYXRpb24uYXBwTmFtZSkucmVwbGFjZSgvPElNUE9SVF9TQ1JJUFRTPi9nLCBpbXBvcnRTY3JpcHRzLmpvaW4oJ1xcJyxcXCcnKSldLCB7IHR5cGU6ICdhcHBsaWNhdGlvbi9qYXZhc2NyaXB0JyB9KSk7XG4gICAgICAgIHRoaXMud29ya2VycyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHdvcmtlclNlcnZpY2VDb25maWd1cmF0aW9uLndvcmtlclRocmVhZHM7IGkrKykge1xuICAgICAgICAgICAgdGhpcy53b3JrZXJzLnB1c2gobmV3IFdvcmtlcihibG9iVVJMKSk7XG4gICAgICAgICAgICB0aGlzLndvcmtlcnNbaV0uYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGV2ZW50SWQgPSBlLmRhdGEuZXZlbnQ7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50SWQgPT09ICdicm9hZGNhc3QnKSB7XG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdChlLmRhdGEubmFtZSwgX3RoaXMucmVzdG9yZVByb3RvdHlwZXMoZS5kYXRhLmFyZ3MpKTtcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9IF90aGlzLmRlZmVycmVkc1tlLmRhdGEuaWRdO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGVmZXJyZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudElkID09PSAnc3VjY2VzcycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgX3RoaXMuZGVmZXJyZWRzW2UuZGF0YS5pZF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShfdGhpcy5yZXN0b3JlUHJvdG90eXBlcyhlLmRhdGEuZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZXZlbnRJZCA9PT0gJ2ZhaWx1cmUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIF90aGlzLmRlZmVycmVkc1tlLmRhdGEuaWRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChfdGhpcy5yZXN0b3JlUHJvdG90eXBlcyhlLmRhdGEuZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLm5vdGlmeShfdGhpcy5yZXN0b3JlUHJvdG90eXBlcyhlLmRhdGEuZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgV29ya2VyU2VydmljZS5zdHJpcE1hcmtzID0gZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICAgICAgaWYgKCFhcmdzIHx8ICFhcmdzLl9fbWFyayB8fCB0eXBlb2YgYXJncyAhPT0gJ29iamVjdCcpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGRlbGV0ZSBhcmdzLl9fbWFyaztcbiAgICAgICAgaWYgKGFyZ3MgaW5zdGFuY2VvZiBBcnJheSlcbiAgICAgICAgICAgIGFyZ3MuZm9yRWFjaChmdW5jdGlvbiAoYXJnKSB7IHJldHVybiBXb3JrZXJTZXJ2aWNlLnN0cmlwTWFya3MoYXJnKTsgfSk7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGFyZ3MpXG4gICAgICAgICAgICAgICAgaWYgKGFyZ3MuaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgICAgICAgICAgV29ya2VyU2VydmljZS5zdHJpcE1hcmtzKGFyZ3Nba2V5XSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFdvcmtlclNlcnZpY2Uuc3RyaXBQcm90b3R5cGVzID0gZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICAgICAgaWYgKCFhcmdzIHx8ICFhcmdzLl9fY2xhc3NOYW1lIHx8IHR5cGVvZiBhcmdzICE9PSAnb2JqZWN0JylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgZGVsZXRlIGFyZ3MuX19jbGFzc05hbWU7XG4gICAgICAgIGlmIChhcmdzIGluc3RhbmNlb2YgQXJyYXkpXG4gICAgICAgICAgICBhcmdzLmZvckVhY2goZnVuY3Rpb24gKGFyZykgeyByZXR1cm4gV29ya2VyU2VydmljZS5zdHJpcFByb3RvdHlwZXMoYXJnKTsgfSk7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGFyZ3MpXG4gICAgICAgICAgICAgICAgaWYgKGFyZ3MuaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgICAgICAgICAgV29ya2VyU2VydmljZS5zdHJpcFByb3RvdHlwZXMoYXJnc1trZXldKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgV29ya2VyU2VydmljZS5zYXZlUHJvdG90eXBlcyA9IGZ1bmN0aW9uIChhcmdzKSB7XG4gICAgICAgIFdvcmtlclNlcnZpY2Uuc3RyaXBQcm90b3R5cGVzKGFyZ3MpO1xuICAgICAgICB0aGlzLnNhdmVQcm90b3R5cGVzSW50ZXJuYWwoYXJncyk7XG4gICAgICAgIHJldHVybiBhcmdzO1xuICAgIH07XG4gICAgV29ya2VyU2VydmljZS5zYXZlUHJvdG90eXBlc0ludGVybmFsID0gZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICAgICAgaWYgKCFhcmdzIHx8IGFyZ3MuX19jbGFzc05hbWUgfHwgdHlwZW9mIGFyZ3MgIT09ICdvYmplY3QnKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAoYXJncyBpbnN0YW5jZW9mIEFycmF5KVxuICAgICAgICAgICAgYXJncy5mb3JFYWNoKGZ1bmN0aW9uIChhcmcpIHsgcmV0dXJuIFdvcmtlclNlcnZpY2Uuc2F2ZVByb3RvdHlwZXNJbnRlcm5hbChhcmcpOyB9KTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAoYXJncy5jb25zdHJ1Y3Rvci5fX25hbWUgfHwgYXJncy5jb25zdHJ1Y3Rvci5uYW1lICE9PSAnT2JqZWN0Jykge1xuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50UHJvdG90eXBlID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKGFyZ3MpO1xuICAgICAgICAgICAgICAgIG91dDogd2hpbGUgKGN1cnJlbnRQcm90b3R5cGUgIT09IE9iamVjdC5wcm90b3R5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGN1cnJlbnRQcm90b3R5cGUpOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByb3AgPSBfYVtfaV07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvcCAhPT0gJ2NvbnN0cnVjdG9yJyAmJiB0eXBlb2YgKGFyZ3MuX19wcm90b19fW3Byb3BdKSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MuX19jbGFzc05hbWUgPSBhcmdzLmNvbnN0cnVjdG9yLl9fbmFtZSA/IGFyZ3MuY29uc3RydWN0b3IuX19uYW1lIDogYXJncy5jb25zdHJ1Y3Rvci5uYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIG91dDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50UHJvdG90eXBlID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKGN1cnJlbnRQcm90b3R5cGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIWFyZ3MuX19jbGFzc05hbWUpXG4gICAgICAgICAgICAgICAgICAgIGFyZ3MuX19jbGFzc05hbWUgPSAnT2JqZWN0JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBhcmdzKVxuICAgICAgICAgICAgICAgIGlmIChhcmdzLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICAgICAgICAgIFdvcmtlclNlcnZpY2Uuc2F2ZVByb3RvdHlwZXNJbnRlcm5hbChhcmdzW2tleV0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBXb3JrZXJTZXJ2aWNlLnByb3RvdHlwZS4kYnJvYWRjYXN0ID0gZnVuY3Rpb24gKG5hbWUsIGFyZ3MpIHtcbiAgICAgICAgdGhpcy53b3JrZXJzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucG9zdE1lc3NhZ2UoeyBuYW1lOiBuYW1lLCBhcmdzOiBXb3JrZXJTZXJ2aWNlLnNhdmVQcm90b3R5cGVzKGFyZ3MpIH0pOyB9KTtcbiAgICB9O1xuICAgIFdvcmtlclNlcnZpY2UucHJvdG90eXBlLmNhbGxBbGwgPSBmdW5jdGlvbiAoc2VydmljZSwgbWV0aG9kLCBhcmdzLCBjYW5jZWxsZXIpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgaWYgKGFyZ3MgPT09IHZvaWQgMCkgeyBhcmdzID0gW107IH1cbiAgICAgICAgdmFyIGRlZmVycmVkID0gdGhpcy4kcS5kZWZlcigpO1xuICAgICAgICB0aGlzLmRlZmVycmVkcy5wdXNoKGRlZmVycmVkKTtcbiAgICAgICAgdmFyIGlkID0gdGhpcy5kZWZlcnJlZHMubGVuZ3RoIC0gMTtcbiAgICAgICAgdmFyIG1lc3NhZ2UgPSB7XG4gICAgICAgICAgICBpZDogaWQsXG4gICAgICAgICAgICBzZXJ2aWNlOiBzZXJ2aWNlLFxuICAgICAgICAgICAgbWV0aG9kOiBtZXRob2QsXG4gICAgICAgICAgICBhcmdzOiBXb3JrZXJTZXJ2aWNlLnNhdmVQcm90b3R5cGVzKGFyZ3MpXG4gICAgICAgIH07XG4gICAgICAgIGlmIChjYW5jZWxsZXIpXG4gICAgICAgICAgICBjYW5jZWxsZXIudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMud29ya2Vycy5mb3JFYWNoKGZ1bmN0aW9uICh3b3JrZXIpIHsgcmV0dXJuIHdvcmtlci5wb3N0TWVzc2FnZSh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZCxcbiAgICAgICAgICAgICAgICAgICAgY2FuY2VsOiB0cnVlXG4gICAgICAgICAgICAgICAgfSk7IH0pO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBfdGhpcy5kZWZlcnJlZHNbaWRdO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIHRoaXMud29ya2Vycy5mb3JFYWNoKGZ1bmN0aW9uICh3b3JrZXIpIHsgcmV0dXJuIHdvcmtlci5wb3N0TWVzc2FnZShtZXNzYWdlKTsgfSk7XG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH07XG4gICAgV29ya2VyU2VydmljZS5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uIChzZXJ2aWNlLCBtZXRob2QsIGFyZ3MsIGNhbmNlbGxlcikge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAoYXJncyA9PT0gdm9pZCAwKSB7IGFyZ3MgPSBbXTsgfVxuICAgICAgICB2YXIgZGVmZXJyZWQgPSB0aGlzLiRxLmRlZmVyKCk7XG4gICAgICAgIHRoaXMuZGVmZXJyZWRzLnB1c2goZGVmZXJyZWQpO1xuICAgICAgICB2YXIgaWQgPSB0aGlzLmRlZmVycmVkcy5sZW5ndGggLSAxO1xuICAgICAgICB2YXIgd29ya2VyID0gdGhpcy53b3JrZXJzW3RoaXMuY3VycmVudFdvcmtlcl07XG4gICAgICAgIHRoaXMuY3VycmVudFdvcmtlciA9ICh0aGlzLmN1cnJlbnRXb3JrZXIgKyAxKSAlIHRoaXMud29ya2Vycy5sZW5ndGg7XG4gICAgICAgIGlmIChjYW5jZWxsZXIpXG4gICAgICAgICAgICBjYW5jZWxsZXIudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgICAgICAgICAgICBjYW5jZWw6IHRydWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBkZWxldGUgX3RoaXMuZGVmZXJyZWRzW2lkXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB3b3JrZXIucG9zdE1lc3NhZ2Uoe1xuICAgICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgICAgc2VydmljZTogc2VydmljZSxcbiAgICAgICAgICAgIG1ldGhvZDogbWV0aG9kLFxuICAgICAgICAgICAgYXJnczogV29ya2VyU2VydmljZS5zYXZlUHJvdG90eXBlcyhhcmdzKVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfTtcbiAgICBXb3JrZXJTZXJ2aWNlLnByb3RvdHlwZS5yZXN0b3JlUHJvdG90eXBlcyA9IGZ1bmN0aW9uIChhcmdzKSB7XG4gICAgICAgIHRoaXMucmVzdG9yZVByb3RvdHlwZXNJbnRlcm5hbChhcmdzKTtcbiAgICAgICAgV29ya2VyU2VydmljZS5zdHJpcE1hcmtzKGFyZ3MpO1xuICAgICAgICByZXR1cm4gYXJncztcbiAgICB9O1xuICAgIFdvcmtlclNlcnZpY2UucHJvdG90eXBlLnJlc3RvcmVQcm90b3R5cGVzSW50ZXJuYWwgPSBmdW5jdGlvbiAoYXJncykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAoIWFyZ3MgfHwgYXJncy5fX21hcmsgfHwgdHlwZW9mIGFyZ3MgIT09ICdvYmplY3QnKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBhcmdzLl9fbWFyayA9IHRydWU7XG4gICAgICAgIGlmIChhcmdzIGluc3RhbmNlb2YgQXJyYXkpXG4gICAgICAgICAgICBhcmdzLmZvckVhY2goZnVuY3Rpb24gKGFyZykgeyByZXR1cm4gX3RoaXMucmVzdG9yZVByb3RvdHlwZXNJbnRlcm5hbChhcmcpOyB9KTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAoYXJncy5fX2NsYXNzTmFtZSkge1xuICAgICAgICAgICAgICAgIHZhciBwcm90b3R5cGUgPSB0aGlzLndvcmtlclNlcnZpY2VQcm90b3R5cGVNYXBwaW5nQ29uZmlndXJhdGlvblthcmdzLl9fY2xhc3NOYW1lXTtcbiAgICAgICAgICAgICAgICBpZiAoIXByb3RvdHlwZSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgJ1Vua25vd24gcHJvdG90eXBlICcgKyBhcmdzLl9fY2xhc3NOYW1lO1xuICAgICAgICAgICAgICAgIGFyZ3MuX19wcm90b19fID0gcHJvdG90eXBlO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBhcmdzLl9fY2xhc3NOYW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGFyZ3MpXG4gICAgICAgICAgICAgICAgaWYgKGFyZ3MuaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXN0b3JlUHJvdG90eXBlc0ludGVybmFsKGFyZ3Nba2V5XSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiBXb3JrZXJTZXJ2aWNlO1xufSgpKTtcbmV4cG9ydCB7IFdvcmtlclNlcnZpY2UgfTtcbldvcmtlclNlcnZpY2Uud29ya2VyVGVtcGxhdGUgPSBcIlxcbiAgICB2YXIgd2luZG93ID0gc2VsZlxcbiAgICB3aW5kb3cuaGlzdG9yeSA9IHt9XFxuICAgIHdpbmRvdy5Ob2RlID0gZnVuY3Rpb24gKCkge31cXG4gICAgLy9zZWxmLnNldEltbWVkaWF0ZSA9IGZ1bmN0aW9uKGZuKSB7IHJldHVybiB3aW5kb3cuc2V0VGltZW91dChmbiwgMCkgfVxcbiAgICB3aW5kb3cuZG9jdW1lbnQgPSB7XFxuICAgICAgcmVhZHlTdGF0ZTogJ2NvbXBsZXRlJyxcXG4gICAgICBjb29raWU6ICcnLFxcbiAgICAgIHF1ZXJ5U2VsZWN0b3I6IGZ1bmN0aW9uIChzZWxlY3Rvcikge1xcbiAgICAgICAgaWYgKHNlbGVjdG9yPT0naHRtbCcpIHJldHVybiB7IGlubmVySFRNTDogJycsIGdldEF0dHJpYnV0ZTogZnVuY3Rpb24oKSB7fX0gLy8gYW5ndWxhci1ob3QtbG9hZGVyIHBhdGNoXFxuICAgICAgfSxcXG4gICAgICBhZGRFdmVudExpc3RlbmVyOiBmdW5jdGlvbigpIHt9LFxcbiAgICAgIGNyZWF0ZUVsZW1lbnQ6IGZ1bmN0aW9uKCkge1xcbiAgICAgICAgcmV0dXJuIHtcXG4gICAgICAgICAgcGF0aG5hbWU6ICcnLFxcbiAgICAgICAgICBzZXRBdHRyaWJ1dGU6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHt9XFxuICAgICAgICB9O1xcbiAgICAgIH0sXFxuICAgIH07XFxuICAgIGltcG9ydFNjcmlwdHMoJzxJTVBPUlRfU0NSSVBUUz4nKVxcbiAgICB3aW5kb3cuYW5ndWxhci5tb2R1bGUoJzxBUFBfTkFNRT4nKS5ydW4oWyd3b3JrZXJXb3JrZXJTZXJ2aWNlJywgZnVuY3Rpb24od29ya2VyV29ya2VyU2VydmljZSkge1xcbiAgICAgIHNlbGYuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uKGUpIHsgd29ya2VyV29ya2VyU2VydmljZS5vbk1lc3NhZ2UoZS5kYXRhKSB9KVxcbiAgICB9XSlcXG4gICAgd2luZG93LmFuZ3VsYXIuYm9vdHN0cmFwKG51bGwsIFsnPEFQUF9OQU1FPiddKVxcbiAgICB3aW5kb3cgPSB1bmRlZmluZWRcXG4gICAgc2VsZi5oaXN0b3J5ID0gdW5kZWZpbmVkXFxuICAgIHNlbGYuTm9kZSA9IHVuZGVmaW5lZFxcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyAvLyBhbmd1bGFyIGluaXQgbmVlZHMgdGhpc1xcbiAgICAgIHNlbGYuZG9jdW1lbnQgPSB1bmRlZmluZWRcXG4gICAgfSwgMClcXG4gIFwiO1xudmFyIFdvcmtlcldvcmtlclNlcnZpY2UgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFdvcmtlcldvcmtlclNlcnZpY2Uod29ya2VyU2VydmljZVByb3RvdHlwZU1hcHBpbmdDb25maWd1cmF0aW9uLCAkaW5qZWN0b3IsICRxLCAkcm9vdFNjb3BlKSB7XG4gICAgICAgIHRoaXMud29ya2VyU2VydmljZVByb3RvdHlwZU1hcHBpbmdDb25maWd1cmF0aW9uID0gd29ya2VyU2VydmljZVByb3RvdHlwZU1hcHBpbmdDb25maWd1cmF0aW9uO1xuICAgICAgICB0aGlzLiRpbmplY3RvciA9ICRpbmplY3RvcjtcbiAgICAgICAgdGhpcy4kcSA9ICRxO1xuICAgICAgICB0aGlzLiRyb290U2NvcGUgPSAkcm9vdFNjb3BlO1xuICAgICAgICB0aGlzLmNhbmNlbGxlcnMgPSBbXTtcbiAgICB9XG4gICAgV29ya2VyV29ya2VyU2VydmljZS5zdHJpcEZ1bmN0aW9ucyA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgdmFyIHJldCA9IHt9O1xuICAgICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBvYmpba2V5XSA9PT0gJ29iamVjdCcpXG4gICAgICAgICAgICAgICAgcmV0W2tleV0gPSBXb3JrZXJXb3JrZXJTZXJ2aWNlLnN0cmlwRnVuY3Rpb25zKG9ialtrZXldKTtcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBvYmpba2V5XSAhPT0gJ2Z1bmN0aW9uJylcbiAgICAgICAgICAgICAgICByZXRba2V5XSA9IG9ialtrZXldO1xuICAgICAgICByZXR1cm4gcmV0O1xuICAgIH07XG4gICAgV29ya2VyV29ya2VyU2VydmljZS5wcm90b3R5cGUuJGJyb2FkY2FzdCA9IGZ1bmN0aW9uIChuYW1lLCBhcmdzKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgZXZlbnQ6ICdicm9hZGNhc3QnLCBuYW1lOiBuYW1lLCBhcmdzOiBXb3JrZXJTZXJ2aWNlLnNhdmVQcm90b3R5cGVzKGFyZ3MpIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhhcmdzLCBlKTtcbiAgICAgICAgICAgIHRocm93IGU7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFdvcmtlcldvcmtlclNlcnZpY2UucHJvdG90eXBlLm9uTWVzc2FnZSA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmIChtZXNzYWdlLmlkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuJHJvb3RTY29wZS4kYnJvYWRjYXN0KG1lc3NhZ2UubmFtZSwgdGhpcy5yZXN0b3JlUHJvdG90eXBlcyhtZXNzYWdlLmFyZ3MpKTtcbiAgICAgICAgICAgIHRoaXMuJHJvb3RTY29wZS4kYXBwbHkoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChtZXNzYWdlLmNhbmNlbCkge1xuICAgICAgICAgICAgdmFyIGNhbmNlbGxlciA9IHRoaXMuY2FuY2VsbGVyc1ttZXNzYWdlLmlkXTtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNhbmNlbGxlcnNbbWVzc2FnZS5pZF07XG4gICAgICAgICAgICBpZiAoY2FuY2VsbGVyKVxuICAgICAgICAgICAgICAgIGNhbmNlbGxlci5yZXNvbHZlKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgc2VydmljZSA9IHRoaXMuJGluamVjdG9yLmdldChtZXNzYWdlLnNlcnZpY2UpO1xuICAgICAgICAgICAgdmFyIGNhbmNlbGxlciA9IHRoaXMuJHEuZGVmZXIoKTtcbiAgICAgICAgICAgIHRoaXMuY2FuY2VsbGVyc1ttZXNzYWdlLmlkXSA9IGNhbmNlbGxlcjtcbiAgICAgICAgICAgIHZhciBwcm9taXNlID0gc2VydmljZVttZXNzYWdlLm1ldGhvZF0uYXBwbHkoc2VydmljZSwgdGhpcy5yZXN0b3JlUHJvdG90eXBlcyhtZXNzYWdlLmFyZ3MpLmNvbmNhdChjYW5jZWxsZXIucHJvbWlzZSkpO1xuICAgICAgICAgICAgaWYgKCFwcm9taXNlIHx8ICFwcm9taXNlLnRoZW4pIHtcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSB0aGlzLiRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShwcm9taXNlKTtcbiAgICAgICAgICAgICAgICBwcm9taXNlID0gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHByb21pc2UudGhlbihmdW5jdGlvbiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBfdGhpcy5jYW5jZWxsZXJzW21lc3NhZ2UuaWRdO1xuICAgICAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoeyBldmVudDogJ3N1Y2Nlc3MnLCBpZDogbWVzc2FnZS5pZCwgZGF0YTogV29ya2VyU2VydmljZS5zYXZlUHJvdG90eXBlcyhzdWNjZXNzKSB9KTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBfdGhpcy5jYW5jZWxsZXJzW21lc3NhZ2UuaWRdO1xuICAgICAgICAgICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoeyBldmVudDogJ2ZhaWx1cmUnLCBpZDogbWVzc2FnZS5pZCwgZGF0YTogeyBuYW1lOiBlcnJvci5uYW1lLCBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLCBzdGFjazogZXJyb3Iuc3RhY2sgfSB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoeyBldmVudDogJ2ZhaWx1cmUnLCBpZDogbWVzc2FnZS5pZCwgZGF0YTogV29ya2VyU2VydmljZS5zYXZlUHJvdG90eXBlcyhXb3JrZXJXb3JrZXJTZXJ2aWNlLnN0cmlwRnVuY3Rpb25zKGVycm9yKSkgfSk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAodXBkYXRlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYucG9zdE1lc3NhZ2UoeyBldmVudDogJ3VwZGF0ZScsIGlkOiBtZXNzYWdlLmlkLCBkYXRhOiBXb3JrZXJTZXJ2aWNlLnNhdmVQcm90b3R5cGVzKHVwZGF0ZSkgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgV29ya2VyV29ya2VyU2VydmljZS5wcm90b3R5cGUucmVzdG9yZVByb3RvdHlwZXMgPSBmdW5jdGlvbiAoYXJncykge1xuICAgICAgICB0aGlzLnJlc3RvcmVQcm90b3R5cGVzSW50ZXJuYWwoYXJncyk7XG4gICAgICAgIFdvcmtlclNlcnZpY2Uuc3RyaXBNYXJrcyhhcmdzKTtcbiAgICAgICAgcmV0dXJuIGFyZ3M7XG4gICAgfTtcbiAgICBXb3JrZXJXb3JrZXJTZXJ2aWNlLnByb3RvdHlwZS5yZXN0b3JlUHJvdG90eXBlc0ludGVybmFsID0gZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgaWYgKCFhcmdzIHx8IGFyZ3MuX19tYXJrIHx8IHR5cGVvZiBhcmdzICE9PSAnb2JqZWN0JylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgYXJncy5fX21hcmsgPSB0cnVlO1xuICAgICAgICBpZiAoYXJncyBpbnN0YW5jZW9mIEFycmF5KVxuICAgICAgICAgICAgYXJncy5mb3JFYWNoKGZ1bmN0aW9uIChhcmcpIHsgcmV0dXJuIF90aGlzLnJlc3RvcmVQcm90b3R5cGVzSW50ZXJuYWwoYXJnKTsgfSk7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKGFyZ3MuX19jbGFzc05hbWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJvdG90eXBlID0gdGhpcy53b3JrZXJTZXJ2aWNlUHJvdG90eXBlTWFwcGluZ0NvbmZpZ3VyYXRpb25bYXJncy5fX2NsYXNzTmFtZV07XG4gICAgICAgICAgICAgICAgaWYgKCFwcm90b3R5cGUpXG4gICAgICAgICAgICAgICAgICAgIHRocm93ICdVbmtub3duIHByb3RvdHlwZSAnICsgYXJncy5fX2NsYXNzTmFtZTtcbiAgICAgICAgICAgICAgICBhcmdzLl9fcHJvdG9fXyA9IHByb3RvdHlwZTtcbiAgICAgICAgICAgICAgICBkZWxldGUgYXJncy5fX2NsYXNzTmFtZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBhcmdzKVxuICAgICAgICAgICAgICAgIGlmIChhcmdzLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVzdG9yZVByb3RvdHlwZXNJbnRlcm5hbChhcmdzW2tleV0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gV29ya2VyV29ya2VyU2VydmljZTtcbn0oKSk7XG5leHBvcnQgeyBXb3JrZXJXb3JrZXJTZXJ2aWNlIH07XG52YXIgU3RhdGVXb3JrZXJTZXJ2aWNlID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBTdGF0ZVdvcmtlclNlcnZpY2UoKSB7XG4gICAgfVxuICAgIFN0YXRlV29ya2VyU2VydmljZS5wcm90b3R5cGUuc2V0U3RhdGUgPSBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHN0YXRlO1xuICAgIH07XG4gICAgcmV0dXJuIFN0YXRlV29ya2VyU2VydmljZTtcbn0oKSk7XG5leHBvcnQgeyBTdGF0ZVdvcmtlclNlcnZpY2UgfTtcbmFuZ3VsYXIubW9kdWxlKCdmaWJyYS5zZXJ2aWNlcy53b3JrZXItc2VydmljZScsIFsnZmlicmEuc2VydmljZXMud29ya2VyLXNlcnZpY2UtcHJvdG90eXBlLW1hcHBpbmctY29uZmlndXJhdGlvbiddKVxuICAgIC5jb25maWcoZnVuY3Rpb24gKCRwcm92aWRlKSB7XG4gICAgJHByb3ZpZGUuc2VydmljZSgnc3RhdGVXb3JrZXJTZXJ2aWNlJywgU3RhdGVXb3JrZXJTZXJ2aWNlKTtcbiAgICAkcHJvdmlkZS5zZXJ2aWNlKCd3b3JrZXJTZXJ2aWNlJywgV29ya2VyU2VydmljZSk7XG4gICAgJHByb3ZpZGUuc2VydmljZSgnd29ya2VyV29ya2VyU2VydmljZScsIFdvcmtlcldvcmtlclNlcnZpY2UpO1xufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL3NlcnZpY2VzL3dvcmtlci1zZXJ2aWNlL3dvcmtlci1zZXJ2aWNlLnRzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFFQTtBQUFBO0FBQ0E7QUFDQTtBQUZBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ })

})