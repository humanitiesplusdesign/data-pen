webpackHotUpdate(1,{

/***/ "./app/services/project-service/project-service.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__models_citable__ = __webpack_require__(\"./app/models/citable.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__project__ = __webpack_require__(\"./app/services/project-service/project.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__primary_endpoint_configuration__ = __webpack_require__(\"./app/services/project-service/primary-endpoint-configuration.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__remote_endpoint_configuration__ = __webpack_require__(\"./app/services/project-service/remote-endpoint-configuration.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__schema__ = __webpack_require__(\"./app/services/project-service/schema.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__components_collection_utils__ = __webpack_require__(\"./app/components/collection-utils.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__components_misc_utils__ = __webpack_require__(\"./app/components/misc-utils.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__models_rdf__ = __webpack_require__(\"./app/models/rdf.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_9__data_model__ = __webpack_require__(\"./app/services/project-service/data-model.ts\");\n/* unused harmony export ProjectService */\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return ProjectWorkerService; });\n\n\n\n\n\n\n\n\n\n\n\n\nvar s = fi.seco.sparql;\nvar ProjectService = function () {\n    function ProjectService(workerService, fibraService, fibraSparqlService, $localStorage) {\n        this.workerService = workerService;\n        this.fibraService = fibraService;\n        this.fibraSparqlService = fibraSparqlService;\n        this.$localStorage = $localStorage;\n        if (!$localStorage.projectSources) $localStorage.projectSources = [];else $localStorage.projectSources.forEach(function (ps) {\n            if (!ps.sparqlEndpoint) {\n                ps.sparqlEndpoint = ps['endpoint'];\n                ps.updateEndpoint = ps['endpoint'];\n                ps.graphStoreEndpoint = ps['endpoint'];\n            }\n        });\n    }\n    ProjectService.orderCitables = function (citables) {\n        citables.sort(function (a, b) {\n            return (a['order'] ? a['order'] : Number.MAX_VALUE) - (b['order'] ? b['order'] : Number.MAX_VALUE);\n        });\n        citables.forEach(function (rh) {\n            return delete rh['order'];\n        });\n    };\n    ProjectService.prototype.getCurrentProject = function () {\n        return this.fibraService.getState().project;\n    };\n    ProjectService.prototype.setCurrentProject = function (project) {\n        return this.fibraService.dispatchAction(this.fibraService.setProject(project));\n    };\n    ProjectService.prototype.getProjectSources = function () {\n        return this.$localStorage.projectSources;\n    };\n    ProjectService.prototype.listPrimaryEndpointConfigurations = function (source) {\n        return this.workerService.call('projectWorkerService', 'listPrimaryEndpointConfigurations', [source]);\n    };\n    ProjectService.prototype.loadPrimaryEndpointConfiguration = function (source, templateId) {\n        return this.workerService.call('projectWorkerService', 'loadPrimaryEndpointConfiguration', [source, templateId]);\n    };\n    ProjectService.prototype.listArchiveEndpointConfigurations = function (source) {\n        return this.workerService.call('projectWorkerService', 'listArchiveEndpointConfigurations', [source]);\n    };\n    ProjectService.prototype.listAuthorityEndpointConfigurations = function (source) {\n        return this.workerService.call('projectWorkerService', 'listAuthorityEndpointConfigurations', [source]);\n    };\n    ProjectService.prototype.loadRemoteEndpointConfiguration = function (source, templateId) {\n        return this.workerService.call('projectWorkerService', 'loadRemoteEndpointConfiguration', [source, templateId]);\n    };\n    ProjectService.prototype.listSchemas = function (source) {\n        return this.workerService.call('projectWorkerService', 'listSchemas', [source]);\n    };\n    ProjectService.prototype.loadSchema = function (source, id) {\n        return this.workerService.call('projectWorkerService', 'loadSchema', [source, id]);\n    };\n    ProjectService.prototype.listProjects = function (source) {\n        return this.workerService.call('projectWorkerService', 'listProjects', [source]);\n    };\n    ProjectService.prototype.loadProject = function (source, projectId, loadFull) {\n        return this.workerService.call('projectWorkerService', 'loadProject', [source, projectId, loadFull]);\n    };\n    ProjectService.prototype.deleteCitable = function (updateEndpoint, citable) {\n        return this.deleteObject(updateEndpoint, citable.id, citable.source.graph);\n    };\n    ProjectService.prototype.deleteObjects = function (updateEndpoint, ids, graph) {\n        var dq = graph ? ProjectService.deleteQuery.replace(/# STARTGRAPH/g, 'GRAPH <' + graph + '> {').replace(/# ENDGRAPH/g, '}') : ProjectService.deleteQuery.replace(/.*# STARTGRAPH\\n/g, '').replace(/.*# ENDGRAPH\\n/g, '');\n        dq = dq.replace(/# PATTERNS/g, ids.reduce(function (acc, id, index) {\n            return acc + ' <' + id + '> ?p' + index + ' ?o' + index + ' .';\n        }, ''));\n        return this.fibraSparqlService.update(updateEndpoint, dq);\n    };\n    ProjectService.prototype.deleteObject = function (updateEndpoint, id, graph) {\n        return this.deleteObjects(updateEndpoint, [id], graph);\n    };\n    ProjectService.prototype.saveCitable = function (updateEndpoint, graphStoreEndpoint, ps) {\n        var _this = this;\n        var m = new __WEBPACK_IMPORTED_MODULE_6__components_collection_utils__[\"d\" /* Map */]();\n        var prefixes = {};\n        ps.toTurtle(m, prefixes);\n        return this.deleteObjects(updateEndpoint, m.keys(), ps.source.graph).then(function () {\n            return _this.fibraSparqlService.post(graphStoreEndpoint, __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_7__components_misc_utils__[\"c\" /* toTurtle */])(prefixes, m), ps.source.graph);\n        });\n    };\n    return ProjectService;\n}();\n\nProjectService.deleteQuery = \"DELETE {\\n# STARTGRAPH\\n  # PATTERNS\\n# ENDGRAPH\\n}\\nWHERE {\\n# STARTGRAPH\\n  # PATTERNS\\n# ENDGRAPH\\n}\";\nvar ProjectWorkerService = function () {\n    function ProjectWorkerService(fibraSparqlService, $q) {\n        this.fibraSparqlService = fibraSparqlService;\n        this.$q = $q;\n    }\n    ProjectWorkerService.prototype.loadPrimaryEndpointConfiguration = function (source, templateId) {\n        return this.runSingleQuery(source, __WEBPACK_IMPORTED_MODULE_3__primary_endpoint_configuration__[\"a\" /* PrimaryEndpointConfiguration */].primaryEndpointConfigurationQuery, templateId, new __WEBPACK_IMPORTED_MODULE_3__primary_endpoint_configuration__[\"a\" /* PrimaryEndpointConfiguration */](templateId, source));\n    };\n    ProjectWorkerService.prototype.listPrimaryEndpointConfigurations = function (source) {\n        return this.runListQuery(source, __WEBPACK_IMPORTED_MODULE_3__primary_endpoint_configuration__[\"a\" /* PrimaryEndpointConfiguration */].listPrimaryEndpointConfigurationsQuery, function (id) {\n            return new __WEBPACK_IMPORTED_MODULE_3__primary_endpoint_configuration__[\"a\" /* PrimaryEndpointConfiguration */](id, source);\n        });\n    };\n    ProjectWorkerService.prototype.loadRemoteEndpointConfiguration = function (source, templateId) {\n        return this.runSingleQuery(source, __WEBPACK_IMPORTED_MODULE_4__remote_endpoint_configuration__[\"a\" /* RemoteEndpointConfiguration */].remoteEndpointConfigurationQuery, templateId, new __WEBPACK_IMPORTED_MODULE_4__remote_endpoint_configuration__[\"a\" /* RemoteEndpointConfiguration */](templateId, source));\n    };\n    ProjectWorkerService.prototype.listArchiveEndpointConfigurations = function (source) {\n        return this.runListQuery(source, __WEBPACK_IMPORTED_MODULE_4__remote_endpoint_configuration__[\"a\" /* RemoteEndpointConfiguration */].listArchiveEndpointConfigurationsQuery, function (id) {\n            return new __WEBPACK_IMPORTED_MODULE_4__remote_endpoint_configuration__[\"a\" /* RemoteEndpointConfiguration */](id, source);\n        });\n    };\n    ProjectWorkerService.prototype.listAuthorityEndpointConfigurations = function (source) {\n        return this.runListQuery(source, __WEBPACK_IMPORTED_MODULE_4__remote_endpoint_configuration__[\"a\" /* RemoteEndpointConfiguration */].listAuthorityEndpointConfigurationsQuery, function (id) {\n            return new __WEBPACK_IMPORTED_MODULE_4__remote_endpoint_configuration__[\"a\" /* RemoteEndpointConfiguration */](id, source);\n        });\n    };\n    ProjectWorkerService.prototype.listProjects = function (source) {\n        return this.runListQuery(source, __WEBPACK_IMPORTED_MODULE_2__project__[\"a\" /* Project */].listProjectsQuery, function (id) {\n            return new __WEBPACK_IMPORTED_MODULE_2__project__[\"a\" /* Project */](id, source);\n        });\n    };\n    ProjectWorkerService.prototype.listSchemas = function (source) {\n        return this.runListQuery(source, __WEBPACK_IMPORTED_MODULE_5__schema__[\"a\" /* Schema */].listSchemasQuery, function (id) {\n            return new __WEBPACK_IMPORTED_MODULE_5__schema__[\"a\" /* Schema */](id, source);\n        });\n    };\n    ProjectWorkerService.prototype.loadSchema = function (source, id) {\n        return this.runSingleQuery(source, __WEBPACK_IMPORTED_MODULE_5__schema__[\"a\" /* Schema */].schemaQuery, id, new __WEBPACK_IMPORTED_MODULE_5__schema__[\"a\" /* Schema */](id, source));\n    };\n    ProjectWorkerService.prototype.loadDataModel = function (schemas) {\n        var _this = this;\n        var dataModel = new __WEBPACK_IMPORTED_MODULE_9__data_model__[\"a\" /* DataModel */]();\n        var classes = new __WEBPACK_IMPORTED_MODULE_6__components_collection_utils__[\"a\" /* EMap */](function (id) {\n            var cl = new __WEBPACK_IMPORTED_MODULE_9__data_model__[\"b\" /* Class */](__WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].namedNode(id));\n            dataModel.classMap.set(id, cl);\n            return cl;\n        });\n        var properties = new __WEBPACK_IMPORTED_MODULE_6__components_collection_utils__[\"a\" /* EMap */](function (id) {\n            var pr = new __WEBPACK_IMPORTED_MODULE_9__data_model__[\"c\" /* Property */](__WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].namedNode(id));\n            dataModel.propertyMap.set(id, pr);\n            return pr;\n        });\n        var promises = [];\n        schemas.forEach(function (schema) {\n            promises.push(_this.fibraSparqlService.query(schema.endpoint, schema.classQuery).then(function (response) {\n                var conf = {\n                    bindingTypes: { types: 'uniqueArray' },\n                    bindingConverters: {\n                        superClasses: function (binding) {\n                            return classes.goc(binding.value);\n                        },\n                        subClasses: function (binding) {\n                            return classes.goc(binding.value);\n                        },\n                        types: function (binding) {\n                            return classes.goc(binding.value);\n                        },\n                        labels: function (binding) {\n                            return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                        },\n                        descriptions: function (binding) {\n                            return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                        }\n                    }\n                };\n                var tracker = new s.UniqueObjectTracker();\n                response.results.bindings.forEach(function (binding) {\n                    return s.SparqlService.bindingsToObject(binding, classes.goc(binding['id'].value), conf, tracker);\n                });\n            }));\n            promises.push(_this.fibraSparqlService.query(schema.endpoint, schema.propertyQuery).then(function (response) {\n                var conf = {\n                    bindingTypes: { types: 'uniqueArray' },\n                    bindingConverters: {\n                        superProperties: function (binding) {\n                            return properties.goc(binding.value);\n                        },\n                        subProperties: function (binding) {\n                            return properties.goc(binding.value);\n                        },\n                        inverseProperty: function (binding) {\n                            return properties.goc(binding.value);\n                        },\n                        types: function (binding) {\n                            return classes.goc(binding.value);\n                        },\n                        domains: function (binding) {\n                            return classes.goc(binding.value);\n                        },\n                        ranges: function (binding) {\n                            return classes.goc(binding.value);\n                        },\n                        labels: function (binding) {\n                            return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                        },\n                        descriptions: function (binding) {\n                            return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                        }\n                    }\n                };\n                var tracker = new s.UniqueObjectTracker();\n                response.results.bindings.forEach(function (binding) {\n                    return s.SparqlService.bindingsToObject(binding, properties.goc(binding['id'].value), conf, tracker);\n                });\n            }));\n        });\n        return this.$q.all(promises).then(function () {\n            classes.values().forEach(function (cl) {\n                cl.buildAsNodes();\n                cl.superClasses.filter(function (spr) {\n                    return !spr.subClasses.find(function (opr) {\n                        return opr === cl;\n                    });\n                }).forEach(function (spr) {\n                    return spr.subClasses.push(cl);\n                });\n                cl.subClasses.filter(function (spr) {\n                    return !spr.superClasses.find(function (opr) {\n                        return opr === cl;\n                    });\n                }).forEach(function (spr) {\n                    return spr.superClasses.push(cl);\n                });\n            });\n            classes.values().forEach(function (cl) {\n                if (cl.superClasses.length === 0) dataModel.rootClasses.push(cl);\n            });\n            properties.values().forEach(function (pr) {\n                pr.buildAsNodes();\n                if (pr.inverseProperty) pr.inverseProperty.inverseProperty = pr;\n                pr.superProperties.filter(function (spr) {\n                    return !spr.subProperties.find(function (opr) {\n                        return opr === pr;\n                    });\n                }).forEach(function (spr) {\n                    return spr.subProperties.push(pr);\n                });\n                pr.subProperties.filter(function (spr) {\n                    return !spr.superProperties.find(function (opr) {\n                        return opr === pr;\n                    });\n                }).forEach(function (spr) {\n                    return spr.superProperties.push(pr);\n                });\n                pr.domains.forEach(function (dc) {\n                    return dc.properties.push(pr);\n                });\n                pr.ranges.forEach(function (rc) {\n                    return rc.inverseProperties.push(pr);\n                });\n            });\n            properties.values().forEach(function (pr) {\n                if (pr.superProperties.length === 0) dataModel.rootProperties.push(pr);\n            });\n            return dataModel;\n        });\n    };\n    ProjectWorkerService.prototype.loadProject = function (source, id, loadFull) {\n        var _this = this;\n        var q = this.runSingleQuery(source, __WEBPACK_IMPORTED_MODULE_2__project__[\"a\" /* Project */].projectQuery, id, new __WEBPACK_IMPORTED_MODULE_2__project__[\"a\" /* Project */](id, source));\n        if (!loadFull) return q;else return q.then(function (p) {\n            var promises = [];\n            promises.push(_this.$q.all(p.schemas.map(function (schema) {\n                return _this.loadSchema(schema.source, schema.id);\n            })).then(function (schemas) {\n                p.schemas = schemas;\n                return _this.loadDataModel(schemas).then(function (dm) {\n                    return p.dataModel = dm;\n                });\n            }));\n            var narche = [];\n            var nauthe = [];\n            p.archiveEndpoints.forEach(function (ae) {\n                return promises.push(_this.loadRemoteEndpointConfiguration(ae.source, ae.id).then(function (ae2) {\n                    return narche.push(ae2);\n                }));\n            });\n            p.authorityEndpoints.forEach(function (ae) {\n                return promises.push(_this.loadRemoteEndpointConfiguration(ae.source, ae.id).then(function (ae2) {\n                    return nauthe.push(ae2);\n                }));\n            });\n            return _this.$q.all(promises).then(function () {\n                p.archiveEndpoints = narche;\n                p.authorityEndpoints = nauthe;\n                return p;\n            });\n        });\n    };\n    ProjectWorkerService.prototype.runSingleQuery = function (source, tq, id, ps) {\n        tq = source.graph ? tq.replace(/# STARTGRAPH/g, 'GRAPH <' + source.graph + '> {').replace(/# ENDGRAPH/g, '}') : tq.replace(/.*# STARTGRAPH\\n/g, '').replace(/.*# ENDGRAPH\\n/g, '');\n        tq = tq.replace(/<ID>/g, '<' + id + '>');\n        var deferred = this.$q.defer();\n        this.fibraSparqlService.query(source.sparqlEndpoint, tq).then(function (response) {\n            var conf = {\n                bindingTypes: { rightsHolders: 'uniqueArray', schemas: 'uniqueArray', authorityEndpoints: 'uniqueArray', archiveEndpoints: 'uniqueArray' },\n                bindingConverters: {\n                    types: function (binding) {\n                        return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                    },\n                    labels: function (binding) {\n                        return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                    },\n                    descriptions: function (binding) {\n                        return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                    },\n                    schemas: function (binding) {\n                        return new __WEBPACK_IMPORTED_MODULE_5__schema__[\"a\" /* Schema */](binding.value, __WEBPACK_IMPORTED_MODULE_1__models_citable__[\"a\" /* CitableSource */].clone(source));\n                    },\n                    authorityEndpoints: function (binding) {\n                        return new __WEBPACK_IMPORTED_MODULE_4__remote_endpoint_configuration__[\"a\" /* RemoteEndpointConfiguration */](binding.value, __WEBPACK_IMPORTED_MODULE_1__models_citable__[\"a\" /* CitableSource */].clone(source));\n                    },\n                    archiveEndpoints: function (binding) {\n                        return new __WEBPACK_IMPORTED_MODULE_4__remote_endpoint_configuration__[\"a\" /* RemoteEndpointConfiguration */](binding.value, __WEBPACK_IMPORTED_MODULE_1__models_citable__[\"a\" /* CitableSource */].clone(source));\n                    },\n                    rightsHolders_labels: function (binding) {\n                        return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                    },\n                    rightsHolders_descriptions: function (binding) {\n                        return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                    },\n                    rightsHolders: function (binding) {\n                        return new __WEBPACK_IMPORTED_MODULE_1__models_citable__[\"b\" /* Citable */](binding.value, source);\n                    }\n                }\n            };\n            var tracker = new s.UniqueObjectTracker();\n            response.results.bindings.forEach(function (b) {\n                return s.SparqlService.bindingsToObject(b, ps, conf, tracker);\n            });\n            ProjectService.orderCitables(ps.rightsHolders);\n            deferred.resolve(ps);\n        });\n        return deferred.promise;\n    };\n    ProjectWorkerService.prototype.runListQuery = function (source, lq, oc) {\n        lq = source.graph ? lq.replace(/# STARTGRAPH/g, 'GRAPH <' + source.graph + '> {').replace(/# ENDGRAPH/g, '}') : lq.replace(/.*# STARTGRAPH\\n/g, '').replace(/.*# ENDGRAPH\\n/g, '');\n        return this.fibraSparqlService.query(source.sparqlEndpoint, lq).then(function (response) {\n            var projects = new __WEBPACK_IMPORTED_MODULE_6__components_collection_utils__[\"a\" /* EMap */](oc);\n            var conf = {\n                bindingTypes: { rightsHolders: 'uniqueArray', schemas: 'uniqueArray', authorityEndpoints: 'uniqueArray', archiveEndpoints: 'uniqueArray' },\n                bindingConverters: {\n                    types: function (binding) {\n                        return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                    },\n                    labels: function (binding) {\n                        return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                    },\n                    descriptions: function (binding) {\n                        return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                    },\n                    schemas: function (binding) {\n                        return new __WEBPACK_IMPORTED_MODULE_5__schema__[\"a\" /* Schema */](binding.value, __WEBPACK_IMPORTED_MODULE_1__models_citable__[\"a\" /* CitableSource */].clone(source));\n                    },\n                    authorityEndpoints: function (binding) {\n                        return new __WEBPACK_IMPORTED_MODULE_4__remote_endpoint_configuration__[\"a\" /* RemoteEndpointConfiguration */](binding.value, __WEBPACK_IMPORTED_MODULE_1__models_citable__[\"a\" /* CitableSource */].clone(source));\n                    },\n                    archiveEndpoints: function (binding) {\n                        return new __WEBPACK_IMPORTED_MODULE_4__remote_endpoint_configuration__[\"a\" /* RemoteEndpointConfiguration */](binding.value, __WEBPACK_IMPORTED_MODULE_1__models_citable__[\"a\" /* CitableSource */].clone(source));\n                    },\n                    rightsHolders_labels: function (binding) {\n                        return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                    },\n                    rightsHolders_descriptions: function (binding) {\n                        return __WEBPACK_IMPORTED_MODULE_8__models_rdf__[\"b\" /* DataFactory */].nodeFromBinding(binding);\n                    },\n                    rightsHolders: function (binding) {\n                        return new __WEBPACK_IMPORTED_MODULE_1__models_citable__[\"b\" /* Citable */](binding.value, source);\n                    }\n                }\n            };\n            var tracker = new s.UniqueObjectTracker();\n            response.results.bindings.forEach(function (binding) {\n                return s.SparqlService.bindingsToObject(binding, projects.goc(binding['id'].value), conf, tracker);\n            });\n            projects.values().forEach(function (p) {\n                return ProjectService.orderCitables(p.rightsHolders);\n            });\n            return projects.values();\n        });\n    };\n    return ProjectWorkerService;\n}();\n\n__WEBPACK_IMPORTED_MODULE_0_angular__[\"module\"]('fibra.services.project-service', ['fibra.services.fibra-service', 'fibra.services.fibra-sparql-service']).config(function ($provide) {\n    $provide.service('projectService', ProjectService);\n    $provide.service('projectWorkerService', ProjectWorkerService);\n});//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvc2VydmljZXMvcHJvamVjdC1zZXJ2aWNlL3Byb2plY3Qtc2VydmljZS50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hcHAvc2VydmljZXMvcHJvamVjdC1zZXJ2aWNlL3Byb2plY3Qtc2VydmljZS50cz8xZTcwIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmltcG9ydCAqIGFzIGFuZ3VsYXIgZnJvbSAnYW5ndWxhcic7XG5pbXBvcnQgeyBDaXRhYmxlU291cmNlLCBDaXRhYmxlIH0gZnJvbSAnLi4vLi4vbW9kZWxzL2NpdGFibGUnO1xuaW1wb3J0IHsgUHJvamVjdCB9IGZyb20gJy4vcHJvamVjdCc7XG5pbXBvcnQgeyBQcmltYXJ5RW5kcG9pbnRDb25maWd1cmF0aW9uIH0gZnJvbSAnLi9wcmltYXJ5LWVuZHBvaW50LWNvbmZpZ3VyYXRpb24nO1xuaW1wb3J0IHsgUmVtb3RlRW5kcG9pbnRDb25maWd1cmF0aW9uIH0gZnJvbSAnLi9yZW1vdGUtZW5kcG9pbnQtY29uZmlndXJhdGlvbic7XG5pbXBvcnQgeyBTY2hlbWEgfSBmcm9tICcuL3NjaGVtYSc7XG5pbXBvcnQgeyBNYXAsIEVNYXAgfSBmcm9tICcuLi8uLi9jb21wb25lbnRzL2NvbGxlY3Rpb24tdXRpbHMnO1xuaW1wb3J0IHsgdG9UdXJ0bGUgfSBmcm9tICcuLi8uLi9jb21wb25lbnRzL21pc2MtdXRpbHMnO1xuaW1wb3J0IHsgRGF0YUZhY3RvcnkgfSBmcm9tICcuLi8uLi9tb2RlbHMvcmRmJztcbmltcG9ydCB7IERhdGFNb2RlbCwgQ2xhc3MsIFByb3BlcnR5IH0gZnJvbSAnLi9kYXRhLW1vZGVsJztcbnZhciBzID0gZmkuc2Vjby5zcGFycWw7XG52YXIgUHJvamVjdFNlcnZpY2UgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFByb2plY3RTZXJ2aWNlKHdvcmtlclNlcnZpY2UsIGZpYnJhU2VydmljZSwgZmlicmFTcGFycWxTZXJ2aWNlLCAkbG9jYWxTdG9yYWdlKSB7XG4gICAgICAgIHRoaXMud29ya2VyU2VydmljZSA9IHdvcmtlclNlcnZpY2U7XG4gICAgICAgIHRoaXMuZmlicmFTZXJ2aWNlID0gZmlicmFTZXJ2aWNlO1xuICAgICAgICB0aGlzLmZpYnJhU3BhcnFsU2VydmljZSA9IGZpYnJhU3BhcnFsU2VydmljZTtcbiAgICAgICAgdGhpcy4kbG9jYWxTdG9yYWdlID0gJGxvY2FsU3RvcmFnZTtcbiAgICAgICAgaWYgKCEkbG9jYWxTdG9yYWdlLnByb2plY3RTb3VyY2VzKVxuICAgICAgICAgICAgJGxvY2FsU3RvcmFnZS5wcm9qZWN0U291cmNlcyA9IFtdO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICAkbG9jYWxTdG9yYWdlLnByb2plY3RTb3VyY2VzLmZvckVhY2goZnVuY3Rpb24gKHBzKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFwcy5zcGFycWxFbmRwb2ludCkge1xuICAgICAgICAgICAgICAgICAgICBwcy5zcGFycWxFbmRwb2ludCA9IHBzWydlbmRwb2ludCddO1xuICAgICAgICAgICAgICAgICAgICBwcy51cGRhdGVFbmRwb2ludCA9IHBzWydlbmRwb2ludCddO1xuICAgICAgICAgICAgICAgICAgICBwcy5ncmFwaFN0b3JlRW5kcG9pbnQgPSBwc1snZW5kcG9pbnQnXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICB9XG4gICAgUHJvamVjdFNlcnZpY2Uub3JkZXJDaXRhYmxlcyA9IGZ1bmN0aW9uIChjaXRhYmxlcykge1xuICAgICAgICBjaXRhYmxlcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiAoYVsnb3JkZXInXSA/IGFbJ29yZGVyJ10gOiBOdW1iZXIuTUFYX1ZBTFVFKSAtIChiWydvcmRlciddID8gYlsnb3JkZXInXSA6IE51bWJlci5NQVhfVkFMVUUpOyB9KTtcbiAgICAgICAgY2l0YWJsZXMuZm9yRWFjaChmdW5jdGlvbiAocmgpIHsgcmV0dXJuIGRlbGV0ZSByaFsnb3JkZXInXTsgfSk7XG4gICAgfTtcbiAgICBQcm9qZWN0U2VydmljZS5wcm90b3R5cGUuZ2V0Q3VycmVudFByb2plY3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZpYnJhU2VydmljZS5nZXRTdGF0ZSgpLnByb2plY3Q7XG4gICAgfTtcbiAgICBQcm9qZWN0U2VydmljZS5wcm90b3R5cGUuc2V0Q3VycmVudFByb2plY3QgPSBmdW5jdGlvbiAocHJvamVjdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5maWJyYVNlcnZpY2UuZGlzcGF0Y2hBY3Rpb24odGhpcy5maWJyYVNlcnZpY2Uuc2V0UHJvamVjdChwcm9qZWN0KSk7XG4gICAgfTtcbiAgICBQcm9qZWN0U2VydmljZS5wcm90b3R5cGUuZ2V0UHJvamVjdFNvdXJjZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRsb2NhbFN0b3JhZ2UucHJvamVjdFNvdXJjZXM7XG4gICAgfTtcbiAgICBQcm9qZWN0U2VydmljZS5wcm90b3R5cGUubGlzdFByaW1hcnlFbmRwb2ludENvbmZpZ3VyYXRpb25zID0gZnVuY3Rpb24gKHNvdXJjZSkge1xuICAgICAgICByZXR1cm4gdGhpcy53b3JrZXJTZXJ2aWNlLmNhbGwoJ3Byb2plY3RXb3JrZXJTZXJ2aWNlJywgJ2xpc3RQcmltYXJ5RW5kcG9pbnRDb25maWd1cmF0aW9ucycsIFtzb3VyY2VdKTtcbiAgICB9O1xuICAgIFByb2plY3RTZXJ2aWNlLnByb3RvdHlwZS5sb2FkUHJpbWFyeUVuZHBvaW50Q29uZmlndXJhdGlvbiA9IGZ1bmN0aW9uIChzb3VyY2UsIHRlbXBsYXRlSWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud29ya2VyU2VydmljZS5jYWxsKCdwcm9qZWN0V29ya2VyU2VydmljZScsICdsb2FkUHJpbWFyeUVuZHBvaW50Q29uZmlndXJhdGlvbicsIFtzb3VyY2UsIHRlbXBsYXRlSWRdKTtcbiAgICB9O1xuICAgIFByb2plY3RTZXJ2aWNlLnByb3RvdHlwZS5saXN0QXJjaGl2ZUVuZHBvaW50Q29uZmlndXJhdGlvbnMgPSBmdW5jdGlvbiAoc291cmNlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLndvcmtlclNlcnZpY2UuY2FsbCgncHJvamVjdFdvcmtlclNlcnZpY2UnLCAnbGlzdEFyY2hpdmVFbmRwb2ludENvbmZpZ3VyYXRpb25zJywgW3NvdXJjZV0pO1xuICAgIH07XG4gICAgUHJvamVjdFNlcnZpY2UucHJvdG90eXBlLmxpc3RBdXRob3JpdHlFbmRwb2ludENvbmZpZ3VyYXRpb25zID0gZnVuY3Rpb24gKHNvdXJjZSkge1xuICAgICAgICByZXR1cm4gdGhpcy53b3JrZXJTZXJ2aWNlLmNhbGwoJ3Byb2plY3RXb3JrZXJTZXJ2aWNlJywgJ2xpc3RBdXRob3JpdHlFbmRwb2ludENvbmZpZ3VyYXRpb25zJywgW3NvdXJjZV0pO1xuICAgIH07XG4gICAgUHJvamVjdFNlcnZpY2UucHJvdG90eXBlLmxvYWRSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb24gPSBmdW5jdGlvbiAoc291cmNlLCB0ZW1wbGF0ZUlkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLndvcmtlclNlcnZpY2UuY2FsbCgncHJvamVjdFdvcmtlclNlcnZpY2UnLCAnbG9hZFJlbW90ZUVuZHBvaW50Q29uZmlndXJhdGlvbicsIFtzb3VyY2UsIHRlbXBsYXRlSWRdKTtcbiAgICB9O1xuICAgIFByb2plY3RTZXJ2aWNlLnByb3RvdHlwZS5saXN0U2NoZW1hcyA9IGZ1bmN0aW9uIChzb3VyY2UpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud29ya2VyU2VydmljZS5jYWxsKCdwcm9qZWN0V29ya2VyU2VydmljZScsICdsaXN0U2NoZW1hcycsIFtzb3VyY2VdKTtcbiAgICB9O1xuICAgIFByb2plY3RTZXJ2aWNlLnByb3RvdHlwZS5sb2FkU2NoZW1hID0gZnVuY3Rpb24gKHNvdXJjZSwgaWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud29ya2VyU2VydmljZS5jYWxsKCdwcm9qZWN0V29ya2VyU2VydmljZScsICdsb2FkU2NoZW1hJywgW3NvdXJjZSwgaWRdKTtcbiAgICB9O1xuICAgIFByb2plY3RTZXJ2aWNlLnByb3RvdHlwZS5saXN0UHJvamVjdHMgPSBmdW5jdGlvbiAoc291cmNlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLndvcmtlclNlcnZpY2UuY2FsbCgncHJvamVjdFdvcmtlclNlcnZpY2UnLCAnbGlzdFByb2plY3RzJywgW3NvdXJjZV0pO1xuICAgIH07XG4gICAgUHJvamVjdFNlcnZpY2UucHJvdG90eXBlLmxvYWRQcm9qZWN0ID0gZnVuY3Rpb24gKHNvdXJjZSwgcHJvamVjdElkLCBsb2FkRnVsbCkge1xuICAgICAgICByZXR1cm4gdGhpcy53b3JrZXJTZXJ2aWNlLmNhbGwoJ3Byb2plY3RXb3JrZXJTZXJ2aWNlJywgJ2xvYWRQcm9qZWN0JywgW3NvdXJjZSwgcHJvamVjdElkLCBsb2FkRnVsbF0pO1xuICAgIH07XG4gICAgUHJvamVjdFNlcnZpY2UucHJvdG90eXBlLmRlbGV0ZUNpdGFibGUgPSBmdW5jdGlvbiAodXBkYXRlRW5kcG9pbnQsIGNpdGFibGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVsZXRlT2JqZWN0KHVwZGF0ZUVuZHBvaW50LCBjaXRhYmxlLmlkLCBjaXRhYmxlLnNvdXJjZS5ncmFwaCk7XG4gICAgfTtcbiAgICBQcm9qZWN0U2VydmljZS5wcm90b3R5cGUuZGVsZXRlT2JqZWN0cyA9IGZ1bmN0aW9uICh1cGRhdGVFbmRwb2ludCwgaWRzLCBncmFwaCkge1xuICAgICAgICB2YXIgZHEgPSBncmFwaCA/IFByb2plY3RTZXJ2aWNlLmRlbGV0ZVF1ZXJ5LnJlcGxhY2UoLyMgU1RBUlRHUkFQSC9nLCAnR1JBUEggPCcgKyBncmFwaCArICc+IHsnKS5yZXBsYWNlKC8jIEVOREdSQVBIL2csICd9JykgOiBQcm9qZWN0U2VydmljZS5kZWxldGVRdWVyeS5yZXBsYWNlKC8uKiMgU1RBUlRHUkFQSFxcbi9nLCAnJykucmVwbGFjZSgvLiojIEVOREdSQVBIXFxuL2csICcnKTtcbiAgICAgICAgZHEgPSBkcS5yZXBsYWNlKC8jIFBBVFRFUk5TL2csIGlkcy5yZWR1Y2UoZnVuY3Rpb24gKGFjYywgaWQsIGluZGV4KSB7IHJldHVybiBhY2MgKyAnIDwnICsgaWQgKyAnPiA/cCcgKyBpbmRleCArICcgP28nICsgaW5kZXggKyAnIC4nOyB9LCAnJykpO1xuICAgICAgICByZXR1cm4gdGhpcy5maWJyYVNwYXJxbFNlcnZpY2UudXBkYXRlKHVwZGF0ZUVuZHBvaW50LCBkcSk7XG4gICAgfTtcbiAgICBQcm9qZWN0U2VydmljZS5wcm90b3R5cGUuZGVsZXRlT2JqZWN0ID0gZnVuY3Rpb24gKHVwZGF0ZUVuZHBvaW50LCBpZCwgZ3JhcGgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVsZXRlT2JqZWN0cyh1cGRhdGVFbmRwb2ludCwgW2lkXSwgZ3JhcGgpO1xuICAgIH07XG4gICAgUHJvamVjdFNlcnZpY2UucHJvdG90eXBlLnNhdmVDaXRhYmxlID0gZnVuY3Rpb24gKHVwZGF0ZUVuZHBvaW50LCBncmFwaFN0b3JlRW5kcG9pbnQsIHBzKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBtID0gbmV3IE1hcCgpO1xuICAgICAgICB2YXIgcHJlZml4ZXMgPSB7fTtcbiAgICAgICAgcHMudG9UdXJ0bGUobSwgcHJlZml4ZXMpO1xuICAgICAgICByZXR1cm4gdGhpcy5kZWxldGVPYmplY3RzKHVwZGF0ZUVuZHBvaW50LCBtLmtleXMoKSwgcHMuc291cmNlLmdyYXBoKS50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmZpYnJhU3BhcnFsU2VydmljZS5wb3N0KGdyYXBoU3RvcmVFbmRwb2ludCwgdG9UdXJ0bGUocHJlZml4ZXMsIG0pLCBwcy5zb3VyY2UuZ3JhcGgpOyB9KTtcbiAgICB9O1xuICAgIHJldHVybiBQcm9qZWN0U2VydmljZTtcbn0oKSk7XG5leHBvcnQgeyBQcm9qZWN0U2VydmljZSB9O1xuUHJvamVjdFNlcnZpY2UuZGVsZXRlUXVlcnkgPSBcIkRFTEVURSB7XFxuIyBTVEFSVEdSQVBIXFxuICAjIFBBVFRFUk5TXFxuIyBFTkRHUkFQSFxcbn1cXG5XSEVSRSB7XFxuIyBTVEFSVEdSQVBIXFxuICAjIFBBVFRFUk5TXFxuIyBFTkRHUkFQSFxcbn1cIjtcbnZhciBQcm9qZWN0V29ya2VyU2VydmljZSA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gUHJvamVjdFdvcmtlclNlcnZpY2UoZmlicmFTcGFycWxTZXJ2aWNlLCAkcSkge1xuICAgICAgICB0aGlzLmZpYnJhU3BhcnFsU2VydmljZSA9IGZpYnJhU3BhcnFsU2VydmljZTtcbiAgICAgICAgdGhpcy4kcSA9ICRxO1xuICAgIH1cbiAgICBQcm9qZWN0V29ya2VyU2VydmljZS5wcm90b3R5cGUubG9hZFByaW1hcnlFbmRwb2ludENvbmZpZ3VyYXRpb24gPSBmdW5jdGlvbiAoc291cmNlLCB0ZW1wbGF0ZUlkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJ1blNpbmdsZVF1ZXJ5KHNvdXJjZSwgUHJpbWFyeUVuZHBvaW50Q29uZmlndXJhdGlvbi5wcmltYXJ5RW5kcG9pbnRDb25maWd1cmF0aW9uUXVlcnksIHRlbXBsYXRlSWQsIG5ldyBQcmltYXJ5RW5kcG9pbnRDb25maWd1cmF0aW9uKHRlbXBsYXRlSWQsIHNvdXJjZSkpO1xuICAgIH07XG4gICAgUHJvamVjdFdvcmtlclNlcnZpY2UucHJvdG90eXBlLmxpc3RQcmltYXJ5RW5kcG9pbnRDb25maWd1cmF0aW9ucyA9IGZ1bmN0aW9uIChzb3VyY2UpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucnVuTGlzdFF1ZXJ5KHNvdXJjZSwgUHJpbWFyeUVuZHBvaW50Q29uZmlndXJhdGlvbi5saXN0UHJpbWFyeUVuZHBvaW50Q29uZmlndXJhdGlvbnNRdWVyeSwgZnVuY3Rpb24gKGlkKSB7IHJldHVybiBuZXcgUHJpbWFyeUVuZHBvaW50Q29uZmlndXJhdGlvbihpZCwgc291cmNlKTsgfSk7XG4gICAgfTtcbiAgICBQcm9qZWN0V29ya2VyU2VydmljZS5wcm90b3R5cGUubG9hZFJlbW90ZUVuZHBvaW50Q29uZmlndXJhdGlvbiA9IGZ1bmN0aW9uIChzb3VyY2UsIHRlbXBsYXRlSWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucnVuU2luZ2xlUXVlcnkoc291cmNlLCBSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb24ucmVtb3RlRW5kcG9pbnRDb25maWd1cmF0aW9uUXVlcnksIHRlbXBsYXRlSWQsIG5ldyBSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb24odGVtcGxhdGVJZCwgc291cmNlKSk7XG4gICAgfTtcbiAgICBQcm9qZWN0V29ya2VyU2VydmljZS5wcm90b3R5cGUubGlzdEFyY2hpdmVFbmRwb2ludENvbmZpZ3VyYXRpb25zID0gZnVuY3Rpb24gKHNvdXJjZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5ydW5MaXN0UXVlcnkoc291cmNlLCBSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb24ubGlzdEFyY2hpdmVFbmRwb2ludENvbmZpZ3VyYXRpb25zUXVlcnksIGZ1bmN0aW9uIChpZCkgeyByZXR1cm4gbmV3IFJlbW90ZUVuZHBvaW50Q29uZmlndXJhdGlvbihpZCwgc291cmNlKTsgfSk7XG4gICAgfTtcbiAgICBQcm9qZWN0V29ya2VyU2VydmljZS5wcm90b3R5cGUubGlzdEF1dGhvcml0eUVuZHBvaW50Q29uZmlndXJhdGlvbnMgPSBmdW5jdGlvbiAoc291cmNlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJ1bkxpc3RRdWVyeShzb3VyY2UsIFJlbW90ZUVuZHBvaW50Q29uZmlndXJhdGlvbi5saXN0QXV0aG9yaXR5RW5kcG9pbnRDb25maWd1cmF0aW9uc1F1ZXJ5LCBmdW5jdGlvbiAoaWQpIHsgcmV0dXJuIG5ldyBSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb24oaWQsIHNvdXJjZSk7IH0pO1xuICAgIH07XG4gICAgUHJvamVjdFdvcmtlclNlcnZpY2UucHJvdG90eXBlLmxpc3RQcm9qZWN0cyA9IGZ1bmN0aW9uIChzb3VyY2UpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucnVuTGlzdFF1ZXJ5KHNvdXJjZSwgUHJvamVjdC5saXN0UHJvamVjdHNRdWVyeSwgZnVuY3Rpb24gKGlkKSB7IHJldHVybiBuZXcgUHJvamVjdChpZCwgc291cmNlKTsgfSk7XG4gICAgfTtcbiAgICBQcm9qZWN0V29ya2VyU2VydmljZS5wcm90b3R5cGUubGlzdFNjaGVtYXMgPSBmdW5jdGlvbiAoc291cmNlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJ1bkxpc3RRdWVyeShzb3VyY2UsIFNjaGVtYS5saXN0U2NoZW1hc1F1ZXJ5LCBmdW5jdGlvbiAoaWQpIHsgcmV0dXJuIG5ldyBTY2hlbWEoaWQsIHNvdXJjZSk7IH0pO1xuICAgIH07XG4gICAgUHJvamVjdFdvcmtlclNlcnZpY2UucHJvdG90eXBlLmxvYWRTY2hlbWEgPSBmdW5jdGlvbiAoc291cmNlLCBpZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ydW5TaW5nbGVRdWVyeShzb3VyY2UsIFNjaGVtYS5zY2hlbWFRdWVyeSwgaWQsIG5ldyBTY2hlbWEoaWQsIHNvdXJjZSkpO1xuICAgIH07XG4gICAgUHJvamVjdFdvcmtlclNlcnZpY2UucHJvdG90eXBlLmxvYWREYXRhTW9kZWwgPSBmdW5jdGlvbiAoc2NoZW1hcykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgZGF0YU1vZGVsID0gbmV3IERhdGFNb2RlbCgpO1xuICAgICAgICB2YXIgY2xhc3NlcyA9IG5ldyBFTWFwKGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgdmFyIGNsID0gbmV3IENsYXNzKERhdGFGYWN0b3J5Lm5hbWVkTm9kZShpZCkpO1xuICAgICAgICAgICAgZGF0YU1vZGVsLmNsYXNzTWFwLnNldChpZCwgY2wpO1xuICAgICAgICAgICAgcmV0dXJuIGNsO1xuICAgICAgICB9KTtcbiAgICAgICAgdmFyIHByb3BlcnRpZXMgPSBuZXcgRU1hcChmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIHZhciBwciA9IG5ldyBQcm9wZXJ0eShEYXRhRmFjdG9yeS5uYW1lZE5vZGUoaWQpKTtcbiAgICAgICAgICAgIGRhdGFNb2RlbC5wcm9wZXJ0eU1hcC5zZXQoaWQsIHByKTtcbiAgICAgICAgICAgIHJldHVybiBwcjtcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBwcm9taXNlcyA9IFtdO1xuICAgICAgICBzY2hlbWFzLmZvckVhY2goZnVuY3Rpb24gKHNjaGVtYSkge1xuICAgICAgICAgICAgcHJvbWlzZXMucHVzaChfdGhpcy5maWJyYVNwYXJxbFNlcnZpY2UucXVlcnkoc2NoZW1hLmVuZHBvaW50LCBzY2hlbWEuY2xhc3NRdWVyeSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29uZiA9IHtcbiAgICAgICAgICAgICAgICAgICAgYmluZGluZ1R5cGVzOiB7IHR5cGVzOiAndW5pcXVlQXJyYXknIH0sXG4gICAgICAgICAgICAgICAgICAgIGJpbmRpbmdDb252ZXJ0ZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdXBlckNsYXNzZXM6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBjbGFzc2VzLmdvYyhiaW5kaW5nLnZhbHVlKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1YkNsYXNzZXM6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBjbGFzc2VzLmdvYyhiaW5kaW5nLnZhbHVlKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVzOiBmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gY2xhc3Nlcy5nb2MoYmluZGluZy52YWx1ZSk7IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbHM6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBEYXRhRmFjdG9yeS5ub2RlRnJvbUJpbmRpbmcoYmluZGluZyk7IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbnM6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBEYXRhRmFjdG9yeS5ub2RlRnJvbUJpbmRpbmcoYmluZGluZyk7IH0sXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHZhciB0cmFja2VyID0gbmV3IHMuVW5pcXVlT2JqZWN0VHJhY2tlcigpO1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlLnJlc3VsdHMuYmluZGluZ3MuZm9yRWFjaChmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gcy5TcGFycWxTZXJ2aWNlLmJpbmRpbmdzVG9PYmplY3QoYmluZGluZywgY2xhc3Nlcy5nb2MoYmluZGluZ1snaWQnXS52YWx1ZSksIGNvbmYsIHRyYWNrZXIpOyB9KTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIHByb21pc2VzLnB1c2goX3RoaXMuZmlicmFTcGFycWxTZXJ2aWNlLnF1ZXJ5KHNjaGVtYS5lbmRwb2ludCwgc2NoZW1hLnByb3BlcnR5UXVlcnkpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbmYgPSB7XG4gICAgICAgICAgICAgICAgICAgIGJpbmRpbmdUeXBlczogeyB0eXBlczogJ3VuaXF1ZUFycmF5JyB9LFxuICAgICAgICAgICAgICAgICAgICBiaW5kaW5nQ29udmVydGVyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3VwZXJQcm9wZXJ0aWVzOiBmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gcHJvcGVydGllcy5nb2MoYmluZGluZy52YWx1ZSk7IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBzdWJQcm9wZXJ0aWVzOiBmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gcHJvcGVydGllcy5nb2MoYmluZGluZy52YWx1ZSk7IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnZlcnNlUHJvcGVydHk6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBwcm9wZXJ0aWVzLmdvYyhiaW5kaW5nLnZhbHVlKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVzOiBmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gY2xhc3Nlcy5nb2MoYmluZGluZy52YWx1ZSk7IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBkb21haW5zOiBmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gY2xhc3Nlcy5nb2MoYmluZGluZy52YWx1ZSk7IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICByYW5nZXM6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBjbGFzc2VzLmdvYyhiaW5kaW5nLnZhbHVlKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsczogZnVuY3Rpb24gKGJpbmRpbmcpIHsgcmV0dXJuIERhdGFGYWN0b3J5Lm5vZGVGcm9tQmluZGluZyhiaW5kaW5nKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uczogZnVuY3Rpb24gKGJpbmRpbmcpIHsgcmV0dXJuIERhdGFGYWN0b3J5Lm5vZGVGcm9tQmluZGluZyhiaW5kaW5nKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdmFyIHRyYWNrZXIgPSBuZXcgcy5VbmlxdWVPYmplY3RUcmFja2VyKCk7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UucmVzdWx0cy5iaW5kaW5ncy5mb3JFYWNoKGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBzLlNwYXJxbFNlcnZpY2UuYmluZGluZ3NUb09iamVjdChiaW5kaW5nLCBwcm9wZXJ0aWVzLmdvYyhiaW5kaW5nWydpZCddLnZhbHVlKSwgY29uZiwgdHJhY2tlcik7IH0pO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHEuYWxsKHByb21pc2VzKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNsYXNzZXMudmFsdWVzKCkuZm9yRWFjaChmdW5jdGlvbiAoY2wpIHtcbiAgICAgICAgICAgICAgICBjbC5idWlsZEFzTm9kZXMoKTtcbiAgICAgICAgICAgICAgICBjbC5zdXBlckNsYXNzZXMuZmlsdGVyKGZ1bmN0aW9uIChzcHIpIHsgcmV0dXJuICFzcHIuc3ViQ2xhc3Nlcy5maW5kKGZ1bmN0aW9uIChvcHIpIHsgcmV0dXJuIG9wciA9PT0gY2w7IH0pOyB9KS5mb3JFYWNoKGZ1bmN0aW9uIChzcHIpIHsgcmV0dXJuIHNwci5zdWJDbGFzc2VzLnB1c2goY2wpOyB9KTtcbiAgICAgICAgICAgICAgICBjbC5zdWJDbGFzc2VzLmZpbHRlcihmdW5jdGlvbiAoc3ByKSB7IHJldHVybiAhc3ByLnN1cGVyQ2xhc3Nlcy5maW5kKGZ1bmN0aW9uIChvcHIpIHsgcmV0dXJuIG9wciA9PT0gY2w7IH0pOyB9KS5mb3JFYWNoKGZ1bmN0aW9uIChzcHIpIHsgcmV0dXJuIHNwci5zdXBlckNsYXNzZXMucHVzaChjbCk7IH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjbGFzc2VzLnZhbHVlcygpLmZvckVhY2goZnVuY3Rpb24gKGNsKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNsLnN1cGVyQ2xhc3Nlcy5sZW5ndGggPT09IDApXG4gICAgICAgICAgICAgICAgICAgIGRhdGFNb2RlbC5yb290Q2xhc3Nlcy5wdXNoKGNsKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcHJvcGVydGllcy52YWx1ZXMoKS5mb3JFYWNoKGZ1bmN0aW9uIChwcikge1xuICAgICAgICAgICAgICAgIHByLmJ1aWxkQXNOb2RlcygpO1xuICAgICAgICAgICAgICAgIGlmIChwci5pbnZlcnNlUHJvcGVydHkpXG4gICAgICAgICAgICAgICAgICAgIHByLmludmVyc2VQcm9wZXJ0eS5pbnZlcnNlUHJvcGVydHkgPSBwcjtcbiAgICAgICAgICAgICAgICBwci5zdXBlclByb3BlcnRpZXMuZmlsdGVyKGZ1bmN0aW9uIChzcHIpIHsgcmV0dXJuICFzcHIuc3ViUHJvcGVydGllcy5maW5kKGZ1bmN0aW9uIChvcHIpIHsgcmV0dXJuIG9wciA9PT0gcHI7IH0pOyB9KS5mb3JFYWNoKGZ1bmN0aW9uIChzcHIpIHsgcmV0dXJuIHNwci5zdWJQcm9wZXJ0aWVzLnB1c2gocHIpOyB9KTtcbiAgICAgICAgICAgICAgICBwci5zdWJQcm9wZXJ0aWVzLmZpbHRlcihmdW5jdGlvbiAoc3ByKSB7IHJldHVybiAhc3ByLnN1cGVyUHJvcGVydGllcy5maW5kKGZ1bmN0aW9uIChvcHIpIHsgcmV0dXJuIG9wciA9PT0gcHI7IH0pOyB9KS5mb3JFYWNoKGZ1bmN0aW9uIChzcHIpIHsgcmV0dXJuIHNwci5zdXBlclByb3BlcnRpZXMucHVzaChwcik7IH0pO1xuICAgICAgICAgICAgICAgIHByLmRvbWFpbnMuZm9yRWFjaChmdW5jdGlvbiAoZGMpIHsgcmV0dXJuIGRjLnByb3BlcnRpZXMucHVzaChwcik7IH0pO1xuICAgICAgICAgICAgICAgIHByLnJhbmdlcy5mb3JFYWNoKGZ1bmN0aW9uIChyYykgeyByZXR1cm4gcmMuaW52ZXJzZVByb3BlcnRpZXMucHVzaChwcik7IH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBwcm9wZXJ0aWVzLnZhbHVlcygpLmZvckVhY2goZnVuY3Rpb24gKHByKSB7XG4gICAgICAgICAgICAgICAgaWYgKHByLnN1cGVyUHJvcGVydGllcy5sZW5ndGggPT09IDApXG4gICAgICAgICAgICAgICAgICAgIGRhdGFNb2RlbC5yb290UHJvcGVydGllcy5wdXNoKHByKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGFNb2RlbDtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBQcm9qZWN0V29ya2VyU2VydmljZS5wcm90b3R5cGUubG9hZFByb2plY3QgPSBmdW5jdGlvbiAoc291cmNlLCBpZCwgbG9hZEZ1bGwpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIHEgPSB0aGlzLnJ1blNpbmdsZVF1ZXJ5KHNvdXJjZSwgUHJvamVjdC5wcm9qZWN0UXVlcnksIGlkLCBuZXcgUHJvamVjdChpZCwgc291cmNlKSk7XG4gICAgICAgIGlmICghbG9hZEZ1bGwpXG4gICAgICAgICAgICByZXR1cm4gcTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIHEudGhlbihmdW5jdGlvbiAocCkge1xuICAgICAgICAgICAgICAgIHZhciBwcm9taXNlcyA9IFtdO1xuICAgICAgICAgICAgICAgIHByb21pc2VzLnB1c2goX3RoaXMuJHEuYWxsKHAuc2NoZW1hcy5tYXAoZnVuY3Rpb24gKHNjaGVtYSkgeyByZXR1cm4gX3RoaXMubG9hZFNjaGVtYShzY2hlbWEuc291cmNlLCBzY2hlbWEuaWQpOyB9KSkudGhlbihmdW5jdGlvbiAoc2NoZW1hcykge1xuICAgICAgICAgICAgICAgICAgICBwLnNjaGVtYXMgPSBzY2hlbWFzO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMubG9hZERhdGFNb2RlbChzY2hlbWFzKS50aGVuKGZ1bmN0aW9uIChkbSkgeyByZXR1cm4gcC5kYXRhTW9kZWwgPSBkbTsgfSk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIHZhciBuYXJjaGUgPSBbXTtcbiAgICAgICAgICAgICAgICB2YXIgbmF1dGhlID0gW107XG4gICAgICAgICAgICAgICAgcC5hcmNoaXZlRW5kcG9pbnRzLmZvckVhY2goZnVuY3Rpb24gKGFlKSB7IHJldHVybiBwcm9taXNlcy5wdXNoKF90aGlzLmxvYWRSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb24oYWUuc291cmNlLCBhZS5pZCkudGhlbihmdW5jdGlvbiAoYWUyKSB7IHJldHVybiBuYXJjaGUucHVzaChhZTIpOyB9KSk7IH0pO1xuICAgICAgICAgICAgICAgIHAuYXV0aG9yaXR5RW5kcG9pbnRzLmZvckVhY2goZnVuY3Rpb24gKGFlKSB7IHJldHVybiBwcm9taXNlcy5wdXNoKF90aGlzLmxvYWRSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb24oYWUuc291cmNlLCBhZS5pZCkudGhlbihmdW5jdGlvbiAoYWUyKSB7IHJldHVybiBuYXV0aGUucHVzaChhZTIpOyB9KSk7IH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy4kcS5hbGwocHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBwLmFyY2hpdmVFbmRwb2ludHMgPSBuYXJjaGU7XG4gICAgICAgICAgICAgICAgICAgIHAuYXV0aG9yaXR5RW5kcG9pbnRzID0gbmF1dGhlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgIH07XG4gICAgUHJvamVjdFdvcmtlclNlcnZpY2UucHJvdG90eXBlLnJ1blNpbmdsZVF1ZXJ5ID0gZnVuY3Rpb24gKHNvdXJjZSwgdHEsIGlkLCBwcykge1xuICAgICAgICB0cSA9IHNvdXJjZS5ncmFwaCA/IHRxLnJlcGxhY2UoLyMgU1RBUlRHUkFQSC9nLCAnR1JBUEggPCcgKyBzb3VyY2UuZ3JhcGggKyAnPiB7JykucmVwbGFjZSgvIyBFTkRHUkFQSC9nLCAnfScpIDogdHEucmVwbGFjZSgvLiojIFNUQVJUR1JBUEhcXG4vZywgJycpLnJlcGxhY2UoLy4qIyBFTkRHUkFQSFxcbi9nLCAnJyk7XG4gICAgICAgIHRxID0gdHEucmVwbGFjZSgvPElEPi9nLCAnPCcgKyBpZCArICc+Jyk7XG4gICAgICAgIHZhciBkZWZlcnJlZCA9IHRoaXMuJHEuZGVmZXIoKTtcbiAgICAgICAgdGhpcy5maWJyYVNwYXJxbFNlcnZpY2UucXVlcnkoc291cmNlLnNwYXJxbEVuZHBvaW50LCB0cSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHZhciBjb25mID0ge1xuICAgICAgICAgICAgICAgIGJpbmRpbmdUeXBlczogeyByaWdodHNIb2xkZXJzOiAndW5pcXVlQXJyYXknLCBzY2hlbWFzOiAndW5pcXVlQXJyYXknLCBhdXRob3JpdHlFbmRwb2ludHM6ICd1bmlxdWVBcnJheScsIGFyY2hpdmVFbmRwb2ludHM6ICd1bmlxdWVBcnJheScgfSxcbiAgICAgICAgICAgICAgICBiaW5kaW5nQ29udmVydGVyczoge1xuICAgICAgICAgICAgICAgICAgICB0eXBlczogZnVuY3Rpb24gKGJpbmRpbmcpIHsgcmV0dXJuIERhdGFGYWN0b3J5Lm5vZGVGcm9tQmluZGluZyhiaW5kaW5nKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgbGFiZWxzOiBmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gRGF0YUZhY3Rvcnkubm9kZUZyb21CaW5kaW5nKGJpbmRpbmcpOyB9LFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbnM6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBEYXRhRmFjdG9yeS5ub2RlRnJvbUJpbmRpbmcoYmluZGluZyk7IH0sXG4gICAgICAgICAgICAgICAgICAgIHNjaGVtYXM6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBuZXcgU2NoZW1hKGJpbmRpbmcudmFsdWUsIENpdGFibGVTb3VyY2UuY2xvbmUoc291cmNlKSk7IH0sXG4gICAgICAgICAgICAgICAgICAgIGF1dGhvcml0eUVuZHBvaW50czogZnVuY3Rpb24gKGJpbmRpbmcpIHsgcmV0dXJuIG5ldyBSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb24oYmluZGluZy52YWx1ZSwgQ2l0YWJsZVNvdXJjZS5jbG9uZShzb3VyY2UpKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgYXJjaGl2ZUVuZHBvaW50czogZnVuY3Rpb24gKGJpbmRpbmcpIHsgcmV0dXJuIG5ldyBSZW1vdGVFbmRwb2ludENvbmZpZ3VyYXRpb24oYmluZGluZy52YWx1ZSwgQ2l0YWJsZVNvdXJjZS5jbG9uZShzb3VyY2UpKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgcmlnaHRzSG9sZGVyc19sYWJlbHM6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBEYXRhRmFjdG9yeS5ub2RlRnJvbUJpbmRpbmcoYmluZGluZyk7IH0sXG4gICAgICAgICAgICAgICAgICAgIHJpZ2h0c0hvbGRlcnNfZGVzY3JpcHRpb25zOiBmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gRGF0YUZhY3Rvcnkubm9kZUZyb21CaW5kaW5nKGJpbmRpbmcpOyB9LFxuICAgICAgICAgICAgICAgICAgICByaWdodHNIb2xkZXJzOiBmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gbmV3IENpdGFibGUoYmluZGluZy52YWx1ZSwgc291cmNlKTsgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgdHJhY2tlciA9IG5ldyBzLlVuaXF1ZU9iamVjdFRyYWNrZXIoKTtcbiAgICAgICAgICAgIHJlc3BvbnNlLnJlc3VsdHMuYmluZGluZ3MuZm9yRWFjaChmdW5jdGlvbiAoYikgeyByZXR1cm4gcy5TcGFycWxTZXJ2aWNlLmJpbmRpbmdzVG9PYmplY3QoYiwgcHMsIGNvbmYsIHRyYWNrZXIpOyB9KTtcbiAgICAgICAgICAgIFByb2plY3RTZXJ2aWNlLm9yZGVyQ2l0YWJsZXMocHMucmlnaHRzSG9sZGVycyk7XG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHBzKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH07XG4gICAgUHJvamVjdFdvcmtlclNlcnZpY2UucHJvdG90eXBlLnJ1bkxpc3RRdWVyeSA9IGZ1bmN0aW9uIChzb3VyY2UsIGxxLCBvYykge1xuICAgICAgICBscSA9IHNvdXJjZS5ncmFwaCA/IGxxLnJlcGxhY2UoLyMgU1RBUlRHUkFQSC9nLCAnR1JBUEggPCcgKyBzb3VyY2UuZ3JhcGggKyAnPiB7JykucmVwbGFjZSgvIyBFTkRHUkFQSC9nLCAnfScpIDogbHEucmVwbGFjZSgvLiojIFNUQVJUR1JBUEhcXG4vZywgJycpLnJlcGxhY2UoLy4qIyBFTkRHUkFQSFxcbi9nLCAnJyk7XG4gICAgICAgIHJldHVybiB0aGlzLmZpYnJhU3BhcnFsU2VydmljZS5xdWVyeShzb3VyY2Uuc3BhcnFsRW5kcG9pbnQsIGxxKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgdmFyIHByb2plY3RzID0gbmV3IEVNYXAob2MpO1xuICAgICAgICAgICAgdmFyIGNvbmYgPSB7XG4gICAgICAgICAgICAgICAgYmluZGluZ1R5cGVzOiB7IHJpZ2h0c0hvbGRlcnM6ICd1bmlxdWVBcnJheScsIHNjaGVtYXM6ICd1bmlxdWVBcnJheScsIGF1dGhvcml0eUVuZHBvaW50czogJ3VuaXF1ZUFycmF5JywgYXJjaGl2ZUVuZHBvaW50czogJ3VuaXF1ZUFycmF5JyB9LFxuICAgICAgICAgICAgICAgIGJpbmRpbmdDb252ZXJ0ZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGVzOiBmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gRGF0YUZhY3Rvcnkubm9kZUZyb21CaW5kaW5nKGJpbmRpbmcpOyB9LFxuICAgICAgICAgICAgICAgICAgICBsYWJlbHM6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBEYXRhRmFjdG9yeS5ub2RlRnJvbUJpbmRpbmcoYmluZGluZyk7IH0sXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uczogZnVuY3Rpb24gKGJpbmRpbmcpIHsgcmV0dXJuIERhdGFGYWN0b3J5Lm5vZGVGcm9tQmluZGluZyhiaW5kaW5nKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgc2NoZW1hczogZnVuY3Rpb24gKGJpbmRpbmcpIHsgcmV0dXJuIG5ldyBTY2hlbWEoYmluZGluZy52YWx1ZSwgQ2l0YWJsZVNvdXJjZS5jbG9uZShzb3VyY2UpKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgYXV0aG9yaXR5RW5kcG9pbnRzOiBmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gbmV3IFJlbW90ZUVuZHBvaW50Q29uZmlndXJhdGlvbihiaW5kaW5nLnZhbHVlLCBDaXRhYmxlU291cmNlLmNsb25lKHNvdXJjZSkpOyB9LFxuICAgICAgICAgICAgICAgICAgICBhcmNoaXZlRW5kcG9pbnRzOiBmdW5jdGlvbiAoYmluZGluZykgeyByZXR1cm4gbmV3IFJlbW90ZUVuZHBvaW50Q29uZmlndXJhdGlvbihiaW5kaW5nLnZhbHVlLCBDaXRhYmxlU291cmNlLmNsb25lKHNvdXJjZSkpOyB9LFxuICAgICAgICAgICAgICAgICAgICByaWdodHNIb2xkZXJzX2xhYmVsczogZnVuY3Rpb24gKGJpbmRpbmcpIHsgcmV0dXJuIERhdGFGYWN0b3J5Lm5vZGVGcm9tQmluZGluZyhiaW5kaW5nKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgcmlnaHRzSG9sZGVyc19kZXNjcmlwdGlvbnM6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBEYXRhRmFjdG9yeS5ub2RlRnJvbUJpbmRpbmcoYmluZGluZyk7IH0sXG4gICAgICAgICAgICAgICAgICAgIHJpZ2h0c0hvbGRlcnM6IGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBuZXcgQ2l0YWJsZShiaW5kaW5nLnZhbHVlLCBzb3VyY2UpOyB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciB0cmFja2VyID0gbmV3IHMuVW5pcXVlT2JqZWN0VHJhY2tlcigpO1xuICAgICAgICAgICAgcmVzcG9uc2UucmVzdWx0cy5iaW5kaW5ncy5mb3JFYWNoKGZ1bmN0aW9uIChiaW5kaW5nKSB7IHJldHVybiBzLlNwYXJxbFNlcnZpY2UuYmluZGluZ3NUb09iamVjdChiaW5kaW5nLCBwcm9qZWN0cy5nb2MoYmluZGluZ1snaWQnXS52YWx1ZSksIGNvbmYsIHRyYWNrZXIpOyB9KTtcbiAgICAgICAgICAgIHByb2plY3RzLnZhbHVlcygpLmZvckVhY2goZnVuY3Rpb24gKHApIHsgcmV0dXJuIFByb2plY3RTZXJ2aWNlLm9yZGVyQ2l0YWJsZXMocC5yaWdodHNIb2xkZXJzKTsgfSk7XG4gICAgICAgICAgICByZXR1cm4gcHJvamVjdHMudmFsdWVzKCk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcmV0dXJuIFByb2plY3RXb3JrZXJTZXJ2aWNlO1xufSgpKTtcbmV4cG9ydCB7IFByb2plY3RXb3JrZXJTZXJ2aWNlIH07XG5hbmd1bGFyLm1vZHVsZSgnZmlicmEuc2VydmljZXMucHJvamVjdC1zZXJ2aWNlJywgW1xuICAgICdmaWJyYS5zZXJ2aWNlcy5maWJyYS1zZXJ2aWNlJyxcbiAgICAnZmlicmEuc2VydmljZXMuZmlicmEtc3BhcnFsLXNlcnZpY2UnXG5dKVxuICAgIC5jb25maWcoZnVuY3Rpb24gKCRwcm92aWRlKSB7XG4gICAgJHByb3ZpZGUuc2VydmljZSgncHJvamVjdFNlcnZpY2UnLCBQcm9qZWN0U2VydmljZSk7XG4gICAgJHByb3ZpZGUuc2VydmljZSgncHJvamVjdFdvcmtlclNlcnZpY2UnLCBQcm9qZWN0V29ya2VyU2VydmljZSk7XG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBhcHAvc2VydmljZXMvcHJvamVjdC1zZXJ2aWNlL3Byb2plY3Qtc2VydmljZS50cyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBTEE7QUFGQTtBQVVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQVJBO0FBRkE7QUFhQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQVRBO0FBRkE7QUFjQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQVRBO0FBRkE7QUFjQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),

/***/ "./app/services/worker-service/worker-service.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__prototype_mapping_configuration__ = __webpack_require__(\"./app/services/worker-service/prototype-mapping-configuration.ts\");\n/* unused harmony export WorkerServiceConfiguration */\n/* unused harmony export WorkerService */\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"b\", function() { return WorkerWorkerService; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return StateWorkerService; });\n\n\n\n\nvar WorkerServiceConfiguration = function () {\n    function WorkerServiceConfiguration(appName, workerThreads, importScripts) {\n        this.appName = appName;\n        this.workerThreads = workerThreads;\n        this.importScripts = importScripts;\n    }\n    return WorkerServiceConfiguration;\n}();\n\nvar WorkerService = function () {\n    function WorkerService(workerServiceConfiguration, workerServicePrototypeMappingConfiguration, $rootScope, $window, $q) {\n        var _this = this;\n        this.workerServicePrototypeMappingConfiguration = workerServicePrototypeMappingConfiguration;\n        this.$q = $q;\n        this.currentWorker = 0;\n        this.deferreds = [];\n        var path = $window.location.protocol + '//' + $window.location.host;\n        var importScripts = workerServiceConfiguration.importScripts.map(function (s) {\n            return s.indexOf('http') !== 0 ? path + (s.indexOf('/') !== 0 ? $window.location.pathname : '') + s : s;\n        });\n        var blobURL = $window.URL.createObjectURL(new Blob([WorkerService.workerTemplate.replace(/<APP_NAME>/g, workerServiceConfiguration.appName).replace(/<IMPORT_SCRIPTS>/g, importScripts.join('\\',\\''))], { type: 'application/javascript' }));\n        this.workers = [];\n        for (var i = 0; i < workerServiceConfiguration.workerThreads; i++) {\n            this.workers.push(new Worker(blobURL));\n            this.workers[i].addEventListener('message', function (e) {\n                var eventId = e.data.event;\n                if (eventId === 'broadcast') {\n                    $rootScope.$broadcast(e.data.name, _this.restorePrototypes(e.data.args));\n                    $rootScope.$apply();\n                } else {\n                    var deferred = _this.deferreds[e.data.id];\n                    if (deferred) {\n                        if (eventId === 'success') {\n                            delete _this.deferreds[e.data.id];\n                            deferred.resolve(_this.restorePrototypes(e.data.data));\n                        } else if (eventId === 'failure') {\n                            delete _this.deferreds[e.data.id];\n                            deferred.reject(_this.restorePrototypes(e.data.data));\n                        } else deferred.notify(_this.restorePrototypes(e.data.data));\n                    }\n                }\n            });\n        }\n    }\n    WorkerService.stripMarks = function (args) {\n        if (!args || !args.__mark || typeof args !== 'object') return;\n        delete args.__mark;\n        if (args instanceof Array) args.forEach(function (arg) {\n            return WorkerService.stripMarks(arg);\n        });else {\n            for (var key in args) if (args.hasOwnProperty(key)) WorkerService.stripMarks(args[key]);\n        }\n    };\n    WorkerService.stripPrototypes = function (args) {\n        if (!args || !args.__className || typeof args !== 'object') return;\n        delete args.__className;\n        if (args instanceof Array) args.forEach(function (arg) {\n            return WorkerService.stripPrototypes(arg);\n        });else {\n            for (var key in args) if (args.hasOwnProperty(key)) WorkerService.stripPrototypes(args[key]);\n        }\n    };\n    WorkerService.savePrototypes = function (args) {\n        WorkerService.stripPrototypes(args);\n        this.savePrototypesInternal(args);\n        return args;\n    };\n    WorkerService.savePrototypesInternal = function (args) {\n        if (!args || args.__className || typeof args !== 'object') return;\n        if (args instanceof Array) args.forEach(function (arg) {\n            return WorkerService.savePrototypesInternal(arg);\n        });else {\n            if (args.constructor.__name || args.constructor.name !== 'Object') {\n                var currentPrototype = Object.getPrototypeOf(args);\n                out: while (currentPrototype !== Object.prototype) {\n                    for (var _i = 0, _a = Object.getOwnPropertyNames(currentPrototype); _i < _a.length; _i++) {\n                        var prop = _a[_i];\n                        if (prop !== 'constructor' && typeof args.__proto__[prop] === 'function') {\n                            args.__className = args.constructor.__name ? args.constructor.__name : args.constructor.name;\n                            break out;\n                        }\n                    }\n                    currentPrototype = Object.getPrototypeOf(currentPrototype);\n                }\n                if (!args.__className) args.__className = 'Object';\n            }\n            for (var key in args) if (args.hasOwnProperty(key)) WorkerService.savePrototypesInternal(args[key]);\n        }\n    };\n    WorkerService.prototype.$broadcast = function (name, args) {\n        this.workers.forEach(function (w) {\n            return w.postMessage({ name: name, args: WorkerService.savePrototypes(args) });\n        });\n    };\n    WorkerService.prototype.callAll = function (service, method, args, canceller) {\n        var _this = this;\n        if (args === void 0) {\n            args = [];\n        }\n        var deferred = this.$q.defer();\n        this.deferreds.push(deferred);\n        var id = this.deferreds.length - 1;\n        var message = {\n            id: id,\n            service: service,\n            method: method,\n            args: WorkerService.savePrototypes(args)\n        };\n        if (canceller) canceller.then(function () {\n            _this.workers.forEach(function (worker) {\n                return worker.postMessage({\n                    id: id,\n                    cancel: true\n                });\n            });\n            delete _this.deferreds[id];\n        });\n        this.workers.forEach(function (worker) {\n            return worker.postMessage(message);\n        });\n        return deferred.promise;\n    };\n    WorkerService.prototype.call = function (service, method, args, canceller) {\n        var _this = this;\n        if (args === void 0) {\n            args = [];\n        }\n        var deferred = this.$q.defer();\n        this.deferreds.push(deferred);\n        var id = this.deferreds.length - 1;\n        var worker = this.workers[this.currentWorker];\n        this.currentWorker = (this.currentWorker + 1) % this.workers.length;\n        if (canceller) canceller.then(function () {\n            worker.postMessage({\n                id: id,\n                cancel: true\n            });\n            delete _this.deferreds[id];\n        });\n        worker.postMessage({\n            id: id,\n            service: service,\n            method: method,\n            args: WorkerService.savePrototypes(args)\n        });\n        return deferred.promise;\n    };\n    WorkerService.prototype.restorePrototypes = function (args) {\n        this.restorePrototypesInternal(args);\n        WorkerService.stripMarks(args);\n        return args;\n    };\n    WorkerService.prototype.restorePrototypesInternal = function (args) {\n        var _this = this;\n        if (!args || args.__mark || typeof args !== 'object') return;\n        args.__mark = true;\n        if (args instanceof Array) args.forEach(function (arg) {\n            return _this.restorePrototypesInternal(arg);\n        });else {\n            if (args.__className) {\n                var prototype = this.workerServicePrototypeMappingConfiguration[args.__className];\n                if (!prototype) throw 'Unknown prototype ' + args.__className;\n                args.__proto__ = prototype;\n                delete args.__className;\n            }\n            for (var key in args) if (args.hasOwnProperty(key)) this.restorePrototypesInternal(args[key]);\n        }\n    };\n    return WorkerService;\n}();\n\nWorkerService.workerTemplate = \"\\n    var window = self\\n    window.history = {}\\n    window.Node = function () {}\\n    //self.setImmediate = function(fn) { return window.setTimeout(fn, 0) }\\n    window.document = {\\n      readyState: 'complete',\\n      cookie: '',\\n      querySelector: function (selector) {\\n        if (selector=='html') return { innerHTML: '', getAttribute: function() {}} // angular-hot-loader patch\\n      },\\n      addEventListener: function() {},\\n      createElement: function() {\\n        return {\\n          pathname: '',\\n          setAttribute: function(key, value) {}\\n        };\\n      },\\n    };\\n    importScripts('<IMPORT_SCRIPTS>')\\n    window.angular.module('<APP_NAME>').run(['workerWorkerService', function(workerWorkerService) {\\n      self.addEventListener('message', function(e) { workerWorkerService.onMessage(e.data) })\\n    }])\\n    window.angular.bootstrap(null, ['<APP_NAME>'])\\n    window = undefined\\n    self.history = undefined\\n    self.Node = undefined\\n    setTimeout(function() { // angular init needs this\\n      self.document = undefined\\n    }, 0)\\n  \";\nvar WorkerWorkerService = function () {\n    function WorkerWorkerService(workerServicePrototypeMappingConfiguration, $injector, $q, $rootScope) {\n        this.workerServicePrototypeMappingConfiguration = workerServicePrototypeMappingConfiguration;\n        this.$injector = $injector;\n        this.$q = $q;\n        this.$rootScope = $rootScope;\n        this.cancellers = [];\n    }\n    WorkerWorkerService.stripFunctions = function (obj) {\n        var ret = {};\n        for (var key in obj) if (typeof obj[key] === 'object') ret[key] = WorkerWorkerService.stripFunctions(obj[key]);else if (typeof obj[key] !== 'function') ret[key] = obj[key];\n        return ret;\n    };\n    WorkerWorkerService.prototype.$broadcast = function (name, args) {\n        try {\n            self.postMessage({ event: 'broadcast', name: name, args: WorkerService.savePrototypes(args) });\n        } catch (e) {\n            console.log(args, e);\n            throw e;\n        }\n    };\n    WorkerWorkerService.prototype.onMessage = function (message) {\n        var _this = this;\n        if (message.id === undefined) {\n            this.$rootScope.$broadcast(message.name, this.restorePrototypes(message.args));\n            this.$rootScope.$apply();\n        } else if (message.cancel) {\n            var canceller = this.cancellers[message.id];\n            delete this.cancellers[message.id];\n            if (canceller) canceller.resolve();\n        } else {\n            var service = this.$injector.get(message.service);\n            var canceller = this.$q.defer();\n            this.cancellers[message.id] = canceller;\n            var promise = service[message.method].apply(service, this.restorePrototypes(message.args).concat(canceller.promise));\n            if (!promise || !promise.then) {\n                var deferred = this.$q.defer();\n                deferred.resolve(promise);\n                promise = deferred.promise;\n            }\n            promise.then(function (success) {\n                delete _this.cancellers[message.id];\n                self.postMessage({ event: 'success', id: message.id, data: WorkerService.savePrototypes(success) });\n            }, function (error) {\n                delete _this.cancellers[message.id];\n                if (error instanceof Error) {\n                    self.postMessage({ event: 'failure', id: message.id, data: { name: error.name, message: error.message, stack: error.stack } });\n                    throw error;\n                }\n                self.postMessage({ event: 'failure', id: message.id, data: WorkerService.savePrototypes(WorkerWorkerService.stripFunctions(error)) });\n            }, function (update) {\n                return self.postMessage({ event: 'update', id: message.id, data: WorkerService.savePrototypes(update) });\n            });\n        }\n    };\n    WorkerWorkerService.prototype.restorePrototypes = function (args) {\n        this.restorePrototypesInternal(args);\n        WorkerService.stripMarks(args);\n        return args;\n    };\n    WorkerWorkerService.prototype.restorePrototypesInternal = function (args) {\n        var _this = this;\n        if (!args || args.__mark || typeof args !== 'object') return;\n        args.__mark = true;\n        if (args instanceof Array) args.forEach(function (arg) {\n            return _this.restorePrototypesInternal(arg);\n        });else {\n            if (args.__className) {\n                var prototype = this.workerServicePrototypeMappingConfiguration[args.__className];\n                if (!prototype) throw 'Unknown prototype ' + args.__className;\n                args.__proto__ = prototype;\n                delete args.__className;\n            }\n            for (var key in args) if (args.hasOwnProperty(key)) this.restorePrototypesInternal(args[key]);\n        }\n    };\n    return WorkerWorkerService;\n}();\n\nvar StateWorkerService = function () {\n    function StateWorkerService() {}\n    StateWorkerService.prototype.setState = function (state) {\n        this.state = state;\n    };\n    return StateWorkerService;\n}();\n\n__WEBPACK_IMPORTED_MODULE_0_angular__[\"module\"]('fibra.services.worker-service', ['fibra.services.worker-service-prototype-mapping-configuration']).config(function ($provide) {\n    $provide.service('stateWorkerService', StateWorkerService);\n    $provide.service('workerService', WorkerService);\n    $provide.service('workerWorkerService', WorkerWorkerService);\n});//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvc2VydmljZXMvd29ya2VyLXNlcnZpY2Uvd29ya2VyLXNlcnZpY2UudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3NlcnZpY2VzL3dvcmtlci1zZXJ2aWNlL3dvcmtlci1zZXJ2aWNlLnRzP2U2OWYiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuaW1wb3J0ICogYXMgYW5ndWxhciBmcm9tICdhbmd1bGFyJztcbmltcG9ydCAnLi9wcm90b3R5cGUtbWFwcGluZy1jb25maWd1cmF0aW9uJztcbnZhciBXb3JrZXJTZXJ2aWNlQ29uZmlndXJhdGlvbiA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gV29ya2VyU2VydmljZUNvbmZpZ3VyYXRpb24oYXBwTmFtZSwgd29ya2VyVGhyZWFkcywgaW1wb3J0U2NyaXB0cykge1xuICAgICAgICB0aGlzLmFwcE5hbWUgPSBhcHBOYW1lO1xuICAgICAgICB0aGlzLndvcmtlclRocmVhZHMgPSB3b3JrZXJUaHJlYWRzO1xuICAgICAgICB0aGlzLmltcG9ydFNjcmlwdHMgPSBpbXBvcnRTY3JpcHRzO1xuICAgIH1cbiAgICByZXR1cm4gV29ya2VyU2VydmljZUNvbmZpZ3VyYXRpb247XG59KCkpO1xuZXhwb3J0IHsgV29ya2VyU2VydmljZUNvbmZpZ3VyYXRpb24gfTtcbnZhciBXb3JrZXJTZXJ2aWNlID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBXb3JrZXJTZXJ2aWNlKHdvcmtlclNlcnZpY2VDb25maWd1cmF0aW9uLCB3b3JrZXJTZXJ2aWNlUHJvdG90eXBlTWFwcGluZ0NvbmZpZ3VyYXRpb24sICRyb290U2NvcGUsICR3aW5kb3csICRxKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMud29ya2VyU2VydmljZVByb3RvdHlwZU1hcHBpbmdDb25maWd1cmF0aW9uID0gd29ya2VyU2VydmljZVByb3RvdHlwZU1hcHBpbmdDb25maWd1cmF0aW9uO1xuICAgICAgICB0aGlzLiRxID0gJHE7XG4gICAgICAgIHRoaXMuY3VycmVudFdvcmtlciA9IDA7XG4gICAgICAgIHRoaXMuZGVmZXJyZWRzID0gW107XG4gICAgICAgIHZhciBwYXRoID0gJHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyAkd2luZG93LmxvY2F0aW9uLmhvc3Q7XG4gICAgICAgIHZhciBpbXBvcnRTY3JpcHRzID0gd29ya2VyU2VydmljZUNvbmZpZ3VyYXRpb24uaW1wb3J0U2NyaXB0cy5tYXAoZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgICAgIHJldHVybiBzLmluZGV4T2YoJ2h0dHAnKSAhPT0gMCA/IHBhdGggKyAocy5pbmRleE9mKCcvJykgIT09IDAgPyAkd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lIDogJycpICsgcyA6IHM7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgYmxvYlVSTCA9ICgkd2luZG93LlVSTCkuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtXb3JrZXJTZXJ2aWNlLndvcmtlclRlbXBsYXRlLnJlcGxhY2UoLzxBUFBfTkFNRT4vZywgd29ya2VyU2VydmljZUNvbmZpZ3VyYXRpb24uYXBwTmFtZSkucmVwbGFjZSgvPElNUE9SVF9TQ1JJUFRTPi9nLCBpbXBvcnRTY3JpcHRzLmpvaW4oJ1xcJyxcXCcnKSldLCB7IHR5cGU6ICdhcHBsaWNhdGlvbi9qYXZhc2NyaXB0JyB9KSk7XG4gICAgICAgIHRoaXMud29ya2VycyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHdvcmtlclNlcnZpY2VDb25maWd1cmF0aW9uLndvcmtlclRocmVhZHM7IGkrKykge1xuICAgICAgICAgICAgdGhpcy53b3JrZXJzLnB1c2gobmV3IFdvcmtlcihibG9iVVJMKSk7XG4gICAgICAgICAgICB0aGlzLndvcmtlcnNbaV0uYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGV2ZW50SWQgPSBlLmRhdGEuZXZlbnQ7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50SWQgPT09ICdicm9hZGNhc3QnKSB7XG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdChlLmRhdGEubmFtZSwgX3RoaXMucmVzdG9yZVByb3RvdHlwZXMoZS5kYXRhLmFyZ3MpKTtcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9IF90aGlzLmRlZmVycmVkc1tlLmRhdGEuaWRdO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGVmZXJyZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudElkID09PSAnc3VjY2VzcycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgX3RoaXMuZGVmZXJyZWRzW2UuZGF0YS5pZF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShfdGhpcy5yZXN0b3JlUHJvdG90eXBlcyhlLmRhdGEuZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZXZlbnRJZCA9PT0gJ2ZhaWx1cmUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIF90aGlzLmRlZmVycmVkc1tlLmRhdGEuaWRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChfdGhpcy5yZXN0b3JlUHJvdG90eXBlcyhlLmRhdGEuZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLm5vdGlmeShfdGhpcy5yZXN0b3JlUHJvdG90eXBlcyhlLmRhdGEuZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgV29ya2VyU2VydmljZS5zdHJpcE1hcmtzID0gZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICAgICAgaWYgKCFhcmdzIHx8ICFhcmdzLl9fbWFyayB8fCB0eXBlb2YgYXJncyAhPT0gJ29iamVjdCcpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGRlbGV0ZSBhcmdzLl9fbWFyaztcbiAgICAgICAgaWYgKGFyZ3MgaW5zdGFuY2VvZiBBcnJheSlcbiAgICAgICAgICAgIGFyZ3MuZm9yRWFjaChmdW5jdGlvbiAoYXJnKSB7IHJldHVybiBXb3JrZXJTZXJ2aWNlLnN0cmlwTWFya3MoYXJnKTsgfSk7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGFyZ3MpXG4gICAgICAgICAgICAgICAgaWYgKGFyZ3MuaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgICAgICAgICAgV29ya2VyU2VydmljZS5zdHJpcE1hcmtzKGFyZ3Nba2V5XSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFdvcmtlclNlcnZpY2Uuc3RyaXBQcm90b3R5cGVzID0gZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICAgICAgaWYgKCFhcmdzIHx8ICFhcmdzLl9fY2xhc3NOYW1lIHx8IHR5cGVvZiBhcmdzICE9PSAnb2JqZWN0JylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgZGVsZXRlIGFyZ3MuX19jbGFzc05hbWU7XG4gICAgICAgIGlmIChhcmdzIGluc3RhbmNlb2YgQXJyYXkpXG4gICAgICAgICAgICBhcmdzLmZvckVhY2goZnVuY3Rpb24gKGFyZykgeyByZXR1cm4gV29ya2VyU2VydmljZS5zdHJpcFByb3RvdHlwZXMoYXJnKTsgfSk7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGFyZ3MpXG4gICAgICAgICAgICAgICAgaWYgKGFyZ3MuaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgICAgICAgICAgV29ya2VyU2VydmljZS5zdHJpcFByb3RvdHlwZXMoYXJnc1trZXldKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgV29ya2VyU2VydmljZS5zYXZlUHJvdG90eXBlcyA9IGZ1bmN0aW9uIChhcmdzKSB7XG4gICAgICAgIFdvcmtlclNlcnZpY2Uuc3RyaXBQcm90b3R5cGVzKGFyZ3MpO1xuICAgICAgICB0aGlzLnNhdmVQcm90b3R5cGVzSW50ZXJuYWwoYXJncyk7XG4gICAgICAgIHJldHVybiBhcmdzO1xuICAgIH07XG4gICAgV29ya2VyU2VydmljZS5zYXZlUHJvdG90eXBlc0ludGVybmFsID0gZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICAgICAgaWYgKCFhcmdzIHx8IGFyZ3MuX19jbGFzc05hbWUgfHwgdHlwZW9mIGFyZ3MgIT09ICdvYmplY3QnKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAoYXJncyBpbnN0YW5jZW9mIEFycmF5KVxuICAgICAgICAgICAgYXJncy5mb3JFYWNoKGZ1bmN0aW9uIChhcmcpIHsgcmV0dXJuIFdvcmtlclNlcnZpY2Uuc2F2ZVByb3RvdHlwZXNJbnRlcm5hbChhcmcpOyB9KTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAoYXJncy5jb25zdHJ1Y3Rvci5fX25hbWUgfHwgYXJncy5jb25zdHJ1Y3Rvci5uYW1lICE9PSAnT2JqZWN0Jykge1xuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50UHJvdG90eXBlID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKGFyZ3MpO1xuICAgICAgICAgICAgICAgIG91dDogd2hpbGUgKGN1cnJlbnRQcm90b3R5cGUgIT09IE9iamVjdC5wcm90b3R5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGN1cnJlbnRQcm90b3R5cGUpOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByb3AgPSBfYVtfaV07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvcCAhPT0gJ2NvbnN0cnVjdG9yJyAmJiB0eXBlb2YgKGFyZ3MuX19wcm90b19fW3Byb3BdKSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MuX19jbGFzc05hbWUgPSBhcmdzLmNvbnN0cnVjdG9yLl9fbmFtZSA/IGFyZ3MuY29uc3RydWN0b3IuX19uYW1lIDogYXJncy5jb25zdHJ1Y3Rvci5uYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIG91dDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50UHJvdG90eXBlID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKGN1cnJlbnRQcm90b3R5cGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIWFyZ3MuX19jbGFzc05hbWUpXG4gICAgICAgICAgICAgICAgICAgIGFyZ3MuX19jbGFzc05hbWUgPSAnT2JqZWN0JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBhcmdzKVxuICAgICAgICAgICAgICAgIGlmIChhcmdzLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICAgICAgICAgIFdvcmtlclNlcnZpY2Uuc2F2ZVByb3RvdHlwZXNJbnRlcm5hbChhcmdzW2tleV0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBXb3JrZXJTZXJ2aWNlLnByb3RvdHlwZS4kYnJvYWRjYXN0ID0gZnVuY3Rpb24gKG5hbWUsIGFyZ3MpIHtcbiAgICAgICAgdGhpcy53b3JrZXJzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucG9zdE1lc3NhZ2UoeyBuYW1lOiBuYW1lLCBhcmdzOiBXb3JrZXJTZXJ2aWNlLnNhdmVQcm90b3R5cGVzKGFyZ3MpIH0pOyB9KTtcbiAgICB9O1xuICAgIFdvcmtlclNlcnZpY2UucHJvdG90eXBlLmNhbGxBbGwgPSBmdW5jdGlvbiAoc2VydmljZSwgbWV0aG9kLCBhcmdzLCBjYW5jZWxsZXIpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgaWYgKGFyZ3MgPT09IHZvaWQgMCkgeyBhcmdzID0gW107IH1cbiAgICAgICAgdmFyIGRlZmVycmVkID0gdGhpcy4kcS5kZWZlcigpO1xuICAgICAgICB0aGlzLmRlZmVycmVkcy5wdXNoKGRlZmVycmVkKTtcbiAgICAgICAgdmFyIGlkID0gdGhpcy5kZWZlcnJlZHMubGVuZ3RoIC0gMTtcbiAgICAgICAgdmFyIG1lc3NhZ2UgPSB7XG4gICAgICAgICAgICBpZDogaWQsXG4gICAgICAgICAgICBzZXJ2aWNlOiBzZXJ2aWNlLFxuICAgICAgICAgICAgbWV0aG9kOiBtZXRob2QsXG4gICAgICAgICAgICBhcmdzOiBXb3JrZXJTZXJ2aWNlLnNhdmVQcm90b3R5cGVzKGFyZ3MpXG4gICAgICAgIH07XG4gICAgICAgIGlmIChjYW5jZWxsZXIpXG4gICAgICAgICAgICBjYW5jZWxsZXIudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMud29ya2Vycy5mb3JFYWNoKGZ1bmN0aW9uICh3b3JrZXIpIHsgcmV0dXJuIHdvcmtlci5wb3N0TWVzc2FnZSh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZCxcbiAgICAgICAgICAgICAgICAgICAgY2FuY2VsOiB0cnVlXG4gICAgICAgICAgICAgICAgfSk7IH0pO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBfdGhpcy5kZWZlcnJlZHNbaWRdO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIHRoaXMud29ya2Vycy5mb3JFYWNoKGZ1bmN0aW9uICh3b3JrZXIpIHsgcmV0dXJuIHdvcmtlci5wb3N0TWVzc2FnZShtZXNzYWdlKTsgfSk7XG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH07XG4gICAgV29ya2VyU2VydmljZS5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uIChzZXJ2aWNlLCBtZXRob2QsIGFyZ3MsIGNhbmNlbGxlcikge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAoYXJncyA9PT0gdm9pZCAwKSB7IGFyZ3MgPSBbXTsgfVxuICAgICAgICB2YXIgZGVmZXJyZWQgPSB0aGlzLiRxLmRlZmVyKCk7XG4gICAgICAgIHRoaXMuZGVmZXJyZWRzLnB1c2goZGVmZXJyZWQpO1xuICAgICAgICB2YXIgaWQgPSB0aGlzLmRlZmVycmVkcy5sZW5ndGggLSAxO1xuICAgICAgICB2YXIgd29ya2VyID0gdGhpcy53b3JrZXJzW3RoaXMuY3VycmVudFdvcmtlcl07XG4gICAgICAgIHRoaXMuY3VycmVudFdvcmtlciA9ICh0aGlzLmN1cnJlbnRXb3JrZXIgKyAxKSAlIHRoaXMud29ya2Vycy5sZW5ndGg7XG4gICAgICAgIGlmIChjYW5jZWxsZXIpXG4gICAgICAgICAgICBjYW5jZWxsZXIudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgICAgICAgICAgICBjYW5jZWw6IHRydWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBkZWxldGUgX3RoaXMuZGVmZXJyZWRzW2lkXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB3b3JrZXIucG9zdE1lc3NhZ2Uoe1xuICAgICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgICAgc2VydmljZTogc2VydmljZSxcbiAgICAgICAgICAgIG1ldGhvZDogbWV0aG9kLFxuICAgICAgICAgICAgYXJnczogV29ya2VyU2VydmljZS5zYXZlUHJvdG90eXBlcyhhcmdzKVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfTtcbiAgICBXb3JrZXJTZXJ2aWNlLnByb3RvdHlwZS5yZXN0b3JlUHJvdG90eXBlcyA9IGZ1bmN0aW9uIChhcmdzKSB7XG4gICAgICAgIHRoaXMucmVzdG9yZVByb3RvdHlwZXNJbnRlcm5hbChhcmdzKTtcbiAgICAgICAgV29ya2VyU2VydmljZS5zdHJpcE1hcmtzKGFyZ3MpO1xuICAgICAgICByZXR1cm4gYXJncztcbiAgICB9O1xuICAgIFdvcmtlclNlcnZpY2UucHJvdG90eXBlLnJlc3RvcmVQcm90b3R5cGVzSW50ZXJuYWwgPSBmdW5jdGlvbiAoYXJncykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAoIWFyZ3MgfHwgYXJncy5fX21hcmsgfHwgdHlwZW9mIGFyZ3MgIT09ICdvYmplY3QnKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBhcmdzLl9fbWFyayA9IHRydWU7XG4gICAgICAgIGlmIChhcmdzIGluc3RhbmNlb2YgQXJyYXkpXG4gICAgICAgICAgICBhcmdzLmZvckVhY2goZnVuY3Rpb24gKGFyZykgeyByZXR1cm4gX3RoaXMucmVzdG9yZVByb3RvdHlwZXNJbnRlcm5hbChhcmcpOyB9KTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAoYXJncy5fX2NsYXNzTmFtZSkge1xuICAgICAgICAgICAgICAgIHZhciBwcm90b3R5cGUgPSB0aGlzLndvcmtlclNlcnZpY2VQcm90b3R5cGVNYXBwaW5nQ29uZmlndXJhdGlvblthcmdzLl9fY2xhc3NOYW1lXTtcbiAgICAgICAgICAgICAgICBpZiAoIXByb3RvdHlwZSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgJ1Vua25vd24gcHJvdG90eXBlICcgKyBhcmdzLl9fY2xhc3NOYW1lO1xuICAgICAgICAgICAgICAgIGFyZ3MuX19wcm90b19fID0gcHJvdG90eXBlO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBhcmdzLl9fY2xhc3NOYW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGFyZ3MpXG4gICAgICAgICAgICAgICAgaWYgKGFyZ3MuaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXN0b3JlUHJvdG90eXBlc0ludGVybmFsKGFyZ3Nba2V5XSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiBXb3JrZXJTZXJ2aWNlO1xufSgpKTtcbmV4cG9ydCB7IFdvcmtlclNlcnZpY2UgfTtcbldvcmtlclNlcnZpY2Uud29ya2VyVGVtcGxhdGUgPSBcIlxcbiAgICB2YXIgd2luZG93ID0gc2VsZlxcbiAgICB3aW5kb3cuaGlzdG9yeSA9IHt9XFxuICAgIHdpbmRvdy5Ob2RlID0gZnVuY3Rpb24gKCkge31cXG4gICAgLy9zZWxmLnNldEltbWVkaWF0ZSA9IGZ1bmN0aW9uKGZuKSB7IHJldHVybiB3aW5kb3cuc2V0VGltZW91dChmbiwgMCkgfVxcbiAgICB3aW5kb3cuZG9jdW1lbnQgPSB7XFxuICAgICAgcmVhZHlTdGF0ZTogJ2NvbXBsZXRlJyxcXG4gICAgICBjb29raWU6ICcnLFxcbiAgICAgIHF1ZXJ5U2VsZWN0b3I6IGZ1bmN0aW9uIChzZWxlY3Rvcikge1xcbiAgICAgICAgaWYgKHNlbGVjdG9yPT0naHRtbCcpIHJldHVybiB7IGlubmVySFRNTDogJycsIGdldEF0dHJpYnV0ZTogZnVuY3Rpb24oKSB7fX0gLy8gYW5ndWxhci1ob3QtbG9hZGVyIHBhdGNoXFxuICAgICAgfSxcXG4gICAgICBhZGRFdmVudExpc3RlbmVyOiBmdW5jdGlvbigpIHt9LFxcbiAgICAgIGNyZWF0ZUVsZW1lbnQ6IGZ1bmN0aW9uKCkge1xcbiAgICAgICAgcmV0dXJuIHtcXG4gICAgICAgICAgcGF0aG5hbWU6ICcnLFxcbiAgICAgICAgICBzZXRBdHRyaWJ1dGU6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHt9XFxuICAgICAgICB9O1xcbiAgICAgIH0sXFxuICAgIH07XFxuICAgIGltcG9ydFNjcmlwdHMoJzxJTVBPUlRfU0NSSVBUUz4nKVxcbiAgICB3aW5kb3cuYW5ndWxhci5tb2R1bGUoJzxBUFBfTkFNRT4nKS5ydW4oWyd3b3JrZXJXb3JrZXJTZXJ2aWNlJywgZnVuY3Rpb24od29ya2VyV29ya2VyU2VydmljZSkge1xcbiAgICAgIHNlbGYuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uKGUpIHsgd29ya2VyV29ya2VyU2VydmljZS5vbk1lc3NhZ2UoZS5kYXRhKSB9KVxcbiAgICB9XSlcXG4gICAgd2luZG93LmFuZ3VsYXIuYm9vdHN0cmFwKG51bGwsIFsnPEFQUF9OQU1FPiddKVxcbiAgICB3aW5kb3cgPSB1bmRlZmluZWRcXG4gICAgc2VsZi5oaXN0b3J5ID0gdW5kZWZpbmVkXFxuICAgIHNlbGYuTm9kZSA9IHVuZGVmaW5lZFxcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyAvLyBhbmd1bGFyIGluaXQgbmVlZHMgdGhpc1xcbiAgICAgIHNlbGYuZG9jdW1lbnQgPSB1bmRlZmluZWRcXG4gICAgfSwgMClcXG4gIFwiO1xudmFyIFdvcmtlcldvcmtlclNlcnZpY2UgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFdvcmtlcldvcmtlclNlcnZpY2Uod29ya2VyU2VydmljZVByb3RvdHlwZU1hcHBpbmdDb25maWd1cmF0aW9uLCAkaW5qZWN0b3IsICRxLCAkcm9vdFNjb3BlKSB7XG4gICAgICAgIHRoaXMud29ya2VyU2VydmljZVByb3RvdHlwZU1hcHBpbmdDb25maWd1cmF0aW9uID0gd29ya2VyU2VydmljZVByb3RvdHlwZU1hcHBpbmdDb25maWd1cmF0aW9uO1xuICAgICAgICB0aGlzLiRpbmplY3RvciA9ICRpbmplY3RvcjtcbiAgICAgICAgdGhpcy4kcSA9ICRxO1xuICAgICAgICB0aGlzLiRyb290U2NvcGUgPSAkcm9vdFNjb3BlO1xuICAgICAgICB0aGlzLmNhbmNlbGxlcnMgPSBbXTtcbiAgICB9XG4gICAgV29ya2VyV29ya2VyU2VydmljZS5zdHJpcEZ1bmN0aW9ucyA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgdmFyIHJldCA9IHt9O1xuICAgICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBvYmpba2V5XSA9PT0gJ29iamVjdCcpXG4gICAgICAgICAgICAgICAgcmV0W2tleV0gPSBXb3JrZXJXb3JrZXJTZXJ2aWNlLnN0cmlwRnVuY3Rpb25zKG9ialtrZXldKTtcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBvYmpba2V5XSAhPT0gJ2Z1bmN0aW9uJylcbiAgICAgICAgICAgICAgICByZXRba2V5XSA9IG9ialtrZXldO1xuICAgICAgICByZXR1cm4gcmV0O1xuICAgIH07XG4gICAgV29ya2VyV29ya2VyU2VydmljZS5wcm90b3R5cGUuJGJyb2FkY2FzdCA9IGZ1bmN0aW9uIChuYW1lLCBhcmdzKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgZXZlbnQ6ICdicm9hZGNhc3QnLCBuYW1lOiBuYW1lLCBhcmdzOiBXb3JrZXJTZXJ2aWNlLnNhdmVQcm90b3R5cGVzKGFyZ3MpIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhhcmdzLCBlKTtcbiAgICAgICAgICAgIHRocm93IGU7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFdvcmtlcldvcmtlclNlcnZpY2UucHJvdG90eXBlLm9uTWVzc2FnZSA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmIChtZXNzYWdlLmlkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuJHJvb3RTY29wZS4kYnJvYWRjYXN0KG1lc3NhZ2UubmFtZSwgdGhpcy5yZXN0b3JlUHJvdG90eXBlcyhtZXNzYWdlLmFyZ3MpKTtcbiAgICAgICAgICAgIHRoaXMuJHJvb3RTY29wZS4kYXBwbHkoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChtZXNzYWdlLmNhbmNlbCkge1xuICAgICAgICAgICAgdmFyIGNhbmNlbGxlciA9IHRoaXMuY2FuY2VsbGVyc1ttZXNzYWdlLmlkXTtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNhbmNlbGxlcnNbbWVzc2FnZS5pZF07XG4gICAgICAgICAgICBpZiAoY2FuY2VsbGVyKVxuICAgICAgICAgICAgICAgIGNhbmNlbGxlci5yZXNvbHZlKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgc2VydmljZSA9IHRoaXMuJGluamVjdG9yLmdldChtZXNzYWdlLnNlcnZpY2UpO1xuICAgICAgICAgICAgdmFyIGNhbmNlbGxlciA9IHRoaXMuJHEuZGVmZXIoKTtcbiAgICAgICAgICAgIHRoaXMuY2FuY2VsbGVyc1ttZXNzYWdlLmlkXSA9IGNhbmNlbGxlcjtcbiAgICAgICAgICAgIHZhciBwcm9taXNlID0gc2VydmljZVttZXNzYWdlLm1ldGhvZF0uYXBwbHkoc2VydmljZSwgdGhpcy5yZXN0b3JlUHJvdG90eXBlcyhtZXNzYWdlLmFyZ3MpLmNvbmNhdChjYW5jZWxsZXIucHJvbWlzZSkpO1xuICAgICAgICAgICAgaWYgKCFwcm9taXNlIHx8ICFwcm9taXNlLnRoZW4pIHtcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSB0aGlzLiRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShwcm9taXNlKTtcbiAgICAgICAgICAgICAgICBwcm9taXNlID0gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHByb21pc2UudGhlbihmdW5jdGlvbiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBfdGhpcy5jYW5jZWxsZXJzW21lc3NhZ2UuaWRdO1xuICAgICAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoeyBldmVudDogJ3N1Y2Nlc3MnLCBpZDogbWVzc2FnZS5pZCwgZGF0YTogV29ya2VyU2VydmljZS5zYXZlUHJvdG90eXBlcyhzdWNjZXNzKSB9KTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBfdGhpcy5jYW5jZWxsZXJzW21lc3NhZ2UuaWRdO1xuICAgICAgICAgICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoeyBldmVudDogJ2ZhaWx1cmUnLCBpZDogbWVzc2FnZS5pZCwgZGF0YTogeyBuYW1lOiBlcnJvci5uYW1lLCBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLCBzdGFjazogZXJyb3Iuc3RhY2sgfSB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoeyBldmVudDogJ2ZhaWx1cmUnLCBpZDogbWVzc2FnZS5pZCwgZGF0YTogV29ya2VyU2VydmljZS5zYXZlUHJvdG90eXBlcyhXb3JrZXJXb3JrZXJTZXJ2aWNlLnN0cmlwRnVuY3Rpb25zKGVycm9yKSkgfSk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAodXBkYXRlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYucG9zdE1lc3NhZ2UoeyBldmVudDogJ3VwZGF0ZScsIGlkOiBtZXNzYWdlLmlkLCBkYXRhOiBXb3JrZXJTZXJ2aWNlLnNhdmVQcm90b3R5cGVzKHVwZGF0ZSkgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgV29ya2VyV29ya2VyU2VydmljZS5wcm90b3R5cGUucmVzdG9yZVByb3RvdHlwZXMgPSBmdW5jdGlvbiAoYXJncykge1xuICAgICAgICB0aGlzLnJlc3RvcmVQcm90b3R5cGVzSW50ZXJuYWwoYXJncyk7XG4gICAgICAgIFdvcmtlclNlcnZpY2Uuc3RyaXBNYXJrcyhhcmdzKTtcbiAgICAgICAgcmV0dXJuIGFyZ3M7XG4gICAgfTtcbiAgICBXb3JrZXJXb3JrZXJTZXJ2aWNlLnByb3RvdHlwZS5yZXN0b3JlUHJvdG90eXBlc0ludGVybmFsID0gZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgaWYgKCFhcmdzIHx8IGFyZ3MuX19tYXJrIHx8IHR5cGVvZiBhcmdzICE9PSAnb2JqZWN0JylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgYXJncy5fX21hcmsgPSB0cnVlO1xuICAgICAgICBpZiAoYXJncyBpbnN0YW5jZW9mIEFycmF5KVxuICAgICAgICAgICAgYXJncy5mb3JFYWNoKGZ1bmN0aW9uIChhcmcpIHsgcmV0dXJuIF90aGlzLnJlc3RvcmVQcm90b3R5cGVzSW50ZXJuYWwoYXJnKTsgfSk7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKGFyZ3MuX19jbGFzc05hbWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJvdG90eXBlID0gdGhpcy53b3JrZXJTZXJ2aWNlUHJvdG90eXBlTWFwcGluZ0NvbmZpZ3VyYXRpb25bYXJncy5fX2NsYXNzTmFtZV07XG4gICAgICAgICAgICAgICAgaWYgKCFwcm90b3R5cGUpXG4gICAgICAgICAgICAgICAgICAgIHRocm93ICdVbmtub3duIHByb3RvdHlwZSAnICsgYXJncy5fX2NsYXNzTmFtZTtcbiAgICAgICAgICAgICAgICBhcmdzLl9fcHJvdG9fXyA9IHByb3RvdHlwZTtcbiAgICAgICAgICAgICAgICBkZWxldGUgYXJncy5fX2NsYXNzTmFtZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBhcmdzKVxuICAgICAgICAgICAgICAgIGlmIChhcmdzLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVzdG9yZVByb3RvdHlwZXNJbnRlcm5hbChhcmdzW2tleV0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gV29ya2VyV29ya2VyU2VydmljZTtcbn0oKSk7XG5leHBvcnQgeyBXb3JrZXJXb3JrZXJTZXJ2aWNlIH07XG52YXIgU3RhdGVXb3JrZXJTZXJ2aWNlID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBTdGF0ZVdvcmtlclNlcnZpY2UoKSB7XG4gICAgfVxuICAgIFN0YXRlV29ya2VyU2VydmljZS5wcm90b3R5cGUuc2V0U3RhdGUgPSBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHN0YXRlO1xuICAgIH07XG4gICAgcmV0dXJuIFN0YXRlV29ya2VyU2VydmljZTtcbn0oKSk7XG5leHBvcnQgeyBTdGF0ZVdvcmtlclNlcnZpY2UgfTtcbmFuZ3VsYXIubW9kdWxlKCdmaWJyYS5zZXJ2aWNlcy53b3JrZXItc2VydmljZScsIFsnZmlicmEuc2VydmljZXMud29ya2VyLXNlcnZpY2UtcHJvdG90eXBlLW1hcHBpbmctY29uZmlndXJhdGlvbiddKVxuICAgIC5jb25maWcoZnVuY3Rpb24gKCRwcm92aWRlKSB7XG4gICAgJHByb3ZpZGUuc2VydmljZSgnc3RhdGVXb3JrZXJTZXJ2aWNlJywgU3RhdGVXb3JrZXJTZXJ2aWNlKTtcbiAgICAkcHJvdmlkZS5zZXJ2aWNlKCd3b3JrZXJTZXJ2aWNlJywgV29ya2VyU2VydmljZSk7XG4gICAgJHByb3ZpZGUuc2VydmljZSgnd29ya2VyV29ya2VyU2VydmljZScsIFdvcmtlcldvcmtlclNlcnZpY2UpO1xufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL3NlcnZpY2VzL3dvcmtlci1zZXJ2aWNlL3dvcmtlci1zZXJ2aWNlLnRzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFFQTtBQUFBO0FBQ0E7QUFDQTtBQUZBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ })

})