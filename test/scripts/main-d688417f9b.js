var fibra;!function(e){"use strict";var t=angular.module("fibra",["http-auth-interceptor","ngStorage","ui.router","ui.bootstrap","ui.bootstrap.tpls"]);t.config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/configure"),e.state("configure",{url:"/configure",template:"<configure-view></configure-view>"}),e.state("select",{url:"/select",template:"<select-view></select-view>"}),e.state("construct",{url:"/construct",template:"<construct-view></construct-view>"}),e.state("author",{url:"/author",template:"<author-view></author-view>"})}]),t.config(["$localStorageProvider",function(e){e.setKeyPrefix("fibra-")}]),t.value("workerServiceConfiguration",{appName:"fibra",workerThreads:8,importScripts:["scripts/worker-011c8d34a7.js"]}),t.run(["$rootScope","$localStorage","$http","authService","workerService",function(e,t,r,n,o){e.authInfo={authOpen:!1,username:void 0,password:void 0},t.authorization&&(r.defaults.headers.common.Authorization=t.authorization,o.$broadcast("main:auth-loginAuthInfo",t.authorization)),e.setAuth=function(){e.authInfo.authOpen=!1,t.authorization="Basic "+btoa(e.authInfo.username+":"+e.authInfo.password),r.defaults.headers.common.Authorization=t.authorization,o.$broadcast("main:auth-loginAuthInfo",t.authorization),n.loginConfirmed()},e.dismissAuth=function(){e.authInfo.authOpen=!1,n.loginCancelled({status:401},"Authentication required")},e.$on("event:auth-loginRequired",function(){return e.authInfo.authOpen=!0})}])}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=angular.module("fibra",["http-auth-interceptor","ngStorage","ui.router","ui.bootstrap","ui.bootstrap.tpls"]);t.config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/configure"),e.state("configure",{url:"/configure",template:"<configure-view></configure-view>"}),e.state("select",{url:"/select",template:"<select-view></select-view>"}),e.state("construct",{url:"/construct",template:"<construct-view></construct-view>"}),e.state("author",{url:"/author",template:"<author-view></author-view>"})}]),t.config(["$localStorageProvider",function(e){e.setKeyPrefix("fibra-")}]),t.value("workerServiceConfiguration",{appName:"fibra",workerThreads:8,importScripts:["scripts/worker-011c8d34a7.js"]}),t.run(["$rootScope","$localStorage","$http","authService","workerService",function(e,t,r,n,o){e.authInfo={authOpen:!1,username:void 0,password:void 0},t.authorization&&(r.defaults.headers.common.Authorization=t.authorization,o.$broadcast("main:auth-loginAuthInfo",t.authorization)),e.setAuth=function(){e.authInfo.authOpen=!1,t.authorization="Basic "+btoa(e.authInfo.username+":"+e.authInfo.password),r.defaults.headers.common.Authorization=t.authorization,o.$broadcast("main:auth-loginAuthInfo",t.authorization),n.loginConfirmed()},e.dismissAuth=function(){e.authInfo.authOpen=!1,n.loginCancelled({status:401},"Authentication required")},e.$on("event:auth-loginRequired",function(){return e.authInfo.authOpen=!0})}])}(fibra||(fibra={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},fibra;!function(e){"use strict";function t(e,t,r){return void 0===e[t]&&(e[t]=r?r(t):{}),e[t]}function r(e,t,r,n){return void 0===e[t]&&(e[t]=n?n(t):{},r.push(e[t])),e[t]}function n(e,t,r,n){void 0===t[r]&&(t[r]=n,e.push(n))}function o(e,t,r){for(var o in r)n(e,t,o,r[o])}var i=function(){function e(e){void 0===e&&(e=function(){return{}}),this.create=e,this.s={}}return e.prototype.has=function(e){return void 0!==this.s[e]},e.prototype.goc=function(e,t){return this.has(e)||this.set(e,t?t(e):this.create(e)),this.get(e)},e.prototype.set=function(e,t){return this.s[e]=t,this},e.prototype.get=function(e){return this.s[e]},e.prototype.remove=function(e){var t=this.has(e);return delete this.s[e],t},e.prototype.sets=function(e){for(var t in e)this.set(t,e[t]);return this},e.prototype.setm=function(e){for(var t in e)this.set(t,e[t]);return this},e.prototype.clear=function(){return this.s={},this},e.prototype.keys=function(){var e=[];for(var t in this.s)e.push(t);return e},e.prototype.values=function(){var e=[];for(var t in this.s)e.push(this.s[t]);return e},e.prototype.entries=function(){var e=[];for(var t in this.s)e.push({key:t,value:this.s[t]});return e},e.prototype.each=function(e){for(var t in this.s)e(this.s[t],t,this)},e.prototype.size=function(){var e=0;for(var t in this.s)e++;return e},e.prototype.empty=function(){return 0===this.size()},e}();e.EMap=i;var a=function(){function e(){this.a=[]}return e.prototype.clear=function(){return this.a=[],this},e.prototype.has=function(e){return this.a.indexOf(e)!==-1},e.prototype.add=function(e){return this.has(e)?this:(this.a.push(e),this)},e.prototype.adda=function(e){var t=this;return e.forEach(function(e){return t.add(e)}),this},e.prototype.adds=function(e){var t=this;return e.each(function(e){return t.add(e)}),this},e.prototype.remove=function(e){var t=this.a.indexOf(e);return t!==-1&&(this.a.splice(t,1),!0)},e.prototype.each=function(e){for(var t=0,r=this.a;t<r.length;t++){var n=r[t];e(n,n,this)}},e.prototype.size=function(){return this.a.length},e.prototype.empty=function(){return 0===this.size()},e.prototype.values=function(){return this.a},e}();e.IdentitySet=a;var s=function(){function e(){this.s={}}return e.prototype.clear=function(){return this.s={},this},e.prototype.has=function(e){return void 0!==this.s[e]},e.prototype.add=function(e){return this.s[e]=e,this},e.prototype.adda=function(e){var t=this;return e.forEach(function(e){return t.add(e)}),this},e.prototype.adds=function(e){var t=this;return e.each(function(e){return t.add(e)}),this},e.prototype.remove=function(e){var t=this.has(e);return delete this.s[e],t},e.prototype.each=function(e){for(var t in this.s)e(this.s[t],t,this)},e.prototype.size=function(){var e=0;for(var t in this.s)e++;return e},e.prototype.empty=function(){return 0===this.size()},e.prototype.values=function(){var e=[];for(var t in this.s)e.push(t);return e},e}();e.StringSet=s;var l=function(e){function t(t){e.call(this,t),this.a=[]}return __extends(t,e),t.prototype.goc=function(e,t){return this.has(e)||this.set(e,t?t(e):this.create(e)),this.get(e)},t.prototype.set=function(t,r){return this.has(t)||(e.prototype.set.call(this,t,r),this.a.push(r)),this},t.prototype.remove=function(t){var r=this.get(t);return void 0!==r&&(e.prototype.remove.call(this,t),this.a.splice(this.a.indexOf(r),1)),void 0!==r},t.prototype.size=function(){return this.a.length},t.prototype.values=function(){return this.a},t.prototype.clear=function(){return e.prototype.clear.call(this),this.a=[],this},t}(i);e.EOMap=l;var c=function(e){function t(){e.apply(this,arguments),this.a=[]}return __extends(t,e),t.prototype.add=function(t){return this.has(t)||(e.prototype.add.call(this,t),this.a.push(t)),this},t.prototype.remove=function(t){var r=e.prototype.remove.call(this,t);return r&&this.a.splice(this.a.indexOf(t),1),r},t.prototype.size=function(){return this.a.length},t.prototype.values=function(){return this.a},t.prototype.clear=function(){return e.prototype.clear.call(this),this.a=[],this},t}(s);e.OStringSet=c,e.goc=t,e.ogoc=r,e.cpush=n,e.cpushs=o}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e){this.workerService=e}return e.prototype.getTree=function(e,t,r){return this.workerService.call("sparqlTreeWorkerService","getTree",[e,t],r)},e.getClassTreeQuery='\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX sf: <http://ldf.fi/functions#>\nSELECT ?subClass ?superClass ?class ?classLabel ?instances {\n  GRAPH <GRAPH> {\n    {\n      ?subClass rdfs:subClassOf ?class .\n      FILTER EXISTS {\n        ?p a ?subClass .\n      }\n    } UNION {\n      {\n        SELECT ?class (COUNT(DISTINCT ?p) AS ?instances) {\n          ?p a ?class .\n        }\n        GROUP BY ?class\n      }\n    }\n    OPTIONAL {\n      ?class sf:preferredLanguageLiteral (skos:prefLabel rdfs:label skos:altLabel \'en\' \'\' ?classLabelP) .\n    }\n    FILTER(ISIRI(?class))\n    BIND(COALESCE(?classLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?class),".*/",""),".*#",""),"_"," "),"([A-ZÅÄÖ])"," $1")) AS ?classLabel)\n  }\n}\n',e}();angular.module("fibra").service("sparqlTreeService",["workerService",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.SparqlTreeService=t;var r=function(){function t(e){this.sparqlService=e}return t.prototype.getTree=function(t,r,n){return this.sparqlService.query(t,r,{timeout:n}).then(function(t){var r={},n={};t.data.results.bindings.forEach(function(t){if(t.classLabel&&(n[t.class.value]=new e.TreeNode(t.class.value,t.classLabel.value)),t.instances&&(n[t.class.value].instances=parseInt(t.instances.value,10)),t.subClass){var o=t.subClass.value;r[o]||(r[o]={}),r[o][t.class.value]=!0}if(t.superClass){var o=t.class.value;r[o]||(r[o]={}),r[o][t.superClass.value]=!0}});var o=[];for(var i in n)if(r[i])for(var a in r[i])n[a].children.push(n[i]);else o.push(n[i]);return o})},t}();angular.module("fibra").service("sparqlTreeWorkerService",["sparqlService",function(){return new(Function.prototype.bind.apply(r,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.SparqlTreeWorkerService=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e){this.workerService=e}return e.prototype.updateQuads=function(e,t,r){return this.workerService.call("sparqlUpdateWorkerService","update",[e,t,r])},e.prototype.updateGraphs=function(e,t,r){return this.workerService.call("sparqlUpdateWorkerService","update",[e,t,r])},e}();angular.module("fibra").service("sparqlUpdateService",["workerService",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.SparqlUpdateService=t;var r=function(){function t(e){this.sparqlService=e}return t.prototype.updateQuads=function(t,r,n){void 0===r&&(r=[]),void 0===n&&(n=[]);var o={},i={},a=[],s=[];return r.forEach(function(t){var r=o[t.graph.value];r||(r=new e.Graph(t.graph),o[t.graph.value]=r,a.push(r)),r.triples.push(t)}),n.forEach(function(t){var r=i[t.graph.value];r||(r=new e.Graph(t.graph),i[t.graph.value]=r,s.push(r)),r.triples.push(t)}),this.updateGraphs(t,a,s)},t.prototype.updateGraphs=function(r,n,o){void 0===n&&(n=[]),void 0===o&&(o=[]);var i=n.map(function(t){return(e.DefaultGraph.instance.equals(t.graph)?"":"GRAPH"+t.graph.toCanonical())+"{"+t.triples.map(function(e){return e.toCanonical()}).join(" . ")+"}"}).join(""),a=o.map(function(t){return(e.DefaultGraph.instance.equals(t.graph)?"":"GRAPH"+t.graph.toCanonical())+"{"+t.triples.map(function(e){return e.toCanonical()}).join(" . ")+"}"}).join("");return this.sparqlService.update(r,t.queryTemplate.replace(/<DELETE>/g,a).replace(/<INSERT>/g,i)).then(function(e){return 204===e.status},function(e){return!1})},t.queryTemplate="DELETE{<DELETE>}INSERT{<INSERT>}WHERE {}",t}();angular.module("fibra").service("sparqlUpdateWorkerService",["sparqlService",function(){return new(Function.prototype.bind.apply(r,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.SparqlUpdateWorkerService=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=angular.module("fibra");t.service("workerServicePrototypeMappingConfiguration",function(){for(var t={Object:Object.prototype},r=0,n=Object.getOwnPropertyNames(e);r<n.length;r++){var o=n[r];t[o]=e[o].prototype,e[o].__name=o}return t})}(fibra||(fibra={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},fibra;!function(e){"use strict";var t=function(){function t(t,r){this.id=t,this.name=r,this.preferredLanguage="en",this.authorityEndpoints=[],this.archiveEndpoints=[],this.globalDataModelConfiguration=new o,this.deleteItemQuery=e.SparqlItemService.deleteItemQuery,this.prefixes=""}return t.prototype.allEndpoints=function(){var e=this.archiveEndpoints.concat(this.authorityEndpoints);return e.push(this.primaryEndpoint),e},t.prototype.remoteEndpoints=function(){return this.archiveEndpoints.concat(this.authorityEndpoints)},t}();e.Configuration=t;var r=function(){function t(t,r,n,i){void 0===i&&(i=[]),this.id=t,this.title=r,this.endpoint=n,this.class="",this.autocompletionTextMatchQueryTemplate=e.SparqlAutocompleteService.defaultMatchQueryTemplate,this.treeQueryTemplate=e.SparqlTreeService.getClassTreeQuery,this.localItemQueryTemplate=e.SparqlItemService.getLocalItemPropertiesQuery,this.remoteItemQueryTemplate=e.SparqlItemService.getRemoteItemPropertiesQuery,this.dataModelConfiguration=new o,this.dataModelConfiguration.setSelectedTypes(i)}return t}();e.EndpointConfiguration=r;var n=function(e){function t(t,r,n,o){void 0===o&&(o=n),e.call(this,t,r,n),this.updateEndpoint=o}return __extends(t,e),t}(r);e.PrimaryEndpointConfiguration=n;var o=function(){function e(){this.typeConstraints="",this.typeTree=[],this.selectedTypes=[],this.properties=[],this.selectedProperties=[],this.propertyPropertyMap={},this.typeTypeMap={}}return e.prototype.setSelectedTypes=function(e){this.selectedTypes=e,this.updateFilter()},e.prototype.updateFilter=function(){0===this.selectedTypes.length?this.typeConstraints="":this.typeConstraints="FILTER (?groupId IN ("+this.selectedTypes.map(function(e){return e.toCanonical()}).join(", ")+"))"},e}();e.DataModelConfiguration=o;var i=function(){function t(e,t){this.workerService=e,this.$localStorage=t,this.configuration=t.configuration,this.configuration&&(e.restorePrototypes(this.configuration),this.workerService.callAll("configurationWorkerService","setConfiguration",[this.configuration]))}return t.prototype.setConfiguration=function(t){e.WorkerService.savePrototypes(t),this.$localStorage.configuration=t,this.configuration=t,this.workerService.callAll("configurationWorkerService","setConfiguration",[t])},t}();angular.module("fibra").service("configurationService",["workerService","$localStorage",function(){return new(Function.prototype.bind.apply(i,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.ConfigurationService=i;var a=function(){function e(){}return e.prototype.setConfiguration=function(e){this.configuration=e},e}();angular.module("fibra").service("configurationWorkerService",[function(){return new(Function.prototype.bind.apply(a,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.ConfigurationWorkerService=a}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t="PLACEHOLDER",r="CREATE_ITEMS",n="ADD_TYPE",o="CLEAR_TYPES",i="DISPLAY_ITEMS",a="HIDE_ITEM",s="CREATE_LOCAL_ITEM",l={construct:{types:[],items:[],itemIndex:{},localItems:[]},actionsRunning:0},c={type:"",payload:null},p=function(){function e(e,t,r){this.sparqlItemService=t,this.sparqlTreeService=r,this.callbacks={},this.q=e,this.createState()}return e.prototype.on=function(e,t){var r=this;return void 0===this.callbacks[e]&&(this.callbacks[e]=Array()),this.callbacks[e].push(t),function(){r.callbacks[e].indexOf(t)!==-1&&r.callbacks[e].splice(r.callbacks[e].indexOf(t),1)}},e.prototype.dispatch=function(e){var t=this.callbacks[e].map(function(e){return e()});return this.q.all(t)},e.prototype.createState=function(){this.state=l,this.store||this.createStore()},e.prototype.createStore=function(){this.store=[this.state]},e.prototype.placeHolderAction=function(e){return{type:t,payload:e}},e.prototype.createLocalItem=function(e){return{type:s,payload:e}},e.prototype.displayItem=function(e){return{type:i,payload:[e]}},e.prototype.displayItems=function(e){return{type:i,payload:e}},e.prototype.hideItem=function(e){return{type:a,payload:e}},e.prototype.createItem=function(e){return{type:r,payload:[e]}},e.prototype.createItems=function(e){return{type:r,payload:e}},e.prototype.addType=function(e){return{type:n,payload:e}},e.prototype.clearTypes=function(){return{type:o,payload:void 0}},e.prototype.itemReducer=function(e,t){var n=this;switch(void 0===e&&(e=l),void 0===t&&(t=c),t.type){case i:return t.payload.forEach(function(t){e.construct.itemIndex[t.value]||(e.construct.items.push(t),e.construct.itemIndex[t.value]=t)}),this.dispatch("change"),this.q.resolve(e);case a:var o=e.construct.itemIndex[t.payload.value];return o&&(e.construct.items.splice(e.construct.items.indexOf(o),1),delete e.construct.itemIndex[t.payload.value]),this.dispatch("change"),this.q.resolve(e);case s:var p=t.payload;return e.construct.localItems.push(p),this.q.resolve(e);case r:var u=t.payload;if(u[0]){var d=u.map(function(e){return n.sparqlItemService.createNewItem([e])});return this.q.all(d).then(function(e){console.log(e),n.dispatch("change")}).then(function(){return e})}return this.sparqlItemService.createNewItem().then(function(e){return console.log(e),n.state});default:return this.q.resolve(e)}},e.prototype.constructReducer=function(e,r){switch(void 0===e&&(e=l),void 0===r&&(r=c),r.type){case t:return r.payload.then(function(){return e});case n:return e.construct.types.push(r.payload),this.q.resolve(e);case o:return e.construct.types=[],this.q.resolve(e);default:return this.q.resolve(e)}},e.prototype.dispatchAction=function(e){var t=this;return this.state.actionsRunning=this.state.actionsRunning+1,console.log(e.type,this.state.actionsRunning),this.dispatch("action"),this.constructReducer(this.state,e).then(function(r){return t.itemReducer(r,e)}).then(function(e){return t.state.actionsRunning=t.state.actionsRunning-1,e})},e.prototype.getState=function(){return this.state},e.prototype.undo=function(){},e}();angular.module("fibra").service("fibraService",["$q","sparqlItemService","sparqlTreeService",function(){return new(Function.prototype.bind.apply(p,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.FibraService=p}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e){this.sparqlItemService=e,this.items=[]}return e}();angular.module("fibra").controller("AuthorViewComponentController",["sparqlItemService",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.AuthorViewComponentController=t;var r=function(){function e(){this.controller="AuthorViewComponentController",this.templateUrl="components/author-view/author-view.html"}return e}();angular.module("fibra").component("authorView",new r),e.AuthorViewComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function t(t,r){this.configurationService=t,this.$state=r,this.configurations=[];var n=new e.EndpointConfiguration("emlo","EMLO",new e.NamedNode("http://ldf.fi/emlo/sparql"),[e.CIDOC.Person,e.CIDOC.Place,e.CIDOC.Group]);n.autocompletionTextMatchQueryTemplate=n.autocompletionTextMatchQueryTemplate.replace(/\{ # ADDITIONALVARIABLES/g,"?ifpWikipediaPage ?ifpODBNId {").replace(/# ADDITIONALSELECT/g,"\nUNION {\n  {\n    ?id <http://emlo.bodleian.ox.ac.uk/schema#cofk_union_relationship_type-is_related_to> ?ref .\n    FILTER(REGEX(STR(?ref),'http://..\\\\.wikipedia\\\\.org/wiki/'))\n    BIND(?ref AS ?ifpWikipediaPage)\n  } UNION {\n    ?id <http://emlo.bodleian.ox.ac.uk/schema#cofk_union_relationship_type-is_related_to> ?ref .\n    FILTER(STRSTARTS(STR(?ref),'http://www.oxforddnb.com/view/article/'))\n    BIND(REPLACE(STR(?ref),'http://www.oxforddnb.com/view/article/([^?]*).*','$1') AS ?ifpODBNId)\n  }\n}");var o=new e.EndpointConfiguration("sdfb","SDFB",new e.NamedNode("http://ldf.fi/sdfb/sparql"),[e.CIDOC.Person,e.CIDOC.Place,e.CIDOC.Group]);o.autocompletionTextMatchQueryTemplate=o.autocompletionTextMatchQueryTemplate.replace(/\{ # ADDITIONALVARIABLES/g,"?ifpODBNId {").replace(/# ADDITIONALSELECT/g,"\nUNION {\n  ?id <http://ldf.fi/sdfb/schema#odbnId> ?ifpODBNId .\n}\n");var i=new e.EndpointConfiguration("lcnames","LC Names",new e.NamedNode("http://ldf.fi/lcnames/sparql"));i.autocompletionTextMatchQueryTemplate=i.autocompletionTextMatchQueryTemplate.replace(/# GROUPLABELSTART/g,"").replace(/# GROUPLABELEND/g,"").replace(/.*# GROUPLABEL/g,"\nBIND(SUBSTR(STR(?groupId),32) AS ?groupLabel)\n");var a=new e.EndpointConfiguration("procope","Procope",new e.NamedNode("http://ldf.fi/procope/sparql"),[e.CIDOC.Person,e.CIDOC.Place,e.CIDOC.Group]);a.autocompletionTextMatchQueryTemplate=a.autocompletionTextMatchQueryTemplate.replace(/\{ # ADDITIONALVARIABLES/g,"?ifpWikipediaPage {").replace(/# ADDITIONALSELECT/g,"\nUNION {\n  ?id <http://ldf.fi/procope-schema#wikipediaUrl> ?ref .\n  BIND(IRI(?ref) AS ?ifpWikipediaPage)\n}\n");var s='PREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX luc: <http://www.ontotext.com/owlim/lucene#>\nPREFIX gvp: <http://vocab.getty.edu/ontology#>\nPREFIX aat: <http://vocab.getty.edu/aat/>\nPREFIX tgn: <http://vocab.getty.edu/tgn/>\nSELECT ?groupId ?groupLabel ?id ?prefLabel ?matchedLabel ?sameAs ?altLabel {\n  {\n    SELECT ?id ?matchedLabel {\n      BIND(CONCAT(REPLACE(<QUERY>,"([\\\\+\\\\-\\\\&\\\\|\\\\!\\\\(\\\\)\\\\{\\\\}\\\\[\\\\]\\\\^\\\\\\"\\\\~\\\\*\\\\?\\\\:\\\\/\\\\\\\\])","\\\\$1"),"*") AS ?query)\n      ?id luc:term ?query .\n      # CONSTRAINTS\n      ?id rdfs:label ?matchedLabel .\n    } LIMIT <LIMIT>\n  } UNION {\n    BIND(CONCAT("\\"",REPLACE(<QUERY>,"([\\\\+\\\\-\\\\&\\\\|\\\\!\\\\(\\\\)\\\\{\\\\}\\\\[\\\\]\\\\^\\\\\\"\\\\~\\\\*\\\\?\\\\:\\\\/\\\\\\\\])","\\\\$1"),"\\"") AS ?query)\n    ?id luc:term ?query .\n    # CONSTRAINTS\n    ?id rdfs:label ?matchedLabel .\n    FILTER (LCASE(?matchedLabel)=LCASE(<QUERY>))\n  }\n  ?id skos:inScheme <SCHEME> .\n  FILTER (REGEX(LCASE(?matchedLabel),CONCAT("\\\\b",LCASE(<QUERY>))))\n  ?id a ?groupId .\n  ?groupId rdfs:label ?groupLabel .\n  {\n    ?id gvp:prefLabelGVP [xl:literalForm ?prefLabel] .\n  } UNION {\n    ?id skos:exactMatch ?sameAs .\n  }\n}',l="PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX gvp: <http://vocab.getty.edu/ontology#>\nSELECT ?property ?propertyLabel ?object ?objectLabel {\n  VALUES (?id ?oid) { <IDPAIRS> }\n  ?oid ?property ?object .\n  ?property rdfs:label ?propertyLabel .\n  ?object gvp:prefLabelGVP [xl:literalForm ?objectLabel] .\n}",c=new e.EndpointConfiguration("ulan","ULAN",new e.NamedNode("http://ldf.fi/corsproxy/vocab.getty.edu/sparql"),[e.GETTY.PersonConcept,e.GETTY.GroupConcept]);c.autocompletionTextMatchQueryTemplate=s.replace(/<SCHEME>/g,"ulan:"),c.remoteItemQueryTemplate=l;var p=new e.EndpointConfiguration("tgn","TGN",new e.NamedNode("http://ldf.fi/corsproxy/vocab.getty.edu/sparql"),[e.GETTY.AdminPlaceConcept,e.GETTY.PhysAdminPlaceConcept]);p.autocompletionTextMatchQueryTemplate=s.replace(/<SCHEME>/g,"tgn:"),p.remoteItemQueryTemplate=l;var u=new e.EndpointConfiguration("viaf","VIAF",new e.NamedNode("http://ldf.fi/viaf/sparql"));u.autocompletionTextMatchQueryTemplate=u.autocompletionTextMatchQueryTemplate.replace(/# ADDITIONALSELECT/g,'\nUNION {\n  ?id dcterms:identifier ?rid .\n  FILTER(STRSTARTS(?rid,"LC|n"))\n  BIND(IRI(REPLACE(?rid, "^LC\\\\|n *","http://id.loc.gov/authorities/names/n")) AS ?sameAs)\n}');var d=new e.Configuration("fbtee","French Book Trade in Enlightenment Europe");d.primaryEndpoint=new e.PrimaryEndpointConfiguration("local","Local",new e.NamedNode("http://ldf.fi/fibra/sparql"),new e.NamedNode("http://ldf.fi/fibra/sparql")),d.authorityEndpoints=[c,u,p,new e.EndpointConfiguration("geonames","GeoNames",new e.NamedNode("http://ldf.fi/geonames/sparql"))],d.authorityEndpoints.forEach(function(e,t){return e.class="source"+t}),d.archiveEndpoints=[new e.EndpointConfiguration("fbtee","FBTEE",new e.NamedNode("http://ldf.fi/fbtee/sparql"),[e.CIDOC.Person,e.CIDOC.Place,e.CIDOC.Group])],d.archiveEndpoints.forEach(function(e,t){return e.class="source"+(d.authorityEndpoints.length+t)}),this.configurations.push(d),d=new e.Configuration("aw","Ancient World"),d.primaryEndpoint=new e.PrimaryEndpointConfiguration("local","Local",new e.NamedNode("http://ldf.fi/fibra/sparql"),new e.NamedNode("http://ldf.fi/fibra/sparql")),d.authorityEndpoints=[p,new e.EndpointConfiguration("geonames","GeoNames",new e.NamedNode("http://ldf.fi/geonames/sparql"))],d.authorityEndpoints.forEach(function(e,t){return e.class="source"+t}),d.archiveEndpoints=[],d.archiveEndpoints.forEach(function(e,t){return e.class="source"+(d.authorityEndpoints.length+t)}),this.configurations.push(d),d=new e.Configuration("procope","Procope"),d.primaryEndpoint=new e.PrimaryEndpointConfiguration("local","Local",new e.NamedNode("http://ldf.fi/fibra/sparql"),new e.NamedNode("http://ldf.fi/fibra/sparql")),d.authorityEndpoints=[c,u,p,new e.EndpointConfiguration("geonames","GeoNames",new e.NamedNode("http://ldf.fi/geonames/sparql"))],d.authorityEndpoints.forEach(function(e,t){return e.class="source"+t}),d.archiveEndpoints=[n],d.archiveEndpoints.forEach(function(e,t){return e.class="source"+(d.authorityEndpoints.length+t)}),this.configurations.push(d),d=new e.Configuration("all","All Datasources"),d.primaryEndpoint=new e.PrimaryEndpointConfiguration("local","Local",new e.NamedNode("http://ldf.fi/fibra/sparql"),new e.NamedNode("http://ldf.fi/fibra/sparql")),d.authorityEndpoints=[c,i,u,p,new e.EndpointConfiguration("geonames","GeoNames",new e.NamedNode("http://ldf.fi/geonames/sparql"))],d.authorityEndpoints.forEach(function(e,t){return e.class="source"+t}),d.archiveEndpoints=[o,n,a,new e.EndpointConfiguration("fbtee","FBTEE",new e.NamedNode("http://ldf.fi/fbtee/sparql"),[e.CIDOC.Person,e.CIDOC.Place,e.CIDOC.Group]),new e.EndpointConfiguration("schoenberg","Schoenberg",new e.NamedNode("http://ldf.fi/schoenberg/sparql"),[e.CIDOC.Person,e.CIDOC.Place,e.CIDOC.Group])],d.archiveEndpoints.forEach(function(e,t){return e.class="source"+(d.authorityEndpoints.length+t)}),d.instanceNS="http://ldf.fi/fibra/",d.schemaNS="http://ldf.fi/fibra/schema#",this.configurations.push(d),d=new e.Configuration("local","SPARQL endpoint on localhost"),d.primaryEndpoint=new e.PrimaryEndpointConfiguration("local","Local",new e.NamedNode("http://localhost:3030/fibra/sparql"),new e.NamedNode("http://localhost:3030/fibra/update")),d.primaryEndpoint.autocompletionTextMatchQueryTemplate=e.SparqlAutocompleteService.naiveMatchQueryTemplate,d.primaryEndpoint.localItemQueryTemplate=e.SparqlItemService.naiveGetLocalItemPropertiesQuery,this.configurations.push(d)}return t.prototype.setConfiguration=function(e){this.configurationService.setConfiguration(e),this.$state.go("select")},t}();angular.module("fibra").controller("ConfigureViewComponentController",["configurationService","$state",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.ConfigureViewComponentController=t;var r=function(){function e(){this.controller="ConfigureViewComponentController",this.templateUrl="components/configure-view/configure-view.html"}return e}();angular.module("fibra").component("configureView",new r),e.ConfigureViewComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=(function(){function e(e,t){this.endpoint=e,this.queryTemplate=t}return e}(),function(){function t(t,r,n,o,i,a){var s=this;this.configurationService=t,this.sparqlTreeService=r,this.sparqlItemService=n,this.fibraService=o,this.$scope=i,this.$q=a,this.types=[],this.chosenTypes={primary:null,secondary:null,tertiary:null},this.classTreePromise=r.getTree(this.configurationService.configuration.primaryEndpoint.endpoint.value,this.configurationService.configuration.primaryEndpoint.treeQueryTemplate),this.classTreePromise.then(function(e){s.classTree=e,s.fibraService.dispatchAction(s.fibraService.clearTypes()),s.types=s.fibraService.getState().construct.types;var t=function(e){return s.fibraService.dispatchAction(s.fibraService.addType(e))};s.traverseClassTree(e,function(e){return s.types.indexOf(e)===-1&&0===e.children.length},function(e){return t(e)})}),this.fibraService.on("change",function(){return s.classTreePromise=r.getTree(s.configurationService.configuration.primaryEndpoint.endpoint.value,e.SparqlTreeService.getClassTreeQuery),s.classTreePromise.then(function(e){return s.classTree=e,"ok"})}),this.fibraService.on("action",function(){return s.state=o.getState(),s.$q.resolve("ok")}),this.state=o.getState()}return t.prototype.createItem=function(e){e.ids.filter(function(e){return e.value.indexOf("http://ldf.fi/fibra/")!==-1});return this.fibraService.dispatchAction(this.fibraService.displayItem(e.ids[0]))},t.prototype.traverseClassTree=function(e,t,r){var n=function(e){t(e)&&(r(e),e.children.forEach(n))};e.forEach(n)},t}());angular.module("fibra").controller("ConstructViewComponentController",["configurationService","sparqlTreeService","sparqlItemService","fibraService","$scope","$q",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.ConstructViewComponentController=t;var r=function(){function e(){this.controller="ConstructViewComponentController",this.templateUrl="components/construct-view/construct-view.html"}return e}();angular.module("fibra").component("constructView",new r),e.ConstructViewComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function t(t,r,n,o,i,a,s,l){var c=this;this.$element=t,this.$compile=r,this.$window=n,this.$scope=o,this.$timeout=i,this.sparqlItemService=a,this.fibraService=s,this.$q=l,this.primaryItems=[],this.secondaryItems=[],this.tertiaryItems=[],this.allItems=[],this.radius=8,this.gridOffset=50,this.chargeForce=d3.forceCollide(this.gridOffset/1.5),this.chargeForce2=d3.forceCollide(this.gridOffset/1.5),this.svgBackgroundColor="#EEE",this.drawmode=!1,this.sunburst=new e.Sunburst(t,r,o,a,s),this.fibraService.on("change",function(){return c.queryAndBuild()}),this.itemService=a,this.links=[],this.$scope.layout={choice:"force"},this.$scope.$watch("layout.choice",this.updateExplore.bind(this,!1))}return t.prototype.$postLink=function(){var e=this;this.svgSel=d3.select(this.$element[0]).select("svg"),this.svgSel.append("rect").classed("background",!0).style("fill",this.svgBackgroundColor).on("click",function(){console.log(d3.event),e.fibraService.dispatchAction(e.fibraService.createItem())}),this.svgSel.append("g").attr("class","links"),this.sunburst.addSunburstGroup(this.svgSel),this.forceSim=d3.forceSimulation().force("charge",this.chargeForce).force("charge2",this.chargeForce2).force("link",d3.forceLink().distance(40).strength(1).iterations(1).id(function(e){return""+e.index})),this.radius=8,this.tooltip=d3.select("body").append("div").style("position","absolute").style("z-index","20").style("background-color","gray").style("color","white").style("padding","3px").style("border-radius","2px").style("visibility","hidden"),this.edittip=d3.select("body").append("div").attr("id","edittip").style("position","absolute").style("z-index","40").style("background-color","white").style("color","gray").style("border","1px solid gray").style("padding","3px").style("border-radius","2px").style("visibility","hidden"),this.updateSizing(),this.queryAndBuild()},t.prototype.lockExisting=function(e){e.forEach(function(e){e.fx=e.gx,e.fy=e.gy})},t.prototype.queryAndBuild=function(){var e=this,t=this.sparqlItemService.getItems(this.fibraService.getState().construct.items,!1).then(function(t){if(console.log("Items in explore",t),e.lockExisting(e.primaryItems),e.lockExisting(e.secondaryItems),e.lockExisting(e.tertiaryItems),e.chosenTypes.primary&&(e.primaryItems=e.mergeNodes(e.primaryItems,e.filterItemsByType(t,e.chosenTypes.primary.id))),e.chosenTypes.secondary&&(e.secondaryItems=e.mergeNodes(e.secondaryItems,e.filterItemsByType(t,e.chosenTypes.secondary.id))),e.chosenTypes.tertiary&&(e.tertiaryItems=e.mergeNodes(e.tertiaryItems,e.filterItemsByType(t,e.chosenTypes.tertiary.id))),e.allItems=e.primaryItems.concat(e.secondaryItems).concat(e.tertiaryItems),e.properties=[],e.primaryItems[0]&&e.primaryItems[0].localProperties)for(var r=0,n=e.primaryItems[0].localProperties;r<n.length;r++){
var o=n[r];e.properties.push({key:o.toCanonical(),value:o.label.value})}return e.links=e.mergeLinks(e.links),e.primaryProperties=[],e.secondaryProperties=[],e.tertiaryProperties=[],e.sortProperties(),"ok"}).then(function(){return e.updateExplore()});return this.fibraService.dispatchAction(this.fibraService.placeHolderAction(t)),t},t.prototype.filterItemsByType=function(e,t){return e.filter(function(e){var r=e.localProperties.concat(e.remoteProperties).filter(function(e){return"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===e.value});return!!r[0]&&r[0].values.map(function(e){return e.value}).indexOf(t)!==-1})},t.prototype.sortProperties=function(){for(var e=0;e<this.primaryItems.length;e++)for(var t=0;t<this.primaryItems[e].localProperties.length;t++){for(var r=!1,n=0;n<this.primaryProperties.length;n++)this.primaryProperties[n]==this.primaryItems[e].localProperties[t].label.value&&(r=!0);r||this.primaryProperties.push(this.primaryItems[e].localProperties[t].label.value)}for(var e=0;e<this.secondaryItems.length;e++)for(var t=0;t<this.secondaryItems[e].localProperties.length;t++){for(var r=!1,n=0;n<this.secondaryProperties.length;n++)this.secondaryProperties[n]==this.secondaryItems[e].localProperties[t].label.value&&(r=!0);r||this.secondaryProperties.push(this.secondaryItems[e].localProperties[t].label.value)}for(var e=0;e<this.tertiaryItems.length;e++)for(var t=0;t<this.tertiaryItems[e].localProperties.length;t++){for(var r=!1,n=0;n<this.tertiaryProperties.length;n++)this.tertiaryProperties[n]==this.tertiaryItems[e].localProperties[t].label.value&&(r=!0);r||this.tertiaryProperties.push(this.tertiaryItems[e].localProperties[t].label.value)}},t.prototype.updateSizing=function(){var e=window.innerWidth,t=window.innerHeight,r=+d3.select("#searchbar").style("width").replace("px","");this.exploreWidth=e,this.exploreHeight=t-36,d3.select(this.$element[0]).select("#explorecontainer").style("width",this.exploreWidth+"px").style("height",this.exploreHeight+"px"),d3.select(this.$element[0].parentElement).select("#searchbar").style("top",6*t/7+"px").style("left",e/2-r/2+"px").style("display","block"),d3.select(this.$element[0]).select("#exploretable").style("width",e+"px").style("height",t-50+"px"),this.svgSel.style("width",e+"px").style("height",t-36+"px"),this.svgSel.select("rect.background").style("width",e+"px").style("height",t-36+"px");var n=+this.svgSel.style("width").replace("px",""),o=+this.svgSel.style("height").replace("px","");this.forceSim.force("center",d3.forceCenter(n/2,o/2)),this.forceSim.force("xposition",d3.forceX(n/2).strength(.01)),this.forceSim.force("yposition",d3.forceY(o/2).strength(.01))},t.prototype.appendNodes=function(e,t){var r=this;return e.append("g").attr("id",function(e,r){return"node-"+r+"-"+t}).attr("class","node").append("circle").classed("node-circle",!0).classed(t,!0).attr("id",function(e,r){return"node-circle-"+r+"-"+t}).style("stroke","black").attr("r",this.radius+"px").call(d3.drag().on("start",function(e,t){r.drawmode?r.dragline=r.svgSel.append("line").attr("class","dragLine"):(e.fx=e.x,e.fy=e.y)}).on("drag",function(e,t,n){r.drawmode?r.dragline.attr("x1",e.x).attr("y1",e.y).attr("x2",d3.event.x).attr("y2",d3.event.y):(d3.select(n[t]).classed("fixed",!0),e.x=d3.event.x,e.y=d3.event.y,d3.select(n[t]).classed("selected-circle")),r.updateExplore(!1,!1)}).on("end",function(e,t,n){if(r.drawmode){var o=+r.dragline.attr("x2"),i=+r.dragline.attr("y2");d3.selectAll(".node").each(function(t,n){Math.abs(o-t.x)<r.radius&&Math.abs(i-t.y)<r.radius&&(r.links.push({source:e,target:t,property:void 0}),r.updateExplore(!1))}),r.dragline.remove()}else d3.select(n[t]).classed("fixed")||(e.fx=void 0,e.fy=void 0)})).on("mouseover",function(e,t){r.highlightLinks(e,t),r.tooltip.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px").style("visibility","visible").text(e.label.value)}).on("mouseout",function(e,t){r.svgSel.selectAll("line").classed("relevant",!1),r.tooltip.style("visibility","hidden")}).on("click",function(e,t,n){r.forceSim.stop();var o=e.selected;r.svgSel.selectAll(".node").each(function(e){e.selected=!1}),e.selected=!o,r.updateExplore(!1),e.selected?r.svgSel.select("g.sunburst-overlay").datum(e).each(r.sunburst.buildSunburst.bind(r)).style("display","block"):r.svgSel.select(".sunburst-overlay").style("display","none"),r.highlightLinks(e,t)})},t.prototype.snapToGrid=function(e,t,r){void 0===r&&(r=!0);var n,o;return r?(n=Math.round(e/this.gridOffset)*this.gridOffset,o=Math.round(t/this.gridOffset)*this.gridOffset):(n=Math.round(e/this.gridOffset)*this.gridOffset-this.gridOffset/2,o=Math.round(t/this.gridOffset)*this.gridOffset-this.gridOffset/2),[n,o]},t.prototype.tickTransformNodes=function(e,t){var r=this;if(void 0===t&&(t=!0),e.attr("transform",function(e,n){var o=e.x,i=e.y;e.x<r.radius&&(o=r.radius),e.y<r.radius&&(i=r.radius);var a=[o,i],s=a[0],l=a[1];return"forcegrid"===r.$scope.layout.choice&&(c=r.snapToGrid(o,i,t),s=c[0],l=c[1]),e.gx=s,e.gy=l,"translate("+s+", "+l+")";var c}),e.filter(function(e){return e.selected}).node()){var n=this.sunburst.buildSunburst,o=this.svgSel,i=function(e,t,r){o.select("g.sunburst-overlay").datum(e).each(n.bind(this))};e.filter(function(e){return e.selected}).each(i.bind(this))}},t.prototype.genericTick=function(e,t,r,n){var o=this;void 0===n&&(n=!1);var i=e,a=t,s=r;n&&(i=i.transition(),a=a.transition(),s=s.transition()),this.tickTransformNodes(i,!0),this.tickTransformNodes(a,!1),this.svgSel.selectAll(".node-circle").classed("selected-circle",function(e){return e.selected}).attr("r",function(e){return o.radius+(e.selected?3:0)+"px"}),s.attr("x1",function(e){return e.source.gx}).attr("y1",function(e){return e.source.gy}).attr("x2",function(e){return e.target.gx}).attr("y2",function(e){return e.target.gy})},t.prototype.updateExplore=function(e,t){var r=this;void 0===e&&(e=!0),void 0===t&&(t=!1);var n=this.svgSel.selectAll("circle.primary").data(this.primaryItems,function(e){return e.value}),o=this.svgSel.selectAll("circle.secondary").data(this.secondaryItems,function(e){return e.value});n.exit().remove(),o.exit().remove(),n=n.merge(this.appendNodes(n.enter(),"primary")),o=o.merge(this.appendNodes(o.enter(),"secondary"));var i=this.svgSel.select("g.links").selectAll("line").data(this.links);i.exit().remove(),i=i.enter().append("line").attr("id",function(e,t){return"link-"+t}).on("mouseover",function(e,t){r.tooltip.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px").style("visibility","visible").text(e.property.label.value)}).on("mouseout",function(e,t){r.tooltip.style("visibility","hidden")}).merge(i),this.sunburst.addSunburstGroup(this.svgSel),this.forceSim.stop();var a=this.genericTick.bind(this,n,o,i,!1);this.forceSim.nodes(this.primaryItems.concat(this.secondaryItems)).on("tick",a),this.forceSim.force("link").links(this.links);var s=this.forceSim.force("charge"),l=this.forceSim.force("charge2");this.forceSim.force("center"),this.forceSim.force("xposition"),this.forceSim.force("yposition");return s.initialize&&s.initialize(this.primaryItems),l.initialize&&l.initialize(this.secondaryItems),e?this.forceSim.alpha(1).restart():this.genericTick(n,o,i,t),this.$q.resolve("ok")},t.prototype.highlightLinks=function(e,t){d3.selectAll("line").classed("relevant",!1);for(var r=0;r<this.links.length;r++){var n=this.links[r].source,o=this.links[r].target;n.index!==t&&o.index!==t||d3.select("#link-"+r).classed("relevant",!0)}},t.prototype.delete=function(e){return this.fibraService.dispatchAction(this.fibraService.hideItem(e)).then(function(){return"ok"})},t.prototype.mergeNodes=function(e,t){for(var r=[],n=0;n<e.length;n++)for(var o=0;o<t.length;o++)e[n].toCanonical()===t[o].toCanonical()&&r.push(e[n]);for(var n=0;n<t.length;n++){for(var i=!1,o=0;o<r.length;o++)r[o].toCanonical()===t[n].toCanonical()&&(i=!0);i||r.push(t[n])}return r},t.prototype.mergeLinks=function(t){for(var r=[],n=this.primaryItems.concat(this.secondaryItems),o=new e.ENodeMap,i=0,a=n;i<a.length;i++){var s=a[i];o.set(s,s);var l=s.localProperties.filter(function(t){return e.OWL.sameAs.equals(t)})[0];if(l&&l.values)for(var c=0,p=l.values;c<p.length;c++){var u=p[c];o.set(u,s)}}for(var d=0,f=n;d<f.length;d++)for(var s=f[d],h=0,m=s.localProperties;h<m.length;h++)for(var y=m[h],v=0,g=y.values;v<g.length;v++){var b=g[v];o.has(b)&&s!==o.get(b)&&n.indexOf(o.get(b))!==-1&&r.push({source:s,target:o.get(b),property:y})}return r},t}();angular.module("fibra").controller("ExploreComponentController",["$element","$compile","$window","$scope","$timeout","sparqlItemService","fibraService","$q",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]);var r=function(){function e(){this.bindings={selectedItem:"=",chosenTypes:"="},this.controller="ExploreComponentController",this.templateUrl="components/construct-view/explore.html"}return e}();angular.module("fibra").component("explore",new r),e.ExploreComponent=r}(fibra||(fibra={}));var fibra;!function(e){var t=function(){function e(e,t,r,n,o){var i=this;this.$element=e,this.$compile=t,this.$scope=r,this.sparqlItemService=n,this.fibraService=o,this.sbRadius=200,this.lessRadius=this.sbRadius*this.sbRadius/3-144,this.sbArc=d3.arc().startAngle(function(e){return e.x0}).endAngle(function(e){return e.x1}).innerRadius(function(e){return Math.sqrt(e.y0-i.lessRadius)}).outerRadius(function(e){return Math.sqrt(e.y1-i.lessRadius)}),this.sbPart=d3.partition().size([2*Math.PI,this.sbRadius*this.sbRadius]),this.item_info_tip_displayed=!1,this.sbTooltip=d3.select("body").append("div").style("position","absolute").style("z-index","20").style("background-color","gray").style("color","white").style("padding","3px").style("border-radius","2px").style("visibility","hidden"),this.item_info_tip=d3.select("body").append("div").attr("id","item_info_tip").style("position","absolute").style("z-index","20").style("background-color","white").style("padding","3px").style("visibility","hidden"),this.buildSunburst=this.buildSunburst.bind(this)}return e.prototype.addSunburstGroup=function(e){var t=this;this.sel=e,this.sbGroup&&this.sbGroup.remove(),this.sbGroup=e.append("g").classed("sunburst-overlay",!0),this.sel.on("click",function(){t.item_info_tip_displayed&&(t.item_info_tip.style("visibility","hidden"),t.item_info_tip_displayed=!1)})},e.prototype.buildSunburst=function(e,t,r){var n=this;this.original_data=e,this.sbGroup.attr("transform",function(e){return"translate("+e.gx+","+e.gy+")"});var o=d3.hierarchy(e,function(e){return e.localProperties?e.localProperties.concat(e.remoteProperties):e.values});o.sum(function(e){return void 0===e.values&&void 0===e.localProperties?1:0});var i=(this.sbPart(o),this.sbGroup.selectAll("path").data(o.descendants(),function(e){return e.data}));i.exit().remove(),i.enter().filter(function(e){return e.depth>0}).append("path").classed("sunburst-cell",!0).on("mouseover",function(e,t){n.sbTooltip.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px").style("visibility","visible").text(2===e.depth?e.data.label.value+" (click to add)":e.data.label.value+" (click to add all children)")}).on("mouseout",function(){n.sbTooltip.style("visibility","hidden")}).on("click",function(e,t){2===e.depth?n.fibraService.dispatchAction(n.fibraService.displayItem(e.data)):n.fibraService.dispatchAction(n.fibraService.displayItems(e.children.map(function(e){return e.data}))),n.original_data.selected=!1,n.sbTooltip.style("visibility","hidden"),n.sbGroup.remove()}).merge(i).attr("d",this.sbArc).style("stroke","#fff")},e.prototype.selectItem=function(e){this.selectedItem=e},e}();e.Sunburst=t}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function t(e,t){this.configurationService=e,this.$state=t}return t.prototype.setData=function(t){var r=this.configurationService.configuration;r.graph=e.DataFactory.instance.namedNode("http://ldf.fi/fibra/"+t+"/"),r.primaryEndpoint.localItemQueryTemplate=r.primaryEndpoint.localItemQueryTemplate.replace(/GRAPH <GRAPH>/g,"GRAPH <http://ldf.fi/fibra/"+t+"/>"),r.primaryEndpoint.autocompletionTextMatchQueryTemplate=r.primaryEndpoint.autocompletionTextMatchQueryTemplate.replace(/GRAPH <GRAPH>/g,"GRAPH <http://ldf.fi/fibra/"+t+"/>"),r.primaryEndpoint.treeQueryTemplate=r.primaryEndpoint.treeQueryTemplate.replace(/GRAPH <GRAPH>/g,"GRAPH <http://ldf.fi/fibra/"+t+"/>"),r.deleteItemQuery=r.deleteItemQuery.replace(/GRAPH <GRAPH>/g,"GRAPH <http://ldf.fi/fibra/"+t+"/>"),this.configurationService.setConfiguration(r),this.$state.go("construct")},t}();angular.module("fibra").controller("SelectViewComponentController",["configurationService","$state",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.SelectViewComponentController=t;var r=function(){function e(){this.controller="SelectViewComponentController",this.templateUrl="components/select-view/select-view.html"}return e}();angular.module("fibra").component("selectView",new r),e.SelectViewComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e,t){var r=this;this.$q=e,this.sparqlAutocompleteService=t,this.error=!1,this.clearResults=function(){r.results=[],r.query=""},this.onChange=function(e){r.canceller.resolve(),r.canceller=r.$q.defer(),r.queryRunning=!0,r.error=!1,r.sparqlAutocompleteService.autocomplete(e,r.limit,r.canceller.promise).then(function(e){r.results=e,r.queryRunning=!1},function(){r.queryRunning=!1,r.error=!0})},this.canceller=e.defer()}return e}();angular.module("fibra").controller("SparqlAutocompleteComponentController",["$q","sparqlAutocompleteService",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]);var r=function(){function e(){this.bindings={constraints:"<",limit:"@",onSelect:"&"},this.controller="SparqlAutocompleteComponentController",this.templateUrl="components/sparql-autocomplete/sparql-autocomplete.html"}return e}();angular.module("fibra").component("sparqlAutocomplete",new r),e.SparqlAutocompleteComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=fi.seco.sparql,r=function(){function e(e){this.label=e,this.results=[]}return e}();e.ResultGroup=r;var n=function(){function e(e,t,r,n){this.ids=e,this.datasources=t,this.matchedLabel=r,this.prefLabel=n,this.additionalInformation={}}return e}();e.Result=n;var o=function(){function e(e){this.workerService=e}return e.prototype.autocomplete=function(e,t,r){return this.workerService.call("sparqlAutocompleteWorkerService","autocomplete",[e,t],r)},e.naiveMatchQueryTemplate='\n  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n  PREFIX skos: <http://www.w3.org/2004/02/skos/core#>\n  PREFIX mads: <http://www.loc.gov/mads/rdf/v1#>\n  PREFIX owl: <http://www.w3.org/2002/07/owl#>\n  PREFIX dcterms: <http://purl.org/dc/terms/>\n  SELECT ?groupId ?groupLabel ?id ?prefLabel ?matchedLabel ?sameAs ?altLabel { # ADDITIONALVARIABLES\n    GRAPH <GRAPH> {\n      {\n        SELECT ?groupId ?id {\n          {\n            ?id skos:prefLabel|rdfs:label|skos:altLabel|mads:authoritativeLabel|mads:variantLabel <QUERY> .\n          } UNION {\n            ?id skos:prefLabel|rdfs:label|skos:altLabel|mads:authoritativeLabel|mads:variantLabel <QUERY>@<PREFLANG> .\n          }\n          ?id a ?groupId .\n        }\n        GROUP BY ?groupId ?id\n        HAVING(BOUND(?id))\n        LIMIT <LIMIT>\n      }\n      ?id skos:prefLabel|rdfs:label|skos:altLabel|mads:authoritativeLabel|mads:variantLabel ?matchedLabel .\n      FILTER (REGEX(LCASE(?matchedLabel),CONCAT("\\\\b",LCASE(<QUERY>))))\n      OPTIONAL {\n        ?groupId skos:prefLabel|rdfs:label|skos:altLabel|mads:authoritativeLabel|mads:variantLabel ?groupLabelP .\n      }\n      BIND(COALESCE(?groupLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?groupId),".*/",""),".*#",""),"_"," "),"([A-ZÅÄÖ])"," $1")) AS ?groupLabel)\n      {\n        ?id  rdfs:label|skos:prefLabel|mads:authoritativeLabel ?prefLabel .\n      } UNION {\n        ?id owl:sameAs ?sameAs .\n      } UNION {\n        ?id skos:altLabel|mads:variantLabel ?altLabel .\n      }\n      # ADDITIONALSELECT\n    }\n  }\n  ',e.defaultMatchQueryTemplate='\nPREFIX text: <http://jena.apache.org/text#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX mads: <http://www.loc.gov/mads/rdf/v1#>\nPREFIX owl: <http://www.w3.org/2002/07/owl#>\nPREFIX sf: <http://ldf.fi/functions#>\nPREFIX fibra: <http://ldf.fi/fibra/schema#>\nPREFIX dcterms: <http://purl.org/dc/terms/>\nSELECT ?groupId ?groupLabel ?id ?prefLabel ?matchedLabel ?sameAs ?altLabel { # ADDITIONALVARIABLES\n  GRAPH <GRAPH> {\n    {\n      SELECT ?groupId ?id (SUM(?sc) AS ?score) {\n        {\n          SELECT ?groupId ?id ?sc {\n            BIND(CONCAT(REPLACE(<QUERY>,"([\\\\+\\\\-\\\\&\\\\|\\\\!\\\\(\\\\)\\\\{\\\\}\\\\[\\\\]\\\\^\\\\\\"\\\\~\\\\*\\\\?\\\\:\\\\/\\\\\\\\])","\\\\$1"),"*") AS ?query)\n            (?id ?sc) text:query ?query .\n            ?id a ?groupId .\n            # GROUPID\n            # CONSTRAINTS\n          } LIMIT <LIMIT>\n        } UNION {\n          BIND(CONCAT("\\"",REPLACE(<QUERY>,"([\\\\+\\\\-\\\\&\\\\|\\\\!\\\\(\\\\)\\\\{\\\\}\\\\[\\\\]\\\\^\\\\\\"\\\\~\\\\*\\\\?\\\\:\\\\/\\\\\\\\])","\\\\$1"),"\\"") AS ?query)\n          (?id ?sc) text:query ?query .\n          ?id skos:prefLabel|rdfs:label|skos:altLabel|mads:authoritativeLabel|mads:variantLabel ?matchedLabel\n          FILTER (LCASE(?matchedLabel)=LCASE(<QUERY>))\n          ?id a ?groupId .\n          # GROUPID\n          # CONSTRAINTS\n        }\n      }\n      GROUP BY ?groupId ?id\n      HAVING(BOUND(?id))\n    }\n    ?id skos:prefLabel|rdfs:label|skos:altLabel|mads:authoritativeLabel|mads:variantLabel ?matchedLabel\n    FILTER (REGEX(LCASE(?matchedLabel),CONCAT("\\\\b",LCASE(<QUERY>))))\n    { # GROUPLABELSTART\n      ?groupId sf:preferredLanguageLiteral (skos:prefLabel mads:authoritativeLabel rdfs:label skos:altLabel mads:variantLabel \'<PREFLANG>\' \'\' ?groupLabel) . # GROUPLABEL\n    } # GROUPLABELEND\n    UNION {\n      ?id sf:preferredLanguageLiteral (skos:prefLabel mads:authoritativeLabel rdfs:label skos:altLabel mads:variantLabel \'<PREFLANG>\' \'\' ?prefLabel) .\n    } UNION {\n      ?id owl:sameAs ?sameAs .\n    } UNION {\n      ?id skos:altLabel|mads:variantLabel ?altLabel .\n    }\n    # ADDITIONALSELECT\n  }\n}\n',e}();angular.module("fibra").service("sparqlAutocompleteService",["workerService",function(){return new(Function.prototype.bind.apply(o,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.SparqlAutocompleteService=o;var i=function(){function o(e,t,r){this.$q=e,this.sparqlService=t,this.configurationWorkerService=r}return o.prototype.autocomplete=function(o,i,a){var s=this,l=new e.EMap(function(){return new e.StringSet}),c=new e.EMap(function(){return new e.StringSet}),p=new e.EMap(function(){return new e.EMap(function(){return new e.StringSet})}),u=new e.EMap(function(){return new e.ONodeSet}),d=new e.EMap(function(){return new e.ONodeSet}),f=new e.EMap(function(){return new e.ONodeSet}),h=new e.EMap(function(){return new e.IdentitySet});return this.$q.all(this.configurationWorkerService.configuration.allEndpoints().map(function(r){var n=r.autocompletionTextMatchQueryTemplate;return n=n.replace(/<QUERY>/g,t.SparqlService.stringToSPARQLString(o)),n=n.replace(/# CONSTRAINTS/g,r.dataModelConfiguration.typeConstraints),n=n.replace(/<LIMIT>/g,""+i),n=n.replace(/<PREFLANG>/g,s.configurationWorkerService.configuration.preferredLanguage),s.sparqlService.query(r.endpoint.value,n,{timeout:a}).then(function(t){return t.data.results.bindings.forEach(function(n){var o=n.id.value;l.goc(o).add(o),h.goc(o).add(r),n.prefLabel&&u.goc(o).add(e.DataFactory.instance.nodeFromBinding(n.prefLabel)),n.altLabel&&f.goc(o).add(e.DataFactory.instance.nodeFromBinding(n.altLabel)),n.matchedLabel&&d.goc(o).add(e.DataFactory.instance.nodeFromBinding(n.matchedLabel)),n.groupId&&(c.goc(o).add(n.groupId.value),n.groupLabel&&u.goc(n.groupId.value).add(e.DataFactory.instance.nodeFromBinding(n.groupLabel))),n.sameAs&&(l.get(o).add(n.sameAs.value),l.goc(n.sameAs.value).add(o));for(var i=0,a=t.data.head.vars;i<a.length;i++){var s=a[i];0===s.indexOf("ifp")&&n[s]&&p.goc(s.substring(3)).goc(n[s].value).add(o)}})}).catch(function(){})})).then(function(){p.each(function(e){return e.each(function(e){return e.each(function(t){return l.goc(t).adds(e)})})}),l.each(function(e,t){e.each(function(r){var n=l.get(r);if(e!==n){l.set(r,e),e.adds(n);var o=h.get(t),i=h.get(r);o?(i&&o.adds(i),h.set(r,o)):i&&h.set(t,i);var a=c.get(t),s=c.get(r);a?(s&&a.adds(s),c.set(r,a)):s&&c.set(t,s);var p=u.get(t),m=u.get(r);p?(m&&p.adds(m),u.set(r,p)):m&&u.set(t,m),p=d.get(t),m=d.get(r),p?(m&&p.adds(m),d.set(r,p)):m&&d.set(t,m),p=f.get(t),m=f.get(r),p?(m&&p.adds(m),f.set(r,p)):m&&f.set(t,m)}})});var t=[],o=new e.EMap,i=new e.StringSet;return l.each(function(a,s){if(!i.has(s)){i.adds(a);var l=new n(a.values().map(function(t){return e.DataFactory.instance.namedNode(t)}),h.get(s).values(),d.get(s).values()[0],u.get(s).values()[0]);f.has(s)&&(l.additionalInformation.altLabel=f.get(s).values()),l.additionalInformation.type=c.get(s).values().map(function(t){return e.DataFactory.instance.namedNode(t)}),l.additionalInformation.typeLabel=c.get(s).values().map(function(e){return u.get(e).values()[0]}),c.get(s).each(function(e){var n=o.get(e);n||(n=new r(u.get(e).values()[0].value),o.set(e,n),t.push(n)),n.results.push(l)})}}),t})},o}();angular.module("fibra").service("sparqlAutocompleteWorkerService",["$q","sparqlService","configurationWorkerService",function(){return new(Function.prototype.bind.apply(i,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.SparqlAutocompleteWorkerService=i}(fibra||(fibra={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},fibra;!function(e){"use strict";var t=function(){function e(e,t,r,n){void 0===r&&(r=void 0),void 0===n&&(n=void 0),this.value=e,this.termType=t,this.language=r,this.datatype=n}return e.prototype.toCanonical=function(){switch(this.termType){case"NamedNode":return"<"+this.value+">";case"BlankNode":return"_:"+this.value;case"Literal":return JSON.stringify(this.value)+(this.language?"@"+this.language:y.string.equals(this.datatype)?"":"^^"+this.datatype.toCanonical());case"Variable":return"?"+this.value;case"DefaultGraph":return"";case"UNDEF":return"UNDEF";default:throw"Unknown term type "+this}},e.prototype.equals=function(e){return this.termType===e.termType&&this.value===e.value&&("Literal"!==this.termType||this.language===e.language&&this.datatype===e.datatype)},e}();e.Node=t;var r=function(e){function t(t){e.call(this,t.value,t.termType,t.language,t.datatype)}return __extends(t,e),t}(t);e.NodeFromNode=r;var n=function(e){function t(){e.call(this,"","DefaultGraph")}return __extends(t,e),t.prototype.toCanonical=function(){return""},t.prototype.equals=function(e){return"DefaultGraph"===e.termType},t.instance=new t,t}(t);e.DefaultGraph=n;var o=function(e){function t(){e.call(this,"","UNDEF")}return __extends(t,e),t.prototype.toCanonical=function(){return""},t.prototype.equals=function(e){return"UNDEF"===e.termType},t.instance=new t,t}(t);e.UNDEF=o;var i=function(e){function t(t){e.call(this,t,"Variable")}return __extends(t,e),t.prototype.toCanonical=function(){return"?"+this.value},t}(t);e.Variable=i;var a=function(e){function t(t){e.call(this,t,"NamedNode")}return __extends(t,e),t.prototype.toCanonical=function(){return"<"+this.value+">"},t}(t);e.NamedNode=a;var s=function(e){function t(t){e.call(this,t,"BlankNode")}return __extends(t,e),t.prototype.toCanonical=function(){return"?"+this.value},t}(t);e.BlankNode=s;var l=function(e){function t(t,r,n){void 0===r&&(r=""),e.call(this,t,"Literal",r,n?n:""!==r?m.langString:y.string)}return __extends(t,e),t}(t);e.Literal=l;var c=function(){function e(e,t,r,n){this.subject=e,this.predicate=t,this.object=r,this.graph=n}return e.prototype.toCanonical=function(){return this.subject.toCanonical()+" "+this.predicate.toCanonical()+" "+this.object.toCanonical()+("DefaultGraph"===this.graph.termType?"":" "+this.graph.toCanonical())},e.prototype.equals=function(e){return this.subject.equals(e.subject)&&this.predicate.equals(e.predicate)&&this.object.equals(e.object)&&this.graph.equals(e.graph)},e}();e.Quad=c;var p=function(){function e(e,t,r){this.subject=e,this.predicate=t,this.object=r,this.graph=n.instance}return e.prototype.toCanonical=function(){return this.subject.toCanonical()+" "+this.predicate.toCanonical()+" "+this.object.toCanonical()},e.prototype.equals=function(e){return this.subject.equals(e.subject)&&this.predicate.equals(e.predicate)&&this.object.equals(e.object)&&this.graph.equals(e.graph)},e}();e.Triple=p;var u=function(){function e(e,t){void 0===t&&(t=[]),this.graph=e,this.triples=t}return e}();e.Graph=u;var d=function(){function e(){this.nextBlankNodeId=0}return e.prototype.nodeFromBinding=function(e){var r=new t(e.value,"literal"===e.type?"Literal":"uri"===e.type?"NamedNode":"BlankNode");return"literal"===e.type&&(r.language=e["xml:lang"]?e["xml:lang"]:"",r.datatype=e.datatype?new a(e.datatype):""!==r.language?m.langString:y.string),r},e.prototype.nodeFromNode=function(e){return"Literal"===e.termType?new l(e.value,e.language,e.datatype):new t(e.value,e.termType)},e.prototype.nodeFromCanonicalRepresentation=function(e){if(0===e.indexOf("<"))return new a(e.substring(1,e.length-1));if(0===e.indexOf("_:"))return new s(e.substring(2));var t=e.substring(1,e.lastIndexOf('"'));return e.lastIndexOf("@")===e.lastIndexOf('"')+1?new l(t,e.substring(e.lastIndexOf("@"))):e.lastIndexOf("^^<")===e.lastIndexOf('"')+1?new l(t,"",new a(e.substring(e.lastIndexOf("^^<"),e.length-1))):new l(t)},e.prototype.namedNode=function(e){return new a(e)},e.prototype.blankNode=function(e){return new s(e?e:"b"+ ++this.nextBlankNodeId)},e.prototype.literal=function(e,t){return"string"==typeof t?new l(e,t):new l(e,(void 0),t)},e.prototype.variable=function(e){return new i(e)},e.prototype.defaultGraph=function(){return n.instance},e.prototype.triple=function(e,t,r){return new p(e,t,r)},e.prototype.quad=function(e,t,r,o){return new c(e,t,r,o?o:n.instance)},e.instance=new e,e}();e.DataFactory=d;var f=function(){function e(){}return e.ns="http://www.w3.org/2004/02/skos/core#",e.prefLabel=new a(e.ns+"prefLabel"),e}();e.SKOS=f;var h=function(){function e(){}return e.ns="http://www.w3.org/2002/07/owl#",e.sameAs=new a(e.ns+"sameAs"),e.Thing=new a(e.ns+"Thing"),e}();e.OWL=h;var m=function(){function e(){}return e.ns="http://www.w3.org/1999/02/22-rdf-syntax-ns#",e.type=new a(e.ns+"type"),e.langString=new a(e.ns+"langString"),e}();e.RDF=m;var y=function(){function e(){}return e.ns="http://www.w3.org/2001/XMLSchema#",e.string=new a(e.ns+"string"),e}();e.XMLSchema=y;var v=function(){function e(){}return e.ns="http://www.cidoc-crm.org/cidoc-crm/",e.Person=new a(e.ns+"E21_Person"),e.Place=new a(e.ns+"E53_Place"),e.Group=new a(e.ns+"E74_Group"),e}();e.CIDOC=v;var g=function(){function e(){}return e.ns="http://vocab.getty.edu/ontology#",e.AdminPlaceConcept=new a(e.ns+"AdminPlaceConcept"),e.PhysicalPlaceConcept=new a(e.ns+"PhysicalPlaceConcept"),e.PhysAdminPlaceConcept=new a(e.ns+"PhysAdminPlaceConcept"),e.PersonConcept=new a(e.ns+"PersonConcept"),e.GroupConcept=new a(e.ns+"GroupConcept"),e}();e.GETTY=g;var b=function(){function e(){}return e.ns="http://www.loc.gov/mads/rdf/v1#",e.CorporateName=new a(e.ns+"CorporateName"),e.PersonalName=new a(e.ns+"PersonalName"),e.NameTitle=new a(e.ns+"NameTitle"),e.Geographic=new a(e.ns+"Geographic"),e}();e.MADS=b;var w=function(){function t(t,r){void 0===t&&(t=function(){return{}}),void 0===r&&(r=new e.EMap),this.create=t,this.map=r}return t.prototype.goc=function(e,t){return this.has(e)||this.set(e,t?t(e):this.create(e)),this.get(e)},t.prototype.get=function(e){return this.map.get(e.toCanonical())},t.prototype.remove=function(e){return this.map.remove(e.toCanonical())},t.prototype.each=function(e){var t=this;this.map.each(function(r,n,o){return e(r,d.instance.nodeFromCanonicalRepresentation(n),t)})},t.prototype.has=function(e){return this.map.has(e.toCanonical())},t.prototype.set=function(e,t){return this.map.set(e.toCanonical(),t),this},Object.defineProperty(t.prototype,"size",{get:function(){return this.map.size()},enumerable:!0,configurable:!0}),t.prototype.values=function(){return this.map.values()},t.prototype.keys=function(){return this.map.keys().map(function(e){return d.instance.nodeFromCanonicalRepresentation(e)})},t.prototype.entries=function(){return this.map.entries().map(function(e){return{key:d.instance.nodeFromCanonicalRepresentation(e.key),value:e.value}})},t.prototype.clear=function(){return this.map.clear(),this},t}();e.ENodeMap=w;var S=function(t){function r(r){t.call(this,r,new e.EOMap)}return __extends(r,t),r}(w);e.EONodeMap=S;var E=function(){function t(t){void 0===t&&(t=new e.EMap),this.m=new w((void 0),t)}return t.prototype.add=function(e){return this.m.set(e,e),this},t.prototype.adda=function(e){var t=this;return e.forEach(function(e){return t.add(e)}),this},t.prototype.adds=function(e){var t=this;return e.each(function(e){return t.add(e)}),this},t.prototype.has=function(e){return this.m.has(e)},t.prototype.get=function(e){return this.m.get(e)},t.prototype.clear=function(){return this.m.clear(),this},t.prototype.remove=function(e){return this.m.remove(e)},t.prototype.values=function(){return this.m.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.m.size},enumerable:!0,configurable:!0}),t.prototype.each=function(e){var t=this;this.m.each(function(r,n,o){return e(r,r,t)})},t}();e.NodeSet=E;var I=function(t){function r(){t.call(this,new e.EOMap)}return __extends(r,t),r}(E);e.ONodeSet=I}(fibra||(fibra={}));var fibra;!function(e){"use strict"}(fibra||(fibra={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},fibra;!function(e){"use strict";var t=function(){function e(){}return e}(),r=function(e){function t(t,r){var n=this;e.call(this),this.sparqlItemService=t,this.fibraService=r,this.$onChanges=function(e){n.itemId&&n.sparqlItemService.getItem(n.itemId).then(function(e){return n.item=e})},this.addItem=function(){n.fibraService.dispatchAction(n.fibraService.displayItem(n.item))}}return __extends(t,e),t}(t);angular.module("fibra").controller("SparqlItemComponentController",["sparqlItemService","fibraService",function(){return new(Function.prototype.bind.apply(r,[null].concat(Array.prototype.slice.apply(arguments))))}]);var n=function(){function e(){this.bindings={itemId:"<",onSelect:"&",showRemoteProperties:"@"},this.controller="SparqlItemComponentController",this.templateUrl="components/sparql-item/sparql-item.html"}return e}();angular.module("fibra").component("sparqlItem",new n),e.SparqlItemComponent=n}(fibra||(fibra={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},fibra;!function(e){"use strict";var t=function(e){function t(t,r){e.call(this,t),r&&(this.label=r)}return __extends(t,e),t}(e.NodeFromNode);e.NodePlusLabel=t;var r=function(e){function t(t,r,n){void 0===n&&(n=[]),e.call(this,t,r),this.sourceEndpoints=n}return __extends(t,e),t}(t);e.SourcedNodePlusLabel=r;var n=function(e){function t(t){e.call(this,t),this.values=[]}return __extends(t,e),t}(t);e.PropertyToValues=n;var o=function(){function e(e){this.source=e,this.properties=[]}return e}();e.SourcePlusProperties=o;var i=function(e){function t(){e.apply(this,arguments),this.localProperties=[],this.remoteProperties=[],this.localInverseProperties=[],
this.remoteInverseProperties=[]}return __extends(t,e),t}(t);e.Item=i;var a=function(){function e(e,t){void 0===t&&(t=0),this.constraintString=e,this.priority=t}return e}();e.SimpleConstraint=a;var s=function(){function e(e){this.workerService=e}return e.UUID=function(){var t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,o=4294967295*Math.random()|0;return e.lut[255&t]+e.lut[t>>8&255]+e.lut[t>>16&255]+e.lut[t>>24&255]+"-"+e.lut[255&r]+e.lut[r>>8&255]+"-"+e.lut[r>>16&15|64]+e.lut[r>>24&255]+"-"+e.lut[63&n|128]+e.lut[n>>8&255]+"-"+e.lut[n>>16&255]+e.lut[n>>24&255]+e.lut[255&o]+e.lut[o>>8&255]+e.lut[o>>16&255]+e.lut[o>>24&255]},e.prototype.getItem=function(e,t,r){return void 0===t&&(t=!1),this.workerService.call("sparqlItemWorkerService","getItems",[[e],t],r).then(function(e){return e[0]},null,function(e){return{endpointType:e.endpointType,endpoint:e.endpoint,item:e.items[0]}})},e.prototype.getItems=function(e,t,r){return void 0===t&&(t=!1),this.workerService.call("sparqlItemWorkerService","getItems",[e,t],r)},e.prototype.createNewItem=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=[]),this.workerService.call("sparqlItemWorkerService","createNewItem",[e,t])},e.prototype.alterItem=function(e,t,r){return void 0===r&&(r=[]),this.workerService.call("sparqlItemWorkerService","alterItem",[e,t,r])},e.prototype.deleteItem=function(e){return this.workerService.call("sparqlItemWorkerService","deleteItem",[e])},e.naiveGetLocalItemPropertiesQuery='\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX mads: <http://www.loc.gov/mads/rdf/v1#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX owl: <http://www.w3.org/2002/07/owl#>\nSELECT ?itemLabel ?property ?propertyLabel ?object ?objectLabel {\n  GRAPH <GRAPH> {\n    {\n      <ID> skos:prefLabel|mads:authoritativeLabel|rdfs:label ?itemLabel .\n      FILTER(LANG(?itemLabel)=\'\' || LANG(?itemLabel)=\'<PREFLANG>\')\n    } UNION {\n      <ID> ?property ?object .\n      OPTIONAL {\n        ?property skos:prefLabel|rdfs:label ?propertyLabelP .\n        FILTER(LANG(?propertyLabelP)=\'\' || LANG(?propertyLabelP)=\'<PREFLANG>\')\n      }\n      BIND(COALESCE(?propertyLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?property),".*/",""),".*#",""),"_"," "),"([A-ZÅÄÖ])"," $1")) AS ?propertyLabel)\n      OPTIONAL {\n        ?object skos:prefLabel|rdfs:label ?objectLabelP .\n        FILTER(LANG(?objectLabelP)=\'\' || LANG(?objectLabelP)=\'<PREFLANG>\')\n      }\n      BIND (IF(ISIRI(?object),COALESCE(?objectLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?object),".*/",""),".*#",""),"_"," "),"([A-ZÅÄÖ])"," $1")),?object) AS ?objectLabel)\n    }\n  }\n}',e.getLocalItemPropertiesQuery='\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX mads: <http://www.loc.gov/mads/rdf/v1#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX owl: <http://www.w3.org/2002/07/owl#>\nPREFIX sf: <http://ldf.fi/functions#>\nSELECT ?id ?itemLabel ?property ?propertyLabel ?object ?objectLabel {\n  GRAPH <GRAPH> {\n    VALUES ?id { <IDS> }\n    ?id sf:preferredLanguageLiteral (skos:prefLabel mads:authoritativeLabel rdfs:label skos:altLabel mads:variantLabel \'<PREFLANG>\' \'\' ?itemLabel) .\n    ?id ?property ?object .\n    OPTIONAL {\n      ?property sf:preferredLanguageLiteral (skos:prefLabel mads:authoritativeLabel rdfs:label skos:altLabel mads:variantLabel \'<PREFLANG>\' \'\' ?propertyLabelP)\n    }\n    BIND(COALESCE(?propertyLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?property),".*/",""),".*#",""),"_"," "),"([A-ZÅÄÖ])"," $1")) AS ?propertyLabel)\n    OPTIONAL {\n      ?object sf:preferredLanguageLiteral (skos:prefLabel mads:authoritativeLabel rdfs:label skos:altLabel mads:variantLabel \'<PREFLANG>\' \'\' ?objectLabelP) .\n    }\n    BIND (IF(ISIRI(?object),COALESCE(?objectLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?object),".*/",""),".*#",""),"_"," "),"([A-ZÅÄÖ])"," $1")),?object) AS ?objectLabel)\n  }\n}',e.getRemoteItemPropertiesQuery='\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX mads: <http://www.loc.gov/mads/rdf/v1#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX owl: <http://www.w3.org/2002/07/owl#>\nPREFIX sf: <http://ldf.fi/functions#>\nSELECT ?id ?property ?propertyLabel ?object ?objectLabel {\n  VALUES (?id ?oid) { <IDPAIRS> }\n  ?oid ?property ?object .\n  OPTIONAL {\n    ?property sf:preferredLanguageLiteral (skos:prefLabel mads:authoritativeLabel rdfs:label skos:altLabel mads:variantLabel \'<PREFLANG>\' \'\' ?propertyLabelP)\n  }\n  BIND(COALESCE(?propertyLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?property),".*/",""),".*#",""),"_"," "),"([A-ZÅÄÖ])"," $1")) AS ?propertyLabel)\n  OPTIONAL {\n    ?object sf:preferredLanguageLiteral (skos:prefLabel mads:authoritativeLabel rdfs:label skos:altLabel mads:variantLabel \'<PREFLANG>\' \'\' ?objectLabelP) .\n  }\n  BIND (IF(ISIRI(?object),COALESCE(?objectLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?object),".*/",""),".*#",""),"_"," "),"([A-ZÅÄÖ])"," $1")),?object) AS ?objectLabel)\n}\n',e.deleteItemQuery="\nDELETE {\n  GRAPH <GRAPH> {\n    <ID> ?p ?o .\n    ?s ?p <ID> .\n  }\n}\nWHERE {\n  GRAPH <GRAPH> {\n    { <ID> ?p ?o } UNION { ?s ?p <ID> }\n  }\n}\n",e.lut=function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return e}(),e}();angular.module("fibra").service("sparqlItemService",["workerService",function(){return new(Function.prototype.bind.apply(s,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.SparqlItemService=s;var l=function(){function t(e,t,r,n){this.sparqlService=e,this.$q=t,this.sparqlUpdateWorkerService=r,this.configurationWorkerService=n}return t.processItemResult=function(t,o,i,a,s,l){if(l.property){var c=i.goc(l.property.value).goc(l.object.value,function(){var i=o.goc(l.property.value,function(){var r=new n(e.DataFactory.instance.nodeFromBinding(l.property));return l.propertyLabel&&(r.label=e.DataFactory.instance.nodeFromBinding(l.propertyLabel)),t.push(r),r}),s=new r(e.DataFactory.instance.nodeFromBinding(l.object));return i.values.push(s),e.OWL.sameAs.equals(i)&&a.push(s),s});c.sourceEndpoints.push(s),l.objectLabel&&!c.label&&(c.label=e.DataFactory.instance.nodeFromBinding(l.objectLabel))}},t.prototype.getItems=function(r,n,o){var a=this;void 0===n&&(n=!1);var s=this.configurationWorkerService.configuration.primaryEndpoint.localItemQueryTemplate;s=s.replace(/<IDS>/g,r.map(function(e){return e.toCanonical()}).join("")),s=s.replace(/<PREFLANG>/g,this.configurationWorkerService.configuration.preferredLanguage);var l=new e.EMap(function(t){return new i(e.DataFactory.instance.namedNode(t))}),c=this.$q.defer();return this.sparqlService.query(this.configurationWorkerService.configuration.primaryEndpoint.endpoint.value,s,{timeout:o}).then(function(r){for(var i=new e.EMap(function(){return new e.EMap}),s=new e.EMap(function(){return new e.EMap(function(){return new e.EMap})}),p=new e.ENodeMap(function(){return[]}),u=0,d=r.data.results.bindings;u<d.length;u++){var f=d[u],h=l.goc(f.id.value);f.itemLabel&&(h.label=e.DataFactory.instance.nodeFromBinding(f.itemLabel)),t.processItemResult(h.localProperties,i.goc(f.id.value),s.goc(f.id.value),p.goc(h),a.configurationWorkerService.configuration.primaryEndpoint,f)}if(n){c.notify({endpointType:"primary",endpoint:a.configurationWorkerService.configuration.primaryEndpoint.endpoint.value,items:l.values()});for(var m="",y=0,v=l.values();y<v.length;y++){var h=v[y];m+="("+h.toCanonical()+h.toCanonical()+")";for(var g=0,b=p.get(h);g<b.length;g++){var w=b[g];m+="("+h.toCanonical()+w.toCanonical()+")"}}a.$q.all(a.configurationWorkerService.configuration.remoteEndpoints().map(function(r){var n=r.remoteItemQueryTemplate;return n=n.replace(/<IDPAIRS>/g,m),n=n.replace(/<PREFLANG>/g,a.configurationWorkerService.configuration.preferredLanguage),a.sparqlService.query(r.endpoint.value,n,{timeout:o}).then(function(e){for(var n=0,o=e.data.results.bindings;n<o.length;n++){var a=o[n],u=l.goc(a.id.value);t.processItemResult(u.remoteProperties,i.goc(a.id.value),s.goc(a.id.value),p.goc(u),r,a)}c.notify({endpointType:"remote",endpoint:r,items:l.values()})},function(t){return c.notify({endpointType:"remote",endpoint:r,error:e.WorkerWorkerService.stripFunctions(t)})})})).then(function(){return c.resolve(l.values())})}else c.resolve(l.values())}),c.promise},t.prototype.deleteItem=function(e){return this.sparqlService.update(this.configurationWorkerService.configuration.primaryEndpoint.updateEndpoint.value,this.configurationWorkerService.configuration.deleteItemQuery.replace(/<ID>/g,e.toCanonical())).then(function(e){return 204===e.status},function(e){return!1})},t.prototype.alterItem=function(t,r,n){void 0===n&&(n=[]);var o=[],i=[];return r.forEach(function(r){r.label&&o.push(new e.Triple(r,e.SKOS.prefLabel,r.label)),r.values.forEach(function(n){o.push(new e.Triple(t,r,n)),n.label&&o.push(new e.Triple(n,e.SKOS.prefLabel,n.label))})}),n.forEach(function(r){return r.values.forEach(function(n){return i.push(new e.Triple(t,r,n))})}),this.sparqlUpdateWorkerService.updateGraphs(this.configurationWorkerService.configuration.primaryEndpoint.updateEndpoint.value,[new e.Graph(this.configurationWorkerService.configuration.graph,o)],[new e.Graph(this.configurationWorkerService.configuration.graph,i)])},t.prototype.createNewItem=function(t,r){void 0===t&&(t=[]),void 0===r&&(r=[]);var n=this.$q.defer(),o=new e.NamedNode(this.configurationWorkerService.configuration.instanceNS+s.UUID());n.notify(o);var i=[];return t.forEach(function(t){return i.push(new e.Triple(o,e.OWL.sameAs,t))}),r.forEach(function(t){t.label&&i.push(new e.Triple(t,e.SKOS.prefLabel,t.label)),t.values.forEach(function(r){i.push(new e.Triple(o,t,r)),r.label&&i.push(new e.Triple(r,e.SKOS.prefLabel,r.label))})}),this.sparqlUpdateWorkerService.updateGraphs(this.configurationWorkerService.configuration.primaryEndpoint.updateEndpoint.value,[new e.Graph(this.configurationWorkerService.configuration.graph,i)]).then(function(){return n.resolve(o)},n.reject,n.notify),n.promise},t}();angular.module("fibra").service("sparqlItemWorkerService",["sparqlService","$q","sparqlUpdateWorkerService","configurationWorkerService",function(){return new(Function.prototype.bind.apply(l,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.SparqlItemWorkerService=l}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e,t){this.id=e,this.label=t,this.children=[],this.selected=!0,this.open=!0}return e.recursivelyProcess=function(t,r){r(t),t.children.forEach(function(t){return e.recursivelyProcess(t,r)})},e}();e.TreeNode=t;var r=function(){function e(){this.bindings={tree:"<",onSelect:"&"},this.templateUrl="components/tree/tree.html"}return e}();angular.module("fibra").component("tree",new r),e.TreeComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(){this.bindings={tree:"<",onSelect:"&"},this.templateUrl="components/type-select/type-select.html"}return e}();angular.module("fibra").component("typeSelect",new t),e.TypeSelectComponent=t}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e,t,r){this.appName=e,this.workerThreads=t,this.importScripts=r}return e}();e.WorkerServiceConfiguration=t;var r=function(){function e(t,r,n,o,i){var a=this;this.workerServicePrototypeMappingConfiguration=r,this.$q=i,this.currentWorker=0,this.deferreds=[];var s=o.location.protocol+"//"+o.location.host,l=t.importScripts.map(function(e){return 0!==e.indexOf("http")?s+(0!==e.indexOf("/")?o.location.pathname:"")+e:e}),c=o.URL.createObjectURL(new Blob([e.workerTemplate.replace(/<APP_NAME>/g,t.appName).replace(/<IMPORT_SCRIPTS>/g,l.join("','"))],{type:"application/javascript"}));this.workers=[];for(var p=0;p<t.workerThreads;p++)this.workers.push(new Worker(c)),this.workers[p].addEventListener("message",function(e){var t=e.data.event;if("broadcast"===t)n.$broadcast(e.data.name,a.restorePrototypes(e.data.args)),n.$apply();else{var r=a.deferreds[e.data.id];r&&("success"===t?(delete a.deferreds[e.data.id],r.resolve(a.restorePrototypes(e.data.data))):"failure"===t?(delete a.deferreds[e.data.id],r.reject(a.restorePrototypes(e.data.data))):r.notify(a.restorePrototypes(e.data.data)))}})}return e.stripMarks=function(t){if(t&&t.__mark&&"object"==typeof t)if(delete t.__mark,t instanceof Array)t.forEach(function(t){return e.stripMarks(t)});else for(var r in t)t.hasOwnProperty(r)&&e.stripMarks(t[r])},e.stripPrototypes=function(t){if(t&&t.__className&&"object"==typeof t)if(delete t.__className,t instanceof Array)t.forEach(function(t){return e.stripPrototypes(t)});else for(var r in t)t.hasOwnProperty(r)&&e.stripPrototypes(t[r])},e.savePrototypes=function(t){return e.stripPrototypes(t),this.savePrototypesInternal(t),t},e.savePrototypesInternal=function(t){if(t&&!t.__className&&"object"==typeof t)if(t instanceof Array)t.forEach(function(t){return e.savePrototypes(t)});else{if(t.constructor.__name||"Object"!==t.constructor.name){var r=Object.getPrototypeOf(t);e:for(;r!==Object.prototype;){for(var n=0,o=Object.getOwnPropertyNames(r);n<o.length;n++){var i=o[n];if("constructor"!==i&&"function"==typeof t.__proto__[i]){t.__className=t.constructor.__name?t.constructor.__name:t.constructor.name;break e}}r=Object.getPrototypeOf(r)}t.__className||(t.__className="Object")}for(var a in t)t.hasOwnProperty(a)&&e.savePrototypes(t[a])}},e.prototype.$broadcast=function(t,r){this.workers.forEach(function(n){return n.postMessage({name:t,args:e.savePrototypes(r)})})},e.prototype.callAll=function(t,r,n,o){var i=this;void 0===n&&(n=[]);var a=this.$q.defer();this.deferreds.push(a);var s=this.deferreds.length-1,l={id:s,service:t,method:r,args:e.savePrototypes(n)};return o&&o.then(function(){i.workers.forEach(function(e){return e.postMessage({id:s,cancel:!0})}),delete i.deferreds[s]}),this.workers.forEach(function(e){return e.postMessage(l)}),a.promise},e.prototype.call=function(t,r,n,o){var i=this;void 0===n&&(n=[]);var a=this.$q.defer();this.deferreds.push(a);var s=this.deferreds.length-1,l=this.workers[this.currentWorker];return this.currentWorker=(this.currentWorker+1)%this.workers.length,o&&o.then(function(){l.postMessage({id:s,cancel:!0}),delete i.deferreds[s]}),l.postMessage({id:s,service:t,method:r,args:e.savePrototypes(n)}),a.promise},e.prototype.restorePrototypes=function(t){return this.restorePrototypesInternal(t),e.stripMarks(t),t},e.prototype.restorePrototypesInternal=function(e){var t=this;if(e&&!e.__mark&&"object"==typeof e)if(e.__mark=!0,e instanceof Array)e.forEach(function(e){return t.restorePrototypesInternal(e)});else{if(e.__className){var r=this.workerServicePrototypeMappingConfiguration[e.__className];if(!r)throw"Unknown prototype "+e.__className;e.__proto__=r,delete e.__className}for(var n in e)e.hasOwnProperty(n)&&this.restorePrototypesInternal(e[n])}},e.workerTemplate="\n      var window = self\n      self.history = {}\n      self.Node = function () {}\n      var document = {\n        readyState: 'complete',\n        cookie: '',\n        querySelector: function () {},\n        createElement: function() {\n          return {\n            pathname: '',\n            setAttribute: function() {}\n          };\n        },\n      };\n      importScripts('<IMPORT_SCRIPTS>')\n      window.angular.module('<APP_NAME>').run(['workerWorkerService', function(workerWorkerService) {\n        self.addEventListener('message', function(e) { workerWorkerService.onMessage(e.data) })\n      }])\n      window.angular.bootstrap(null, ['<APP_NAME>'])\n    ",e}();angular.module("fibra").service("workerService",["workerServiceConfiguration","workerServicePrototypeMappingConfiguration","$rootScope","$window","$q",function(){return new(Function.prototype.bind.apply(r,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.WorkerService=r;var n=function(){function e(e,t,r,n){this.workerServicePrototypeMappingConfiguration=e,this.$injector=t,this.$q=r,this.$rootScope=n,this.cancellers=[]}return e.stripFunctions=function(t){var r={};for(var n in t)"object"==typeof t[n]?r[n]=e.stripFunctions(t[n]):"function"!=typeof t[n]&&(r[n]=t[n]);return r},e.prototype.$broadcast=function(e,t){try{self.postMessage({event:"broadcast",name:e,args:r.savePrototypes(t)})}catch(e){throw console.log(t,e),e}},e.prototype.onMessage=function(t){var n=this;if(void 0===t.id)this.$rootScope.$broadcast(t.name,this.restorePrototypes(t.args)),this.$rootScope.$apply();else if(t.cancel){var o=this.cancellers[t.id];delete this.cancellers[t.id],o&&o.resolve()}else{var i=this.$injector.get(t.service),o=this.$q.defer();this.cancellers[t.id]=o;var a=i[t.method].apply(i,this.restorePrototypes(t.args).concat(o.promise));if(!a||!a.then){var s=this.$q.defer();s.resolve(a),a=s.promise}a.then(function(e){delete n.cancellers[t.id],self.postMessage({event:"success",id:t.id,data:r.savePrototypes(e)})},function(o){delete n.cancellers[t.id],self.postMessage({event:"failure",id:t.id,data:r.savePrototypes(e.stripFunctions(o))})},function(e){return self.postMessage({event:"update",id:t.id,data:r.savePrototypes(e)})})}},e.prototype.restorePrototypes=function(e){return this.restorePrototypesInternal(e),r.stripMarks(e),e},e.prototype.restorePrototypesInternal=function(e){var t=this;if(e&&!e.__mark&&"object"==typeof e)if(e.__mark=!0,e instanceof Array)e.forEach(function(e){return t.restorePrototypesInternal(e)});else{if(e.__className){var r=this.workerServicePrototypeMappingConfiguration[e.__className];if(!r)throw"Unknown prototype "+e.__className;e.__proto__=r,delete e.__className}for(var n in e)e.hasOwnProperty(n)&&this.restorePrototypesInternal(e[n])}},e}();angular.module("fibra").service("workerWorkerService",["workerServicePrototypeMappingConfiguration","$injector","$q","$rootScope",function(){return new(Function.prototype.bind.apply(n,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.WorkerWorkerService=n}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e){console.log(this.chosenTypes),this.fibraService=e}return e.prototype.primaryClick=function(e){this.chosenTypes.primary=e,this.fibraService.dispatch("change")},e.prototype.secondaryClick=function(e){this.chosenTypes.secondary=e,this.fibraService.dispatch("change")},e.prototype.tertiaryClick=function(e){this.chosenTypes.tertiary=e,this.fibraService.dispatch("change")},e}();angular.module("fibra").controller("ExploreTypeComponentController",["fibraService",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.ExploreTypeComponentController=t;var r=function(){function e(){this.bindings={types:"=",chosenTypes:"="},this.templateUrl="components/construct-view/explore-type-component/explore-type-component.html",this.controller="ExploreTypeComponentController"}return e}();angular.module("fibra").component("exploreType",new r),e.ExploreTypeComponent=r}(fibra||(fibra={})),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/author-view/author-view.html",'\n<div class="container-fluid">\n  <div class="row no-gutter">\n    <div class="col-md-12">foo</div>\n  </div>\n  <div class="row">\n    <div class="col-md-12">\n      <sparql-autocomplete on-select="$ctrl.createItem(result)"></sparql-autocomplete>\n    </div>\n  </div>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/configure-view/configure-view.html",'\n<div class="container">\n  <h3>Select configuration</h3>\n  <ul>\n    <li ng-repeat="configuration in $ctrl.configurations">\n      <h4><a ng-click="$ctrl.setConfiguration(configuration)">{{configuration.name}}</a></h4>\n      <h5>Configured Authorities:</h5>\n      <ul class="list-inline">\n        <li ng-repeat="endpoint in configuration.authorityEndpoints">{{endpoint.title}}</li>\n      </ul>\n      <h5>Configured Archives:</h5>\n      <ul class="list-inline">\n        <li ng-repeat="endpoint in configuration.archiveEndpoints">{{endpoint.title}}</li>\n      </ul>\n    </li>\n  </ul>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/construct-view/construct-view.html",'\n<div class="container-fluid main">\n  <div class="row main no-gutter">\n    <div class="col-md-12">\n      <div class="row no-gutter">\n        <div class="col-md-12" id="type-bar">\n          <explore-type types="$ctrl.types" chosen-types="$ctrl.chosenTypes"></explore-type>\n        </div>\n        <div class="pull-right"><span class="glyphicon glyphicon-refresh fa-spin" ng-show="$ctrl.state.actionsRunning &gt; 0"></span></div>\n      </div>\n      <div class="row no-gutter">\n        <div class="col-md-12" id="middle-column">\n          <explore chosen-types="$ctrl.chosenTypes" selected-item="$ctrl.selectedItem"></explore>\n          <sparql-autocomplete limit="5" by="group" on-select="$ctrl.createItem(result)" id="searchbar"></sparql-autocomplete>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/construct-view/explore.html",'\n<div id="explorecontainer">\n  <div id="layout-choice">\n    <label>Force\n      <input type="radio" ng-model="layout.choice" value="force"/>\n    </label>\n    <label>Force Grid\n      <input type="radio" ng-model="layout.choice" value="forcegrid"/>\n    </label>\n  </div>\n  <svg id="explore"></svg>\n</div>\n<div id="tablecontainer">\n  <div id="tabcontainer"><a ng-click="type=\'type1\'" ng-class="{\'active\': type==\'type1\'}">Primary</a><a ng-click="type=\'type2\'" ng-class="{\'active\': type==\'type2\'}">Secondary</a><a ng-click="type=\'type3\'" ng-class="{\'active\': type==\'type3\'}">Tertiary</a></div>\n  <div class="widthcontainer" ng-switch="type">\n    <table class="exploretable" ng-switch-when="type1" style="table-layout: fixed">\n      <tr>\n        <th>Label</th>\n        <th ng-repeat="p in $ctrl.primaryProperties">{{ p}}</th>\n        <th>Actions</th>\n      </tr>\n      <tr ng-repeat="item in $ctrl.primaryItems">\n        <td ng-click="$ctrl.selectItem(item)">{{ item.label.value }}</td>\n        <td ng-repeat="p in $ctrl.primaryProperties" ng-click="$ctrl.selectItem(item)"><small ng-repeat="e in item.localProperties" ng-if="e.label.value == p">{{e.values[0].label.value}}</small></td>\n        <td><a ng-click="$ctrl.delete(item)">Delete</a></td>\n      </tr>\n    </table>\n    <table class="exploretable" ng-switch-when="type2">\n      <tr>\n        <th>Label</th>\n        <th ng-repeat="p in $ctrl.secondaryProperties">{{ p}}</th>\n        <th>Actions</th>\n      </tr>\n      <tr ng-repeat="item in $ctrl.secondaryItems">\n        <td ng-click="$ctrl.selectItem(item)">{{ item.label.value }}</td>\n        <td ng-repeat="p in $ctrl.secondaryProperties" ng-click="$ctrl.selectItem(item)"><small ng-repeat="e in item.localProperties" ng-if="e.label.value == p">{{e.values[0].label.value}}</small></td>\n        <td><a ng-click="$ctrl.delete(item)">Delete</a></td>\n      </tr>\n      <table class="exploretable" ng-switch-when="type3">\n        <tr>\n          <th>Label</th>\n          <th ng-repeat="p in $ctrl.tertiaryProperties">{{ p}}</th>\n          <th>Actions</th>\n        </tr>\n        <tr ng-repeat="item in $ctrl.tertiaryItems">\n          <td ng-click="$ctrl.selectItem(item)">{{ item.label.value }}</td>\n          <td ng-repeat="p in $ctrl.tertiaryProperties" ng-click="$ctrl.selectItem(item)"><small ng-repeat="e in item.localProperties" ng-if="e.label.value == p">{{e.values[0].label.value}}</small></td>\n          <td><a ng-click="$ctrl.delete(item)">Delete</a></td>\n        </tr>\n      </table>\n    </table>\n  </div>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/select-view/select-view.html",'\n<div class="container">\n  <h2>Select data</h2>\n  <ul>\n    <li><a ng-click="$ctrl.setData(\'set1\')">set 1</a></li>\n    <li><a ng-click="$ctrl.setData(\'set2\')">set 2</a></li>\n    <li><a ng-click="$ctrl.setData(\'set3\')">set 3</a></li>\n  </ul>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/sparql-autocomplete/sparql-autocomplete.html",'\n<script type="text/ng-template" id="sparql-autocomplete-item-popover">\n  <sparql-item item-id="result.ids[0]" show-remote-properties="true"></sparql-item>\n</script>\n<div class="form-group has-feedback">\n  <input class="form-control" ng-model="$ctrl.query" ng-model-options="{ debounce: 500 }" ng-change="$ctrl.onChange($ctrl.query)"/><span class="glyphicon glyphicon-refresh fa-spin form-control-feedback" ng-show="$ctrl.queryRunning"></span><span class="danger glyphicon glyphicon-alert form-control-feedback" ng-show="$ctrl.error"></span><span class="glyphicon glyphicon-remove form-control-feedback" ng-show="$ctrl.results" ng-click="$ctrl.clearResults()" style="pointer-events: auto"></span>\n</div>\n<div ng-repeat="result in $ctrl.results track by $index">\n  <h4>{{result.configuration.title || result.label }}</h4>\n  <ul>\n    <li ng-repeat="result in result.results track by $index" ng-click="$ctrl.onSelect({result:result})">{{result.matchedLabel.value}}<span ng-if="result.matchedLabel.value !== result.prefLabel.value">-&gt; {{result.prefLabel.value}}</span><span ng-if="result.additionalInformation[\'altLabel\']">&nbsp;(<span ng-repeat="altLabel in result.additionalInformation[\'altLabel\'] | limitTo:5">{{$last ? altLabel.value : altLabel.value+\', \'}}</span><span ng-if="result.additionalInformation[\'altLabel\'].length&gt;5">, &hellip;</span>)</span>&nbsp;[<span ng-repeat="datasource in result.datasources track by $index">{{$last ? datasource.id : datasource.id+\', \'}}</span>]</li>\n  </ul>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/sparql-item/sparql-item.html",'\n<script type="text/ng-template" id="sparql-item-popover">\n  <sparql-item endpoint="$ctrl.endpoint" item-id="value" show-remote-properties="true"></sparql-item>\n</script>\n<h4>{{$ctrl.item.label.value}}</h4><a ng-click="$ctrl.addItem()">+</a>\n<table class="table table-striped">\n  <tr ng-repeat="property in $ctrl.item.localProperties">\n    <th>{{property.label ? property.label.value : property.value}}</th>\n    <td><span ng-repeat="value in property.values" ng-click="$ctrl.onSelect({value: value})" uib-popover-template="\'sparql-item-popover\'" popover-trigger="mouseenter" popover-placement="right">{{value.label ? value.label.value : value.value}}<i class="glyphicon glyphicon-triangle-top" ng-repeat="endpoint in value.sourceEndpoints" ng-class="endpoint.class"></i>{{ $last ? \'\' : \', \' }}</span></td>\n  </tr>\n</table><i class="glyphicon glyphicon-chevron-down" ng-click="$ctrl.showRemoteProperties=!$ctrl.showRemoteProperties"></i>\n<table class="table table-striped" ng-show="$ctrl.showRemoteProperties">\n  <tr ng-repeat="property in $ctrl.item.remoteProperties">\n    <th>{{property.label ? property.label.value : property.value}}</th>\n    <td><span ng-repeat="value in property.values" ng-click="$ctrl.onSelect({value: value})" uib-popover-template="\'sparql-item-popover\'" popover-trigger="mouseenter" popover-placement="right">{{value.label ? value.label.value : value.value}}<i class="glyphicon glyphicon-triangle-top" ng-repeat="endpoint in value.sourceEndpoints" ng-class="endpoint.class"></i>{{ $last ? \'\' : \', \' }}</span></td>\n  </tr>\n</table>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/tree/tree.html",'\n<script type="text/ng-template" id="treenode.html">\n  <div class="checkbox">\n    <label>\n      <input type="checkbox" ng-model="node.selected" ng-change="$ctrl.onSelect({treeNode:node})"/>{{node.label}}\n    </label><span class="pull-left">{{node.matchingInstances != node.matchingInstances ? node.matchingInstances+\'/\'+node.instances : node.instances}}</span>\n  </div>\n  <ul>\n    <li ng-repeat="node in node.children" ng-include="\'treenode.html\'" ng-class="{selected:node.selected}"></li>\n  </ul>\n</script>\n<ul>\n  <li ng-repeat="node in $ctrl.tree" ng-include="\'treenode.html\'" ng-class="{selected:node.selected}"></li>\n</ul>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/type-select/type-select.html",'\n<script type="text/ng-template" id="type-pill.html">\n  <div class="checkbox">\n    <label>\n      <input type="checkbox" ng-model="node.selected" ng-change="$ctrl.onSelect({treeNode:node})"/>{{node.label}}\n    </label><span class="pull-left">{{node.matchingInstances != node.matchingInstances ? node.matchingInstances+\'/\'+node.instances : node.instances}}</span>\n  </div>\n  <ul>\n    <li ng-repeat="node in node.children" ng-include="\'tree-pill.html\'" ng-class="{selected:node.selected}"></li>\n  </ul>\n</script>\n<ul>\n  <li ng-repeat="node in $ctrl.tree" ng-include="\'type-pill.html\'" ng-class="{selected:node.selected}"></li>\n</ul>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/construct-view/explore-type-component/explore-type-component.html",'\n<div class="btn-group" uib-dropdown="uib-dropdown">\n  <button class="btn btn-primary btn-xs" id="single-button" type="button" uib-dropdown-toggle="uib-dropdown-toggle" ng-disabled="disabled">{{ $ctrl.chosenTypes.primary ? $ctrl.chosenTypes.primary.label : "Primary Nodes" }}&nbsp;<span class="caret"></span></button>\n  <ul class="dropdown-menu" uib-dropdown-menu="uib-dropdown-menu" role="menu" aria-labelledby="single-button">\n    <li role="menuitem" ng-repeat="type in $ctrl.types"><a ng-click="$ctrl.primaryClick(type)">{{type.label}} ({{type.instances}})</a></li>\n  </ul>\n</div>\n<div class="btn-group" uib-dropdown="uib-dropdown">\n  <button class="btn btn-primary btn-xs" id="single-button" type="button" uib-dropdown-toggle="uib-dropdown-toggle" ng-disabled="!$ctrl.chosenTypes.primary || $ctrl.types.length &lt; 2">{{ $ctrl.chosenTypes.secondary ? $ctrl.chosenTypes.secondary.label : "Secondary Nodes" }}&nbsp;<span class="caret"></span></button>\n  <ul class="dropdown-menu" uib-dropdown-menu="uib-dropdown-menu" role="menu" aria-labelledby="single-button">\n    <li role="menuitem" ng-repeat="type in $ctrl.types"><a ng-click="$ctrl.secondaryClick(type)">{{type.label}} ({{type.instances}})</a></li>\n  </ul>\n</div>')}])}();