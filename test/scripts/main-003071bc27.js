var fibra;!function(e){"use strict";var t=angular.module("fibra",["http-auth-interceptor","ngStorage","ui.router","ui.bootstrap","ui.bootstrap.tpls","ngAnimate","fi.seco.yasqe","fi.seco.yasr","toastr","fi.seco.sparql","ui.codemirror","ngFileSaver"]);t.config(["toastrConfig",function(e){return angular.extend(e,{positionClass:"toast-top-full-width"})}]),t.config(["$stateProvider","$urlServiceProvider","$locationProvider","$uiRouterProvider",function(e,t,r,n){t.rules.otherwise(function(e,t,r){var o=t.search;window.location.search.replace("?","").split("&").forEach(function(e){var t=e.split("=");o[t[0]]=t[1]}),o.code?n.stateService.go("callback",o):n.stateService.go("projects")}),e.state("projects",{url:"/projects",template:"<projects-view></projects-view>"}),e.state("rdfstoreTest",{url:"/rdfstore-test",template:"<rdfstore-test-view></rdfstore-test-view>"}),e.state("projectSources",{url:"/project-sources?sourceId&sparqlEndpoint&updateEndpoint&graphStoreEndpoint&graph&type",template:"<project-sources-view></project-sources-view>"}),e.state("projectSourceConfigurations",{url:"/project-source-configurations?sourceId",template:"<project-source-configurations-view></project-source-configurations-view>"}),e.state("editPrimaryEndpointConfiguration",{url:"/edit-primary-endpoint-configuration?sourceId&id",template:"<edit-primary-endpoint-configuration-view></edit-primary-endpoint-configuration-view>"}),e.state("editRemoteEndpointConfiguration",{url:"/edit-remote-endpoint-configuration?sourceId&id",template:"<edit-remote-endpoint-configuration-view></edit-remote-endpoint-configuration-view>"}),e.state("editSchema",{url:"/edit-schema?sourceId&id",template:"<edit-schema-view></edit-schema-view>"}),e.state("configure",{url:"/configure?sourceId&id",template:"<configure-view></configure-view>"}),e.state("construct",{url:"/construct?id&sparqlEndpoint&graph",resolve:{project:["projectService","fibraService","$stateParams",function(e,t,r){return e.loadProject({sparqlEndpoint:r.sparqlEndpoint,graph:r.graph},r.id).then(function(e){return t.dispatchAction(t.setProject(e))})}]},template:"<construct-view></construct-view>"}),e.state("author",{url:"/author",template:"<author-view></author-view>"}),e.state("login",{url:"/login",template:"<login></login>",params:{redirect_hash:{type:"string",value:""}}}),e.state("callback",{url:"/callback",template:"<callback></callback>",params:{code:{type:"string",array:!1,value:""}}})}]),t.config(["$localStorageProvider",function(e){return e.setKeyPrefix("fibra-")}]),t.value("workerServiceConfiguration",{appName:"fibra",workerThreads:8,importScripts:["scripts/worker-e31eba4d6a.js"]}),t.run(["$rootScope","$localStorage","$http","$state","authService","$location","workerService","socialAuthService","$window","$transitions",function(e,t,r,n,o,i,a,s,c,l){e.authInfo={authOpen:!1,username:void 0,password:void 0},t.authorization&&(r.defaults.headers.common.Authorization=t.authorization,a.$broadcast("main:auth-loginAuthInfo",t.authorization)),e.setAuth=function(){e.authInfo.authOpen=!1,t.authorization="Basic "+btoa(e.authInfo.username+":"+e.authInfo.password),r.defaults.headers.common.Authorization=t.authorization,a.$broadcast("main:auth-loginAuthInfo",t.authorization),o.loginConfirmed()},e.dismissAuth=function(){e.authInfo.authOpen=!1,o.loginCancelled({status:401},"Authentication required")},e.$on("event:auth-loginRequired",function(){return e.authInfo.authOpen=!0});var p={to:function(e){return e.data&&e.data.requiresAuth}},u=function(e){if(!s.isAuthenticated())return e.router.stateService.target("login",{redirect_hash:window.location.hash})};e.socialAuthService=s,l.onBefore(p,u,{priority:10}),l.onSuccess({},function(t){return e.viewName=t._targetState.name()})}])}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e,t){this.sparqlEndpoint=e,this.graph=t}return e.clone=function(t){return new e(t.sparqlEndpoint,t.graph)},e}();e.CitableSource=t;var r=function(){function t(e,t,r,n,o,i){void 0===r&&(r=[]),void 0===o&&(o=[]),void 0===i&&(i=[]),this.labels=r,this.url=n,this.descriptions=o,this.rightsHolders=i,this.source={sparqlEndpoint:null},this.id=e,this.source=t}return t.toTurtle=function(t,r,n){n.skos=e.SKOS.ns,n.dcterms=e.DCTerms.ns,n.foaf=e.FOAF.ns,n.fibra=e.FIBRA.ns,n.rdf=e.RDF.ns;var o=r.get(t.id);t.labels.forEach(function(e){e.value&&(o+="\n  skos:prefLabel "+e.toCanonical()+" ;")}),t.descriptions.forEach(function(e){e.value&&(o+="\n  dcterms:description "+e.toCanonical()+" ;")}),t.url&&(o+="\n  foaf:homepage <"+t.url+"> ;"),t.rightsHolders.length>0&&(o+="\n  dcterms:rightsHolder ",t.rightsHolders.forEach(function(e){o+="<"+e.id+">, ",r.has(e.id)||(r.set(e.id,"<"+e.id+"> a foaf:Agent ;"),e.toTurtle(r,n))}),o=o.substring(0,o.length-2)+" ;",t.rightsHolders.length>1&&t.rightsHolders.forEach(function(e,t){o+="\n  fibra:qualifiedAssertion [\n    rdf:predicate dcterms:rightsHolder ;\n    rdf:object <"+e.id+"> ;\n    fibra:order "+t+" ;\n  ] ;"})),r.set(t.id,o)},t.prototype.toTurtle=function(e,r){t.toTurtle(this,e,r)},t}();e.Citable=r}(fibra||(fibra={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),fibra;!function(e){"use strict";var t=fi.seco.sparql,r=function(){function e(e,t,r,n){void 0===r&&(r=void 0),void 0===n&&(n=void 0),this.value=e,this.termType=t,this.language=r,this.datatype=n}return e.prototype.toCanonical=function(){switch(this.termType){case"NamedNode":return"<"+this.value+">";case"BlankNode":return"_:"+this.value;case"Literal":return t.SparqlService.stringToSPARQLString(this.value)+(this.language?"@"+this.language:!this.datatype||w.langString.equals(this.datatype)||E.string.equals(this.datatype)?"":"^^"+this.datatype.toCanonical());case"Variable":return"?"+this.value;case"DefaultGraph":return"";case"UNDEF":return"UNDEF";default:throw"Unknown term type "+this}},e.prototype.equals=function(e){return this.termType===e.termType&&this.value===e.value&&("Literal"!==this.termType||this.language===e.language&&this.datatype===e.datatype)},e}();e.Node=r;var n=function(e){function t(t){return e.call(this,t.value,t.termType,t.language,t.datatype)||this}return __extends(t,e),t}(r);e.NodeFromNode=n;var o=function(e){function t(){return e.call(this,"","DefaultGraph")||this}return __extends(t,e),t.prototype.toCanonical=function(){return""},t.prototype.equals=function(e){return"DefaultGraph"===e.termType},t}(r);o.instance=new o,e.DefaultGraph=o;var i=function(e){function t(){return e.call(this,"","UNDEF")||this}return __extends(t,e),t.prototype.toCanonical=function(){return""},t.prototype.equals=function(e){return"UNDEF"===e.termType},t}(r);i.instance=new i,e.UNDEF=i;var a=function(e){function t(t){return e.call(this,t,"Variable")||this}return __extends(t,e),t.prototype.toCanonical=function(){return"?"+this.value},t}(r);e.Variable=a;var s=function(e){function t(t){return e.call(this,t,"NamedNode")||this}return __extends(t,e),t.prototype.toCanonical=function(){return"<"+this.value+">"},t}(r);e.NamedNode=s;var c=function(e){function t(t){return e.call(this,t,"BlankNode")||this}return __extends(t,e),t.prototype.toCanonical=function(){return"?"+this.value},t}(r);e.BlankNode=c;var l=function(e){function t(t,r,n){return void 0===r&&(r=""),e.call(this,t,"Literal",r,n?n:r?w.langString:E.string)||this}return __extends(t,e),t}(r);e.Literal=l;var p=function(){function e(e,t,r,n){this.subject=e,this.predicate=t,this.object=r,this.graph=n}return e.prototype.toCanonical=function(){return this.subject.toCanonical()+" "+this.predicate.toCanonical()+" "+this.object.toCanonical()+("DefaultGraph"===this.graph.termType?"":" "+this.graph.toCanonical())},e.prototype.equals=function(e){return this.subject.equals(e.subject)&&this.predicate.equals(e.predicate)&&this.object.equals(e.object)&&this.graph.equals(e.graph)},e}();e.Quad=p;var u=function(){function e(e,t,r){this.subject=e,this.predicate=t,this.object=r,this.graph=o.instance}return e.prototype.toCanonical=function(){return this.subject.toCanonical()+" "+this.predicate.toCanonical()+" "+this.object.toCanonical()},e.prototype.equals=function(e){return this.subject.equals(e.subject)&&this.predicate.equals(e.predicate)&&this.object.equals(e.object)&&this.graph.equals(e.graph)},e}();e.Triple=u;var d=function(){function e(e,t){void 0===t&&(t=[]),this.graph=e,this.triples=t}return e}();e.Graph=d;var f=function(){function e(){this.nextBlankNodeId=0}return e.nodeFromBinding=function(t){return e.instance.nodeFromBinding(t)},e.nodeFromNode=function(t){return e.instance.nodeFromNode(t)},e.nodeFromCanonicalRepresentation=function(t){return e.instance.nodeFromCanonicalRepresentation(t)},e.namedNode=function(t){return e.instance.namedNode(t)},e.blankNode=function(t){return e.instance.blankNode(t)},e.literal=function(t,r){return e.instance.literal(t,r)},e.variable=function(t){return e.instance.variable(t)},e.defaultGraph=function(){return e.instance.defaultGraph()},e.triple=function(t,r,n){return e.instance.triple(t,r,n)},e.quad=function(t,r,n,o){return e.instance.quad(t,r,n,o)},e.prototype.nodeFromBinding=function(e){var t=new r(e.value,"literal"===e.type?"Literal":"uri"===e.type?"NamedNode":"BlankNode");return"literal"===e.type&&(t.language=e["xml:lang"]?e["xml:lang"]:"",t.datatype=e.datatype?new s(e.datatype):""!==t.language?w.langString:E.string),t},e.prototype.nodeFromNode=function(e){return"Literal"===e.termType?new l(e.value,e.language,e.datatype):new r(e.value,e.termType)},e.prototype.nodeFromCanonicalRepresentation=function(e){if(0===e.indexOf("<"))return new s(e.substring(1,e.length-1));if(0===e.indexOf("_:"))return new c(e.substring(2));var t=e.substring(1,e.lastIndexOf('"'));return e.lastIndexOf("@")===e.lastIndexOf('"')+1?new l(t,e.substring(e.lastIndexOf("@"))):e.lastIndexOf("^^<")===e.lastIndexOf('"')+1?new l(t,"",new s(e.substring(e.lastIndexOf("^^<"),e.length-1))):new l(t)},e.prototype.namedNode=function(e){return new s(e)},e.prototype.blankNode=function(e){return new c(e?e:"b"+ ++this.nextBlankNodeId)},e.prototype.literal=function(e,t){return"string"==typeof t?new l(e,t):new l(e,void 0,t)},e.prototype.variable=function(e){return new a(e)},e.prototype.defaultGraph=function(){return o.instance},e.prototype.triple=function(e,t,r){return new u(e,t,r)},e.prototype.quad=function(e,t,r,n){return new p(e,t,r,n?n:o.instance)},e}();f.instance=new f,e.DataFactory=f;var h=function(){function e(){}return e}();h.ns="http://hdlab.stanford.edu/fibra/ontology#",h.Project=new s(h.ns+"Project"),h.graph=new s(h.ns+"graph"),h.qualifiedAssertion=new s(h.ns+"qualifiedAssertion"),h.order=new s(h.ns+"order"),h.schemaNS=new s(h.ns+"schemaNS"),h.instanceNS=new s(h.ns+"instanceNS"),h.updateEndpoint=new s(h.ns+"updateEndpoint"),h.configuration=new s(h.ns+"configuration"),h.configurationReference=new s(h.ns+"configurationReference"),h.schema=new s(h.ns+"schema"),h.schemaReference=new s(h.ns+"schemaReference"),h.autocompletionQuery=new s(h.ns+"autocompletionQuery"),h.propertyQuery=new s(h.ns+"propertyQuery"),h.classQuery=new s(h.ns+"classQuery"),h.itemQuery=new s(h.ns+"itemQuery"),h.deleteItemQuery=new s(h.ns+"deleteItemQuery"),h.RemoteEndpointConfiguration=new s(h.ns+"RemoteEndpointConfiguration"),h.PrimaryEndpointConfiguration=new s(h.ns+"PrimaryEndpointConfiguration"),h.AuthorityEndpointConfiguration=new s(h.ns+"AuthorityEndpointConfiguration"),h.ArchiveEndpointConfiguration=new s(h.ns+"ArchiveEndpointConfiguration"),h.Schema=new s(h.ns+"Schema"),e.FIBRA=h;var y=function(){function e(){}return e}();y.ns="http://www.w3.org/ns/sparql-service-description#",y._name=new s(y.ns+"name"),e.SD=y;var g=function(){function e(){}return e}();g.ns="http://www.w3.org/2004/02/skos/core#",g.prefLabel=new s(g.ns+"prefLabel"),g.altLabel=new s(g.ns+"altLabel"),g.related=new s(g.ns+"related"),e.SKOS=g;var v=function(){function e(){}return e}();v.ns="http://rdfs.org/ns/void#",v.sparqlEndpoint=new s(v.ns+"sparqlEndpoint"),e.VOID=v;var m=function(){function e(){}return e}();m.ns="http://purl.org/dc/terms/",m.rightsHolder=new s(m.ns+"rightsHolder"),m.description=new s(m.ns+"description"),e.DCTerms=m;var b=function(){function e(){}return e}();b.ns="http://xmlns.com/foaf/0.1/",b.homepage=new s(b.ns+"homepage"),e.FOAF=b;var S=function(){function e(){}return e}();S.ns="http://www.w3.org/2002/07/owl#",S.sameAs=new s(S.ns+"sameAs"),S.Thing=new s(S.ns+"Thing"),S.Class=new s(S.ns+"Class"),e.OWL=S;var w=function(){function e(){}return e}();w.ns="http://www.w3.org/1999/02/22-rdf-syntax-ns#",w.type=new s(w.ns+"type"),w.langString=new s(w.ns+"langString"),w.Triple=new s(w.ns+"Triple"),w.subject=new s(w.ns+"subject"),w.predicate=new s(w.ns+"predicate"),w.object=new s(w.ns+"object"),w.value=new s(w.ns+"value"),e.RDF=w;var E=function(){function e(){}return e}();E.ns="http://www.w3.org/2001/XMLSchema#",E.string=new s(E.ns+"string"),e.XMLSchema=E;var I=function(){function e(){}return e}();I.ns="http://www.cidoc-crm.org/cidoc-crm/",I.Person=new s(I.ns+"E21_Person"),I.Place=new s(I.ns+"E53_Place"),I.Group=new s(I.ns+"E74_Group"),e.CIDOC=I;var P=function(){function e(){}return e}();P.ns="http://vocab.getty.edu/ontology#",P.AdminPlaceConcept=new s(P.ns+"AdminPlaceConcept"),P.PhysicalPlaceConcept=new s(P.ns+"PhysicalPlaceConcept"),P.PhysAdminPlaceConcept=new s(P.ns+"PhysAdminPlaceConcept"),P.PersonConcept=new s(P.ns+"PersonConcept"),P.GroupConcept=new s(P.ns+"GroupConcept"),e.GETTY=P;var A=function(){function e(){}return e}();A.ns="http://www.loc.gov/mads/rdf/v1#",A.CorporateName=new s(A.ns+"CorporateName"),A.PersonalName=new s(A.ns+"PersonalName"),A.NameTitle=new s(A.ns+"NameTitle"),A.Geographic=new s(A.ns+"Geographic"),e.MADS=A;var C=function(){function e(){}return e}();C.ns="http://geovocab.org/spatial#",C.Feature=new s(C.ns+"Feature"),e.GEOVOCAB=C;var T=function(){function t(t,r){void 0===t&&(t=function(){return{}}),void 0===r&&(r=new e.EMap),this.create=t,this.map=r}return t.prototype.goc=function(e,t){return this.has(e)||this.set(e,t?t(e):this.create(e)),this.get(e)},t.prototype.get=function(e){return this.map.get(e.toCanonical())},t.prototype.remove=function(e){return this.map.remove(e.toCanonical())},t.prototype.each=function(e){var t=this;this.map.each(function(r,n,o){return e(r,f.instance.nodeFromCanonicalRepresentation(n),t)})},t.prototype.has=function(e){return this.map.has(e.toCanonical())},t.prototype.set=function(e,t){return this.map.set(e.toCanonical(),t),this},Object.defineProperty(t.prototype,"size",{get:function(){return this.map.size()},enumerable:!0,configurable:!0}),t.prototype.values=function(){return this.map.values()},t.prototype.keys=function(){return this.map.keys().map(function(e){return f.instance.nodeFromCanonicalRepresentation(e)})},t.prototype.entries=function(){return this.map.entries().map(function(e){return{key:f.instance.nodeFromCanonicalRepresentation(e.key),value:e.value}})},t.prototype.clear=function(){return this.map.clear(),this},t}();e.ENodeMap=T;var R=function(t){function r(r){return t.call(this,r,new e.EOMap)||this}return __extends(r,t),r}(T);e.EONodeMap=R;var L=function(){function t(t){void 0===t&&(t=new e.EMap),this.m=new T(void 0,t)}return t.prototype.add=function(e){return this.m.set(e,e),this},t.prototype.adda=function(e){var t=this;return e.forEach(function(e){return t.add(e)}),this},t.prototype.adds=function(e){var t=this;return e.each(function(e){return t.add(e)}),this},t.prototype.has=function(e){return this.m.has(e)},t.prototype.get=function(e){return this.m.get(e)},t.prototype.clear=function(){return this.m.clear(),this},t.prototype.remove=function(e){return this.m.remove(e)},t.prototype.values=function(){return this.m.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.m.size},enumerable:!0,configurable:!0}),t.prototype.each=function(e){var t=this;this.m.each(function(r,n,o){return e(r,r,t)})},t}();e.NodeSet=L;var q=function(t){function r(){return t.call(this,new e.EOMap)||this}return __extends(r,t),r}(L);e.ONodeSet=q}(fibra||(fibra={}));var fibra;!function(e){"use strict"}(fibra||(fibra={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),fibra;!function(e){"use strict";var t=function(e){function t(t,r,n,o,i){void 0===o&&(o=[]),void 0===i&&(i=[]);var a=e.call(this,t)||this;return a.label=r,a.description=n,a.types=o,a.sourceEndpoints=i,a}return __extends(t,e),t}(e.NodeFromNode);e.FullRichNodeFromNode=t;var r=function(e){function t(t){var r=e.call(this,t)||this;return r.label=t.label,r.description=t.description,r.types=t.types,r.sourceEndpoints=t.sourceEndpoints,r}return __extends(t,e),t}(e.NodeFromNode);e.RichNodeFromRichNode=r;var n=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t}(e.NodeFromNode);e.PrunedRichNodeFromNode=n}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=angular.module("fibra");t.service("workerServicePrototypeMappingConfiguration",function(){for(var t={Object:Object.prototype},r=0,n=Object.getOwnPropertyNames(e);r<n.length;r++){var o=n[r];t[o]=e[o].prototype,e[o].__name=o}return t})}(fibra||(fibra={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),fibra;!function(e){"use strict";var t=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t="en"),this.project=e,this.language=t}return e}();e.CommonState=t;var r=function(){function e(){this.types=[],this.userTypes=[],this.displayTypes=[],this.items=[],this.itemIndex={},this.localItems=[]}return e}();e.ConstructState=r;var n=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.construct=new r,t.actionsRunning=0,t}return __extends(n,e),n.prototype.toCommonState=function(){return new t(this.project,this.language)},n}(t);e.UIState=n;var o="PLACEHOLDER",i="CREATE_TYPE",a="CREATE_ITEMS",s="CREATE_DISPLAY_ITEMS",c="DELETE_ITEMS",l="VERIFY_ITEM",p="ADD_TYPE",u="CLEAR_TYPES",d="DISPLAY_ITEMS",f="HIDE_ITEM",h="CREATE_LOCAL_ITEM",y="ITEM_PROPERTIES",g="SET_ORDERED_TYPES",v="SET_LANGUAGE",m="SET_PROJECT",b=new n,S={type:"",payload:null},w=function(){function t(e,t,r,n){this.$q=e,this.workerService=t,this.sparqlItemService=r,this.sparqlTreeService=n,this.callbacks={},this.createState()}return t.prototype.on=function(e,t){var r=this;return void 0===this.callbacks[e]&&(this.callbacks[e]=Array()),this.callbacks[e].push(t),function(){r.callbacks[e].indexOf(t)!==-1&&r.callbacks[e].splice(r.callbacks[e].indexOf(t),1)}},t.prototype.dispatch=function(e){void 0===this.callbacks[e]&&(this.callbacks[e]=Array());var t=this.callbacks[e].map(function(e){return e()});return this.$q.all(t)},t.prototype.createState=function(){this.state=b,this.store||this.createStore()},t.prototype.createStore=function(){this.store=[this.state]},t.prototype.placeHolderAction=function(e){return{type:o,payload:e}},t.prototype.setLanguage=function(e){return{type:v,payload:e}},t.prototype.setProject=function(e){return{type:m,payload:e}},t.prototype.createLocalItem=function(e){return{type:h,payload:e}},t.prototype.displayItem=function(e,t){return{type:d,payload:{items:[e],coordinates:[t]}}},t.prototype.displayItems=function(e,t){return{type:d,payload:{items:e,coordinates:t}}},t.prototype.hideItem=function(e){return{type:f,payload:e}},t.prototype.itemProperty=function(e,t,r){return{type:y,payload:{item:e,propertiesToAdd:t,propertiesToRemove:r}}},t.prototype.createItem=function(e,t){return{type:a,payload:{items:[e],type:t}}},t.prototype.createItems=function(e,t){return{type:a,payload:{items:e,type:t}}},t.prototype.createDisplayItem=function(e,t){return{type:s,payload:{items:[e],type:t}}},t.prototype.createDisplayItems=function(e,t){return{type:s,payload:{items:e,type:t}}},t.prototype.deleteItem=function(e){return{type:c,payload:[e]}},t.prototype.verifyItem=function(e){return{type:l,payload:e}},t.prototype.addType=function(e){return{type:p,payload:e}},t.prototype.clearTypes=function(){return{type:u,payload:void 0}},t.prototype.setOrderedTypes=function(e){return{type:g,payload:e}},t.prototype.createType=function(e){return{type:i,payload:e}},t.prototype.itemReducer=function(e,t){var r=this;switch(void 0===e&&(e=b),void 0===t&&(t=S),t.type){case d:return t.payload.items.forEach(function(r,n){e.construct.itemIndex[r.value]||(e.construct.items.push(r),e.construct.itemIndex[r.value]=r,t.payload.coordinates&&t.payload.coordinates[n]&&t.payload.coordinates[n][0]&&t.payload.coordinates[n][1]&&(e.construct.itemIndex[r.value].x=t.payload.coordinates[n][0],e.construct.itemIndex[r.value].y=t.payload.coordinates[n][1]))}),this.dispatch("change"),this.$q.resolve(e);case f:var n=e.construct.itemIndex[t.payload.value];return n&&(e.construct.items.splice(e.construct.items.indexOf(n),1),delete e.construct.itemIndex[t.payload.value]),this.dispatch("change"),this.$q.resolve(e);case h:var o=t.payload;return e.construct.localItems.push(o),this.$q.resolve(e);case a:return this.createItemsInternal(t,e).then(function(t){return e});case s:return this.createItemsInternal(t,e).then(function(e){return r.dispatchAction(r.displayItems(e))});case c:return this.$q.all(t.payload.map(function(e){return r.sparqlItemService.deleteItem(e)})).then(function(){return r.dispatch("change"),r.state});case l:return this.state.construct.verifyItem=t.payload,this.dispatch("change"),this.$q.resolve(this.state);case y:return this.sparqlItemService.alterItem(t.payload.item,t.payload.propertiesToAdd,t.payload.propertiesToRemove).then(function(e){return r.state});default:return this.$q.resolve(e)}},t.prototype.sessionReducer=function(e,t){switch(void 0===e&&(e=b),void 0===t&&(t=S),t.type){case v:return e.language=t.payload,this.$q.resolve(e);case m:return e.project=t.payload,this.$q.resolve(e);default:return this.$q.resolve(e)}},t.prototype.constructReducer=function(t,r){var n=this;switch(void 0===t&&(t=b),void 0===r&&(r=S),r.type){case o:return r.payload.then(function(){return t});case p:t.construct.types.push(r.payload);var a=t.construct.userTypes.filter(function(e){return e.id===r.payload.id})[0];return a&&t.construct.userTypes.splice(t.construct.userTypes.indexOf(a),1),this.$q.resolve(t);case u:return t.construct.types=[],this.$q.resolve(t);case g:return t.construct.displayTypes=r.payload,this.$q.resolve(t);case i:return this.sparqlItemService.createNewItem([new e.PropertyAndValue(e.SKOS.prefLabel,e.DataFactory.instance.literal(r.payload)),new e.PropertyAndValue(e.RDF.type,e.OWL.Class)]).then(function(t){var o=new e.TreeNode(t.value,r.payload);return n.state.construct.userTypes.push(o),n.state});default:return this.$q.resolve(t)}},t.prototype.createItemsInternal=function(t,r){var n=this,o=t.payload.items,i=t.payload.type?e.DataFactory.instance.namedNode(t.payload.type):e.OWL.Thing;if(o[0]){var a=o.map(function(t){return t.value?n.sparqlItemService.createNewItem([new e.PropertyAndValue(e.SKOS.prefLabel,e.DataFactory.instance.literal(t.value)),new e.PropertyAndValue(e.RDF.type,i)]):n.sparqlItemService.createNewItem([new e.PropertyAndValue(e.RDF.type,i)])});return this.$q.all(a)}return this.sparqlItemService.createNewItem([new e.PropertyAndValue(e.RDF.type,i),new e.PropertyAndValue(e.SKOS.prefLabel,e.DataFactory.instance.literal(""))]).then(function(e){return[e]})},t.prototype.dispatchAction=function(t){var r=this;this.state.actionsRunning=this.state.actionsRunning+1,console.log(t.type,this.state.actionsRunning),this.dispatch("action");var n=this.state.toCommonState();return this.constructReducer(this.state,t).then(function(e){return r.itemReducer(e,t)}).then(function(e){return r.sessionReducer(e,t)}).then(function(t){if(t.language!==n.language||t.project!==n.project){var o=t.toCommonState();e.WorkerService.savePrototypes(o),r.workerService.callAll("stateWorkerService","setState",[o])}return r.state=t,r.state.actionsRunning=r.state.actionsRunning-1,t})},t.prototype.getState=function(){return this.state},t.prototype.undo=function(){},t}();angular.module("fibra").service("fibraService",["$q","workerService","sparqlItemService","sparqlTreeService",function(){return new(Function.prototype.bind.apply(w,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.FibraService=w;var E=function(){function e(){}return e.prototype.setState=function(e){this.state=e},e}();angular.module("fibra").service("stateWorkerService",[function(){return new(Function.prototype.bind.apply(E,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.StateWorkerService=E}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e,t){this.type=e,this.id=t}return e}();e.SparqlServiceDefinition=t;var r=function(){function t(t,r){var i=this;this.sparqlService=t,this.$q=r,this.services=new e.EMap(function(e){if(0===e.indexOf("local:")){var t=i.$q.defer();return new rdfstore.Store({name:e,persistent:!0},function(e,r){e?t.reject(e):t.resolve(new o(r,i.$q))}),t.promise}return i.$q.resolve(new n(i.sparqlService,e))})}return t.prototype.query=function(e,t,r){return this.services.goc(e).then(function(e){return e.query(t,r)})},t.prototype.update=function(e,t,r){return this.services.goc(e).then(function(e){return e.update(t,r)})},t.prototype.get=function(e,t,r){return this.services.goc(e).then(function(e){return e.get(t,r)})},t.prototype.put=function(e,t,r,n){return this.services.goc(e).then(function(e){return e.put(t,r,n)})},t.prototype.post=function(e,t,r,n){return this.services.goc(e).then(function(e){return e.post(t,r,n)})},t}();angular.module("fibra").service("fibraSparqlService",["sparqlService","$q",function(){return new(Function.prototype.bind.apply(r,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.FibraSparqlService=r;var n=function(){function e(e,t){this.s=e,this.endpoint=t}return e.prototype.query=function(e,t){return this.s.query(this.endpoint,e,t).then(function(e){return e.data})},e.prototype.update=function(e,t){return this.s.update(this.endpoint,e,t).then(function(e){return e.data})},e.prototype.get=function(e,t){return this.s.get(this.endpoint,e,t).then(function(e){return e.data})},e.prototype.post=function(e,t,r){return this.s.post(this.endpoint,e,t,r).then(function(e){return e.data})},e.prototype.put=function(e,t,r){return this.s.put(this.endpoint,e,t,r).then(function(e){return e.data})},e}();angular.module("fibra").service("remoteInternalSparqlService",["s","endpoint",function(){return new(Function.prototype.bind.apply(n,[null].concat(Array.prototype.slice.apply(arguments))))}]);var o=function(){function t(e,t){this.s=e,this.$q=t}return t.convertBinding=function(e){switch(e.token){case"uri":return{type:"uri",value:e.value};case"blank":return{type:"bnode",value:e.value};case"literal":return{type:"literal",value:e.value,"xml:lang":e.lang,datatype:e.type};default:throw"Unknown binding type "+e.token}},t.prototype.query=function(r,n){var o=this,i=this.$q.defer();try{this.s.execute(r,function(n,a){if(n)console.log("Error executing",o.s,r,n),i.reject(n);else{var s={head:{vars:[]},results:{bindings:[]}},c=new e.StringSet;s.results.bindings=a.map(function(e){var r={};for(var n in e)c.add(n),null!==e[n]&&(r[n]=t.convertBinding(e[n]));return r}),s.head.vars=c.values(),i.resolve(s)}})}catch(e){throw console.log("Exception executing",this.s,r,e),e}return i.promise},t.prototype.update=function(e,t){var r=this.$q.defer();return this.s.execute(e,function(e,t){e?r.reject(e):r.resolve(t)}),r.promise},t.prototype.get=function(e,t){var r=this.$q.defer();return this.s.graph(e,function(e,t){e?r.reject(e):r.resolve(t.toNT())}),r.promise},t.prototype.post=function(e,t,r){var n=this.$q.defer(),o=function(e,t){e?n.reject(e):n.resolve()};return t?this.s.load("text/turtle",e,t,o):this.s.load("text/turtle",e,o),n.promise},t.prototype.put=function(e,t,r){var n=this,o=this.$q.defer(),i=function(r){r&&o.reject(r);var i=function(e,t){e?o.reject(e):o.resolve()};t?n.s.load("text/turtle",e,t,i):n.s.load("text/turtle",e,i)};return t?this.s.clear(t,i):this.s.clear(i),o.promise},t}();angular.module("fibra").service("rDFStoreInternalSparqlService",["s","$q",function(){return new(Function.prototype.bind.apply(o,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.RDFStoreInternalSparqlService=o}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e,t){this.$localStorage=e,this.$state=t}return e.prototype.loginState=function(){return this.$localStorage.user_email?this.$localStorage.user_email+" (via "+this.$localStorage.login_provider+")":"Not logged in"},e.prototype.isLoggedIn=function(){return null!==this.$localStorage.user_email&&void 0!==this.$localStorage.user_email},e.prototype.isAuthenticated=function(){return!!this.$localStorage.access_token},e.prototype.logout=function(){this.$localStorage.access_token=null,this.$localStorage.login_provider=null,this.$localStorage.user_email=null,this.$state.go("projects")},e}();angular.module("fibra").service("socialAuthService",["$localStorage","$state",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.SocialAuthService=t}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e){this.sparqlItemService=e,this.items=[]}return e}();angular.module("fibra").controller("AuthorViewComponentController",["sparqlItemService",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.AuthorViewComponentController=t;var r=function(){function e(){this.controller="AuthorViewComponentController",this.templateUrl="components/author-view/author-view.html"}return e}();angular.module("fibra").component("authorView",new r),e.AuthorViewComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e,t,r){this.projectService=t,this.toastr=r,this.disabled=!1,this.projectSource=t.getProjectSources().find(function(t){return t.id===e})}return e.prototype.delete=function(){var e=this;this.disabled=!0,this.projectService.deleteCitable(this.projectSource.updateEndpoint,this.c).then(function(){e.toastr.success("Resource deleted"),e.disabled=!1},function(t){e.toastr.error("Error deleting resource",t),e.disabled=!1})},e.prototype.save=function(){var e=this;this.disabled=!0,this.c.source=this.projectSource,this.projectService.saveCitable(this.projectSource.updateEndpoint,this.projectSource.graphStoreEndpoint,this.c).then(function(){e.toastr.success("Resource saved"),e.disabled=!1},function(t){e.toastr.error("Error saving resource",t),e.disabled=!1})},e}();angular.module("fibra").controller("EditCitableComponentController",["sourceId","projectService","toastr",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.EditCitableComponentController=t;var r=function(){function t(e){this.fibraService=e}return t.prototype.addRightsHolder=function(){var t=new e.Citable("http://ldf.fi/fibra/citable_"+e.UUID());t.labels=[e.DataFactory.literal("",this.fibraService.getState().language)],t.descriptions=[e.DataFactory.literal("",this.fibraService.getState().language)],this.citable.rightsHolders.push(t)},t.prototype.addLabel=function(){this.citable.labels.push(e.DataFactory.literal("",""))},t.prototype.addDescription=function(){this.citable.descriptions.push(e.DataFactory.literal("",""))},t.prototype.removeLabel=function(e){this.citable.labels.splice(e,1)},t.prototype.removeDescription=function(e){
this.citable.descriptions.splice(e,1)},t}();angular.module("fibra").controller("CitableEditorComponentController",["fibraService",function(){return new(Function.prototype.bind.apply(r,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.CitableEditorComponentController=r;var n=function(){function e(){this.bindings={citable:"=",noRightsHolders:"@",noId:"@",noRightsHolderIds:"@"},this.controller="CitableEditorComponentController",this.templateUrl="components/citable-editor/citable-editor.html"}return e}();angular.module("fibra").component("citableEditor",new n),e.CitableEditorComponent=n}(fibra||(fibra={}));var fibra;!function(e){"use strict";angular.module("fibra").filter("citable",["fibraService",function(t){return function(r){var n=t.getState().language,o=e.getPrefLangString(r.labels,n);return r.rightsHolders.length>0&&(o+=" (",r.rightsHolders.forEach(function(t){return o+=e.getPrefLangString(t.labels,n)+", "}),o=o.substring(0,o.length-2)+")"),o}}])}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(){this.bindings={citable:"<",noLink:"@"},this.templateUrl="components/citable/citable.html"}return e}();angular.module("fibra").component("citable",new t),e.CitableComponent=t}(fibra||(fibra={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),fibra;!function(e){"use strict";function t(e,t,r){return void 0===e[t]&&(e[t]=r?r(t):{}),e[t]}function r(e,t,r,n){return void 0===e[t]&&(e[t]=n?n(t):{},r.push(e[t])),e[t]}function n(e,t,r,n){void 0===t[r]&&(t[r]=n,e.push(n))}function o(e,t,r){for(var o in r)n(e,t,o,r[o])}var i=function(){function e(){this.s={}}return e.prototype.has=function(e){return void 0!==this.s[e]},e.prototype.set=function(e,t){return this.s[e]=t,this},e.prototype.get=function(e){return this.s[e]},e.prototype.remove=function(e){var t=this.has(e);return delete this.s[e],t},e.prototype.sets=function(e){for(var t in e)this.set(t,e[t]);return this},e.prototype.setm=function(e){for(var t in e)this.set(t,e[t]);return this},e.prototype.clear=function(){return this.s={},this},e.prototype.keys=function(){var e=[];for(var t in this.s)e.push(t);return e},e.prototype.values=function(){var e=[];for(var t in this.s)e.push(this.s[t]);return e},e.prototype.entries=function(){var e=[];for(var t in this.s)e.push({key:t,value:this.s[t]});return e},e.prototype.each=function(e){for(var t in this.s)e(this.s[t],t,this)},e.prototype.size=function(){var e=0;for(var t in this.s)e++;return e},e.prototype.empty=function(){return 0===this.size()},e}();e.Map=i;var a=function(e){function t(t){void 0===t&&(t=function(){return{}});var r=e.call(this)||this;return r.create=t,r}return __extends(t,e),t.prototype.goc=function(e,t){return this.has(e)||this.set(e,t?t(e):this.create(e)),this.get(e)},t}(i);e.EMap=a;var s=function(){function e(){this.a=[]}return e.prototype.clear=function(){return this.a=[],this},e.prototype.has=function(e){return this.a.indexOf(e)!==-1},e.prototype.add=function(e){return this.has(e)?this:(this.a.push(e),this)},e.prototype.adda=function(e){var t=this;return e.forEach(function(e){return t.add(e)}),this},e.prototype.adds=function(e){var t=this;return e.each(function(e){return t.add(e)}),this},e.prototype.remove=function(e){var t=this.a.indexOf(e);return t!==-1&&(this.a.splice(t,1),!0)},e.prototype.each=function(e){for(var t=0,r=this.a;t<r.length;t++){var n=r[t];e(n,n,this)}},e.prototype.size=function(){return this.a.length},e.prototype.empty=function(){return 0===this.size()},e.prototype.values=function(){return this.a},e}();e.IdentitySet=s;var c=function(){function e(){this.s={}}return e.prototype.clear=function(){return this.s={},this},e.prototype.has=function(e){return void 0!==this.s[e]},e.prototype.add=function(e){return this.s[e]=e,this},e.prototype.adda=function(e){var t=this;return e.forEach(function(e){return t.add(e)}),this},e.prototype.adds=function(e){var t=this;return e.each(function(e){return t.add(e)}),this},e.prototype.remove=function(e){var t=this.has(e);return delete this.s[e],t},e.prototype.each=function(e){for(var t in this.s)e(this.s[t],t,this)},e.prototype.size=function(){var e=0;for(var t in this.s)e++;return e},e.prototype.empty=function(){return 0===this.size()},e.prototype.values=function(){var e=[];for(var t in this.s)e.push(t);return e},e}();e.StringSet=c;var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.a=[],t}return __extends(t,e),t.prototype.set=function(t,r){return this.has(t)||(e.prototype.set.call(this,t,r),this.a.push(r)),this},t.prototype.remove=function(t){var r=this.get(t);return void 0!==r&&(e.prototype.remove.call(this,t),this.a.splice(this.a.indexOf(r),1)),void 0!==r},t.prototype.size=function(){return this.a.length},t.prototype.values=function(){return this.a},t.prototype.clear=function(){return e.prototype.clear.call(this),this.a=[],this},t}(i);e.OMap=l;var p=function(e){function t(t){var r=e.call(this)||this;return r.create=t,r}return __extends(t,e),t.prototype.goc=function(e,t){return this.has(e)||this.set(e,t?t(e):this.create(e)),this.get(e)},t}(l);e.EOMap=p;var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.a=[],t}return __extends(t,e),t.prototype.add=function(t){return this.has(t)||(e.prototype.add.call(this,t),this.a.push(t)),this},t.prototype.remove=function(t){var r=e.prototype.remove.call(this,t);return r&&this.a.splice(this.a.indexOf(t),1),r},t.prototype.size=function(){return this.a.length},t.prototype.values=function(){return this.a},t.prototype.clear=function(){return e.prototype.clear.call(this),this.a=[],this},t}(c);e.OStringSet=u,e.goc=t,e.ogoc=r,e.cpush=n,e.cpushs=o}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function t(t,r,n,o,i,a){var s=this;if(this.$q=t,this.projectService=r,this.sparqlTreeService=o,this.$state=a,this.primaryEndpointConfigurations=[],this.statistics={},this.selectedAuthorities={},this.selectedArchives={},this.selectedSchemas={},this.schemas=[],this.authorities=[],this.archives=[],this.projectSources=r.getProjectSources(),this.projectSource=this.projectSources.find(function(e){return e.id===i.sourceId}),i.id)r.loadProject(this.projectSource,i.id).then(function(e){s.project=e,s.selectedTemplate=e.asTemplate()});else{var c="http://ldf.fi/fibra/project_"+e.UUID();this.project=new e.Project(c),this.project.labels=[e.DataFactory.literal("",n.getState().language)],this.project.descriptions=[e.DataFactory.literal("",n.getState().language)],this.project.source=this.projectSource,this.project.endpoint=this.projectSource.sparqlEndpoint,this.project.updateEndpoint=this.projectSource.updateEndpoint,this.project.graphStoreEndpoint=this.projectSource.graphStoreEndpoint,this.project.graph=c}this.projectSources.forEach(function(e){r.listPrimaryEndpointConfigurations(e).then(function(e){if(!s.selectedTemplate){var t=e.find(function(e){return void 0!==e.compatibleEndpoints.find(function(e){return e===s.projectSource.type})});t&&(s.selectedTemplate=t,s.changeTemplate())}s.primaryEndpointConfigurations=s.primaryEndpointConfigurations.concat(e)}),r.listAuthorityEndpointConfigurations(e).then(function(e){return s.authorities=s.authorities.concat(e)}),r.listArchiveEndpointConfigurations(e).then(function(e){return s.archives=s.archives.concat(e)}),r.listSchemas(e).then(function(e){return s.schemas=s.schemas.concat(e)})})}return t.prototype.saveAndOpen=function(){var e=this;this.project.authorityEndpoints=this.authorities.filter(function(t){return e.selectedAuthorities[t.id]}),this.project.archiveEndpoints=this.archives.filter(function(t){return e.selectedArchives[t.id]}),this.project.schemas=this.schemas.filter(function(t){return e.selectedSchemas[t.id]}),this.projectService.saveCitable(this.projectSource.updateEndpoint,this.projectSource.graphStoreEndpoint,this.project).then(function(){return e.$state.go("construct",{id:e.project.id,sparqlEndpoint:e.project.source.sparqlEndpoint,graph:e.project.source.graph})})},t.prototype.delete=function(){var e=this;this.projectService.deleteCitable(this.projectSource.updateEndpoint,this.project).then(function(){return e.$state.go("projects")})},t.prototype.changeTemplate=function(){this.project&&this.selectedTemplate.copyToProject(this.project)},t}();angular.module("fibra").controller("ConfigureViewComponentController",["$q","projectService","fibraService","sparqlTreeService","$stateParams","$state",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.ConfigureViewComponentController=t;var r=function(){function e(){this.controller="ConfigureViewComponentController",this.templateUrl="components/configure-view/configure-view.html"}return e}();angular.module("fibra").component("configureView",new r),e.ConfigureViewComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=(function(){function e(e,t){this.endpoint=e,this.queryTemplate=t}return e}(),function(){function t(t,r,n,o,i,a,s,c){var l=this;this.sparqlTreeService=t,this.sparqlItemService=r,this.socialAuthService=n,this.$localStorage=o,this.$sessionStorage=i,this.projectService=a,this.fibraService=s,this.$q=c,this.types=[],this.paletteDisplay=!1,this.limitFilter="";var p=a.getCurrentProject();this.currentProjectSource=a.getProjectSources().find(function(e){return e.sparqlEndpoint===p.source.sparqlEndpoint&&e.graph===p.source.graph}),s.on("change",function(){var e=s.getState().construct.displayTypes;return l.limitFilter="",e.forEach(function(e){e&&(l.limitFilter+="<"+e.id+">,")}),0!==l.limitFilter.length&&(l.limitFilter="FILTER (?groupId IN ("+l.limitFilter.substring(0,l.limitFilter.length-1)+"))"),l.$q.resolve("ok")}),this.classTreePromise=t.getTree(this.fibraService.getState().project.endpoint,this.fibraService.getState().project.treeQuery),this.classTreePromise.then(function(e){l.classTree=e,l.fibraService.dispatchAction(l.fibraService.clearTypes()),l.types=l.fibraService.getState().construct.types;var t=function(e){return l.fibraService.dispatchAction(l.fibraService.addType(e))};l.traverseClassTree(e,function(e){return l.types.indexOf(e)===-1&&0===e.children.length},function(e){return t(e)})}),this.fibraService.on("change",function(){return l.classTreePromise=t.getTree(l.fibraService.getState().project.endpoint,e.SparqlTreeService.getClassTreeQuery),l.classTreePromise.then(function(e){return l.classTree=e,"ok"})}),this.fibraService.on("action",function(){return l.state=s.getState(),l.$q.resolve("ok")}),this.state=s.getState()}return t.prototype.createItem=function(e){var t=e.additionalInformation.type[0]?e.additionalInformation.type[0].value:"",r=this.types.filter(function(e){return e.id===t})[0],n=this.fibraService.getState().construct.displayTypes;if(!n[0]&&r)this.fibraService.dispatchAction(this.fibraService.setOrderedTypes([r]));else if(!n[1]&&r&&n[0]!==r){var o=n.concat([]);o.push(r),this.fibraService.dispatchAction(this.fibraService.setOrderedTypes(o))}return this.fibraService.dispatchAction(this.fibraService.displayItem(e.ids[0]))},t.prototype.downloadRDF=function(){var e=this.fibraService.getState().project.graph,t="http://ldf.fi/fibra/sparql?graph="+e,r=new XMLHttpRequest;r.open("GET",t,!0),r.onload=function(e){if(4===r.readyState)if(200===r.status){var t=r.responseText,n=document.createElement("a");n.href="data:application/rdf+xml;charset=utf-8,"+t,n.download="fibra.ttl",document.body.appendChild(n),n.click(),document.body.removeChild(n)}else console.error(r.statusText)},r.send(null)},t.prototype.traverseClassTree=function(e,t,r){var n=function(e){t(e)&&(r(e),e.children.forEach(n))};e.forEach(n)},t}());angular.module("fibra").controller("ConstructViewComponentController",["sparqlTreeService","sparqlItemService","socialAuthService","$localStorage","$sessionStorage","projectService","fibraService","$q",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.ConstructViewComponentController=t;var r=function(){function e(){this.controller="ConstructViewComponentController",this.templateUrl="components/construct-view/construct-view.html"}return e}();angular.module("fibra").component("constructView",new r),e.ConstructViewComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function t(t,r,n,o,i,a,s,c){var l=this;this.$element=t,this.$compile=r,this.$window=n,this.$scope=o,this.$timeout=i,this.sparqlItemService=a,this.fibraService=s,this.$q=c,this.primaryItems=[],this.secondaryItems=[],this.tertiaryItems=[],this.untypedItems=[],this.removedUntypedItems=[],this.allItems=[],this.radius=8,this.gridOffset=50,this.chargeForce=d3.forceCollide(this.gridOffset/1.5),this.chargeForce2=d3.forceCollide(this.gridOffset/1.5),this.svgBackgroundColor="#EEE",this.lastClickX=0,this.lastClickY=0,this.verifyItem=null,this.sunburst=new e.Sunburst(t,r,o,a,s),this.propertyPopover=new e.PropertyPopover(t,o,s,r),this.fibraService.on("change",function(){return l.verifyItem=l.fibraService.getState().construct.verifyItem,l.queryAndBuild()}),this.itemService=a,this.links=[],this.$scope.layout={choice:"force",links:"hide"},this.$scope.$watch("layout.choice",this.updateExplore.bind(this,!1)),this.$scope.$watch("layout.links",this.updateExplore.bind(this,!1))}return t.prototype.$onChanges=function(e){this.svgSel&&this.updateExplore(!1,!1)},t.prototype.$postLink=function(){var e=this;this.svgSel=d3.select(this.$element[0]).select("svg"),this.svgSel.append("rect").classed("background",!0).style("fill",this.svgBackgroundColor).on("click",function(){e.lastClickX=d3.event.offsetX,e.lastClickY=d3.event.offsetY,e.fibraService.dispatchAction(e.fibraService.createDisplayItem())}),this.svgSel.append("g").attr("class","links"),this.sunburst.addSunburstGroup(this.svgSel),this.forceSim=d3.forceSimulation().force("charge",this.chargeForce).force("charge2",this.chargeForce2).force("link",d3.forceLink().id(function(e){return""+e.index})),this.radius=8,this.tooltip=d3.select("body").append("div").style("position","absolute").style("z-index","20").style("background-color","gray").style("color","white").style("padding","3px").style("border-radius","2px").style("visibility","hidden"),this.edittip=d3.select("body").append("div").attr("id","edittip").style("position","absolute").style("z-index","40").style("background-color","white").style("color","gray").style("border","1px solid gray").style("padding","3px").style("border-radius","2px").style("visibility","hidden"),this.updateSizing(),this.queryAndBuild()},t.prototype.queryAndBuild=function(){var t=this,r=this.sparqlItemService.getItems(this.fibraService.getState().construct.items,!1).then(function(r){console.log("Items in explore",r),t.propertyPopover.hidePopover(),t.lockExisting(t.primaryItems),t.lockExisting(t.secondaryItems),t.lockExisting(t.tertiaryItems);var n=t.fibraService.getState().construct.displayTypes,o=t.filterItemsByType(r,e.OWL.Thing.value);if(t.removedUntypedItems=t.untypedItems.filter(function(e){return o.indexOf(e)===-1}),t.untypedItems=t.mergeNodes(t.untypedItems,t.filterItemsByType(r,e.OWL.Thing.value)),n[0]&&(t.primaryItems=t.mergeNodes(t.primaryItems,t.filterItemsByType(r,n[0].id))),n[1]&&(t.secondaryItems=t.mergeNodes(t.secondaryItems,t.filterItemsByType(r,n[1].id))),n[2]&&(t.tertiaryItems=t.mergeNodes(t.tertiaryItems,t.filterItemsByType(r,n[2].id))),t.allItems=t.primaryItems.concat(t.secondaryItems).concat(t.tertiaryItems).concat(t.untypedItems),t.properties=[],t.primaryItems[0]&&t.primaryItems[0].localProperties)for(var i=0,a=t.primaryItems[0].localProperties;i<a.length;i++){var s=a[i];t.properties.push({key:s.toCanonical(),value:s.label})}return t.links=t.mergeLinks(t.links),console.log(t.links),"ok"}).then(function(){return t.updateExplore()});return this.fibraService.dispatchAction(this.fibraService.placeHolderAction(r)),r},t.prototype.lockExisting=function(e){e.forEach(function(e){e.fx=e.gx,e.fy=e.gy})},t.prototype.filterItemsByType=function(e,t){return e.filter(function(e){var r=e.localProperties.concat(e.remoteProperties).filter(function(e){return"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===e.value});return!!r[0]&&r[0].values.map(function(e){return e.value.value}).indexOf(t)!==-1})},t.prototype.updateSizing=function(){var e=window.innerWidth,t=window.innerHeight;this.exploreWidth=e,this.exploreHeight=t-36,d3.select(this.$element[0]).select("#explorecontainer").style("height",this.exploreHeight+"px"),d3.select(this.$element[0]).select("#exploretable").style("height",t-50+"px"),this.svgSel.style("width",e+"px").style("height",t-36+"px"),this.svgSel.select("rect.background").style("width",e+"px").style("height",t-36+"px");var r=+this.svgSel.style("width").replace("px",""),n=+this.svgSel.style("height").replace("px","");this.forceSim.force("center",d3.forceCenter(r/2,n/2)),this.forceSim.force("xposition",d3.forceX(r/2).strength(.01)),this.forceSim.force("yposition",d3.forceY(n/2).strength(.01))},t.prototype.appendNodes=function(t,r){var n=this;return t.append("g").attr("id",function(e,t){return"node-"+t+"-"+r}).attr("class","node").classed(r,!0).append("circle").classed("node-circle",!0).classed(r,!0).attr("id",function(e,t){return"node-circle-"+t+"-"+r}).attr("r",this.radius+"px").call(d3.drag().on("start",function(e,t){n.linkMode?n.dragline=n.svgSel.append("line").attr("class","dragLine"):(e.fx=e.x,e.fy=e.y)}).on("drag",function(e,t,r){n.linkMode?n.dragline.attr("x1",e.x).attr("y1",e.y).attr("x2",d3.event.x).attr("y2",d3.event.y):(d3.select(r[t]).classed("fixed",!0),e.x=d3.event.x,e.y=d3.event.y,d3.select(r[t]).classed("selected-circle")),n.updateExplore(!1,!1)}).on("end",function(t,r,o){if(n.linkMode){var i=+n.dragline.attr("x2"),a=+n.dragline.attr("y2"),s=!1;d3.selectAll(".node").each(function(r,o){Math.abs(i-r.x)<n.radius&&Math.abs(a-r.y)<n.radius&&(s=!0,n.fibraService.dispatchAction(n.fibraService.itemProperty(r,[new e.PropertyAndValue(e.SKOS.related,e.DataFactory.instance.nodeFromNode(t))],[])).then(function(e){return n.dragline.remove(),n.queryAndBuild(),e}))}),s||n.dragline.remove()}else d3.select(o[r]).classed("fixed")||(t.fx=void 0,t.fy=void 0)})).on("mouseover",function(e,t){n.highlightLinks(e,t),n.tooltip.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px").style("visibility","visible").text(e.label)}).on("mouseout",function(e,t){n.svgSel.selectAll("line").classed("relevant",!1),n.tooltip.style("visibility","hidden")}).on("click",function(e,t,r){n.forceSim.stop();var o=e.selected;n.svgSel.selectAll(".node").each(function(e){e.selected=!1}),e.selected=!o,n.updateExplore(!1),e.selected?n.svgSel.select("g.sunburst-overlay").datum(e).each(n.sunburst.buildSunburst.bind(n)).style("display","block"):n.svgSel.select(".sunburst-overlay").style("display","none"),n.highlightLinks(e,t)})},t.prototype.snapToGrid=function(e,t,r){void 0===r&&(r=!0);var n,o;return r?(n=Math.round(e/this.gridOffset)*this.gridOffset,o=Math.round(t/this.gridOffset)*this.gridOffset):(n=Math.round(e/this.gridOffset)*this.gridOffset-this.gridOffset/2,o=Math.round(t/this.gridOffset)*this.gridOffset-this.gridOffset/2),[n,o]},t.prototype.tickTransformNodes=function(e,t){var r=this;if(void 0===t&&(t=!0),e.attr("transform",function(e,n){var o=e.x,i=e.y;e.x<r.radius&&(o=r.radius),e.y<r.radius&&(i=r.radius);var a=[o,i],s=a[0],c=a[1];return"forcegrid"===r.$scope.layout.choice&&(l=r.snapToGrid(o,i,t),s=l[0],c=l[1]),e.gx=s,e.gy=c,"translate("+s+", "+c+")";var l}),e.filter(function(e){return e.selected}).node()){var n=this.sunburst.buildSunburst,o=this.svgSel,i=function(e,t,r){o.select("g.sunburst-overlay").datum(e).each(n.bind(this))};e.filter(function(e){return e.selected}).each(i.bind(this))}},t.prototype.genericTick=function(e,t,r,n,o){var i=this;void 0===o&&(o=!1);var a=e,s=t,c=r,l=n;o&&(a=a.transition(),s=s.transition(),c=c.transition(),l=l.transition()),this.tickTransformNodes(a,!0),this.tickTransformNodes(s,!1),this.tickTransformNodes(c,!1),this.svgSel.selectAll(".node-circle").classed("selected-circle",function(e){return e.selected}).attr("r",function(e){return i.radius+(e.selected?3:0)+"px"}).style("cursor",this.linkMode?"crosshair":"initial"),this.svgSel.selectAll(".node-circle").classed("labeled",function(e){return!!e.label}).classed("verified",function(e){return e.localProperties.filter(function(e){return"http://www.w3.org/2002/07/owl#sameAs"===e.value}).length>0}),l.attr("x1",function(e){return e.source.gx}).attr("y1",function(e){return e.source.gy}).attr("x2",function(e){return e.target.gx}).attr("y2",function(e){return e.target.gy})},t.prototype.updateExplore=function(e,t){var r=this;void 0===e&&(e=!0),void 0===t&&(t=!1);var n=this.svgSel.selectAll("circle.untyped").data(this.untypedItems,function(e){return e.value}),o=this.svgSel.selectAll("circle.primary").data(this.primaryItems,function(e){return e.value}),i=this.svgSel.selectAll("circle.secondary").data(this.secondaryItems,function(e){return e.value});o.exit().remove(),i.exit().remove(),n.exit().remove(),n.enter().each(function(e,t,n){e.fx=r.lastClickX,e.fy=r.lastClickY,e.gx=r.lastClickX,e.gy=r.lastClickY}).each(this.propertyPopover.addPopover.bind(this,this.$scope,this.fibraService.getState().construct.types,this.svgSel));var a=function(e){e.fx=r.fibraService.getState().construct.itemIndex[e.value].x,e.fy=r.fibraService.getState().construct.itemIndex[e.value].y,e.gx=r.fibraService.getState().construct.itemIndex[e.value].x,e.gx=r.fibraService.getState().construct.itemIndex[e.value].y;var t=r.removedUntypedItems.filter(function(t){return t.value===e.value})[0];t&&(e.fx=t.fx,e.fy=t.fy,e.gx=t.gx,e.gy=t.gy)};o.enter().each(a),i.enter().each(a),o=o.merge(this.appendNodes(o.enter(),"primary")),i=i.merge(this.appendNodes(i.enter(),"secondary")),n=n.merge(this.appendNodes(n.enter(),"untyped"));var s=this.svgSel.select("g.links").selectAll("line").data(this.links);s.exit().remove(),s=s.enter().append("line").attr("id",function(e,t){return"link-"+t}).on("mouseover",function(e,t){r.tooltip.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px").style("visibility","visible").text(e.property.label)}).on("mouseout",function(e,t){r.tooltip.style("visibility","hidden")}).merge(s).style("visibility","show"===this.$scope.layout.links?"visible":"hidden"),this.sunburst.addSunburstGroup(this.svgSel),this.forceSim.stop();var c=this.genericTick.bind(this,o,i,n,s,!1);this.forceSim.nodes(this.primaryItems.concat(this.secondaryItems).concat(this.untypedItems)).on("tick",c),this.forceSim.force("link").links(this.links);var l=this.forceSim.force("charge"),p=this.forceSim.force("charge2");this.forceSim.force("center"),this.forceSim.force("xposition"),this.forceSim.force("yposition");return l.initialize&&l.initialize(this.primaryItems),p.initialize&&p.initialize(this.secondaryItems),e?this.forceSim.alpha(1).restart():this.genericTick(o,i,n,s,t),this.$q.resolve("ok")},t.prototype.highlightLinks=function(e,t){d3.selectAll("line").classed("relevant",!1);for(var r=0;r<this.links.length;r++){var n=this.links[r].source,o=this.links[r].target;n.index!==t&&o.index!==t||d3.select("#link-"+r).classed("relevant",!0)}},t.prototype.mergeNodes=function(e,t){for(var r=[],n=0;n<e.length;n++)for(var o=0;o<t.length;o++)e[n].toCanonical()===t[o].toCanonical()&&(r.push(e[n]),e[n].label=t[o].label,e[n].localProperties=t[o].localProperties);for(var n=0;n<t.length;n++){for(var i=!1,o=0;o<r.length;o++)r[o].toCanonical()===t[n].toCanonical()&&(i=!0);i||r.push(t[n])}return r},t.prototype.mergeLinks=function(t){for(var r=[],n=this.primaryItems.concat(this.secondaryItems),o=new e.ENodeMap,i=0,a=n;i<a.length;i++){var s=a[i];o.set(s,s);var c=s.localProperties.filter(function(t){return e.OWL.sameAs.equals(t)})[0];if(c&&c.values)for(var l=0,p=c.values;l<p.length;l++){var u=p[l];o.set(u.value,s)}}for(var d=0,f=n;d<f.length;d++)for(var s=f[d],h=0,y=s.localProperties;h<y.length;h++)for(var g=y[h],v=0,m=g.values;v<m.length;v++){var b=m[v];o.has(b.value)&&s!==o.get(b.value)&&n.indexOf(o.get(b.value))!==-1&&r.push({source:s,target:o.get(b.value),property:g})}return r},t}();angular.module("fibra").controller("ExploreComponentController",["$element","$compile","$window","$scope","$timeout","sparqlItemService","fibraService","$q",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]);var r=function(){function e(){this.bindings={linkMode:"<"},this.controller="ExploreComponentController",this.templateUrl="components/construct-view/explore.html"}return e}();angular.module("fibra").component("explore",new r),e.ExploreComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function t(e,t){this.fibraService=e,this.sparqlItemService=t,this.primaryItems=[],this.secondaryItems=[],this.tableTypes=["primary","secondary"],this.primary={properties:[],items:[]},this.secondary={properties:[],items:[]},this.removedProperties=[],this.originalPropertiesMap={},this.fibraService=e}return t.prototype.$onChanges=function(e){this.primary.properties=[],this.secondary.properties=[],this.primary.items=this.primaryItems,this.secondary.items=this.secondaryItems,this.sortProperties(),console.log(this.primary.items),console.log(this.secondary.items),console.log(this.primary.properties),console.log(this.secondary.properties)},t.prototype.selectItem=function(t){this.editItem=t;var r=t.localProperties.map(function(t){var r=new e.PropertyToValues(t);return t.values.filter(function(e){return"Literal"===e.value.termType}).forEach(function(t){var n=e.DataFactory.instance.literal(t.value.value),o=new e.FullRichNodeFromNode(n,t.value.label,void 0,void 0,t.value.sourceEndpoints);r.values.push(new e.RichPropertyValue(o,t.properties))}),r}).filter(function(e){return e.values.length>0});this.originalPropertiesMap[t.value]=r},t.prototype.itemVerified=function(t){return!!t.localProperties.filter(function(t){return t.value===e.OWL.sameAs.value})[0]},t.prototype.saveItem=function(t){var r=this,n=t.localProperties.map(function(t){return t.values.filter(function(e){return"Literal"===e.value.termType}).map(function(r){return new e.PropertyAndValue(t,e.DataFactory.instance.literal(r.value.value))})}).reduce(function(e,t){return e.concat(t)},[]);this.fibraService.dispatchAction(this.fibraService.itemProperty(t,n,this.originalPropertiesMap[t.value].map(function(e){return e.toPropertyAndValues()}).reduce(function(e,t){return e.concat(t)},[]))).then(function(){r.fibraService.dispatch("change"),r.editItem=null})},t.prototype.hide=function(e){return this.fibraService.dispatchAction(this.fibraService.hideItem(e)).then(function(){return"ok"})},t.prototype.delete=function(e){return this.fibraService.dispatchAction(this.fibraService.deleteItem(e))},t.prototype.sortProperties=function(){var e=this;["primary","secondary"].forEach(function(t){for(var r=0;r<e[t].items.length;r++)for(var n=0;n<e[t].items[r].localProperties.length;n++){for(var o=!1,i=0;i<e.removedProperties.length;i++)e.removedProperties[i]==e[t].items[r].localProperties[n].value&&(o=!0);for(var i=0;i<e[t].properties.length;i++)e[t].properties[i]==e[t].items[r].localProperties[n].value&&(o=!0);o||e[t].properties.push(e[t].items[r].localProperties[n])}})},t.prototype.removeFromProperties=function(e){var t=this;["primary","secondary"].forEach(function(r){for(var n=0;n<t[r].properties.length;n++)t[r].properties[n]==e&&t[r].properties.splice(n,1)}),this.addToRemovedProperties(e)},t.prototype.addToRemovedProperties=function(e){this.removedProperties.push(e)},t.prototype.addFromRemovedProperties=function(e){for(var t=0;t<this.removedProperties.length;t++)this.removedProperties[t]==e&&this.removedProperties.splice(t,1);this.fibraService.dispatch("change")},t.prototype.verify=function(e){this.fibraService.dispatchAction(this.fibraService.verifyItem(e))},t.prototype.downloadcsv=function(){for(var e=this.primary.items,t="data:text/csv;charset=utf-8,",r=0;r<e.length;r++){for(var n=0;n<e[r].localProperties.length;n++)t+=e[r].localProperties[n].values[0].value+",";t+="\n"}var o=encodeURI(t);window.open(o)},t}();angular.module("fibra").controller("ExploreTableComponentController",["fibraService","sparqlItemService",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.ExploreTableComponentController=t;var r=function(){function e(){this.templateUrl="components/construct-view/explore-table-component/explore-table-component.html",this.controller="ExploreTableComponentController",this.bindings={primaryItems:"<",secondaryItems:"<"}}return e}();angular.module("fibra").component("exploreTable",new r),e.ExploreTableComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e){var t=this;this.fibraService=e,this.fibraService=e,this.types=function(){return t.fibraService.getState().construct.types.concat(t.fibraService.getState().construct.userTypes)},this.displayTypes=function(){return t.fibraService.getState().construct.displayTypes}}return e.prototype.primaryClick=function(e){var t=this.displayTypes().concat([]);t[0]=e,this.fibraService.dispatchAction(this.fibraService.setOrderedTypes(t)),this.fibraService.dispatch("change")},e.prototype.secondaryClick=function(e){var t=this.displayTypes().concat([]);t[1]=e,this.fibraService.dispatchAction(this.fibraService.setOrderedTypes(t)),this.fibraService.dispatch("change")},e.prototype.tertiaryClick=function(e){var t=this.displayTypes().concat([]);t[2]=e,this.fibraService.dispatchAction(this.fibraService.setOrderedTypes(t)),this.fibraService.dispatch("change")},e}();angular.module("fibra").controller("ExploreTypeComponentController",["fibraService",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.ExploreTypeComponentController=t;var r=function(){function e(){this.templateUrl="components/construct-view/explore-type-component/explore-type-component.html",this.controller="ExploreTypeComponentController"}return e}();angular.module("fibra").component("exploreType",new r),e.ExploreTypeComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function t(e,t,r){this.fibraService=e,this.$q=t,this.sparqlAutocompleteService=r,this.limitFilter="",this.queryString="",this.relevantTypes=[],this.fibraService=e,this.canceller=t.defer()}return t.prototype.$onChanges=function(e){this.node&&(this.queryString=this.node.label,this.node&&this.runQuery())},t.prototype.runQuery=function(){var t=this;this.canceller.resolve(),this.updateResults(new e.AutocompletionResults),this.queryRunning=!0,this.error=!1,this.limitFilter="",this.canceller=this.$q.defer();var r=this.node.localProperties.filter(function(e){return"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===e.value})[0];this.relevantTypes=r?r.values.map(function(e){return e.value}):[],this.relevantTypes.forEach(function(e){e&&(t.limitFilter+="<"+e.value+">,")}),0!==this.limitFilter.length&&(this.limitFilter="FILTER (?groupId IN ("+this.limitFilter.substring(0,this.limitFilter.length-1)+"))"),this.sparqlAutocompleteService.autocomplete(this.queryString,6,!0,this.limitFilter,this.canceller.promise).then(function(e){console.log("Results in verify: ",e),t.queryRunning=!1,t.updateResults(e)},function(){console.log("Error in verify"),t.queryRunning=!1,t.error=!0},function(e){console.log("Update in verify: ",e),e.error?t.error=!0:t.updateResults(e.results)})},t.prototype.updateResults=function(e){console.log(this.relevantTypes);var t=this.relevantTypes.map(function(e){return e.label});this.matchingResults=e.remoteResults.filter(function(e){return t.indexOf(e.label)!==-1}),console.log(this.matchingResults)},t.prototype.sourcesFromResult=function(e){return" (Sources: "+e.datasources.join(", ")+")"},
t.prototype.verify=function(t){var r=this,n=t.ids.map(function(t){return new e.PropertyAndValue(e.OWL.sameAs,t)});this.fibraService.dispatchAction(this.fibraService.itemProperty(this.node,n)).then(function(){r.clear()})},t.prototype.clear=function(){this.fibraService.dispatchAction(this.fibraService.verifyItem(null))},t}();angular.module("fibra").controller("ExploreVerifyComponentController",["fibraService","$q","sparqlAutocompleteService",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.ExploreVerifyComponentController=t;var r=function(){function e(){this.templateUrl="components/construct-view/explore-verify-component/explore-verify-component.html",this.controller="ExploreVerifyComponentController",this.bindings={node:"<"}}return e}();angular.module("fibra").component("exploreVerify",new r),e.ExploreVerifyComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function t(e,t,r,n,o,i,a){this.fibraService=e,this.$element=t,this.sparqlItemService=r,this.sparqlTreeService=n,this.$scope=o,this.$q=i,this.FileSaver=a,this.paletteSearchHeight=40,this.typeColorScale=d3.scaleOrdinal(d3.schemeCategory20c),this.labelFilter="",this.typeItemTree=d3.map(),o.loadCSV=this.loadCSV.bind(this),this.typeItemTree.set("",{label:"No type defined",items:[],expanded:!1}),this.query()}return t.prototype.query=function(){var e=this;return this.typeItemTreePromise=this.sparqlItemService.getAllItems().then(function(t){return e.mergeItems(e.items,t)})},t.prototype.$postLink=function(){var e=this;this.divSel=d3.select(this.$element[0]).select("div.palette"),this.nodeDrag=d3.select(this.$element[0]).select(".palette-node-drag"),this.nodeDrag.style("display","none"),this.nodeDrag.append("circle"),this.divSel.style("height","100%").style("width","100%"),this.tooltip=d3.select("body").append("div").style("position","absolute").style("z-index","20").style("background-color","gray").style("color","white").style("padding","3px").style("border-radius","2px").style("visibility","hidden");var t=function(){return e.query().then(e.build.bind(e)).then(function(){return"Done"})};this.fibraService.on("change",t),this.typeItemTreePromise.then(function(t){e.build.bind(e)(t)})},t.prototype.addItem=function(e,t){var r=this,n=e.typeValue,o=this.fibraService.getState().construct.types.filter(function(e){return e.id===n})[0],i=this.fibraService.getState().construct.displayTypes;if(!i[0]&&o)this.fibraService.dispatchAction(this.fibraService.setOrderedTypes([o]));else if(!i[1]&&o&&i[0]!==o){var a=i.concat([]);a.push(o),this.fibraService.dispatchAction(this.fibraService.setOrderedTypes(a))}return this.fibraService.dispatchAction(this.fibraService.displayItem(e,t)).then(function(e){return r.fibraService.dispatch("change"),e})},t.prototype.createItem=function(t){var r=this,n=e.DataFactory.instance.namedNode(t);this.fibraService.dispatchAction(this.fibraService.createItem(n)).then(function(){r.query().then(function(e){r.build.bind(r)(e)})})},t.prototype.uploadCSV=function(e){this.typeForCreation=e.key,$("#dataModelSelector").click()},t.prototype.downloadCSV=function(t){var r=new Blob([d3.csvFormat(t.value.items.map(function(t){return r={},r[e.SKOS.prefLabel.value]=t.localProperties.filter(function(t){return t.value===e.SKOS.prefLabel.value})[0].values[0].value,r.FibraId=t.value,r;var r}),[e.SKOS.prefLabel.value,"FibraId"])],{type:"application/csv;charset=utf-8"}),n=t.value.label+".csv";this.FileSaver.saveAs(r,n)},t.prototype.loadCSV=function(t){var r=this,n=new FileReader;n.onload=function(){var t=d3.csvParse(n.result),o=t.filter(function(e){return!e.FibraId}),i=t.columns[0],a=[o.length>0?r.fibraService.dispatchAction(r.fibraService.createItems(o.map(function(t){console.log(t);var r=e.DataFactory.instance.namedNode(t[i]);return r}),r.typeForCreation)):r.$q.resolve(r.fibraService.getState()),r.$q.all(t.filter(function(e){return!!e.FibraId}).map(function(t){t.Match&&!t[e.OWL.sameAs.value]&&(t[e.OWL.sameAs.value]=t.Match,delete t.Match);var n=d3.entries(t),o=n.filter(function(t){return"FibraId"!==t.key&&t.value&&t.key!==e.OWL.sameAs.value&&"Notes"!==t.key&&"Match"!==t.key}).map(function(t){return new e.PropertyAndValue(e.DataFactory.instance.namedNode(t.key),0===t.value.indexOf("http://")?e.DataFactory.instance.namedNode(t.value):e.DataFactory.instance.literal(t.value))});return n.filter(function(t){return t.key===e.OWL.sameAs.value&&t.value}).forEach(function(t){return o.push(new e.PropertyAndValue(e.OWL.sameAs,e.DataFactory.instance.namedNode(t.value)))}),console.log(o),r.fibraService.dispatchAction(r.fibraService.itemProperty(new e.NamedNode(t.FibraId),o))})).then(function(e){return e[e.length-1]})];r.$q.all(a).then(function(){r.query().then(function(e){r.build.bind(r)(e)})})},n.readAsText(t.files[0]),t.value=null},t.prototype.build=function(e){var t=this;this.updateSizing();var r=e.entries().filter(function(e){return""!==e.key}),n=r.reduce(function(e,t){return e.concat(t.value.items)},[]),o=n.length>300?n.length>2e3?1:2:4,i=this.paletteHeight-25*r.length,a=(Math.sqrt(this.paletteWidth*i/n.length)-o)/2,s=a>8?8:a,c=2*s+o/2,l=2*s+o/2,p=Math.floor(this.paletteWidth/c)-1,u=this.nodeDrag,d=this.addItem.bind(this);this.paletteWidth;this.types=this.divSel.selectAll("div.type").data(r,function(e){return e.key}),this.types.exit().remove();var f=this.types.enter().append("div").classed("type",!0).classed("inverse-icon",!0).text(function(e){return e.value.label});f.append("span").classed("glyphicon",!0).classed("glyphicon-download",!0).on("click",function(e){return t.downloadCSV(e)}),f.append("span").classed("glyphicon",!0).classed("glyphicon-upload",!0).on("click",this.uploadCSV.bind(this)),f.append("span").classed("glyphicon",!0).classed("expand-button",!0).on("click",function(e){e.value.expanded=!e.value.expanded,t.typeItemTreePromise.then(t.build.bind(t))}),f.append("svg").attr("width","100%"),this.types=f.merge(this.types),this.types.selectAll(".expand-button").classed("glyphicon-resize-small",function(e){return e.value.expanded}).classed("glyphicon-resize-full",function(e){return!e.value.expanded}),this.types.selectAll("svg").style("display",function(e){return e.value.expanded?"block":"none"});var h=this.types.select("svg").attr("height",function(e){return(Math.ceil(e.value.items.length/p)+1)*l});this.circles=h.selectAll("circle.item").data(function(e){return e.value.items},function(e){return e.value}),this.circles.exit().remove(),this.circles=this.circles.enter().append("circle").classed("item",!0).attr("r",s).on("mouseover",function(e,r){t.tooltip.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px").style("visibility","visible").text(e.label+" ("+e.typeLabel+")")}).on("mouseout",function(e,r){t.tooltip.style("visibility","hidden")}).call(d3.drag().on("start",function(e){var t=d3.select(this);u.style("display","block"),u.select("circle").classed("item",t.classed("item")).attr("r",t.attr("r")).attr("fill",t.attr("fill")).attr("transform","translate(8,8)"),u.style("left",d3.event.sourceEvent.clientX-8).style("top",d3.event.sourceEvent.clientY-8)}).on("drag",function(e){u.style("left",d3.event.sourceEvent.clientX-8).style("top",d3.event.sourceEvent.clientY-8)}).on("end",function(e){var t=d3.select("#explorecontainer").node();d3.event.sourceEvent.clientX>t.getBoundingClientRect().left&&d3.event.sourceEvent.clientX<t.getBoundingClientRect().right&&d3.event.sourceEvent.clientY>t.getBoundingClientRect().top&&d3.event.sourceEvent.clientY<t.getBoundingClientRect().bottom?d(d3.select(this).datum(),[d3.event.sourceEvent.clientX-t.getBoundingClientRect().left,d3.event.sourceEvent.clientY-t.getBoundingClientRect().top]).then(function(){u.style("display","none")}):u.style("display","none")})).merge(this.circles).call(this.update.bind(this)),this.circles.transition().attr("fill",function(e){return t.typeColorScale(e.typeValue)}).attr("transform",function(e,t){return"translate("+(t%p+1)*c+","+(Math.floor(t/p)+1)*l+")"})},t.prototype.update=function(e){var t=this,r=e?e:this.circles;r.classed("displayed",function(e){return!!t.fibraService.getState().construct.itemIndex[e.value]}).classed("filtered",function(e){return t.labelFilter&&!(e.label.toUpperCase().indexOf(t.labelFilter.toUpperCase())!==-1)})},t.prototype.updateSizing=function(){this.paletteWidth=Math.round(.15*window.innerWidth),this.paletteHeight=Math.round(window.innerHeight)-this.paletteSearchHeight,this.divSel.style("height",this.paletteHeight+"px")},t.prototype.mergeItems=function(t,r){var n=this;return this.typeItemTree.values().forEach(function(e){e.items=[]}),r.forEach(function(t){var r=t.localProperties.filter(function(t){return t.value===e.RDF.type.value})[0];r&&r.values[0]?(t.typeValue=r.values[0].value.value,t.typeLabel=r.values[0].value.label,n.typeItemTree.has(t.typeValue)?n.typeItemTree.get(t.typeValue).items.push(t):n.typeItemTree.set(t.typeValue,{label:t.typeLabel,items:[t],expanded:!0})):(t.typeValue="",t.typeLabel="No type defined")}),this.typeItemTree.values().forEach(function(e){e.items.sort(function(e,t){return e.label===t.label?0:e.label>t.label?1:-1})}),this.typeItemTree},t}();angular.module("fibra").controller("PaletteComponentController",["fibraService","$element","sparqlItemService","sparqlTreeService","$scope","$q","FileSaver",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.PaletteComponentController=t;var r=function(){function e(){this.templateUrl="components/construct-view/palette-component/palette-component.html",this.controller="PaletteComponentController"}return e}();angular.module("fibra").component("palette",new r),e.PaletteComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e,t,r,n){this.$element=e,this.$scope=t,this.fibraService=r,this.$compile=n,this.propertyPopover=d3.select(e[0]).append("div").classed("property-popover",!0)}return e.prototype.addPopover=function(e,t,r,n,o,i){var a=d3.select(r.node().parentElement.parentElement).select("div.property-popover");a.select("property-popover").remove(),a.style("left",n.fx-3+"px").style("top",n.fy+12+"px");var s=e.$new(!0);s.node=n,s.types=t,s.close=function(){a.style("visibility","hidden")},console.log(s.close),a.node().appendChild(this.$compile('<property-popover node="node" types="types" close="close"></property-popover>')(s)[0]),a.style("visibility","visible")},e.prototype.hidePopover=function(){this.propertyPopover.style("visibility","hidden")},e}();e.PropertyPopover=t;var r=function(){function e(){this.bindings={types:"=",node:"=",close:"="},this.templateUrl="components/construct-view/property-popover-component.html",this.controller="PropertyPopoverComponentController"}return e}();angular.module("fibra").component("propertyPopover",new r),e.PropertyPopoverComponent=r;var n=function(){function t(t,r,n,o){var i=this;this.fibraService=t,this.sparqlItemService=r,this.$scope=n,this.$q=o,this.thingType=e.OWL.Thing.value,this.showTypeCreate=!1,this.typeQuery="",this.typeQueryGS=function(e){return void 0!==e&&(i.typeQuery=e),i.typeQuery},this.getTypes=function(){return i.fibraService.getState().construct.types.concat(i.fibraService.getState().construct.userTypes)}}return t.prototype.$postLink=function(){this.label=this.node.label;var e=this.node.localProperties.filter(function(e){return"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===e.value})[0].values[0].value.value;this.chosenType=this.types.filter(function(t){return t.id===e})[0],this.chosenType&&(this.typeQuery=this.chosenType.label)},t.prototype.typeCreate=function(e){var t=this;e&&!this.types.filter(function(t){return t.label===e})[0]&&this.fibraService.dispatchAction(this.fibraService.createType(e)).then(function(r){var n=r.construct.userTypes.filter(function(t){return t.label===e})[0];return n?t.typeChange(n):t.$q.resolve(r)})},t.prototype.typeEvaluate=function(e){console.log(e,this.getTypes()),e&&!this.getTypes().filter(function(t){return t.label===e})[0]?this.showTypeCreate=!0:this.showTypeCreate=!1},t.prototype.typeChange=function(t){var r=this;this.chosenType=t;var n=this.node.localProperties.filter(function(t){return t.value===e.RDF.type.value})[0],o=new e.NamedNode(t.id);return this.showTypeCreate=!1,this.fibraService.dispatchAction(this.fibraService.itemProperty(this.node,[new e.PropertyAndValue(e.RDF.type,o)],n.toPropertyAndValues())).then(function(e){var n=r.fibraService.getState().construct.displayTypes;if(!n[0]&&t)return r.fibraService.dispatchAction(r.fibraService.setOrderedTypes([t]));if(!n[1]&&t&&n[0]!==t){var o=n.concat([]);return o.push(t),r.fibraService.dispatchAction(r.fibraService.setOrderedTypes(o))}})},t.prototype.labelChange=function(){var t=this.node.localProperties.filter(function(t){return t.value===e.SKOS.prefLabel.value})[0];this.fibraService.dispatchAction(this.fibraService.itemProperty(this.node,[new e.PropertyAndValue(e.SKOS.prefLabel,e.DataFactory.instance.literal(this.label))],t.toPropertyAndValues()))},t.prototype.deleteAndClose=function(){var e=this;this.fibraService.dispatchAction(this.fibraService.deleteItem(this.node)).then(function(){e.fibraService.dispatch("change"),e.close()})},t.prototype.closePopover=function(){this.close(),this.fibraService.dispatch("change")},t}();angular.module("fibra").controller("PropertyPopoverComponentController",["fibraService","sparqlItemService","$scope","$q",function(){return new(Function.prototype.bind.apply(n,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.PropertyPopoverComponentController=n}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e,t,r,n,o){var i=this;this.$element=e,this.$compile=t,this.$scope=r,this.sparqlItemService=n,this.fibraService=o,this.sbRadius=200,this.lessRadius=this.sbRadius*this.sbRadius/3-144,this.sbArc=d3.arc().startAngle(function(e){return e.x0}).endAngle(function(e){return e.x1}).innerRadius(function(e){return Math.sqrt(e.y0-i.lessRadius)}).outerRadius(function(e){return Math.sqrt(e.y1-i.lessRadius)}),this.sbPart=d3.partition().size([2*Math.PI,this.sbRadius*this.sbRadius]),this.item_info_tip_displayed=!1,this.sbTooltip=d3.select("body").append("div").style("position","absolute").style("z-index","20").style("background-color","gray").style("color","white").style("padding","3px").style("border-radius","2px").style("visibility","hidden"),this.item_info_tip=d3.select("body").append("div").attr("id","item_info_tip").style("position","absolute").style("z-index","20").style("background-color","white").style("padding","3px").style("visibility","hidden"),this.buildSunburst=this.buildSunburst.bind(this)}return e.prototype.addSunburstGroup=function(e){var t=this;this.sel=e,this.sbGroup&&this.sbGroup.remove(),this.sbGroup=e.append("g").classed("sunburst-overlay",!0),this.sel.on("click",function(){t.item_info_tip_displayed&&(t.item_info_tip.style("visibility","hidden"),t.item_info_tip_displayed=!1)})},e.prototype.buildSunburst=function(e,t,r){var n=this;this.original_data=e,this.sbGroup.attr("transform",function(e){return"translate("+e.gx+","+e.gy+")"});var o=d3.hierarchy(e,function(e){return e.localProperties?e.localProperties.concat(e.remoteProperties):e.values?e.values.map(function(e){return e.value}):void 0});o.sum(function(e){return void 0===e.values&&void 0===e.localProperties?1:0});var i=(this.sbPart(o),this.sbGroup.selectAll("path").data(o.descendants(),function(e){return e.data}));i.exit().remove(),i.enter().filter(function(e){return e.depth>0}).append("path").classed("sunburst-cell",!0).on("mouseover",function(e,t){n.sbTooltip.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px").style("visibility","visible").text(2===e.depth?e.data.label+" (click to add)":e.data.label+" (click to add all children)")}).on("mouseout",function(){n.sbTooltip.style("visibility","hidden")}).on("click",function(e,t){2===e.depth?n.fibraService.dispatchAction(n.fibraService.displayItem(e.data)):n.fibraService.dispatchAction(n.fibraService.displayItems(e.children.map(function(e){return e.data}))),n.original_data.selected=!1,n.sbTooltip.style("visibility","hidden"),n.sbGroup.remove()}).merge(i).attr("d",this.sbArc).style("stroke","#fff")},e.prototype.selectItem=function(e){this.selectedItem=e},e}();e.Sunburst=t}(fibra||(fibra={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),fibra;!function(e){"use strict";var t=function(t){function r(r,n,o,i){var a=t.call(this,r.sourceId,o,i)||this;return r.id?o.loadPrimaryEndpointConfiguration(a.projectSource,r.id).then(function(e){return a.c=e}):(a.c=new e.PrimaryEndpointConfiguration,a.c.id=r.id,a.c.labels=[e.DataFactory.literal("",n.getState().language)],a.c.descriptions=[e.DataFactory.literal("",n.getState().language)]),a}return __extends(r,t),r.prototype.addCompatibleEndpoint=function(){this.c.compatibleEndpoints.push("")},r.prototype.removeCompatibleEndpoint=function(e){this.c.compatibleEndpoints.splice(e,1)},r}(e.EditCitableComponentController);angular.module("fibra").controller("EditPrimaryEndpointConfigurationViewComponentController",["$stateParams","fibraService","projectService","toastr",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.EditPrimaryEndpointConfigurationViewComponentController=t;var r=function(){function e(){this.controller="EditPrimaryEndpointConfigurationViewComponentController",this.templateUrl="components/edit-primary-endpoint-configuration-view/edit-primary-endpoint-configuration-view.html"}return e}();angular.module("fibra").component("editPrimaryEndpointConfigurationView",new r),e.EditPrimaryEndpointConfigurationViewComponent=r}(fibra||(fibra={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),fibra;!function(e){"use strict";var t=function(t){function r(r,n,o,i){var a=t.call(this,r.sourceId,o,i)||this;return r.id?o.loadRemoteEndpointConfiguration(a.projectSource,r.id).then(function(e){return a.c=e}):(a.c=new e.RemoteEndpointConfiguration,a.c.labels=[e.DataFactory.literal("",n.getState().language)],a.c.descriptions=[e.DataFactory.literal("",n.getState().language)]),a}return __extends(r,t),r}(e.EditCitableComponentController);angular.module("fibra").controller("EditRemoteEndpointConfigurationViewComponentController",["$stateParams","fibraService","projectService","toastr",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.EditRemoteEndpointConfigurationViewComponentController=t;var r=function(){function e(){this.controller="EditRemoteEndpointConfigurationViewComponentController",this.templateUrl="components/edit-remote-endpoint-configuration-view/edit-remote-endpoint-configuration-view.html"}return e}();angular.module("fibra").component("editRemoteEndpointConfigurationView",new r),e.EditRemoteEndpointConfigurationViewComponent=r}(fibra||(fibra={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),fibra;!function(e){"use strict";var t=function(t){function r(r,n,o,i){var a=t.call(this,r.sourceId,o,i)||this;return r.id?o.loadSchema(a.projectSource,r.id).then(function(e){return a.c=e}):(a.c=new e.Schema,a.c.labels=[e.DataFactory.literal("",n.getState().language)],a.c.descriptions=[e.DataFactory.literal("",n.getState().language)],a.c.endpoint=a.projectSource.sparqlEndpoint),a}return __extends(r,t),r}(e.EditCitableComponentController);angular.module("fibra").controller("EditSchemaViewComponentController",["$stateParams","fibraService","projectService","toastr",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.EditSchemaViewComponentController=t;var r=function(){function e(){this.controller="EditSchemaViewComponentController",this.templateUrl="components/edit-schema-view/edit-schema-view.html"}return e}();angular.module("fibra").component("editSchemaView",new r),e.EditSchemaViewComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";function t(e,t){var r="";for(var n in e)r=r+"@prefix "+n+": <"+e[n]+"> .\n";return t.values().forEach(function(e){return r=r+e.substring(0,e.length-2)+" .\n\n"}),r}function r(r){var n={},o=new e.Map;return r.toTurtle(o,n),t(n,o)}function n(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return o[255&e]+o[e>>8&255]+o[e>>16&255]+o[e>>24&255]+"-"+o[255&t]+o[t>>8&255]+"-"+o[t>>16&15|64]+o[t>>24&255]+"-"+o[63&r|128]+o[r>>8&255]+"-"+o[r>>16&255]+o[r>>24&255]+o[255&n]+o[n>>8&255]+o[n>>16&255]+o[n>>24&255]}e.toTurtle=t,e.citableToTurtle=r;for(var o=[],i=0;i<256;i++)o[i]=(i<16?"0":"")+i.toString(16);e.UUID=n}(fibra||(fibra={}));var fibra;!function(e){"use strict";function t(e,t){var r=null,n=null,o=e.find(function(e){return""===e.language?r=e.value:n=e.value,e.language===t});return o?o.value:r?r:n}e.getPrefLangString=t,angular.module("fibra").filter("prefLang",["fibraService",function(e){return function(r){return t(r,e.getState().language)}}])}(fibra||(fibra={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),fibra;!function(e){"use strict";var t=function(){function t(e){this.id=e,this.labels=[],this.descriptions=[],this.types=[]}return t.prototype.asNode=function(e){var t=this.asNodes[e];if(t)return t;if(t=this.asNodes[""])return t;for(var r in this.asNodes)return this.asNodes[r]},t.prototype.buildAsNodes=function(){var t=this;if(!this.asNodes){this.asNodes={};var r=new e.StringSet,n=new e.Map,o=new e.Map,i=new e.Map;this.labels.forEach(function(e){n.set(e.language,e.value),n.has("")||n.set("",e.value),r.add(e.language)}),this.descriptions.forEach(function(e){o.set(e.language,e.value),o.has("")||o.set("",e.value),r.add(e.language)}),this.types.forEach(function(t){t.buildAsNodes();var n=new e.Map;i.set(t.id.value,n),t.labels.forEach(function(e){n.set(e.language,e.value),n.has("")||n.set("",e.value),r.add(e.language)})}),r.each(function(r){var i=new e.FullRichNodeFromNode(t.id);i.label=n.get(r),i.label||(i.label=n.get("")),i.description=o.get(r),i.description||(i.description=o.get("")),i.types=t.types.map(function(e){return e.id===t.id?i:e.asNode(r)}),t.asNodes[r]=i})}},t}(),r=function(e){function t(t){var r=e.call(this,t)||this;return r.superClasses=[],r.subClasses=[],r.properties=[],r.inverseProperties=[],r}return __extends(t,e),t}(t);e.Class=r;var n=function(e){function t(t){var r=e.call(this,t)||this;return r.domains=[],r.ranges=[],r.superProperties=[],r.subProperties=[],r}return __extends(t,e),t}(t);e.Property=n;var o=function(){function t(){this.classMap=new e.Map,this.propertyMap=new e.Map,this.rootClasses=[],this.rootProperties=[]}return t.getFilter=function(e){return 0===e.length?"":"FILTER (?groupId IN ("+e.map(function(e){return e.toCanonical()}).join(", ")+"))"},t}();o.propertyQuery="PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX owl: <http://www.w3.org/2002/07/owl#>\nPREFIX sf: <http://ldf.fi/functions#>\nPREFIX dcterms: <http://purl.org/dc/terms/>\nPREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nSELECT ?id ?domains ?ranges ?labels ?descriptions ?types ?inverseProperty ?superProperties ?subProperties {\n  # STARTGRAPH\n    {\n      ?types rdfs:subClassOf* rdf:Property .\n      ?id a ?types .\n    }\n      {\n      ?id skos:prefLabel|rdfs:label ?labels .\n    } UNION {\n      ?id rdfs:comment|dcterms:description ?descriptions .\n    } UNION {\n      ?id owl:inverseOf ?inverseProperty .\n    } UNION {\n      ?id rdfs:domain ?domains .\n    } UNION {\n      ?id rdfs:range ?ranges .\n    } UNION {\n      ?id rdfs:subPropertyOf ?superProperties .\n    } UNION {\n      ?subProperties rdfs:subPropertyOf ?id .\n    }\n # ENDGRAPH\n}",o.classQuery="PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX owl: <http://www.w3.org/2002/07/owl#>\nPREFIX sf: <http://ldf.fi/functions#>\nPREFIX dcterms: <http://purl.org/dc/terms/>\nSELECT ?id ?types ?labels ?descriptions ?superClasses ?subClasses {\n  # STARTGRAPH\n    {\n      ?types rdfs:subClassOf* rdfs:Class .\n      ?id a ?types .\n    }\n    {\n      ?id skos:prefLabel|rdfs:label ?labels .\n    } UNION {\n      ?id rdfs:comment|dcterms:description ?descriptions .\n    } UNION {\n      ?id rdfs:subClassOf ?superClasses .\n    } UNION {\n      ?subClasses rdfs:subClassOf ?id .\n    }\n  # ENDGRAPH\n}",e.DataModel=o}(fibra||(fibra={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),fibra;!function(e){"use strict";var t=fi.seco.sparql.SparqlService,r=function(r){function n(){var t=null!==r&&r.apply(this,arguments)||this;return t.compatibleEndpoints=[],t.autocompletionQuery=e.SparqlAutocompleteService.defaultMatchQuery,t.itemQuery=e.SparqlItemService.getLocalItemPropertiesQuery,t.deleteItemQuery=e.SparqlItemService.deleteItemQuery,t.treeQuery=e.SparqlTreeService.getClassTreeQuery,t.classQuery=e.DataModel.classQuery,t.propertyQuery=e.DataModel.propertyQuery,t}return __extends(n,r),n.prototype.toTurtle=function(n,o){if(!n.has(this.id)){o.fibra=e.FIBRA.ns,n.set(this.id,"<"+this.id+"> a fibra:PrimaryEndpointConfiguration ;"),r.prototype.toTurtle.call(this,n,o);var i=n.get(this.id),a=this.compatibleEndpoints.filter(function(e){return e});0!==a.length&&(i+="\n  fibra:compatibleEndpoint ",a.forEach(function(e){return i+="<"+e+">, "}),i=i.substring(0,i.length-2)+" ;"),i+="\n  fibra:autocompletionQuery "+t.stringToSPARQLString(this.autocompletionQuery)+" ;\n  fibra:treeQuery "+t.stringToSPARQLString(this.treeQuery)+" ;\n  fibra:propertyQuery "+t.stringToSPARQLString(this.propertyQuery)+" ;\n  fibra:classQuery "+t.stringToSPARQLString(this.classQuery)+" ;\n  fibra:itemQuery "+t.stringToSPARQLString(this.itemQuery)+" ;\n  fibra:deleteItemQuery "+t.stringToSPARQLString(this.deleteItemQuery)+" .",n.set(this.id,i)}},n.prototype.copyToProject=function(e){var t=this.autocompletionQuery;t=e.graph?t.replace(/# STARTGRAPH/g,"GRAPH <"+e.graph+"> {").replace(/# ENDGRAPH/g,"}"):t.replace(/.*# STARTGRAPH\n/g,"").replace(/.*# ENDGRAPH\n/g,""),e.autocompletionQuery=t,t=this.itemQuery,t=e.graph?t.replace(/# STARTGRAPH/g,"GRAPH <"+e.graph+"> {").replace(/# ENDGRAPH/g,"}"):t.replace(/.*# STARTGRAPH\n/g,"").replace(/.*# ENDGRAPH\n/g,""),e.itemQuery=t,t=this.deleteItemQuery,t=e.graph?t.replace(/# STARTGRAPH/g,"GRAPH <"+e.graph+"> {").replace(/# ENDGRAPH/g,"}"):t.replace(/.*# STARTGRAPH\n/g,"").replace(/.*# ENDGRAPH\n/g,""),e.deleteItemQuery=t,t=this.treeQuery,t=e.graph?t.replace(/# STARTGRAPH/g,"GRAPH <"+e.graph+"> {").replace(/# ENDGRAPH/g,"}"):t.replace(/.*# STARTGRAPH\n/g,"").replace(/.*# ENDGRAPH\n/g,""),e.treeQuery=t,t=this.propertyQuery,t=e.graph?t.replace(/# STARTGRAPH/g,"GRAPH <"+e.graph+"> {").replace(/# ENDGRAPH/g,"}"):t.replace(/.*# STARTGRAPH\n/g,"").replace(/.*# ENDGRAPH\n/g,""),e.propertyQuery=t,t=this.classQuery,t=e.graph?t.replace(/# STARTGRAPH/g,"GRAPH <"+e.graph+"> {").replace(/# ENDGRAPH/g,"}"):t.replace(/.*# STARTGRAPH\n/g,"").replace(/.*# ENDGRAPH\n/g,""),e.classQuery=t},n}(e.Citable);r.listPrimaryEndpointConfigurationsQuery="PREFIX fibra: <http://hdlab.stanford.edu/fibra/ontology#>\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX dcterms: <http://purl.org/dc/terms/>\nPREFIX foaf: <http://xmlns.com/foaf/0.1/>\nPREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nSELECT ?id ?labels ?descriptions ?compatibleEndpoints ?rightsHolders ?rightsHolders_labels ?rightsHolders_descriptions ?rightsHolders_url ?rightsHolders_order ?url ?autocompletionQuery ?itemQuery ?deleteItemQuery ?treeQuery ?properyQuery ?classQuery {\n  # STARTGRAPH\n    ?id a fibra:PrimaryEndpointConfiguration .\n    { ?id skos:prefLabel ?labels }\n    UNION\n    { ?id dcterms:description ?descriptions }\n    UNION\n    { ?id fibra:compatibleEndpoint ?compatibleEndpoints }\n    UNION\n    {\n      ?id fibra:autocompletionQuery ?autocompletionQuery .\n      ?id fibra:itemQuery ?itemQuery .\n      ?id fibra:deleteItemQuery ?deleteItemQuery .\n      ?id fibra:treeQuery ?treeQuery .\n      ?id fibra:propertyQuery ?propertyQuery .\n      ?id fibra:classQuery ?classQuery .\n      OPTIONAL { ?id foaf:homepage ?url }\n    } UNION {\n      {\n        ?id dcterms:rightsHolder ?rightsHolders\n      } UNION {\n        ?id fibra:qualifiedAssertion ?qa .\n        ?qa rdf:predicate dcterms:rightsHolder .\n        ?qa rdf:object ?rightsHolders .\n        OPTIONAL { ?qa fibra:order ?rightsHolders_order }\n      }\n      {\n        ?rightsHolders skos:prefLabel ?rightsHolders_labels\n      } UNION {\n        ?rightsHolders foaf:homepage ?rightsHolders_url\n      } UNION {\n        ?rightsHolders dcterms:description ?rightsHolders_descriptions\n      }\n    }\n  # ENDGRAPH\n}",r.primaryEndpointConfigurationQuery="PREFIX fibra: <http://hdlab.stanford.edu/fibra/ontology#>\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX dcterms: <http://purl.org/dc/terms/>\nPREFIX foaf: <http://xmlns.com/foaf/0.1/>\nPREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nSELECT ?labels ?descriptions ?compatibleEndpoints ?rightsHolders ?rightsHolders_labels ?rightsHolders_descriptions ?rightsHolders_url ?rightsHolders_order ?url ?autocompletionQuery ?itemQuery ?deleteItemQuery ?treeQuery ?properyQuery ?classQuery {\n  # STARTGRAPH\n    { <ID> skos:prefLabel ?labels }\n    UNION\n    { <ID> dcterms:description ?descriptions }\n    UNION\n    { <ID> fibra:compatibleEndpoint ?compatibleEndpoints }\n    UNION\n    {\n      <ID> fibra:autocompletionQuery ?autocompletionQuery .\n      <ID> fibra:itemQuery ?itemQuery .\n      <ID> fibra:deleteItemQuery ?deleteItemQuery .\n      <ID> fibra:treeQuery ?treeQuery .\n      <ID> fibra:propertyQuery ?propertyQuery .\n      <ID> fibra:classQuery ?classQuery .\n      OPTIONAL { <ID> foaf:homepage ?url }\n    } UNION {\n      {\n        <ID> dcterms:rightsHolder ?rightsHolders\n      } UNION {\n        <ID> fibra:qualifiedAssertion ?qa .\n        <ID> rdf:predicate dcterms:rightsHolder .\n        <ID> rdf:object ?rightsHolders .\n        OPTIONAL { <ID> fibra:order ?rightsHolders_order }\n      }\n      {\n        ?rightsHolders skos:prefLabel ?rightsHolders_labels\n      } UNION {\n        ?rightsHolders foaf:homepage ?rightsHolders_url\n      } UNION {\n        ?rightsHolders dcterms:description ?rightsHolders_descriptions\n      }\n    }\n  # ENDGRAPH\n}",e.PrimaryEndpointConfiguration=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=fi.seco.sparql,r=function(){function t(e,t,r,n){this.workerService=e,this.fibraService=t,this.fibraSparqlService=r,this.$localStorage=n,
n.projectSources?n.projectSources.forEach(function(e){e.sparqlEndpoint||(e.sparqlEndpoint=e.endpoint,e.updateEndpoint=e.endpoint,e.graphStoreEndpoint=e.endpoint)}):n.projectSources=[]}return t.orderCitables=function(e){e.sort(function(e,t){return(e.order?e.order:Number.MAX_VALUE)-(t.order?t.order:Number.MAX_VALUE)}),e.forEach(function(e){return delete e.order})},t.prototype.getCurrentProject=function(){return this.fibraService.getState().project},t.prototype.setCurrentProject=function(e){return this.fibraService.dispatchAction(this.fibraService.setProject(e))},t.prototype.getProjectSources=function(){return this.$localStorage.projectSources},t.prototype.listPrimaryEndpointConfigurations=function(e){return this.workerService.call("projectWorkerService","listPrimaryEndpointConfigurations",[e])},t.prototype.loadPrimaryEndpointConfiguration=function(e,t){return this.workerService.call("projectWorkerService","loadPrimaryEndpointConfiguration",[e,t])},t.prototype.listArchiveEndpointConfigurations=function(e){return this.workerService.call("projectWorkerService","listArchiveEndpointConfigurations",[e])},t.prototype.listAuthorityEndpointConfigurations=function(e){return this.workerService.call("projectWorkerService","listAuthorityEndpointConfigurations",[e])},t.prototype.loadRemoteEndpointConfiguration=function(e,t){return this.workerService.call("projectWorkerService","loadRemoteEndpointConfiguration",[e,t])},t.prototype.listSchemas=function(e){return this.workerService.call("projectWorkerService","listSchemas",[e])},t.prototype.loadSchema=function(e,t){return this.workerService.call("projectWorkerService","loadSchema",[e,t])},t.prototype.listProjects=function(e){return this.workerService.call("projectWorkerService","listProjects",[e])},t.prototype.loadProject=function(e,t){return this.workerService.call("projectWorkerService","loadProject",[e,t])},t.prototype.deleteCitable=function(e,t){return this.deleteObject(e,t.id,t.source.graph)},t.prototype.deleteObjects=function(e,r,n){var o=n?t.deleteQuery.replace(/# STARTGRAPH/g,"GRAPH <"+n+"> {").replace(/# ENDGRAPH/g,"}"):t.deleteQuery.replace(/.*# STARTGRAPH\n/g,"").replace(/.*# ENDGRAPH\n/g,"");return o=o.replace(/# PATTERNS/g,r.reduce(function(e,t,r){return e+" <"+t+"> ?p"+r+" ?o"+r+" ."},"")),this.fibraSparqlService.update(e,o)},t.prototype.deleteObject=function(e,t,r){return this.deleteObjects(e,[t],r)},t.prototype.saveCitable=function(t,r,n){var o=this,i=new e.Map,a={};return n.toTurtle(i,a),this.deleteObjects(t,i.keys(),n.source.graph).then(function(){return o.fibraSparqlService.post(r,e.toTurtle(a,i),n.source.graph)})},t}();angular.module("fibra").service("projectService",["workerService","fibraService","fibraSparqlService","$localStorage",function(){return new(Function.prototype.bind.apply(r,[null].concat(Array.prototype.slice.apply(arguments))))}]),r.deleteQuery="DELETE {\n  # STARTGRAPH\n    # PATTERNS\n  # ENDGRAPH\n}\nWHERE {\n  # STARTGRAPH\n    # PATTERNS\n  # ENDGRAPH\n}",e.ProjectService=r;var n=function(){function n(e,t){this.fibraSparqlService=e,this.$q=t}return n.prototype.loadPrimaryEndpointConfiguration=function(t,r){return this.runSingleQuery(t,e.PrimaryEndpointConfiguration.primaryEndpointConfigurationQuery,r,new e.PrimaryEndpointConfiguration(r,t))},n.prototype.listPrimaryEndpointConfigurations=function(t){return this.runListQuery(t,e.PrimaryEndpointConfiguration.listPrimaryEndpointConfigurationsQuery,function(r){return new e.PrimaryEndpointConfiguration(r,t)})},n.prototype.loadRemoteEndpointConfiguration=function(t,r){return this.runSingleQuery(t,e.RemoteEndpointConfiguration.remoteEndpointConfigurationQuery,r,new e.RemoteEndpointConfiguration(r,t))},n.prototype.listArchiveEndpointConfigurations=function(t){return this.runListQuery(t,e.RemoteEndpointConfiguration.listArchiveEndpointConfigurationsQuery,function(r){return new e.RemoteEndpointConfiguration(r,t)})},n.prototype.listAuthorityEndpointConfigurations=function(t){return this.runListQuery(t,e.RemoteEndpointConfiguration.listAuthorityEndpointConfigurationsQuery,function(r){return new e.RemoteEndpointConfiguration(r,t)})},n.prototype.listProjects=function(t){return this.runListQuery(t,e.Project.listProjectsQuery,function(r){return new e.Project(r,t)})},n.prototype.listSchemas=function(t){return this.runListQuery(t,e.Schema.listSchemasQuery,function(r){return new e.Schema(r,t)})},n.prototype.loadSchema=function(t,r){return this.runSingleQuery(t,e.Schema.schemaQuery,r,new e.Schema(r,t))},n.prototype.loadDataModel=function(r){var n=this,o=new e.DataModel,i=new e.EMap(function(t){var r=new e.Class(e.DataFactory.namedNode(t));return o.classMap.set(t,r),r}),a=new e.EMap(function(t){var r=new e.Property(e.DataFactory.namedNode(t));return o.propertyMap.set(t,r),r}),s=[];return r.forEach(function(r){s.push(n.fibraSparqlService.query(r.endpoint,r.classQuery).then(function(r){var n={bindingTypes:{types:"uniqueArray"},bindingConverters:{superClasses:function(e){return i.goc(e.value)},subClasses:function(e){return i.goc(e.value)},types:function(e){return i.goc(e.value)},labels:function(t){return e.DataFactory.nodeFromBinding(t)},descriptions:function(t){return e.DataFactory.nodeFromBinding(t)}}},o=new t.UniqueObjectTracker;r.results.bindings.forEach(function(e){return t.SparqlService.bindingsToObject(e,i.goc(e.id.value),n,o)})})),s.push(n.fibraSparqlService.query(r.endpoint,r.propertyQuery).then(function(r){var n={bindingTypes:{types:"uniqueArray"},bindingConverters:{superProperties:function(e){return a.goc(e.value)},subProperties:function(e){return a.goc(e.value)},inverseProperty:function(e){return a.goc(e.value)},types:function(e){return i.goc(e.value)},domains:function(e){return i.goc(e.value)},ranges:function(e){return i.goc(e.value)},labels:function(t){return e.DataFactory.nodeFromBinding(t)},descriptions:function(t){return e.DataFactory.nodeFromBinding(t)}}},o=new t.UniqueObjectTracker;r.results.bindings.forEach(function(e){return t.SparqlService.bindingsToObject(e,a.goc(e.id.value),n,o)})}))}),this.$q.all(s).then(function(){return i.values().forEach(function(e){e.buildAsNodes(),e.superClasses.filter(function(t){return!t.subClasses.find(function(t){return t===e})}).forEach(function(t){return t.subClasses.push(e)}),e.subClasses.filter(function(t){return!t.superClasses.find(function(t){return t===e})}).forEach(function(t){return t.superClasses.push(e)})}),i.values().forEach(function(e){0===e.superClasses.length&&o.rootClasses.push(e)}),a.values().forEach(function(e){e.buildAsNodes(),e.inverseProperty&&(e.inverseProperty.inverseProperty=e),e.superProperties.filter(function(t){return!t.subProperties.find(function(t){return t===e})}).forEach(function(t){return t.subProperties.push(e)}),e.subProperties.filter(function(t){return!t.superProperties.find(function(t){return t===e})}).forEach(function(t){return t.superProperties.push(e)}),e.domains.forEach(function(t){return t.properties.push(e)}),e.ranges.forEach(function(t){return t.inverseProperties.push(e)})}),a.values().forEach(function(e){0===e.superProperties.length&&o.rootProperties.push(e)}),o})},n.prototype.loadProject=function(t,r){var n=this;return this.runSingleQuery(t,e.Project.projectQuery,r,new e.Project(r,t)).then(function(e){var t=[];t.push(n.$q.all(e.schemas.map(function(e){return n.loadSchema(e.source,e.id)})).then(function(t){return e.schemas=t,n.loadDataModel(t).then(function(t){return e.dataModel=t})}));var r=[],o=[];return e.archiveEndpoints.forEach(function(e){return t.push(n.loadRemoteEndpointConfiguration(e.source,e.id).then(function(e){return r.push(e)}))}),e.authorityEndpoints.forEach(function(e){return t.push(n.loadRemoteEndpointConfiguration(e.source,e.id).then(function(e){return o.push(e)}))}),n.$q.all(t).then(function(){return e.archiveEndpoints=r,e.authorityEndpoints=o,e})})},n.prototype.runSingleQuery=function(n,o,i,a){o=n.graph?o.replace(/# STARTGRAPH/g,"GRAPH <"+n.graph+"> {").replace(/# ENDGRAPH/g,"}"):o.replace(/.*# STARTGRAPH\n/g,"").replace(/.*# ENDGRAPH\n/g,""),o=o.replace(/<ID>/g,"<"+i+">");var s=this.$q.defer();return this.fibraSparqlService.query(n.sparqlEndpoint,o).then(function(o){var i={bindingTypes:{rightsHolders:"uniqueArray",schemas:"uniqueArray",authorityEndpoints:"uniqueArray",archiveEndpoints:"uniqueArray"},bindingConverters:{types:function(t){return e.DataFactory.nodeFromBinding(t)},labels:function(t){return e.DataFactory.nodeFromBinding(t)},descriptions:function(t){return e.DataFactory.nodeFromBinding(t)},schemas:function(t){return new e.Schema(t.value,e.CitableSource.clone(n))},authorityEndpoints:function(t){return new e.RemoteEndpointConfiguration(t.value,e.CitableSource.clone(n))},archiveEndpoints:function(t){return new e.RemoteEndpointConfiguration(t.value,e.CitableSource.clone(n))},rightsHolders_labels:function(t){return e.DataFactory.nodeFromBinding(t)},rightsHolders_descriptions:function(t){return e.DataFactory.nodeFromBinding(t)},rightsHolders:function(t){return new e.Citable(t.value,n)}}},c=new t.UniqueObjectTracker;o.results.bindings.forEach(function(e){return t.SparqlService.bindingsToObject(e,a,i,c)}),r.orderCitables(a.rightsHolders),s.resolve(a)}),s.promise},n.prototype.runListQuery=function(n,o,i){return o=n.graph?o.replace(/# STARTGRAPH/g,"GRAPH <"+n.graph+"> {").replace(/# ENDGRAPH/g,"}"):o.replace(/.*# STARTGRAPH\n/g,"").replace(/.*# ENDGRAPH\n/g,""),this.fibraSparqlService.query(n.sparqlEndpoint,o).then(function(o){var a=new e.EMap(i),s={bindingTypes:{rightsHolders:"uniqueArray",schemas:"uniqueArray",authorityEndpoints:"uniqueArray",archiveEndpoints:"uniqueArray"},bindingConverters:{types:function(t){return e.DataFactory.nodeFromBinding(t)},labels:function(t){return e.DataFactory.nodeFromBinding(t)},descriptions:function(t){return e.DataFactory.nodeFromBinding(t)},schemas:function(t){return new e.Schema(t.value,e.CitableSource.clone(n))},authorityEndpoints:function(t){return new e.RemoteEndpointConfiguration(t.value,e.CitableSource.clone(n))},archiveEndpoints:function(t){return new e.RemoteEndpointConfiguration(t.value,e.CitableSource.clone(n))},rightsHolders_labels:function(t){return e.DataFactory.nodeFromBinding(t)},rightsHolders_descriptions:function(t){return e.DataFactory.nodeFromBinding(t)},rightsHolders:function(t){return new e.Citable(t.value,n)}}},c=new t.UniqueObjectTracker;return o.results.bindings.forEach(function(e){return t.SparqlService.bindingsToObject(e,a.goc(e.id.value),s,c)}),a.values().forEach(function(e){return r.orderCitables(e.rightsHolders)}),a.values()})},n}();angular.module("fibra").service("projectWorkerService",["fibraSparqlService","$q",function(){return new(Function.prototype.bind.apply(n,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.ProjectWorkerService=n}(fibra||(fibra={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),fibra;!function(e){"use strict";var t=fi.seco.sparql.SparqlService,r=function(r){function n(){var t=null!==r&&r.apply(this,arguments)||this;return t.instanceNS="http://ldf.fi/fibra/",t.schemaNS="http://ldf.fi/fibra/schema#",t.dataModel=new e.DataModel,t.autocompletionQuery=e.SparqlAutocompleteService.defaultMatchQuery,t.treeQuery=e.SparqlTreeService.getClassTreeQuery,t.itemQuery=e.SparqlItemService.getLocalItemPropertiesQuery,t.deleteItemQuery=e.SparqlItemService.deleteItemQuery,t.classQuery=e.DataModel.classQuery,t.propertyQuery=e.DataModel.propertyQuery,t.authorityEndpoints=[],t.archiveEndpoints=[],t.schemas=[],t}return __extends(n,r),n.prototype.remoteEndpoints=function(){return this.archiveEndpoints.concat(this.authorityEndpoints)},n.prototype.asTemplate=function(){var t=new e.PrimaryEndpointConfiguration;return t.autocompletionQuery=this.autocompletionQuery,t.itemQuery=this.itemQuery,t.deleteItemQuery=this.deleteItemQuery,t.treeQuery=this.treeQuery,t.propertyQuery=this.propertyQuery,t.classQuery=this.classQuery,t},n.prototype.toTurtle=function(n,o){var i=this;if(!n.has(this.id)){o.fibra=e.FIBRA.ns,o.void=e.VOID.ns,n.set(this.id,"<"+this.id+"> a fibra:Project ;"),r.prototype.toTurtle.call(this,n,o);var a=n.get(this.id);this.schemas.length>0&&(a+="\n  fibra:schema ",this.schemas.forEach(function(e){a+="<"+e.id+">, "}),a=a.substring(0,a.length-2)+" ;",this.schemas.filter(function(e){return e.source.sparqlEndpoint!==i.source.sparqlEndpoint||i.source.graph!==e.source.graph}).forEach(function(e){a+="\n  fibra:schemaReference [\n    rdf:value <"+e.id+"> ;\n    void:sparqlEndpoint <"+e.source.sparqlEndpoint+"> ;",e.source.graph&&(a+="\n    fibra:graph <"+e.source.graph+">"),a+="\n  ] ;"})),this.authorityEndpoints.length>0&&(a+="\n  fibra:authorityEndpoint ",this.authorityEndpoints.forEach(function(e){a+="<"+e.id+">, "}),a=a.substring(0,a.length-2)+" ;",this.authorityEndpoints.filter(function(e){return e.source.sparqlEndpoint!==i.source.sparqlEndpoint||i.source.graph!==e.source.graph}).forEach(function(e){a+="\n  fibra:authorityEndpointReference [\n    rdf:value <"+e.id+"> ;\n    void:sparqlEndpoint <"+e.source.sparqlEndpoint+"> ;",e.source.graph&&(a+="\n    fibra:graph <"+e.source.graph+">"),a+="\n  ] ;"})),this.archiveEndpoints.length>0&&(a+="\n  fibra:archiveEndpoint ",this.archiveEndpoints.forEach(function(e){a+="<"+e.id+">, "}),a=a.substring(0,a.length-2)+" ;",this.archiveEndpoints.filter(function(e){return e.source.sparqlEndpoint!==i.source.sparqlEndpoint||i.source.graph!==e.source.graph}).forEach(function(e){a+="\n  fibra:archiveEndpointReference [\n    rdf:value <"+e.id+"> ;\n    void:sparqlEndpoint <"+e.source.sparqlEndpoint+"> ;",e.source.graph&&(a+="\n    fibra:graph <"+e.source.graph+">"),a+="\n  ] ;"})),this.graph&&(a+="\n  fibra:graph <"+this.graph+"> ;"),a+="\n  fibra:autocompletionQuery "+t.stringToSPARQLString(this.autocompletionQuery)+" ;\n  fibra:treeQuery "+t.stringToSPARQLString(this.treeQuery)+" ;\n  fibra:itemQuery "+t.stringToSPARQLString(this.itemQuery)+" ;\n  fibra:deleteItemQuery "+t.stringToSPARQLString(this.deleteItemQuery)+" ;\n  fibra:classQuery "+t.stringToSPARQLString(this.classQuery)+" ;\n  fibra:propertyQuery "+t.stringToSPARQLString(this.propertyQuery)+" ;\n  void:sparqlEndpoint <"+this.endpoint+"> ;\n  fibra:updateEndpoint <"+this.updateEndpoint+"> ;\n  fibra:graphStoreEndpoint <"+this.graphStoreEndpoint+"> ;\n  fibra:schemaNS "+t.stringToSPARQLString(this.schemaNS)+" ;\n  fibra:instanceNS "+t.stringToSPARQLString(this.instanceNS)+" .",n.set(this.id,a)}},n}(e.Citable);r.listProjectsQuery="PREFIX fibra: <http://hdlab.stanford.edu/fibra/ontology#>\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX dcterms: <http://purl.org/dc/terms/>\nPREFIX foaf: <http://xmlns.com/foaf/0.1/>\nPREFIX void: <http://rdfs.org/ns/void#>\nPREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nSELECT ?id ?labels ?descriptions ?url ?rightsHolders ?rightsHolders_labels ?rightsHolders_descriptions ?rightsHolder_surl ?rightsHolders_order ?instanceNS ?schemaNS ?endpoint ?graphStoreEndpoint ?updateEndpoint ?graph ?autocompletionQuery ?treeQuery ?itemQuery ?deleteItemQuery ?authorityEndpoints ?authorityEndpoints_source_graph ?authorityEndpoints_source_sparqlEndpoint ?archiveEndpoints ?archiveEndpoints_source_graph ?archiveEndpoints_source_sparqlEndpoint ?schemas ?schemas_source_graph ?schemas_source_sparqlEndpoint {\n  # STARTGRAPH\n    ?id a fibra:Project .\n    {\n      ?id skos:prefLabel ?labels\n    } UNION {\n      ?id fibra:instanceNS ?instanceNS .\n      ?id fibra:schemaNS ?schemaNS .\n      ?id void:sparqlEndpoint ?endpoint .\n      ?id fibra:updateEndpoint ?updateEndpoint .\n      ?id fibra:graphStoreEndpoint ?graphStoreEndpoint .\n      ?id fibra:autocompletionQuery ?autocompletionQuery .\n      ?id fibra:treeQuery ?treeQuery .\n      ?id fibra:itemQuery ?itemQuery .\n      ?id fibra:deleteItemQuery ?deleteItemQuery .\n      OPTIONAL { ?id fibra:graph ?graph }\n    } UNION {\n      ?id foaf:homepage ?url .\n    } UNION {\n      ?id fibra:schema ?schemas\n    } UNION {\n      ?id fibra:schemaReference ?ar .\n      ?ar rdf:value ?schemas .\n      ?ar void:sparqlEndpoint ?schemas_source_sparqlEndpoint .\n      OPTIONAL { ?ar fibra:graph ?schemas_source_graph }\n    } UNION {\n      ?id fibra:authorityEndpoint ?authorityEndpoints\n    } UNION {\n      ?id fibra:authorityEndpointReference ?ar .\n      ?ar rdf:value ?authorityEndpoints .\n      ?ar void:sparqlEndpoint ?authorityEndpoints_source_sparqlEndpoint .\n      OPTIONAL { ?ar fibra:graph ?authorityEndpoints_source_graph }\n    } UNION {\n      ?id fibra:archiveEndpoint ?archiveEndpoints\n    } UNION {\n      ?id fibra:archiveEndpointReference ?ar .\n      ?ar rdf:value ?archiveEndpoints .\n      ?ar void:sparqlEndpoint ?archiveEndpoints_source_sparqlEndpoint .\n      OPTIONAL { ?ar fibra:graph ?archiveEndpoints_source_graph }\n    } UNION {\n      ?id dcterms:description ?descriptions\n    } UNION {\n      {\n        ?id dcterms:rightsHolder ?rightsHolders\n      } UNION {\n        ?id fibra:qualifiedAssertion ?qa .\n        ?qa rdf:predicate dcterms:rightsHolder .\n        ?qa rdf:object ?rightsHolders .\n        OPTIONAL { ?qa fibra:order ?rightsHolders_order }\n      }\n      {\n        ?rightsHolders skos:prefLabel ?rightsHolders_labels\n      } UNION {\n        ?rightsHolders foaf:homepage ?rightsHolders_url\n      } UNION {\n        ?rightsHolders dcterms:description ?rightsHolders_descriptions\n      }\n    }\n  # ENDGRAPH\n}",r.projectQuery="PREFIX fibra: <http://hdlab.stanford.edu/fibra/ontology#>\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX dcterms: <http://purl.org/dc/terms/>\nPREFIX foaf: <http://xmlns.com/foaf/0.1/>\nPREFIX void: <http://rdfs.org/ns/void#>\nPREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nSELECT ?labels ?descriptions ?url ?rightsHolders ?rightsHolders_labels ?rightsHolders_descriptions ?rightsHolder_surl ?rightsHolders_order ?instanceNS ?schemaNS ?endpoint ?graphStoreEndpoint ?updateEndpoint ?graph ?autocompletionQuery ?treeQuery ?itemQuery ?deleteItemQuery ?authorityEndpoints ?authorityEndpoints_source_graph ?authorityEndpoints_source_sparqlEndpoint ?archiveEndpoints ?archiveEndpoints_source_graph ?archiveEndpoints_source_sparqlEndpoint ?schemas ?schemas_source_graph ?schemas_source_sparqlEndpoint {\n  # STARTGRAPH\n    {\n      <ID> skos:prefLabel ?labels\n    } UNION {\n      <ID> fibra:instanceNS ?instanceNS .\n      <ID> fibra:schemaNS ?schemaNS .\n      <ID> void:sparqlEndpoint ?endpoint .\n      <ID> fibra:updateEndpoint ?updateEndpoint .\n      <ID> fibra:graphStoreEndpoint ?graphStoreEndpoint .\n      <ID> fibra:autocompletionQuery ?autocompletionQuery .\n      <ID> fibra:treeQuery ?treeQuery .\n      <ID> fibra:itemQuery ?itemQuery .\n      <ID> fibra:deleteItemQuery ?deleteItemQuery .\n      OPTIONAL { <ID> fibra:graph ?graph }\n    } UNION {\n      <ID> foaf:homepage ?url .\n    } UNION {\n      <ID> fibra:schema ?schemas\n    } UNION {\n      <ID> fibra:schemaReference ?ar .\n      ?ar rdf:value ?schemas .\n      ?ar void:sparqlEndpoint ?schemas_source_sparqlEndpoint .\n      OPTIONAL { ?ar fibra:graph ?schemas_source_graph }\n    } UNION {\n      <ID> fibra:authorityEndpoint ?authorityEndpoints\n    } UNION {\n      <ID> fibra:authorityEndpointReference ?ar .\n      ?ar rdf:value ?authorityEndpoints .\n      ?ar void:sparqlEndpoint ?authorityEndpoints_source_sparqlEndpoint .\n      OPTIONAL { ?ar fibra:graph ?authorityEndpoints_source_graph }\n    } UNION {\n      <ID> fibra:archiveEndpoint ?archiveEndpoints\n    } UNION {\n      <ID> fibra:archiveEndpointReference ?ar .\n      ?ar rdf:value ?archiveEndpoints .\n      ?ar void:sparqlEndpoint ?archiveEndpoints_source_sparqlEndpoint .\n      OPTIONAL { ?ar fibra:graph ?archiveEndpoints_source_graph }\n    } UNION {\n      <ID> dcterms:description ?descriptions\n    } UNION {\n      {\n        <ID> dcterms:rightsHolder ?rightsHolders\n      } UNION {\n        <ID> fibra:qualifiedAssertion ?qa .\n        ?qa rdf:predicate dcterms:rightsHolder .\n        ?qa rdf:object ?rightsHolders .\n        OPTIONAL { ?qa fibra:order ?rightsHolders_order }\n      }\n      {\n        ?rightsHolders skos:prefLabel ?rightsHolders_labels\n      } UNION {\n        ?rightsHolders foaf:homepage ?rightsHolders_url\n      } UNION {\n        ?rightsHolders dcterms:description ?rightsHolders_descriptions\n      }\n    }\n  # ENDGRAPH\n}",e.Project=r}(fibra||(fibra={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),fibra;!function(e){"use strict";var t=fi.seco.sparql.SparqlService,r=function(r){function n(){var t=null!==r&&r.apply(this,arguments)||this;return t.types=[],t.autocompletionQuery=e.SparqlAutocompleteService.defaultMatchQuery,t.propertyQuery=e.DataModel.propertyQuery,t.classQuery=e.DataModel.classQuery,t.itemQuery=e.SparqlItemService.getRemoteItemPropertiesQuery,t.treeQuery=e.SparqlTreeService.getClassTreeQuery,t}return __extends(n,r),n.prototype.toTurtle=function(n,o){if(!n.has(this.id)){o.fibra=e.FIBRA.ns,o.void=e.VOID.ns,o.rdf=e.RDF.ns;var i="<"+this.id+"> a ";this.types.forEach(function(e){return i+=e.toCanonical()+" ,"}),i=i.substring(0,i.length-2)+" ;",n.set(this.id,i),r.prototype.toTurtle.call(this,n,o),i=n.get(this.id),i+="\n  void:sparqlEndpoint <"+this.endpoint+"> ;\n  fibra:autocompletionQuery "+t.stringToSPARQLString(this.autocompletionQuery)+" ;\n  fibra:itemQuery "+t.stringToSPARQLString(this.itemQuery)+" ;\n  fibra:treeQuery "+t.stringToSPARQLString(this.treeQuery)+" ;\n  fibra:propertyQuery "+t.stringToSPARQLString(this.propertyQuery)+" ;\n  fibra:classQuery "+t.stringToSPARQLString(this.classQuery)+" .",n.set(this.id,i)}},n}(e.Citable);r.listAuthorityEndpointConfigurationsQuery="PREFIX fibra: <http://hdlab.stanford.edu/fibra/ontology#>\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX dcterms: <http://purl.org/dc/terms/>\nPREFIX foaf: <http://xmlns.com/foaf/0.1/>\nPREFIX void: <http://rdfs.org/ns/void#>\nPREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nSELECT ?id ?types ?labels ?descriptions ?rightsHolders ?rightsHolders_labels ?rightsHolders_descriptions ?rightsHolders_url ?rightsHolders_order ?url ?endpoint ?autocompletionQuery ?itemQuery ?treeQuery ?propertyQuery ?classQuery {\n  # STARTGRAPH\n    ?id a fibra:AuthorityEndpointConfiguration .\n    ?id a ?types .\n    { ?id skos:prefLabel ?labels }\n    UNION\n    { ?id dcterms:description ?descriptions }\n    UNION\n    {\n      ?id void:sparqlEndpoint ?endpoint .\n      ?id fibra:autocompletionQuery ?autocompletionQuery .\n      ?id fibra:itemQuery ?itemQuery .\n      ?id fibra:treeQuery ?treeQuery .\n      ?id fibra:propertyQuery ?propertyQuery .\n      ?id fibra:classQuery ?classQuery .\n      OPTIONAL { ?id foaf:homepage ?url }\n    } UNION {\n      {\n        ?id dcterms:rightsHolder ?rightsHolders\n      } UNION {\n        ?id fibra:qualifiedAssertion ?qa .\n        ?qa rdf:predicate dcterms:rightsHolder .\n        ?qa rdf:object ?rightsHolders .\n        OPTIONAL { ?qa fibra:order ?rightsHolders_order }\n      }\n      {\n        ?rightsHolders skos:prefLabel ?rightsHolders_labels\n      } UNION {\n        ?rightsHolders foaf:homepage ?rightsHolders_url\n      } UNION {\n        ?rightsHolders dcterms:description ?rightsHolders_descriptions\n      }\n    }\n  # ENDGRAPH\n}",r.listArchiveEndpointConfigurationsQuery=r.listAuthorityEndpointConfigurationsQuery.replace(/fibra:AuthorityEndpointConfiguration/,"fibra:ArchiveEndpointConfiguration"),r.remoteEndpointConfigurationQuery="PREFIX fibra: <http://hdlab.stanford.edu/fibra/ontology#>\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX dcterms: <http://purl.org/dc/terms/>\nPREFIX foaf: <http://xmlns.com/foaf/0.1/>\nPREFIX void: <http://rdfs.org/ns/void#>\nPREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nSELECT ?types ?labels ?descriptions ?rightsHolders ?rightsHolders_labels ?rightsHolders_descriptions ?rightsHolders_url ?rightsHolders_order ?url ?endpoint ?autocompletionQuery ?itemQuery ?treeQuery ?propertyQuery ?classQuery {\n  # STARTGRAPH\n    { <ID> skos:prefLabel ?labels }\n    UNION\n    { <ID> dcterms:description ?descriptions }\n    UNION\n    {\n      <ID> a ?types .\n      <ID> void:sparqlEndpoint ?endpoint .\n      <ID> fibra:autocompletionQuery ?autocompletionQuery .\n      <ID> fibra:itemQuery ?itemQuery .\n      <ID> fibra:treeQuery ?treeQuery .\n      <ID> fibra:propertyQuery ?propertyQuery .\n      <ID> fibra:classQuery ?classQuery .\n      OPTIONAL { <ID> foaf:homepage ?url }\n    } UNION {\n      {\n        <ID> dcterms:rightsHolder ?rightsHolders\n      } UNION {\n        <ID> fibra:qualifiedAssertion ?qa .\n        ?qa rdf:predicate dcterms:rightsHolder .\n        ?qa rdf:object ?rightsHolders .\n        OPTIONAL { ?qa fibra:order ?rightsHolders_order }\n      }\n      {\n        ?rightsHolders skos:prefLabel ?rightsHolders_labels\n      } UNION {\n        ?rightsHolders foaf:homepage ?rightsHolders_url\n      } UNION {\n        ?rightsHolders dcterms:description ?rightsHolders_descriptions\n      }\n    }\n  # ENDGRAPH\n}",e.RemoteEndpointConfiguration=r}(fibra||(fibra={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),fibra;!function(e){"use strict";var t=fi.seco.sparql.SparqlService,r=function(r){function n(){var t=null!==r&&r.apply(this,arguments)||this;return t.classQuery=e.DataModel.classQuery,t.propertyQuery=e.DataModel.propertyQuery,t}return __extends(n,r),n.prototype.toTurtle=function(n,o){if(!n.has(this.id)){o.fibra=e.FIBRA.ns,o.void=e.VOID.ns,n.set(this.id,"<"+this.id+"> a fibra:Schema ;"),r.prototype.toTurtle.call(this,n,o);var i=n.get(this.id);i+="\n  void:sparqlEndpoint <"+this.endpoint+"> ;\n  fibra:classQuery "+t.stringToSPARQLString(this.classQuery)+" ;\n  fibra:propertyQuery "+t.stringToSPARQLString(this.propertyQuery)+" .",n.set(this.id,i)}},n}(e.Citable);r.listSchemasQuery="PREFIX fibra: <http://hdlab.stanford.edu/fibra/ontology#>\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX dcterms: <http://purl.org/dc/terms/>\nPREFIX foaf: <http://xmlns.com/foaf/0.1/>\nPREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nPREFIX void: <http://rdfs.org/ns/void#>\nSELECT ?id ?labels ?descriptions ?rightsHolders ?rightsHolders_labels ?rightsHolders_descriptions ?rightsHolders_url ?rightsHolders_order ?url ?endpoint ?classQuery ?propertyQuery {\n  # STARTGRAPH\n    ?id a fibra:Schema .\n    { ?id skos:prefLabel ?labels }\n    UNION\n    { ?id dcterms:description ?descriptions }\n    UNION\n    { ?id foaf:homepage ?url }\n    UNION\n    {\n      ?id void:sparqlEndpoint ?endpoint .\n      ?id fibra:classQuery ?classQuery .\n      ?id fibra:propertyQuery ?propertyQuery .\n    } UNION {\n      {\n        ?id dcterms:rightsHolder ?rightsHolders\n      } UNION {\n        ?id fibra:qualifiedAssertion ?qa .\n        ?qa rdf:predicate dcterms:rightsHolder .\n        ?qa rdf:object ?rightsHolders .\n        OPTIONAL { ?qa fibra:order ?rightsHolders_order }\n      }\n      {\n        ?rightsHolders skos:prefLabel ?rightsHolders_labels\n      } UNION {\n        ?rightsHolders foaf:homepage ?rightsHolders_url\n      } UNION {\n        ?rightsHolders dcterms:description ?rightsHolders_descriptions\n      }\n    }\n  # ENDGRAPH\n}",r.schemaQuery="PREFIX fibra: <http://hdlab.stanford.edu/fibra/ontology#>\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX dcterms: <http://purl.org/dc/terms/>\nPREFIX foaf: <http://xmlns.com/foaf/0.1/>\nPREFIX void: <http://rdfs.org/ns/void#>\nPREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nSELECT ?labels ?descriptions ?rightsHolders ?rightsHolders_labels ?rightsHolders_descriptions ?rightsHolders_url ?rightsHolders_order ?url ?endpoint ?classQuery ?propertyQuery {\n  # STARTGRAPH\n    { <ID> skos:prefLabel ?labels }\n    UNION\n    { <ID> dcterms:description ?descriptions }\n    UNION\n    {\n      <ID> void:sparqlEndpoint ?endpoint .\n      <ID> fibra:classQuery ?classQuery .\n      <ID> fibra:propertyQuery ?propertyQuery .\n    } UNION {\n      {\n        <ID> dcterms:rightsHolder ?rightsHolders\n      } UNION {\n        <ID> fibra:qualifiedAssertion ?qa .\n        ?qa rdf:predicate dcterms:rightsHolder .\n        ?qa rdf:object ?rightsHolders .\n        OPTIONAL { ?qa fibra:order ?rightsHolders_order }\n      }\n      {\n        ?rightsHolders skos:prefLabel ?rightsHolders_labels\n      } UNION {\n        ?rightsHolders foaf:homepage ?rightsHolders_url\n      } UNION {\n        ?rightsHolders dcterms:description ?rightsHolders_descriptions\n      }\n    }\n  # ENDGRAPH\n}\n",e.Schema=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e,t){var r=this;this.source=t.getProjectSources().find(function(t){return t.id===e.sourceId}),t.listProjects(this.source).then(function(e){return r.projects=e}),t.listSchemas(this.source).then(function(e){return r.schemas=e}),t.listPrimaryEndpointConfigurations(this.source).then(function(e){return r.primaryEndpointConfigurations=e}),t.listAuthorityEndpointConfigurations(this.source).then(function(e){return r.authorityEndpoints=e}),t.listArchiveEndpointConfigurations(this.source).then(function(e){return r.archiveEndpoints=e})}return e}();angular.module("fibra").controller("ProjectSourceConfigurationsViewComponentController",["$stateParams","projectService",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.ProjectSourceConfigurationsViewComponentController=t;var r=function(){function e(){this.controller="ProjectSourceConfigurationsViewComponentController",this.templateUrl="components/project-source-configurations-view/project-source-configurations-view.html"}return e}();angular.module("fibra").component("projectSourceConfigurationsView",new r),e.ProjectSourceConfigurationsViewComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e,t,n){this.$state=e,this.projectSources=n.getProjectSources(),t.sourceId&&t.sparqlEndpoint&&t.type&&(this.projectSources.push(new r(t.sourceId,t.sparqlEndpoint,t.updateEndpoint?t.updateEndpoint:t.sparqlEndpoint,t.graphStoreEndpoint?t.graphStoreEndpoint:t.sparqlEndpoint,t.graph?t.graph:"",t.type)),e.go("projects"))}return e.prototype.deleteProjectSource=function(e){this.projectSources.splice(e,1)},e.prototype.addNewProjectSource=function(){this.projectSources.push(new r("","","","","",""))},e}();angular.module("fibra").controller("ProjectSourcesViewComponentController",["$state","$stateParams","projectService",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.ProjectSourcesViewComponentController=t;var r=function(){function e(e,t,r,n,o,i){this.id=e,this.sparqlEndpoint=t,this.updateEndpoint=r,this.graphStoreEndpoint=n,this.graph=o,this.type=i}return e}();e.ProjectSourceInfo=r;var n=function(){function e(){this.controller="ProjectSourcesViewComponentController",this.templateUrl="components/project-sources-view/project-sources-view.html"}return e}();angular.module("fibra").component("projectSourcesView",new n),e.ProjectSourcesViewComponent=n}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function t(t,r,n){var o=this;this.projectService=t,this.projectSourceState={},
this.projects={},this.projectSources={};var i=n.projectSources;if(i&&0!==i.length||(i=[],i.push(new e.ProjectSourceInfo("Private projects in local browser storage","local:projects","local:projects","local:projects","","http://ldf.fi/fibra/rdfstoreJSEndpoint")),i.push(new e.ProjectSourceInfo("Projects in local Fuseki SPARQL server","http://localhost:3030/fibra/sparql","http://localhost:3030/fibra/update","http://localhost:3030/fibra/data","","http://ldf.fi/fibra/fusekiEndpoint")),i.push(new e.ProjectSourceInfo("Shared projects on the public LDF.fi endpoint","http://ldf.fi/fibra/sparql","http://ldf.fi/fibra/update","http://ldf.fi/fibra/data","http://ldf.fi/fibra/shared-projects/","http://ldf.fi/fibra/fusekiEndpointWithTextIndexAndSecoFunctions")),n.projectSources=i),r.isLoggedIn()&&!i.some(function(e){return"Personal projects on the public LDF.fi endpoint"===e.id})){var a=CryptoJS.SHA256(r.loginState());i.push(new e.ProjectSourceInfo("Personal projects on the public LDF.fi endpoint","http://ldf.fi/fibra/sparql","http://ldf.fi/fibra/sparql","http://ldf.fi/fibra/sparql","http://ldf.fi/fibra/user/"+a+"/projects/","http://ldf.fi/fibra/fusekiEndpointWithTextIndexAndSecoFunctions"))}i.forEach(function(e){o.projectSources[e.id]=e,o.projects[e.id]=[],o.projectSourceState[e.id]="loading",t.listProjects(e).then(function(t){o.projectSourceState[e.id]="ready",o.projects[e.id]=t},function(t){o.projectSourceState[e.id]="error",o.projects[e.id]=t})})}return t.prototype.deleteProject=function(e,t,r){this.projects[e].splice(t,1),this.projectService.deleteCitable(this.projectSources[e].updateEndpoint,r)},t}();angular.module("fibra").controller("ProjectsViewComponentController",["projectService","socialAuthService","$localStorage",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.ProjectsViewComponentController=t;var r=function(){function e(){this.controller="ProjectsViewComponentController",this.templateUrl="components/projects-view/projects-view.html"}return e}();angular.module("fibra").component("projectsView",new r),e.ProjectsViewComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e,t){this.fibraSparqlService=e,this.toastr=t,this.editorOptions={lineWrapping:!0,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,showTrailingSpace:!0,styleActiveLine:!0,syntaxErrorCheck:!0,highlightSelectionMatches:{showToken:/\w/},foldGutter:{rangeFinder:CodeMirror.fold.indent},gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"]}}return e.prototype.loadData=function(){var e=this;this.fibraSparqlService.put("local:test",this.data).then(function(t){e.toastr.success("success"),e.status="success",e.message=t},function(t){e.toastr.error("error"),e.status="error",e.message=t})},e.prototype.runQuery=function(){var e=this;this.fibraSparqlService.query("local:test",this.query).then(function(t){e.toastr.success("success"),e.message="",e.results=t},function(t){e.toastr.error("error"),e.results=t})},e}();angular.module("fibra").controller("RdfstoreTestViewComponentController",["fibraSparqlService","toastr",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.RdfstoreTestViewComponentController=t;var r=function(){function e(){this.controller="RdfstoreTestViewComponentController",this.templateUrl="components/rdfstore-test-view/rdfstore-test-view.html"}return e}();angular.module("fibra").component("rdfstoreTestView",new r),e.RdfstoreTestViewComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(){this.controller="CallbackController",this.template="<div>Please wait...</div>"}return e}();angular.module("fibra").component("callback",new t),e.CallbackComponent=t;var r=function(){function e(e,t,r,n,o){var i={code:r.code,state:e.redirectState?e.redirectState:"projects"};i.code||window.location.search.replace("?","").split("&").forEach(function(e){var t=e.split("=");i[t[0]]=t[1]}),e.requestTime?$.getJSON("https://fibra-auth-gateway.herokuapp.com/authenticate/"+i.code,function(t){o.$apply(function(r){$.get("https://api.github.com/user/emails?access_token="+t.token,function(r){o.$apply(function(o){var a=r.filter(function(e){return e.primary&&e.verified})[0];a&&a.email?(e.login_provider="Github",e.user_email=a.email,e.access_token=t.token,e.requestTime=null,n.location.href=n.location.origin+n.location.pathname+"#!/"+i.state):alert("Authentication failed")})})})}):n.location.href="http://localhost:3000/#!/?"+n.location.href.split("?")[1]}return e}();angular.module("fibra").controller("CallbackController",["$localStorage","$sessionStorage","$stateParams","$window","$scope",function(){return new(Function.prototype.bind.apply(r,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.CallbackController=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(){this.controller="LoginController",this.template='<button ng-click="login()">Login with Github</button>'}return e}();angular.module("fibra").component("login",new t),e.LoginComponent=t;var r=function(){function e(e,t,r,n,o){t.login=function(){r.redirectState=o.redirect_hash.replace("#/",""),r.requestTime=Date.now(),n.location.href="https://github.com/login/oauth/authorize?client_id=6a9ff845a1c35f43a0f2&scope=user:email"}}return e}();angular.module("fibra").controller("LoginController",["$urlService","$scope","$localStorage","$window","$stateParams",function(){return new(Function.prototype.bind.apply(r,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.LoginController=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e,t){this.$q=e,this.sparqlAutocompleteService=t,this.error=!1,this.hasMoreResults=!1,this.hide=!1,this.canceller=e.defer()}return e.prototype.onSelectInternal=function(e){this.onSelect(e),this.hide=!0},e.prototype.clear=function(){this.results=null,this.query="",this.currentLimit=parseInt(this.limit,10)},e.prototype.onChange=function(e){var t=this;this.canceller.resolve(),this.canceller=this.$q.defer(),this.queryRunning=!0,this.error=!1,this.sparqlAutocompleteService.autocomplete(e,this.currentLimit+1,void 0!==this.queryRemote,this.constraints,this.canceller.promise).then(function(e){t.queryRunning=!1},function(){t.queryRunning=!1,t.error=!0},function(e){e.error?t.error=!0:t.onResults(e.results)})},e.prototype.$onInit=function(){this.currentLimit=parseInt(this.limit,10)},e.prototype.onResults=function(e){this.results=e,this.results.localMatchingResults.length===this.currentLimit+1&&(this.results.localMatchingResults.splice(this.results.localMatchingResults.length-1,1),this.results.localNonMatchingResults=[],this.results.remoteResults=[])},e}();angular.module("fibra").controller("SparqlAutocompleteComponentController",["$q","sparqlAutocompleteService",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]);var r=function(){function e(){this.bindings={constraints:"<",limit:"@",onSelect:"&",queryRemote:"@"},this.controller="SparqlAutocompleteComponentController",this.templateUrl="components/sparql-autocomplete/sparql-autocomplete.html"}return e}();angular.module("fibra").component("sparqlAutocomplete",new r),e.SparqlAutocompleteComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=fi.seco.sparql,r=function(){function e(){this.localMatchingResults=[],this.localNonMatchingResults=[],this.remoteResults=[]}return e}();e.AutocompletionResults=r;var n=function(){function e(e){this.label=e,this.results=[]}return e}();e.ResultGroup=n;var o=function(){function e(e,t,r,n){this.ids=e,this.datasources=t,this.matchedLabel=r,this.prefLabel=n,this.additionalInformation={}}return e}();e.Result=o;var i=function(){function e(e){this.workerService=e}return e.prototype.autocomplete=function(e,t,r,n,o){return void 0===r&&(r=!1),void 0===n&&(n=""),this.workerService.call("sparqlAutocompleteWorkerService","autocomplete",[e,t,r,n],o)},e}();angular.module("fibra").service("sparqlAutocompleteService",["workerService",function(){return new(Function.prototype.bind.apply(i,[null].concat(Array.prototype.slice.apply(arguments))))}]),i.naiveMatchQueryTemplate='PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX mads: <http://www.loc.gov/mads/rdf/v1#>\nPREFIX owl: <http://www.w3.org/2002/07/owl#>\nPREFIX dcterms: <http://purl.org/dc/terms/>\nSELECT ?groupId ?id ?prefLabel ?matchedLabel ?sameAs ?altLabel { # ADDITIONALVARIABLES\n  GRAPH <GRAPH> {\n    {\n      SELECT ?groupId ?id {\n        {\n          ?id skos:prefLabel|rdfs:label|skos:altLabel|mads:authoritativeLabel|mads:variantLabel <QUERY> .\n        } UNION {\n          ?id skos:prefLabel|rdfs:label|skos:altLabel|mads:authoritativeLabel|mads:variantLabel <QUERY>@<PREFLANG> .\n        }\n        ?id a ?groupId .\n      }\n      GROUP BY ?groupId ?id\n      HAVING(BOUND(?id))\n      LIMIT <LIMIT>\n    }\n    ?id skos:prefLabel|rdfs:label|skos:altLabel|mads:authoritativeLabel|mads:variantLabel ?matchedLabel .\n    FILTER (REGEX(LCASE(?matchedLabel),CONCAT("\\\\b",LCASE(<QUERY>))))\n    BIND(COALESCE(?groupLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?groupId),".*/",""),".*#",""),"_"," "),"([A-Z])"," $1")) AS ?groupLabel)\n    {\n      ?id  rdfs:label|skos:prefLabel|mads:authoritativeLabel ?prefLabel .\n    } UNION {\n      ?id owl:sameAs ?sameAs .\n    } UNION {\n      ?id skos:altLabel|mads:variantLabel ?altLabel .\n    }\n    # ADDITIONALSELECT\n  }\n}',i.defaultMatchQuery='\nPREFIX text: <http://jena.apache.org/text#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX mads: <http://www.loc.gov/mads/rdf/v1#>\nPREFIX owl: <http://www.w3.org/2002/07/owl#>\nPREFIX sf: <http://ldf.fi/functions#>\nPREFIX fibra: <http://ldf.fi/fibra/schema#>\nPREFIX dcterms: <http://purl.org/dc/terms/>\nSELECT ?groupId ?id ?prefLabel ?matchedLabel ?sameAs ?altLabel { # ADDITIONALVARIABLES\n  # STARTGRAPH\n    {\n      SELECT ?groupId ?id (SUM(?sc) AS ?score) {\n        {\n          SELECT ?groupId ?id ?sc {\n            BIND(CONCAT("\\"",REPLACE(<QUERY>,"([\\\\+\\\\-\\\\&\\\\|\\\\!\\\\(\\\\)\\\\{\\\\}\\\\[\\\\]\\\\^\\\\\\"\\\\~\\\\*\\\\?\\\\:\\\\/\\\\\\\\])","\\\\$1"),"\\"") AS ?query)\n            (?id ?sc) text:query ?query .\n            ?id skos:prefLabel|rdfs:label|skos:altLabel|mads:authoritativeLabel|mads:variantLabel ?matchedLabel\n            FILTER (LCASE(?matchedLabel)=LCASE(<QUERY>))\n            ?id a ?groupIdLocal .\n            BIND(?groupIdLocal AS ?groupId)\n            # CONSTRAINTS\n          }\n          GROUP BY ?groupId ?id ?sc\n          LIMIT <LIMIT>\n        } UNION {\n          SELECT ?groupId ?id ?sc {\n            BIND(CONCAT(REPLACE(<QUERY>,"([\\\\+\\\\-\\\\&\\\\|\\\\!\\\\(\\\\)\\\\{\\\\}\\\\[\\\\]\\\\^\\\\\\"\\\\~\\\\*\\\\?\\\\:\\\\/\\\\\\\\])","\\\\$1"),"*") AS ?query)\n            (?id ?sc) text:query ?query .\n            ?id a ?groupIdLocal .\n            BIND(?groupIdLocal AS ?groupId)\n            # CONSTRAINTS\n          }\n          GROUP BY ?groupId ?id ?sc\n          LIMIT <LIMIT>\n        }\n      }\n      GROUP BY ?groupId ?id\n      HAVING(BOUND(?id))\n      LIMIT <LIMIT>\n    }\n    ?id skos:prefLabel|rdfs:label|skos:altLabel|mads:authoritativeLabel|mads:variantLabel ?matchedLabel\n    FILTER (REGEX(LCASE(?matchedLabel),CONCAT("\\\\b",LCASE(<QUERY>))))\n    {\n      ?id sf:preferredLanguageLiteral (skos:prefLabel mads:authoritativeLabel rdfs:label skos:altLabel mads:variantLabel \'<PREFLANG>\' \'\' ?prefLabel) .\n    } UNION {\n      ?id owl:sameAs ?sameAs .\n    } UNION {\n      ?id skos:altLabel|mads:variantLabel ?altLabel .\n    }\n    # ADDITIONALSELECT\n  # ENDGRAPH\n}\n',e.SparqlAutocompleteService=i;var a=function(){function t(){this.idToIdSet=new e.EMap(function(){return new e.StringSet}),this.idToGroupIdSet=new e.EMap(function(){return new e.StringSet}),this.ifpVarPlusValueToIdSet=new e.EMap(function(){return new e.EMap(function(){return new e.StringSet})}),this.idToPrefLabelSet=new e.EMap(function(){return new e.ONodeSet}),this.idToMatchedLabelSet=new e.EMap(function(){return new e.ONodeSet}),this.idToAltLabelSet=new e.EMap(function(){return new e.ONodeSet}),this.idToDatasourceSet=new e.EMap(function(){return new e.StringSet}),this.seen=new e.StringSet}return t}(),s=function(){function i(e,t,r){this.$q=e,this.fibraSparqlService=t,this.stateWorkerService=r}return i.processBindings=function(t,r,n){n.results.bindings.forEach(function(o){var i=o.id.value;t.idToIdSet.goc(i).add(i),t.idToDatasourceSet.goc(i).add(r),o.prefLabel&&t.idToPrefLabelSet.goc(i).add(e.DataFactory.instance.nodeFromBinding(o.prefLabel)),o.altLabel&&t.idToAltLabelSet.goc(i).add(e.DataFactory.instance.nodeFromBinding(o.altLabel)),o.matchedLabel&&t.idToMatchedLabelSet.goc(i).add(e.DataFactory.instance.nodeFromBinding(o.matchedLabel)),o.groupId&&(t.idToGroupIdSet.goc(i).add(o.groupId.value),o.groupLabel&&t.idToPrefLabelSet.goc(o.groupId.value).add(e.DataFactory.instance.nodeFromBinding(o.groupLabel))),o.sameAs&&(t.idToIdSet.get(i).add(o.sameAs.value),t.idToIdSet.goc(o.sameAs.value).add(i));for(var a=0,s=n.head.vars;a<s.length;a++){var c=s[a];0===c.indexOf("ifp")&&o[c]&&t.ifpVarPlusValueToIdSet.goc(c.substring(3)).goc(o[c].value).add(i)}})},i.buildResults=function(t,r){var i=[];return t.idToIdSet.each(function(a,s){var c=t.seen.has(s)||a.values().some(function(e){return t.seen.has(e)});if(!c){t.seen.adds(a);var l=new o(a.values().map(function(t){return e.DataFactory.instance.namedNode(t)}),t.idToDatasourceSet.get(s).values(),t.idToMatchedLabelSet.get(s).values()[0],t.idToPrefLabelSet.has(s)?t.idToPrefLabelSet.get(s).values()[0]:null);t.idToAltLabelSet.has(s)&&(l.additionalInformation.altLabel=t.idToAltLabelSet.get(s).values()),l.additionalInformation.type=t.idToGroupIdSet.get(s).values().map(function(t){return e.DataFactory.instance.namedNode(t)}),l.additionalInformation.typeLabel=t.idToGroupIdSet.get(s).values().map(function(e){return t.idToPrefLabelSet.has(s)?t.idToPrefLabelSet.get(s).values()[0]:null}),t.idToGroupIdSet.get(s).each(function(e){var o=r.get(e);!o&&t.idToPrefLabelSet.has(e)&&(o=new n(t.idToPrefLabelSet.get(e).values()[0].value),r.set(e,o),i.push(o)),o&&o.results.push(l)})}}),i},i.unifyResults=function(e){e.ifpVarPlusValueToIdSet.each(function(t){return t.each(function(t){return t.each(function(r){return e.idToIdSet.goc(r).adds(t)})})}),e.idToIdSet.each(function(t,r){return t.each(function(n){var o=e.idToIdSet.get(n);if(t!==o){e.idToIdSet.set(n,t),t.adds(o);var i=e.idToDatasourceSet.get(r),a=e.idToDatasourceSet.get(n);i?(a&&i.adds(a),e.idToDatasourceSet.set(n,i)):a&&e.idToDatasourceSet.set(r,a);var s=e.idToGroupIdSet.get(r),c=e.idToGroupIdSet.get(n);s?(c&&s.adds(c),e.idToGroupIdSet.set(n,s)):c&&e.idToGroupIdSet.set(r,c);var l=e.idToPrefLabelSet.get(r),p=e.idToPrefLabelSet.get(n);l?(p&&l.adds(p),e.idToPrefLabelSet.set(n,l)):p&&e.idToPrefLabelSet.set(r,p),l=e.idToMatchedLabelSet.get(r),p=e.idToMatchedLabelSet.get(n),l?(p&&l.adds(p),e.idToMatchedLabelSet.set(n,l)):p&&e.idToMatchedLabelSet.set(r,p),l=e.idToAltLabelSet.get(r),p=e.idToAltLabelSet.get(n),l?(p&&l.adds(p),e.idToAltLabelSet.set(n,l)):p&&e.idToAltLabelSet.set(r,p)}})})},i.prototype.autocomplete=function(n,o,s,c,l){var p=this;void 0===s&&(s=!1),void 0===c&&(c="");var u=this.$q.defer(),d=new r,f=this.stateWorkerService.state.project.autocompletionQuery;f=f.replace(/<QUERY>/g,t.SparqlService.stringToSPARQLString(n)),f=f.replace(/<LIMIT>/g,""+o),f=f.replace(/# CONSTRAINTS/g,c),f=f.replace(/<PREFLANG>/g,this.stateWorkerService.state.language);var h=new a,y=this.fibraSparqlService.query(this.stateWorkerService.state.project.endpoint,f,{timeout:l}).then(function(t){console.log(t),i.processBindings(h,p.stateWorkerService.state.project.endpoint,t),console.log(h),d.localMatchingResults=i.buildResults(h,new e.EMap),console.log(d.localMatchingResults),s?u.notify({endpointType:"primary",endpoint:p.stateWorkerService.state.project.id,results:d}):u.resolve(d)});if(s){var g=new e.EMap;this.$q.all(this.stateWorkerService.state.project.remoteEndpoints().map(function(r){return f=r.autocompletionQuery,f=f.replace(/<QUERY>/g,t.SparqlService.stringToSPARQLString(n)),f=f.replace(/<LIMIT>/g,""+o),f=f.replace(/<PREFLANG>/g,p.stateWorkerService.state.language),p.fibraSparqlService.query(r.endpoint,f,{timeout:l}).then(function(e){console.log(e),0!==e.results.bindings.length&&y.then(function(){i.processBindings(h,r.id,e),console.log(h),i.unifyResults(h),d.remoteResults=d.remoteResults.concat(i.buildResults(h,g)),console.log(d.remoteResults),u.notify({endpointType:"remote",endpoint:r.id,results:d})})},function(t){return u.notify({endpointType:"remote",endpoint:r.id,error:e.WorkerWorkerService.stripFunctions(t)})})})).then(function(){return u.resolve(d)})}return u.promise},i}();angular.module("fibra").service("sparqlAutocompleteWorkerService",["$q","fibraSparqlService","stateWorkerService",function(){return new(Function.prototype.bind.apply(s,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.SparqlAutocompleteWorkerService=s}(fibra||(fibra={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),fibra;!function(e){"use strict";var t=function(){function e(){}return e}(),r=function(e){function t(t,r){var n=e.call(this)||this;return n.sparqlItemService=t,n.fibraService=r,n.$onChanges=function(e){n.itemId&&n.sparqlItemService.getItem(n.itemId).then(function(e){return n.item=e})},n.addItem=function(){n.fibraService.dispatchAction(n.fibraService.displayItem(n.item))},n}return __extends(t,e),t}(t);angular.module("fibra").controller("SparqlItemComponentController",["sparqlItemService","fibraService",function(){return new(Function.prototype.bind.apply(r,[null].concat(Array.prototype.slice.apply(arguments))))}]);var n=function(){function e(){this.bindings={itemId:"<",onSelect:"&",showRemoteProperties:"@"},this.controller="SparqlItemComponentController",this.templateUrl="components/sparql-item/sparql-item.html"}return e}();angular.module("fibra").component("sparqlItem",new n),e.SparqlItemComponent=n}(fibra||(fibra={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),fibra;!function(e){"use strict";var t=function(){function t(e,t){this.property=e,this.object=t}return t.prototype.pruned=function(){return new t(new e.PrunedRichNodeFromNode(this.property),new e.PrunedRichNodeFromNode(this.object))},t}();e.PropertyAndValue=t;var r=function(){function e(e,t){void 0===t&&(t=[]),this.value=e,this.properties=t}return e}();e.RichPropertyValue=r;var n=function(t){function n(n){var o=t.call(this,n)||this;return o.values=n.values.map(function(t){return new r(new e.PrunedRichNodeFromNode(t.value))}),o}return __extends(n,t),n.prototype.toPropertyAndValues=function(){return o.toPropertyAndValues(this)},n.prototype.toTriples=function(e){return o.toTriples(e,this)},n.prototype.toQuads=function(e,t){return o.toQuads(e,this,t)},n.prototype.pruned=function(){return this},n}(e.PrunedRichNodeFromNode);e.PrunedPropertyValuesFromPropertyValues=n;var o=function(r){function o(e){var t=r.call(this,e)||this;return t.values=[],t}return __extends(o,r),o.toPropertyAndValues=function(e){return e.values.map(function(r){return new t(e,r.value)})},o.toTriples=function(t,r){return o.toQuads(t,r,e.DefaultGraph.instance)},o.toQuads=function(t,r,n){return r.values.map(function(o){return e.DataFactory.instance.quad(t,r,o.value,n)})},o.prototype.pruned=function(){return new n(this)},o.prototype.toPropertyAndValues=function(){return o.toPropertyAndValues(this)},o.prototype.toTriples=function(e){return o.toTriples(e,this)},o.prototype.toQuads=function(e,t){return o.toQuads(e,this,t)},o}(e.RichNodeFromRichNode);e.PropertyToValues=o;var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.localProperties=[],t.remoteProperties=[],t.localInverseProperties=[],t.remoteInverseProperties=[],t}return __extends(t,e),t}(e.FullRichNodeFromNode);e.Item=i;var a=function(){function e(e,t){void 0===t&&(t=0),this.constraintString=e,this.priority=t}return e}();e.SimpleConstraint=a;var s=function(){function e(e){this.workerService=e}return e.prototype.getItem=function(e,t,r){return void 0===t&&(t=!1),this.workerService.call("sparqlItemWorkerService","getItems",[[e.toCanonical()],t],r).then(function(e){return e[0]},null,function(e){return{endpointType:e.endpointType,endpoint:e.endpoint,item:e.items[0]}})},e.prototype.getItems=function(e,t,r){return void 0===t&&(t=!1),this.workerService.call("sparqlItemWorkerService","getItems",[e.map(function(e){return e.toCanonical()}),t],r)},e.prototype.getAllItems=function(e,t){return void 0===e&&(e=!1),this.workerService.call("sparqlItemWorkerService","getItems",[!1,e],t)},e.prototype.createNewItem=function(e){return void 0===e&&(e=[]),this.workerService.call("sparqlItemWorkerService","createNewItem",[e.map(function(e){return e.pruned()})])},e.prototype.alterItem=function(e,t,r){return void 0===r&&(r=[]),this.workerService.call("sparqlItemWorkerService","alterItem",[e,t.map(function(e){return e.pruned()}),r.map(function(e){return e.pruned()})])},e.prototype.deleteItem=function(e){return this.workerService.call("sparqlItemWorkerService","deleteItem",[e])},e}();angular.module("fibra").service("sparqlItemService",["workerService",function(){return new(Function.prototype.bind.apply(s,[null].concat(Array.prototype.slice.apply(arguments))))}]),s.naiveGetLocalItemPropertiesQuery='PREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX mads: <http://www.loc.gov/mads/rdf/v1#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX owl: <http://www.w3.org/2002/07/owl#>\nSELECT ?id ?itemLabel ?property ?propertyLabel ?object ?objectLabel {\n  # STARTGRAPH\n    VALUES ?id { <IDS> }\n    ?id skos:prefLabel|mads:authoritativeLabel|rdfs:label ?itemLabel .\n    FILTER(LANG(?itemLabel)=\'\' || LANG(?itemLabel)=\'<PREFLANG>\')\n    ?id ?property ?object .\n    OPTIONAL {\n      ?property skos:prefLabel|rdfs:label ?propertyLabelP .\n      FILTER(LANG(?propertyLabelP)=\'\' || LANG(?propertyLabelP)=\'<PREFLANG>\')\n    }\n    BIND(COALESCE(?propertyLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?property),".*/",""),".*#",""),"_"," "),"([A-Z])"," $1")) AS ?propertyLabel)\n    OPTIONAL {\n      ?object skos:prefLabel|rdfs:label ?objectLabelP .\n      FILTER(LANG(?objectLabelP)=\'\' || LANG(?objectLabelP)=\'<PREFLANG>\')\n    }\n    BIND (IF(ISIRI(?object),COALESCE(?objectLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?object),".*/",""),".*#",""),"_"," "),"([A-Z])"," $1")),?object) AS ?objectLabel)\n  # ENDGRAPH\n}',s.getLocalItemPropertiesQuery='PREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX mads: <http://www.loc.gov/mads/rdf/v1#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX owl: <http://www.w3.org/2002/07/owl#>\nPREFIX sf: <http://ldf.fi/functions#>\nSELECT ?id ?itemLabel ?property ?propertyLabel ?object ?objectLabel {\n  # STARTGRAPH\n    VALUES ?id { <IDS> }\n    { ?id ?property ?object . }\n    UNION\n    { ?object ?property ?id . }\n    ?id sf:preferredLanguageLiteral (skos:prefLabel mads:authoritativeLabel rdfs:label skos:altLabel mads:variantLabel \'<PREFLANG>\' \'\' ?itemLabel) .\n    OPTIONAL {\n      ?property sf:preferredLanguageLiteral (skos:prefLabel mads:authoritativeLabel rdfs:label skos:altLabel mads:variantLabel \'<PREFLANG>\' \'\' ?propertyLabelP)\n    }\n    BIND(COALESCE(?propertyLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?property),".*/",""),".*#",""),"_"," "),"([A-Z])"," $1")) AS ?propertyLabel)\n    OPTIONAL {\n      ?object sf:preferredLanguageLiteral (skos:prefLabel mads:authoritativeLabel rdfs:label skos:altLabel mads:variantLabel \'<PREFLANG>\' \'\' ?objectLabelP) .\n    }\n    BIND (IF(ISIRI(?object),COALESCE(?objectLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?object),".*/",""),".*#",""),"_"," "),"([A-Z])"," $1")),?object) AS ?objectLabel)\n  # ENDGRAPH\n}',s.getRemoteItemPropertiesQuery='PREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX mads: <http://www.loc.gov/mads/rdf/v1#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX owl: <http://www.w3.org/2002/07/owl#>\nPREFIX sf: <http://ldf.fi/functions#>\nSELECT ?id ?property ?propertyLabel ?object ?objectLabel {\n  VALUES (?id ?oid) { <IDPAIRS> }\n  ?oid ?property ?object .\n  OPTIONAL {\n    ?property sf:preferredLanguageLiteral (skos:prefLabel mads:authoritativeLabel rdfs:label skos:altLabel mads:variantLabel \'<PREFLANG>\' \'\' ?propertyLabelP)\n  }\n  BIND(COALESCE(?propertyLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?property),".*/",""),".*#",""),"_"," "),"([A-Z])"," $1")) AS ?propertyLabel)\n  OPTIONAL {\n    ?object sf:preferredLanguageLiteral (skos:prefLabel mads:authoritativeLabel rdfs:label skos:altLabel mads:variantLabel \'<PREFLANG>\' \'\' ?objectLabelP) .\n  }\n  BIND (IF(ISIRI(?object),COALESCE(?objectLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?object),".*/",""),".*#",""),"_"," "),"([A-Z])"," $1")),?object) AS ?objectLabel)\n}\n',s.deleteItemQuery="DELETE {\n  # STARTGRAPH\n    <ID> ?p ?o .\n    ?s ?p <ID> .\n  # ENDGRAPH\n}\nWHERE {\n  # STARTGRAPH\n    { <ID> ?p ?o } UNION { ?s ?p <ID> }\n  # ENDGRAPH\n}\n",e.SparqlItemService=s;var c=function(){function t(e,t,r,n){this.fibraSparqlService=e,this.$q=t,this.sparqlUpdateWorkerService=r,this.stateWorkerService=n}return t.processItemResult=function(t,n,i,a,s,c){if(c.property){var l=i.goc(c.property.value).goc(c.object.value,function(){var i=n.goc(c.property.value,function(){var r=new o(e.DataFactory.instance.nodeFromBinding(c.property));return c.propertyLabel&&(r.label=c.propertyLabel.value),t.push(r),r}),s=new e.FullRichNodeFromNode(e.DataFactory.instance.nodeFromBinding(c.object));return s.sourceEndpoints=[],i.values.push(new r(s)),e.OWL.sameAs.equals(i)&&a.push(s),s});l.sourceEndpoints.push(s),c.objectLabel&&!l.label&&(l.label=c.objectLabel.value)}},t.prototype.getItems=function(r,n,o){var a=this;void 0===n&&(n=!1);var s=this.stateWorkerService.state.project.itemQuery;s=r?s.replace(/<IDS>/g,r.join("")):s.replace(/VALUES \?id { <IDS> }/g,""),s=s.replace(/<PREFLANG>/g,this.stateWorkerService.state.language);var c=new e.EMap(function(t){return new i(e.DataFactory.instance.namedNode(t))}),l=this.$q.defer();return this.fibraSparqlService.query(this.stateWorkerService.state.project.endpoint,s,{timeout:o}).then(function(r){for(var i=new e.EMap(function(){return new e.EMap}),s=new e.EMap(function(){return new e.EMap(function(){return new e.EMap})}),p=new e.ENodeMap(function(){return[]}),u=0,d=r.results.bindings;u<d.length;u++){var f=d[u],h=c.goc(f.id.value);f.itemLabel&&(h.label=f.itemLabel.value),t.processItemResult(h.localProperties,i.goc(f.id.value),s.goc(f.id.value),p.goc(h),a.stateWorkerService.state.project.endpoint,f)}if(n){l.notify({endpointType:"primary",endpoint:a.stateWorkerService.state.project.endpoint,items:c.values()});for(var y="",g=0,v=c.values();g<v.length;g++){var h=v[g];y+="("+h.toCanonical()+h.toCanonical()+")";for(var m=0,b=p.get(h);m<b.length;m++){var S=b[m];y+="("+h.toCanonical()+S.toCanonical()+")"}}a.$q.all(a.stateWorkerService.state.project.remoteEndpoints().map(function(r){var n=r.itemQuery;return n=n.replace(/<IDPAIRS>/g,y),n=n.replace(/<PREFLANG>/g,a.stateWorkerService.state.language),a.fibraSparqlService.query(r.endpoint,n,{timeout:o}).then(function(e){if(0!==e.results.bindings.length){for(var n=0,o=e.results.bindings;n<o.length;n++){var a=o[n],u=c.goc(a.id.value);t.processItemResult(u.remoteProperties,i.goc(a.id.value),s.goc(a.id.value),p.goc(u),r.id,a)}l.notify({endpointType:"remote",endpoint:r.id,items:c.values()})}},function(t){return l.notify({endpointType:"remote",endpoint:r.id,error:e.WorkerWorkerService.stripFunctions(t)})})})).then(function(){return l.resolve(c.values())})}else l.resolve(c.values())}),l.promise},t.prototype.deleteItem=function(e){return this.fibraSparqlService.update(this.stateWorkerService.state.project.updateEndpoint,this.stateWorkerService.state.project.deleteItemQuery.replace(/<ID>/g,e.toCanonical())).then(function(e){return!0},function(e){return!1})},t.prototype.alterItem=function(t,r,n){void 0===n&&(n=[]);var o=[],i=[];return r.forEach(function(r){return o.push(new e.Triple(t,r.property,r.object))}),n.forEach(function(r){return i.push(new e.Triple(t,r.property,r.object))}),this.sparqlUpdateWorkerService.updateGraphs(this.stateWorkerService.state.project.updateEndpoint,[new e.Graph(this.stateWorkerService.state.project.graph?e.DataFactory.namedNode(this.stateWorkerService.state.project.graph):e.DefaultGraph.instance,o)],[new e.Graph(this.stateWorkerService.state.project.graph?e.DataFactory.namedNode(this.stateWorkerService.state.project.graph):e.DefaultGraph.instance,i)])},t.prototype.createNewItem=function(t){void 0===t&&(t=[]);var r=this.$q.defer(),n=new e.NamedNode(this.stateWorkerService.state.project.instanceNS+e.UUID());r.notify(n);var o=[];return t.forEach(function(t){return o.push(new e.Triple(n,t.property,t.object))}),this.sparqlUpdateWorkerService.updateGraphs(this.stateWorkerService.state.project.updateEndpoint,[new e.Graph(this.stateWorkerService.state.project.graph?e.DataFactory.namedNode(this.stateWorkerService.state.project.graph):e.DefaultGraph.instance,o)]).then(function(){return r.resolve(n)},r.reject,r.notify),r.promise},t}();angular.module("fibra").service("sparqlItemWorkerService",["fibraSparqlService","$q","sparqlUpdateWorkerService","stateWorkerService",function(){return new(Function.prototype.bind.apply(c,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.SparqlItemWorkerService=c}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e){this.workerService=e}return e.prototype.getTree=function(e,t,r){return this.workerService.call("sparqlTreeWorkerService","getTree",[e,t],r)},e}();angular.module("fibra").service("sparqlTreeService",["workerService",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),t.getClassTreeQuery='PREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX sf: <http://ldf.fi/functions#>\nSELECT ?subClass ?superClass ?class ?classLabel ?instances {\n  # STARTGRAPH\n    {\n      ?groupId rdfs:subClassOf ?class .\n      FILTER EXISTS {\n        ?id a ?groupId .\n        # CONSTRAINTS\n      }\n      BIND(?groupId AS ?subClass)\n    } UNION {\n      {\n        SELECT ?groupId (COUNT(*) AS ?instances) {\n          ?id a ?groupId .\n        }\n        GROUP BY ?groupId\n      }\n      # CONSTRAINTS\n      BIND (?groupId AS ?class)\n    }\n    OPTIONAL {\n      ?class sf:preferredLanguageLiteral (skos:prefLabel rdfs:label skos:altLabel \'en\' \'\' ?classLabelP) .\n    }\n    FILTER(ISIRI(?class))\n    BIND(COALESCE(?classLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?class),".*/",""),".*#",""),"_"," "),"([A-Z])"," $1")) AS ?classLabel)\n  # ENDGRAPH\n}\n',e.SparqlTreeService=t;var r=function(){function t(e){this.fibraSparqlService=e}return t.prototype.getTree=function(t,r,n){return this.fibraSparqlService.query(t,r,{timeout:n}).then(function(t){var r={},n={};t.results.bindings.forEach(function(t){if(t.classLabel&&(n[t.class.value]=new e.TreeNode(t.class.value,t.classLabel.value)),t.instances&&(n[t.class.value].instances=parseInt(t.instances.value,10)),
t.subClass){var o=t.subClass.value;r[o]||(r[o]={}),r[o][t.class.value]=!0}if(t.superClass){var o=t.class.value;r[o]||(r[o]={}),r[o][t.superClass.value]=!0}});var o=[];for(var i in n)if(r[i])for(var a in r[i])n[a].children.push(n[i]);else o.push(n[i]);return o})},t}();angular.module("fibra").service("sparqlTreeWorkerService",["fibraSparqlService",function(){return new(Function.prototype.bind.apply(r,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.SparqlTreeWorkerService=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e){this.workerService=e}return e.prototype.updateQuads=function(e,t,r){return this.workerService.call("sparqlUpdateWorkerService","updateQuads",[e,t,r])},e.prototype.updateGraphs=function(e,t,r){return this.workerService.call("sparqlUpdateWorkerService","updateGraphs",[e,t,r])},e}();angular.module("fibra").service("sparqlUpdateService",["workerService",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.SparqlUpdateService=t;var r=function(){function t(e){this.fibraSparqlService=e}return t.prototype.updateQuads=function(t,r,n){void 0===r&&(r=[]),void 0===n&&(n=[]);var o={},i={},a=[],s=[];return r.forEach(function(t){var r=o[t.graph.value];r||(r=new e.Graph(t.graph),o[t.graph.value]=r,a.push(r)),r.triples.push(e.DataFactory.triple(t.subject,t.predicate,t.object))}),n.forEach(function(t){var r=i[t.graph.value];r||(r=new e.Graph(t.graph),i[t.graph.value]=r,s.push(r)),r.triples.push(e.DataFactory.triple(t.subject,t.predicate,t.object))}),this.updateGraphs(t,a,s)},t.prototype.updateGraphs=function(r,n,o){void 0===n&&(n=[]),void 0===o&&(o=[]);var i=n.map(function(t){return(e.DefaultGraph.instance.equals(t.graph)?"":"GRAPH"+t.graph.toCanonical())+"{"+t.triples.map(function(e){return e.toCanonical()}).join(" . ")+"}"}).join(""),a=o.map(function(t){return(e.DefaultGraph.instance.equals(t.graph)?"":"GRAPH"+t.graph.toCanonical())+"{"+t.triples.map(function(e){return e.toCanonical()}).join(" . ")+"}"}).join("");return this.fibraSparqlService.update(r,t.queryTemplate.replace(/<DELETE>/g,a).replace(/<INSERT>/g,i)).then(function(e){return!0},function(e){return!1})},t}();angular.module("fibra").service("sparqlUpdateWorkerService",["fibraSparqlService",function(){return new(Function.prototype.bind.apply(r,[null].concat(Array.prototype.slice.apply(arguments))))}]),r.queryTemplate="DELETE{<DELETE>}INSERT{<INSERT>}WHERE {}",e.SparqlUpdateWorkerService=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e,t){this.id=e,this.label=t,this.children=[],this.selected=!0,this.open=!0}return e.recursivelyProcess=function(t,r){r(t),t.children.forEach(function(t){return e.recursivelyProcess(t,r)})},e.filter=function(e,t){for(var r=e.cloneWithoutChildren(),n=0,o=e.children;n<o.length;n++){var i=o[n];t(i)&&r.children.push(i)}return r},e.recursivelyMap=function(t,r){for(var n=[],o=0,i=t.children;o<i.length;o++){var a=i[o];n=n.concat(e.recursivelyMap(a,r))}return r(t,n)},e.prototype.cloneWithoutChildren=function(){var t=new e(this.id,this.label);return t.instances=this.instances,t.matchingInstances=this.matchingInstances,t.selected=this.selected,t.open=this.open,t},e}();e.TreeNode=t;var r=function(){function e(){this.bindings={tree:"<",onSelect:"&"},this.templateUrl="components/tree/tree.html"}return e}();angular.module("fibra").component("tree",new r),e.TreeComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(){this.bindings={tree:"<",onSelect:"&"},this.templateUrl="components/type-select/type-select.html"}return e}();angular.module("fibra").component("typeSelect",new t),e.TypeSelectComponent=t}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e,t,r){this.appName=e,this.workerThreads=t,this.importScripts=r}return e}();e.WorkerServiceConfiguration=t;var r=function(){function e(t,r,n,o,i){var a=this;this.workerServicePrototypeMappingConfiguration=r,this.$q=i,this.currentWorker=0,this.deferreds=[];var s=o.location.protocol+"//"+o.location.host,c=t.importScripts.map(function(e){return 0!==e.indexOf("http")?s+(0!==e.indexOf("/")?o.location.pathname:"")+e:e}),l=o.URL.createObjectURL(new Blob([e.workerTemplate.replace(/<APP_NAME>/g,t.appName).replace(/<IMPORT_SCRIPTS>/g,c.join("','"))],{type:"application/javascript"}));this.workers=[];for(var p=0;p<t.workerThreads;p++)this.workers.push(new Worker(l)),this.workers[p].addEventListener("message",function(e){var t=e.data.event;if("broadcast"===t)n.$broadcast(e.data.name,a.restorePrototypes(e.data.args)),n.$apply();else{var r=a.deferreds[e.data.id];r&&("success"===t?(delete a.deferreds[e.data.id],r.resolve(a.restorePrototypes(e.data.data))):"failure"===t?(delete a.deferreds[e.data.id],r.reject(a.restorePrototypes(e.data.data))):r.notify(a.restorePrototypes(e.data.data)))}})}return e.stripMarks=function(t){if(t&&t.__mark&&"object"==typeof t)if(delete t.__mark,t instanceof Array)t.forEach(function(t){return e.stripMarks(t)});else for(var r in t)t.hasOwnProperty(r)&&e.stripMarks(t[r])},e.stripPrototypes=function(t){if(t&&t.__className&&"object"==typeof t)if(delete t.__className,t instanceof Array)t.forEach(function(t){return e.stripPrototypes(t)});else for(var r in t)t.hasOwnProperty(r)&&e.stripPrototypes(t[r])},e.savePrototypes=function(t){return e.stripPrototypes(t),this.savePrototypesInternal(t),t},e.savePrototypesInternal=function(t){if(t&&!t.__className&&"object"==typeof t)if(t instanceof Array)t.forEach(function(t){return e.savePrototypesInternal(t)});else{if(t.constructor.__name||"Object"!==t.constructor.name){var r=Object.getPrototypeOf(t);e:for(;r!==Object.prototype;){for(var n=0,o=Object.getOwnPropertyNames(r);n<o.length;n++){var i=o[n];if("constructor"!==i&&"function"==typeof t.__proto__[i]){t.__className=t.constructor.__name?t.constructor.__name:t.constructor.name;break e}}r=Object.getPrototypeOf(r)}t.__className||(t.__className="Object")}for(var a in t)t.hasOwnProperty(a)&&e.savePrototypesInternal(t[a])}},e.prototype.$broadcast=function(t,r){this.workers.forEach(function(n){return n.postMessage({name:t,args:e.savePrototypes(r)})})},e.prototype.callAll=function(t,r,n,o){var i=this;void 0===n&&(n=[]);var a=this.$q.defer();this.deferreds.push(a);var s=this.deferreds.length-1,c={id:s,service:t,method:r,args:e.savePrototypes(n)};return o&&o.then(function(){i.workers.forEach(function(e){return e.postMessage({id:s,cancel:!0})}),delete i.deferreds[s]}),this.workers.forEach(function(e){return e.postMessage(c)}),a.promise},e.prototype.call=function(t,r,n,o){var i=this;void 0===n&&(n=[]);var a=this.$q.defer();this.deferreds.push(a);var s=this.deferreds.length-1,c=this.workers[this.currentWorker];return this.currentWorker=(this.currentWorker+1)%this.workers.length,o&&o.then(function(){c.postMessage({id:s,cancel:!0}),delete i.deferreds[s]}),c.postMessage({id:s,service:t,method:r,args:e.savePrototypes(n)}),a.promise},e.prototype.restorePrototypes=function(t){return this.restorePrototypesInternal(t),e.stripMarks(t),t},e.prototype.restorePrototypesInternal=function(e){var t=this;if(e&&!e.__mark&&"object"==typeof e)if(e.__mark=!0,e instanceof Array)e.forEach(function(e){return t.restorePrototypesInternal(e)});else{if(e.__className){var r=this.workerServicePrototypeMappingConfiguration[e.__className];if(!r)throw"Unknown prototype "+e.__className;e.__proto__=r,delete e.__className}for(var n in e)e.hasOwnProperty(n)&&this.restorePrototypesInternal(e[n])}},e}();angular.module("fibra").service("workerService",["workerServiceConfiguration","workerServicePrototypeMappingConfiguration","$rootScope","$window","$q",function(){return new(Function.prototype.bind.apply(r,[null].concat(Array.prototype.slice.apply(arguments))))}]),r.workerTemplate="\n      var window = self\n      self.history = {}\n      self.Node = function () {}\n      self.setImmediate = function(fn) { return window.setTimeout(fn, 0) }\n      var document = {\n        readyState: 'complete',\n        cookie: '',\n        querySelector: function () {},\n        addEventListener: function() {},\n        createElement: function() {\n          return {\n            pathname: '',\n            setAttribute: function(key, value) {}\n          };\n        },\n      };\n      importScripts('<IMPORT_SCRIPTS>')\n      window.angular.module('<APP_NAME>').run(['workerWorkerService', function(workerWorkerService) {\n        self.addEventListener('message', function(e) { workerWorkerService.onMessage(e.data) })\n      }])\n      window.angular.bootstrap(null, ['<APP_NAME>'])\n    ",e.WorkerService=r;var n=function(){function e(e,t,r,n){this.workerServicePrototypeMappingConfiguration=e,this.$injector=t,this.$q=r,this.$rootScope=n,this.cancellers=[]}return e.stripFunctions=function(t){var r={};for(var n in t)"object"==typeof t[n]?r[n]=e.stripFunctions(t[n]):"function"!=typeof t[n]&&(r[n]=t[n]);return r},e.prototype.$broadcast=function(e,t){try{self.postMessage({event:"broadcast",name:e,args:r.savePrototypes(t)})}catch(e){throw console.log(t,e),e}},e.prototype.onMessage=function(t){var n=this;if(void 0===t.id)this.$rootScope.$broadcast(t.name,this.restorePrototypes(t.args)),this.$rootScope.$apply();else if(t.cancel){var o=this.cancellers[t.id];delete this.cancellers[t.id],o&&o.resolve()}else{var i=this.$injector.get(t.service),o=this.$q.defer();this.cancellers[t.id]=o;var a=i[t.method].apply(i,this.restorePrototypes(t.args).concat(o.promise));if(!a||!a.then){var s=this.$q.defer();s.resolve(a),a=s.promise}a.then(function(e){delete n.cancellers[t.id],self.postMessage({event:"success",id:t.id,data:r.savePrototypes(e)})},function(o){if(delete n.cancellers[t.id],o instanceof Error)throw self.postMessage({event:"failure",id:t.id,data:{name:o.name,message:o.message,stack:o.stack}}),o;self.postMessage({event:"failure",id:t.id,data:r.savePrototypes(e.stripFunctions(o))})},function(e){return self.postMessage({event:"update",id:t.id,data:r.savePrototypes(e)})})}},e.prototype.restorePrototypes=function(e){return this.restorePrototypesInternal(e),r.stripMarks(e),e},e.prototype.restorePrototypesInternal=function(e){var t=this;if(e&&!e.__mark&&"object"==typeof e)if(e.__mark=!0,e instanceof Array)e.forEach(function(e){return t.restorePrototypesInternal(e)});else{if(e.__className){var r=this.workerServicePrototypeMappingConfiguration[e.__className];if(!r)throw"Unknown prototype "+e.__className;e.__proto__=r,delete e.__className}for(var n in e)e.hasOwnProperty(n)&&this.restorePrototypesInternal(e[n])}},e}();angular.module("fibra").service("workerWorkerService",["workerServicePrototypeMappingConfiguration","$injector","$q","$rootScope",function(){return new(Function.prototype.bind.apply(n,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.WorkerWorkerService=n}(fibra||(fibra={})),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/citable/citable.html",'<a ng-if="$ctrl.citable.url &amp;&amp; !$ctrl.noLink" href="{{$ctrl.citable.url}}" title="{{$ctrl.citable.descriptions | prefLang}}">{{$ctrl.citable.labels | prefLang}}</a><span ng-if="!$ctrl.citable.url" title="{{$ctrl.citable.descriptions | prefLang}}">{{$ctrl.citable.labels | prefLang}}</span><span ng-repeat="rightsHolder in $ctrl.citable.rightsHolders"><span ng-if="$first">&nbsp;(</span><a ng-if="rightsHolder.url" href="{{rightsHolder.url}}" title="{{rightsHolder.descriptions | prefLang}}">{{rightsHolder.labels | prefLang}}</a><span ng-if="!rightsHolder.url" title="{{rightsHolder.descriptions | prefLang}}">{{rightsHolder.labels | prefLang}}</span><span ng-if="$middle">,&nbsp;</span><span ng-if="$last">)</span></span>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/author-view/author-view.html",'\n<div class="container-fluid">\n  <div class="row no-gutter">\n    <div class="col-md-12">foo</div>\n  </div>\n  <div class="row">\n    <div class="col-md-12">\n      <sparql-autocomplete on-select="$ctrl.createItem(result)"></sparql-autocomplete>\n    </div>\n  </div>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/citable-editor/citable-editor.html",'\n<div class="form-group" ng-show="!$ctrl.noId">\n  <label>ID</label>\n  <input class="form-control" type="text" ng-model="$ctrl.citable.id"/>\n</div>\n<h4>Names</h4>\n<div class="form-inline">\n  <div class="form-group" ng-repeat="label in $ctrl.citable.labels">\n    <button class="pull-right btn btn-xs" ng-click="$ctrl.removeLabel($index)"><span class="glyphicon glyphicon-remove"></span></button>\n    <label>Language</label>\n    <input class="form-control" style="width:4em;" type="text" ng-model="label.language"/>\n    <label>Name</label>\n    <input class="form-control" type="text" ng-model="label.value"/>\n  </div>\n  <button class="btn btn-xs" ng-click="$ctrl.addLabel()"><span class="glyphicon glyphicon-plus"></span></button>\n</div>\n<h4>Descriptions</h4>\n<div class="form-inline">\n  <div class="form-group" ng-repeat="descr in $ctrl.citable.descriptions">\n    <button class="pull-right btn btn-xs" ng-click="$ctrl.removeDescription($index)"><span class="glyphicon glyphicon-remove"></span></button>\n    <label>Language</label>\n    <input class="form-control" style="width:4em;" type="text" ng-model="descr.language"/>\n    <label>Description</label>\n    <textarea class="form-control" ng-model="descr.value"></textarea>\n  </div>\n  <button class="btn btn-xs" ng-click="$ctrl.addDescription()"><span class="glyphicon glyphicon-plus"></span></button>\n</div>\n<div class="form-group">\n  <label>Homepage URL</label>\n  <input class="form-control" type="text" ng-model="$ctrl.citable.url"/>\n</div>\n<div ng-if="!$ctrl.noRightsHolders">\n  <h4>Rights holders</h4>\n  <div class="well" ng-repeat="rightsHolder in $ctrl.citable.rightsHolders">\n    <button class="pull-right btn btn-xs btn-dange" ng-click="$ctrl.citable.rightsHolders.splice($index, 1)"><span class="glyphicon glyphicon-remove"></span></button>\n    <citable-editor citable="rightsHolder" no-rights-holders="no-rights-holders" no-id="$ctrl.noRightsHolderIds"></citable-editor>\n  </div>\n  <button class="btn btn-xs" ng-click="$ctrl.addRightsHolder()"><span class="glyphicon glyphicon-plus"></span></button>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/configure-view/configure-view.html",'\n<div class="container">\n  <h1>Fibra</h1>\n  <citable-editor citable="$ctrl.project" no-id="no-id"></citable-editor>\n  <h4>Schemas</h4>\n  <div class="form-group">\n    <div class="form-group">\n      <label class="checkbox-inline" ng-repeat="schema in $ctrl.schemas">\n        <input type="checkbox" ng-model="$ctrl.selectedSchemas[schema.id]"/>\n        <citable citable="schema"></citable>\n      </label>\n    </div>\n  </div>\n  <h4>Authorities</h4>\n  <div class="form-group">\n    <label class="checkbox-inline" ng-repeat="authority in $ctrl.authorities">\n      <input type="checkbox" ng-model="$ctrl.selectedAuthorities[authority.id]"/>\n      <citable citable="authority"></citable>\n    </label>\n  </div>\n  <h4>Archives</h4>\n  <div class="form-group">\n    <label class="checkbox-inline" ng-repeat="archive in $ctrl.archives">\n      <input type="checkbox" ng-model="$ctrl.selectedArchives[archive.id]"/>\n      <citable citable="archive"></citable>\n    </label>\n  </div>\n  <button class="btn btn-success" ng-click="$ctrl.saveAndOpen()">Save and open</button>\n  <button class="btn btn-danger" ng-click="$ctrl.delete()">Delete</button>\n  <div ng-show="!details"><span class="glyphicon glyphicon-chevron-down" title="details" ng-click="details=true"></span></div>\n  <div ng-show="details"><span class="glyphicon glyphicon-chevron-up" title="details" ng-click="details=false"></span>\n    <div class="form-group">\n      <label>Project ID</label>\n      <input class="form-control" type="text" ng-model="$ctrl.project.id"/>\n    </div>\n    <div class="form-group">\n      <label>Project storage</label>\n      <select class="form-control" ng-model="$ctrl.projectSource" ng-options="ps as ps.id for ps in $ctrl.projectSources" ng-change="$ctrl.onUpdatedProjectSource()"></select>\n    </div>\n    <div class="form-group">\n      <label>Schema namespace</label>\n      <input class="form-control" type="text" ng-model="$ctrl.project.schemaNS"/>\n    </div>\n    <div class="form-group">\n      <label>Instance namespace</label>\n      <input class="form-control" type="text" ng-model="$ctrl.project.instanceNS"/>\n    </div>\n    <div class="form-group">\n      <label>Project Query Endpoint</label>\n      <input class="form-control" type="text" ng-model="$ctrl.project.endpoint"/>\n    </div>\n    <div class="form-group">\n      <label>Project Update Endpoint</label>\n      <input class="form-control" type="text" ng-model="$ctrl.project.updateEndpoint"/>\n    </div>\n    <div class="form-group">\n      <label>Project Graph Store Endpoint</label>\n      <input class="form-control" type="text" ng-model="$ctrl.project.graphStoreEndpoint"/>\n    </div>\n    <div class="form-group">\n      <label>Project Graph</label>\n      <input class="form-control" type="text" ng-model="$ctrl.project.graph"/>\n    </div>\n    <div class="form-group">\n      <label>Template</label>\n      <div class="radio" ng-repeat="template in $ctrl.primaryEndpointConfigurations">\n        <label>\n          <input type="radio" name="selectedTemplate" ng-value="template" ng-model="$ctrl.selectedTemplate" ng-change="$ctrl.changeTemplate()"/>\n          <citable citable="template"></citable>\n        </label>\n      </div>\n    </div>\n    <div class="form-group">\n      <label>Autocompletion Query</label>\n      <yasqe content="$ctrl.project.autocompletionQuery" on-content-changed="$ctrl.project.autocompletionQuery=content"></yasqe>\n    </div>\n    <div class="form-group">\n      <label>Item Query</label>\n      <yasqe content="$ctrl.project.itemQuery" on-content-changed="$ctrl.project.itemQuery=content"></yasqe>\n    </div>\n    <div class="form-group">\n      <label>Delete Item Query</label>\n      <yasqe content="$ctrl.project.deleteItemQuery" on-content-changed="$ctrl.project.deleteItemQuery=content"></yasqe>\n    </div>\n    <div class="form-group">\n      <label>Tree Query</label>\n      <yasqe content="$ctrl.project.treeQuery" on-content-changed="$ctrl.project.treeQuery=content"></yasqe>\n    </div>\n    <div class="form-group">\n      <label>Class Query</label>\n      <yasqe content="$ctrl.project.classQuery" on-content-changed="$ctrl.project.classQuery=content"></yasqe>\n    </div>\n    <div class="form-group">\n      <label>Property Query</label>\n      <yasqe content="$ctrl.project.propertyQuery" on-content-changed="$ctrl.project.propertyQuery=content"></yasqe>\n    </div>\n  </div>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/construct-view/construct-view.html",'\n<nav class="navbar navbar-default navbar-static-top palette-relevant" id="menu-bar" ng-class="{\'palette-offset\': $ctrl.paletteDisplay }">\n  <div class="pull-left" id="type-bar">\n    <explore-type></explore-type>\n  </div>\n  <div class="pull-left" id="menu-icons"><span class="btn-group">\n      <button class="btn btn-xs" ng-init="linkMode = false" ng-click="linkMode = !linkMode" ng-class="{\'btn-primary\': linkMode}"><span class="glyphicon glyphicon-link" aria-hidden="true"></span></button></span><span class="btn-group">\n      <button class="btn btn-xs disabled"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span></button>\n      <button class="btn btn-xs disabled"><span class="glyphicon glyphicon-zoom-out" aria-hidden="true"></span></button></span><span class="btn-group">\n      <button class="btn btn-xs disabled"><span class="glyphicon glyphicon-upload" aria-hidden="true"></span></button>\n      <button class="btn btn-xs" ng-click="$ctrl.downloadRDF()"><span class="glyphicon glyphicon-download" aria-hidden="true"></span></button></span><span class="btn-group">\n      <button class="btn btn-xs" ui-sref="configure({id:$ctrl.state.project.id,sourceId:$ctrl.currentProjectSource.id})"><span class="glyphicon glyphicon-cog"></span></button></span></div>\n  <div class="pull-right"><span class="glyphicon glyphicon-refresh fa-spin" ng-show="$ctrl.state.actionsRunning &gt; 0"></span></div>\n</nav>\n<div class="container-fluid main">\n  <div class="row main no-gutter">\n    <div class="col-md-12">\n      <div class="col-md-12 palette-relevant" id="middle-column" ng-class="{\'palette-offset\': $ctrl.paletteDisplay }">\n        <explore link-mode="linkMode"></explore>\n      </div>\n    </div>\n  </div>\n</div>\n<div id="palette-container" ng-show="$ctrl.paletteDisplay">\n  <palette></palette>\n</div>\n<div id="palette-tab" ng-class="{closed: !$ctrl.paletteDisplay }" ng-click="$ctrl.paletteDisplay = !$ctrl.paletteDisplay"></div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/construct-view/explore.html",'\n<div id="explorecontainer">\n  <svg id="explore"></svg>\n</div>\n<div id="layout-choice">\n  <label>Force\n    <input type="radio" ng-model="layout.choice" value="force"/>\n  </label>\n  <label>Force Grid\n    <input type="radio" ng-model="layout.choice" value="forcegrid"/>\n  </label>\n</div>\n<div id="link-options">\n  <label>Show\n    <input type="radio" ng-model="layout.links" value="show"/>\n  </label>\n  <label>Hide\n    <input type="radio" ng-model="layout.links" value="hide"/>\n  </label>\n</div>\n<div id="tablecontainer">\n  <explore-table primary-items="$ctrl.primaryItems" secondary-items="$ctrl.secondaryItems"></explore-table>\n</div>\n<div id="verifycontainer" ng-show="$ctrl.verifyItem">\n  <explore-verify node="$ctrl.verifyItem"></explore-verify>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/construct-view/property-popover-component.html",'\n<div>\n  <div class="form-group">\n    <label class="control-label" for="typeSelect">Type\n      <button class="btn btn-sm pull-right" type="button" ng-show="$ctrl.showTypeCreate" ng-click="$ctrl.typeCreate($ctrl.typeQueryGS())">Create Type</button>\n      <input class="form-control label-input pull-right" type="text" ng-model="$ctrl.typeQueryGS" ng-model-options="{ getterSetter: true }" uib-typeahead="type.label for type in $ctrl.getTypes() | filter:$viewValue | limitTo:8" ng-change="$ctrl.typeEvaluate($ctrl.typeQueryGS())" typeahead-on-select="$ctrl.typeChange($item, $model, $label, $event)"/>\n    </label>\n  </div>\n  <div class="form-group" ng-show="$ctrl.chosenType.id !== $ctrl.thingType">\n    <label class="control-label" for="labelField">Label\n      <input class="form-control label-input pull-right" type="text" ng-model="$ctrl.label" ng-blur="$ctrl.labelChange()"/>\n    </label>\n  </div>\n  <div class="form-group"><a class="btn btn-sm" ng-click="$ctrl.deleteAndClose()">Cancel</a><a class="btn btn-sm" ng-click="$ctrl.closePopover()" ng-show="$ctrl.label!==\'\'">Save and close</a></div>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/edit-primary-endpoint-configuration-view/edit-primary-endpoint-configuration-view.html",'\n<div class="container">\n  <h1>Fibra</h1>\n  <h2>Edit project template</h2>\n  <citable-editor citable="$ctrl.c"></citable-editor>\n  <div class="form-group">\n    <label>Project storage</label>\n    <select class="form-control" ng-model="$ctrl.projectSource" ng-options="ps as ps.id for ps in $ctrl.projectSources"></select>\n  </div>\n  <h4>Compatible endpoints</h4>\n  <div class="form-group" ng-repeat="ce in $ctrl.c.compatibleEndpoints">\n    <button class="pull-right btn btn-xs" ng-click="$ctrl.removeCompatibleEndpoint($index)"><span class="glyphicon glyphicon-remove"></span></button>\n    <label>endpoint IRI</label>\n    <input class="form-control" type="text" ng-model="$ctrl.c.compatibleEndpoints[$index]"/>\n  </div>\n  <button class="btn btn-xs" ng-click="$ctrl.addCompatibleEndpoint()"><span class="glyphicon glyphicon-plus"></span></button>\n  <div class="form-group">\n    <label>Autocompletion query template</label>\n    <yasqe content="$ctrl.c.autocompletionQuery" on-content-changed="$ctrl.c.autocompletionQuery = content"></yasqe>\n  </div>\n  <div class="form-group">\n    <label>Item query template</label>\n    <yasqe content="$ctrl.c.itemQuery" on-content-changed="$ctrl.c.itemQuery = content"></yasqe>\n  </div>\n  <div class="form-group">\n    <label>Item deletion query template</label>\n    <yasqe content="$ctrl.c.deleteItemQuery" on-content-changed="$ctrl.c.deleteItemQuery = content"></yasqe>\n  </div>\n  <div class="form-group">\n    <label>Tree query template</label>\n    <yasqe content="$ctrl.c.treeQuery" on-content-changed="$ctrl.c.treeQuery = content"></yasqe>\n  </div>\n  <div class="form-group">\n    <label>Class query template</label>\n    <yasqe content="$ctrl.c.classQuery" on-content-changed="$ctrl.c.classQuery = content"></yasqe>\n  </div>\n  <div class="form-group">\n    <label>Property query template</label>\n    <yasqe content="$ctrl.c.propertyQuery" on-content-changed="$ctrl.c.propertyQuery = content"></yasqe>\n  </div>\n  <button class="btn btn-success" ng-click="$ctrl.save()" ng-disabled="$ctrl.disabled">Save to endpoint</button>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/edit-remote-endpoint-configuration-view/edit-remote-endpoint-configuration-view.html",'\n<div class="container">\n  <h1>Fibra</h1>\n  <h2>Edit remote configuration</h2>\n  <citable-editor citable="$ctrl.c"></citable-editor>\n  <div class="form-group">\n    <label>Project storage</label>\n    <select class="form-control" ng-model="$ctrl.projectSource" ng-options="ps as ps.id for ps in $ctrl.projectSources"></select>\n  </div>\n  <div class="form-group">\n    <label>Autocompletion query template</label>\n    <yasqe content="$ctrl.c.autocompletionQuery" on-content-changed="$ctrl.c.autocompletionQuery = content"></yasqe>\n  </div>\n  <div class="form-group">\n    <label>Item query template</label>\n    <yasqe content="$ctrl.c.itemQuery" on-content-changed="$ctrl.c.itemQuery = content"></yasqe>\n  </div>\n  <div class="form-group">\n    <label>Tree query template</label>\n    <yasqe content="$ctrl.c.treeQuery" on-content-changed="$ctrl.c.treeQuery = content"></yasqe>\n  </div>\n  <button class="btn btn-success" ng-click="$ctrl.save()" ng-disabled="$ctrl.disabled">Save to endpoint</button>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/edit-schema-view/edit-schema-view.html",'\n<div class="container">\n  <h1>Fibra</h1>\n  <h2>Edit schema</h2>\n  <citable-editor citable="$ctrl.c"></citable-editor>\n  <div class="form-group">\n    <label>Project storage</label>\n    <select class="form-control" ng-model="$ctrl.projectSource" ng-options="ps as ps.id for ps in $ctrl.projectSources"></select>\n  </div>\n  <div class="form group">\n    <label>schema endpoint</label>\n    <input class="form-control" type="text" ng-model="$ctrl.c.endpoint"/>\n  </div>\n  <div class="form-group">\n    <label>Class query template</label>\n    <yasqe content="$ctrl.c.classQuery" on-content-changed="$ctrl.c.classQuery = content"></yasqe>\n  </div>\n  <div class="form-group">\n    <label>Property query template</label>\n    <yasqe content="$ctrl.c.propertyQuery" on-content-changed="$ctrl.c.propertyQuery = content"></yasqe>\n  </div>\n  <button class="btn btn-success" ng-click="$ctrl.save()" ng-disabled="$ctrl.disabled">Save to endpoint</button>\n  <button class="btn btn-danger" ng-click="$ctrl.delete()" ng-disabled="$ctrl.disabled">Delete</button>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/project-source-configurations-view/project-source-configurations-view.html",'\n<div class="container">\n  <h1>Fibra</h1>\n  <h2>Projects</h2>\n  <ul>\n    <li ng-repeat="c in $ctrl.projects"><a ui-sref="configure({sourceId:$ctrl.source.id,id:c.id})">{{c.labels | prefLang}}</a></li>\n  </ul>\n  <h2>Schemas</h2>\n  <ul>\n    <li ng-repeat="c in $ctrl.schemas"><a ui-sref="editSchema({sourceId:$ctrl.source.id,id:c.id})">{{c.labels | prefLang}}</a></li>\n  </ul>\n  <h2>Primary endpoint configurations</h2>\n  <ul>\n    <li ng-repeat="c in $ctrl.primaryEndpointConfigurations"><a ui-sref="editPrimaryEndpointConfiguration({sourceId:$ctrl.source.id,id:c.id})">{{c.labels | prefLang}}</a></li>\n  </ul>\n  <h2>Archive endpoints</h2>\n  <ul>\n    <li ng-repeat="c in $ctrl.archiveEndpoints"><a ui-sref="editRemoteEndpointConfiguration({sourceId:$ctrl.source.id,id:c.id})">{{c.labels | prefLang}}</a></li>\n  </ul>\n  <h2>Authority endpoints</h2>\n  <ul>\n    <li ng-repeat="c in $ctrl.authorityEndpoints"><a ui-sref="editRemoteEndpointConfiguration({sourceId:$ctrl.source.id,id:c.id})">{{c.labels | prefLang}}</a></li>\n  </ul><a ui-sref="projectSources()">Back to project sources</a>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/project-sources-view/project-sources-view.html",'\n<div class="container">\n  <h1>Fibra</h1>\n  <h2>Your project sources</h2>\n  <div class="well" ng-repeat="source in $ctrl.projectSources">\n    <div class="pull-right">\n      <button class="btn btn-xs btn-danger" ng-click="$ctrl.deleteProjectSource($index)"><span class="glyphicon glyphicon-remove"></span></button>\n    </div>\n    <div class="form-group">\n      <label>Name</label>\n      <input class="form-control" type="text" ng-model="source.id"/>\n    </div>\n    <div class="form-group">\n      <label>SPARQL query endpoint address</label>\n      <input class="form-control" type="text" ng-model="source.sparqlEndpoint"/>\n    </div>\n    <div class="form-group">\n      <label>SPARQL update endpoint address</label>\n      <input class="form-control" type="text" ng-model="source.updateEndpoint"/>\n    </div>\n    <div class="form-group">\n      <label>SPARQL graph store protocol endpoint address</label>\n      <input class="form-control" type="text" ng-model="source.graphStoreEndpoint"/>\n    </div>\n    <div class="form-group">\n      <label>Graph</label>\n      <input class="form-control" type="text" ng-model="source.graph"/>\n    </div>\n    <div class="form-group">\n      <label>Type IRI</label>\n      <input class="form-control" type="text" ng-model="source.type"/>\n    </div>\n    <button class="btn btn-xs" ui-sref="projectSourceConfigurations({sourceId:source.id})" title="Examine project source configurations"><span class="glyphicon glyphicon-cog"></span></button>\n  </div>\n  <button class="btn btn-success" ng-click="$ctrl.addNewProjectSource()">Add new</button><a ui-sref="projects()">Back to projects</a>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/projects-view/projects-view.html",'\n<div class="container">\n  <h1>Fibra</h1>\n  <h2>Your projects</h2>\n  <div ng-repeat="(id,projectSource) in $ctrl.projectSources track by $index">\n    <h3>{{id}}&nbsp;<span class="glyphicon glyphicon-refresh fa-spin" ng-if="$ctrl.projectSourceState[id]==\'loading\'"></span></h3>\n    <div class="alert alert-danger" ng-if="$ctrl.projectSourceState[id]==\'error\'">Error loading: {{projects}}</div>\n    <ul>\n      <li ng-if="$ctrl.projectSourceState[id]==\'ready\'" ng-repeat="project in $ctrl.projects[id] track by $index"><a ui-sref="construct({id:project.id,sparqlEndpoint:project.source.sparqlEndpoint,graph:project.source.graph})">\n          <citable citable="project" no-link="no-link"></citable></a>\n        <!-- button.btn.btn-xs.btn-danger(ng-click="$ctrl.deleteProject(id, $index, project)"): span.glyphicon.glyphicon-remove-->\n      </li>\n      <li><a ui-sref="configure({sourceId:id})">new project</a></li>\n    </ul>\n  </div>\n  <button class="btn btn-xs" ui-sref="projectSources()" title="Configure project sources"><span class="glyphicon glyphicon-cog"></span></button>\n</div>');
}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/rdfstore-test-view/rdfstore-test-view.html",'\n<h1>RDFStore test view</h1>\n<div class="form-group">\n  <label>data</label>\n  <ui-codemirror ui-codemirror-opts="$ctrl.editorOptions" ng-model="$ctrl.data"></ui-codemirror>\n  <button class="btn btn-success" ng-click="$ctrl.loadData()">Load</button>{{$ctrl.status}}: {{$ctrl.message}}\n</div>\n<div class="form-group">\n  <label>query</label>\n  <yasqe on-content-changed="$ctrl.query=content" on-init="$ctrl.getPrefixes = yasqe.getPrefixesFromQuery"></yasqe>\n  <button class="btn btn-success" ng-click="$ctrl.runQuery()">Query</button>\n</div>\n<div class="form-group">\n  <label>results</label>\n  <yasr data="$ctrl.results" prefixes="$ctrl.getPrefixes"></yasr>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/sparql-autocomplete/sparql-autocomplete.html",'\n<script type="text/ng-template" id="sparql-autocomplete-item-popover">\n  <sparql-item item-id="result.ids[0]" show-remote-properties="true"></sparql-item>\n</script>\n<div class="has-feedback">\n  <input class="form-control" ng-model="$ctrl.query" ng-model-options="{ debounce: 500 }" ng-change="$ctrl.onChange($ctrl.query)" ng-focus="$ctrl.hide = false"/><span class="glyphicon glyphicon-refresh fa-spin form-control-feedback" ng-show="$ctrl.queryRunning"></span><span class="danger glyphicon glyphicon-alert form-control-feedback" ng-show="$ctrl.error"></span><span class="glyphicon glyphicon-remove form-control-feedback" ng-show="$ctrl.results" ng-click="$ctrl.clear()" style="pointer-events: auto;"></span>\n</div>\n<div ng-if="!$ctrl.hide">\n  <div ng-repeat="resultGroup in $ctrl.results.localMatchingResults track by $index">\n    <h4>{{ resultGroup.label }}</h4>\n    <ul>\n      <li ng-repeat="result in resultGroup.results track by $index" ng-click="$ctrl.onSelectInternal({result:result})">{{result.matchedLabel.value}}<span ng-if="result.matchedLabel.value !== result.prefLabel.value">-&gt; {{result.prefLabel.value}}</span><span ng-if="result.additionalInformation[\'altLabel\']">&nbsp;(<span ng-repeat="altLabel in result.additionalInformation[\'altLabel\'] | limitTo:5">{{$last ? altLabel.value : altLabel.value+\', \'}}</span><span ng-if="result.additionalInformation[\'altLabel\'].length&gt;5">, &hellip;</span>)</span>&nbsp;[<span ng-repeat="datasource in result.datasources track by $index">{{$last ? datasource.id : datasource.id+\', \'}}</span>]</li>\n    </ul>\n  </div>\n</div>\n<div ng-if="!$ctrl.hide &amp;&amp; $ctrl.results.remoteResults &amp;&amp; $ctrl.results.remoteResults.length != 0">\n  <h3>Further results</h3>\n  <div ng-repeat="resultGroup in $ctrl.results.remoteResults track by $index">\n    <h4>{{ resultGroup.label }}</h4>\n    <ul>\n      <li ng-repeat="result in resultGroup.results track by $index" ng-click="$ctrl.onSelectInternal({result:result})">{{result.matchedLabel.value}}<span ng-if="result.matchedLabel.value !== result.prefLabel.value">-&gt; {{result.prefLabel.value}}</span><span ng-if="result.additionalInformation[\'altLabel\']">&nbsp;(<span ng-repeat="altLabel in result.additionalInformation[\'altLabel\'] | limitTo:5">{{$last ? altLabel.value : altLabel.value+\', \'}}</span><span ng-if="result.additionalInformation[\'altLabel\'].length&gt;5">, &hellip;</span>)</span>&nbsp;[<span ng-repeat="datasource in result.datasources track by $index">{{$last ? datasource.id : datasource.id+\', \'}}</span>]</li>\n    </ul>\n  </div>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/sparql-item/sparql-item.html",'\n<script type="text/ng-template" id="sparql-item-popover">\n  <sparql-item endpoint="$ctrl.endpoint" item-id="value" show-remote-properties="true"></sparql-item>\n</script>\n<h4>{{$ctrl.item.label.value}}</h4><a ng-click="$ctrl.addItem()">+</a>\n<table class="table table-striped">\n  <tr ng-repeat="property in $ctrl.item.localProperties">\n    <th>{{property.label ? property.label.value : property.value}}</th>\n    <td><span ng-repeat="value in property.values" ng-click="$ctrl.onSelect({value: value})" uib-popover-template="\'sparql-item-popover\'" popover-trigger="mouseenter" popover-placement="right">{{value.label ? value.label.value : value.value}}<i class="glyphicon glyphicon-triangle-top" ng-repeat="endpoint in value.sourceEndpoints" ng-class="endpoint.class"></i>{{ $last ? \'\' : \', \' }}</span></td>\n  </tr>\n</table><i class="glyphicon glyphicon-chevron-down" ng-click="$ctrl.showRemoteProperties=!$ctrl.showRemoteProperties"></i>\n<table class="table table-striped" ng-show="$ctrl.showRemoteProperties">\n  <tr ng-repeat="property in $ctrl.item.remoteProperties">\n    <th>{{property.label ? property.label.value : property.value}}</th>\n    <td><span ng-repeat="value in property.values" ng-click="$ctrl.onSelect({value: value})" uib-popover-template="\'sparql-item-popover\'" popover-trigger="mouseenter" popover-placement="right">{{value.label ? value.label.value : value.value}}<i class="glyphicon glyphicon-triangle-top" ng-repeat="endpoint in value.sourceEndpoints" ng-class="endpoint.class"></i>{{ $last ? \'\' : \', \' }}</span></td>\n  </tr>\n</table>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/tree/tree.html",'\n<script type="text/ng-template" id="treenode.html">\n  <div class="checkbox">\n    <label>\n      <input type="checkbox" ng-model="node.selected" ng-change="$ctrl.onSelect({treeNode:node})"/>{{node.label}}\n    </label><span class="pull-left">{{node.matchingInstances != node.matchingInstances ? node.matchingInstances+\'/\'+node.instances : node.instances}}</span>\n  </div>\n  <ul>\n    <li ng-repeat="node in node.children" ng-include="\'treenode.html\'" ng-class="{selected:node.selected}"></li>\n  </ul>\n</script>\n<ul>\n  <li ng-repeat="node in $ctrl.tree" ng-include="\'treenode.html\'" ng-class="{selected:node.selected}"></li>\n</ul>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/type-select/type-select.html",'\n<script type="text/ng-template" id="type-pill.html">\n  <div class="checkbox">\n    <label>\n      <input type="checkbox" ng-model="node.selected" ng-change="$ctrl.onSelect({treeNode:node})"/>{{node.label}}\n    </label><span class="pull-left">{{node.matchingInstances != node.matchingInstances ? node.matchingInstances+\'/\'+node.instances : node.instances}}</span>\n  </div>\n  <ul>\n    <li ng-repeat="node in node.children" ng-include="\'tree-pill.html\'" ng-class="{selected:node.selected}"></li>\n  </ul>\n</script>\n<ul>\n  <li ng-repeat="node in $ctrl.tree" ng-include="\'type-pill.html\'" ng-class="{selected:node.selected}"></li>\n</ul>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/construct-view/explore-table-component/explore-table-component.html",'\n<uib-tabset>\n  <uib-tab ng-repeat="t in $ctrl.tableTypes" index="$index" heading="{{$ctrl.fibraService.getState().construct.displayTypes[$index] ? $ctrl.fibraService.getState().construct.displayTypes[$index].label : t }}">\n    <div class="widthcontainer"><a ng-click="$ctrl.downloadcsv()">Download</a>\n      <table class="exploretable table table-striped" style="table-layout: fixed;">\n        <tr>\n          <th>Label</th>\n          <th ng-repeat="p in $ctrl[t].properties" ng-click="$ctrl.removeFromProperties(p)">{{ p.label }}</th>\n          <th>Actions</th>\n        </tr>\n        <tr ng-repeat="item in $ctrl[t].items">\n          <td ng-click="$ctrl.selectItem(item)">{{ item.label.value }}</td>\n          <td ng-repeat="p in $ctrl[t].properties" ng-if="item === $ctrl.editItem">\n            <input type="text" ng-repeat="e in $ctrl.editItem.localProperties" ng-if="e.value == p.value &amp;&amp; e.values[0].value.termType === \'Literal\'" ng-model="e.values[0].value.value"/><small ng-repeat="e in item.localProperties" ng-if="e.value == p.value &amp;&amp; e.values[0].value.termType !== \'Literal\'">{{e.values[0].value.label.value}}</small>\n          </td>\n          <td ng-repeat="p in $ctrl[t].properties" ng-click="$ctrl.selectItem(item)" ng-if="item !== $ctrl.editItem"><small ng-repeat="e in item.localProperties" ng-if="e.value == p.value">\n              <p ng-repeat="i in e.values">{{i.value.label}}</p></small></td>\n          <td><a ng-click="$ctrl.hide(item)">Hide</a><a ng-click="$ctrl.verify(item)" ng-if="!$ctrl.itemVerified(item)">&nbsp;Verify</a><a ng-click="$ctrl.delete(item)">&nbsp;Delete</a><a ng-click="$ctrl.saveItem($ctrl.editItem)" ng-if="item === $ctrl.editItem">&nbsp;Save</a></td>\n        </tr>\n      </table>\n      <div>Hidden Properties (click to show)\n        <p ng-repeat="x in $ctrl.removedProperties" ng-click="$ctrl.addFromRemovedProperties(x)">{{ x }}</p>\n      </div>\n    </div>\n  </uib-tab>\n</uib-tabset>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/construct-view/explore-type-component/explore-type-component.html",'\n<div class="btn-group" uib-dropdown="uib-dropdown">\n  <button class="btn btn-primary btn-xs" id="single-button" type="button" uib-dropdown-toggle="uib-dropdown-toggle" ng-disabled="disabled">{{ $ctrl.displayTypes()[0] ? $ctrl.displayTypes()[0].label : "Primary Nodes" }}&nbsp;<span class="caret"></span></button>\n  <ul class="dropdown-menu" uib-dropdown-menu="uib-dropdown-menu" role="menu" aria-labelledby="single-button">\n    <li role="menuitem" ng-repeat="type in $ctrl.types()"><a ng-click="$ctrl.primaryClick(type)">{{type.label}} ({{type.instances}})</a></li>\n  </ul>\n</div>\n<div class="btn-group" uib-dropdown="uib-dropdown">\n  <button class="btn btn-primary btn-xs" id="single-button" type="button" uib-dropdown-toggle="uib-dropdown-toggle" ng-disabled="!$ctrl.displayTypes()[0] || $ctrl.types().length &lt; 2">{{ $ctrl.displayTypes()[1] ? $ctrl.displayTypes()[1].label : "Secondary Nodes" }}&nbsp;<span class="caret"></span></button>\n  <ul class="dropdown-menu" uib-dropdown-menu="uib-dropdown-menu" role="menu" aria-labelledby="single-button">\n    <li role="menuitem" ng-repeat="type in $ctrl.types()"><a ng-click="$ctrl.secondaryClick(type)">{{type.label}} ({{type.instances}})</a></li>\n  </ul>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/construct-view/explore-verify-component/explore-verify-component.html",'\n<div class="verify-container">\n  <div class="verify-header">Verify\n    <div class="verify-cancel pull-left" ng-click="$ctrl.clear()">X</div><span class="glyphicon glyphicon-refresh fa-spin form-control-feedback" ng-show="$ctrl.queryRunning"></span>\n  </div>\n  <div class="verify-input">\n    <input type="text" placeholder="search term" ng-model="$ctrl.queryString"/>\n    <button class="btn btn-sm btn-primary" ng-click="$ctrl.runQuery()">Search</button>\n  </div>\n  <div class="verify-content">\n    <ul class="verify-result-group" ng-repeat="grp in $ctrl.matchingResults">\n      <div class="verify-result-group-header">{{grp.label}}</div>\n      <div class="verify-result" ng-repeat="rslt in grp.results" ng-click="$ctrl.verify(rslt)">\n        <button class="btn btn-sm" ng-click="$ctrl.verify(rslt)">Verify</button><span>{{ rslt.prefLabel.value }}</span><span>{{ $ctrl.sourcesFromResult(rslt) }}</span>\n      </div>\n    </ul>\n  </div>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/construct-view/palette-component/palette-component.html",'\n<div class="inner-palette-container">\n  <div class="palette"></div>\n  <svg class="palette-node-drag"></svg>\n  <input class="palette-filter" type="text" placeholder="filter by label" ng-model="$ctrl.labelFilter" ng-change="$ctrl.update()"/><span ng-click="$ctrl.createItem($ctrl.labelFilter)"><span class="glyphicon glyphicon-plus inverse-icon"></span></span>\n  <input type="file" id="dataModelSelector" style="display:none;" onchange="angular.element(this).scope().loadCSV(this)"/>\n</div>')}])}();