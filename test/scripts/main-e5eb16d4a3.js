var fibra;!function(e){"use strict";var t=angular.module("fibra",["http-auth-interceptor","ngStorage","ui.router","ui.bootstrap","ui.bootstrap.tpls","ngAnimate"]);t.config(["$stateProvider","$urlServiceProvider","$locationProvider","$uiRouterProvider",function(e,t,r,n){t.rules.otherwise(function(e,t,r){var i=t.search;window.location.search.replace("?","").split("&").forEach(function(e){var t=e.split("=");i[t[0]]=t[1]}),i.code?n.stateService.go("callback",i):n.stateService.go("projects")}),e.state("projects",{url:"/projects",template:"<projects-view></projects-view>",data:{requiresAuth:!0}}),e.state("configure",{url:"/configure",template:"<configure-view></configure-view>",data:{requiresAuth:!0}}),e.state("select",{url:"/select",template:"<select-view></select-view>",data:{requiresAuth:!0}}),e.state("construct",{url:"/construct",template:"<construct-view></construct-view>",data:{requiresAuth:!0}}),e.state("author",{url:"/author",template:"<author-view></author-view>",data:{requiresAuth:!0}}),e.state("login",{url:"/login",template:"<login></login>",params:{redirect_hash:{type:"string",value:""}}}),e.state("callback",{url:"/callback",template:"<callback></callback>",params:{code:{type:"string",array:!1,value:""}}})}]),t.config(["$localStorageProvider",function(e){e.setKeyPrefix("fibra-")}]),t.value("workerServiceConfiguration",{appName:"fibra",workerThreads:8,importScripts:["scripts/worker-1c1af4822b.js"]}),t.run(["$rootScope","$localStorage","$http","$state","authService","$location","workerService","socialAuthService","$window","$transitions",function(e,t,r,n,i,o,a,s,l,c){e.authInfo={authOpen:!1,username:void 0,password:void 0},t.authorization&&(r.defaults.headers.common.Authorization=t.authorization,a.$broadcast("main:auth-loginAuthInfo",t.authorization)),e.setAuth=function(){e.authInfo.authOpen=!1,t.authorization="Basic "+btoa(e.authInfo.username+":"+e.authInfo.password),r.defaults.headers.common.Authorization=t.authorization,a.$broadcast("main:auth-loginAuthInfo",t.authorization),i.loginConfirmed()},e.dismissAuth=function(){e.authInfo.authOpen=!1,i.loginCancelled({status:401},"Authentication required")},e.$on("event:auth-loginRequired",function(){return e.authInfo.authOpen=!0});var p={to:function(e){return e.data&&e.data.requiresAuth}},u=function(e){if(!s.isAuthenticated())return e.router.stateService.target("login",{redirect_hash:window.location.hash})};e.socialAuthService=s,c.onBefore(p,u,{priority:10})}])}(fibra||(fibra={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},fibra;!function(e){"use strict";function t(e,t,r){return void 0===e[t]&&(e[t]=r?r(t):{}),e[t]}function r(e,t,r,n){return void 0===e[t]&&(e[t]=n?n(t):{},r.push(e[t])),e[t]}function n(e,t,r,n){void 0===t[r]&&(t[r]=n,e.push(n))}function i(e,t,r){for(var i in r)n(e,t,i,r[i])}var o=function(){function e(e){void 0===e&&(e=function(){return{}}),this.create=e,this.s={}}return e.prototype.has=function(e){return void 0!==this.s[e]},e.prototype.goc=function(e,t){return this.has(e)||this.set(e,t?t(e):this.create(e)),this.get(e)},e.prototype.set=function(e,t){return this.s[e]=t,this},e.prototype.get=function(e){return this.s[e]},e.prototype.remove=function(e){var t=this.has(e);return delete this.s[e],t},e.prototype.sets=function(e){for(var t in e)this.set(t,e[t]);return this},e.prototype.setm=function(e){for(var t in e)this.set(t,e[t]);return this},e.prototype.clear=function(){return this.s={},this},e.prototype.keys=function(){var e=[];for(var t in this.s)e.push(t);return e},e.prototype.values=function(){var e=[];for(var t in this.s)e.push(this.s[t]);return e},e.prototype.entries=function(){var e=[];for(var t in this.s)e.push({key:t,value:this.s[t]});return e},e.prototype.each=function(e){for(var t in this.s)e(this.s[t],t,this)},e.prototype.size=function(){var e=0;for(var t in this.s)e++;return e},e.prototype.empty=function(){return 0===this.size()},e}();e.EMap=o;var a=function(){function e(){this.a=[]}return e.prototype.clear=function(){return this.a=[],this},e.prototype.has=function(e){return this.a.indexOf(e)!==-1},e.prototype.add=function(e){return this.has(e)?this:(this.a.push(e),this)},e.prototype.adda=function(e){var t=this;return e.forEach(function(e){return t.add(e)}),this},e.prototype.adds=function(e){var t=this;return e.each(function(e){return t.add(e)}),this},e.prototype.remove=function(e){var t=this.a.indexOf(e);return t!==-1&&(this.a.splice(t,1),!0)},e.prototype.each=function(e){for(var t=0,r=this.a;t<r.length;t++){var n=r[t];e(n,n,this)}},e.prototype.size=function(){return this.a.length},e.prototype.empty=function(){return 0===this.size()},e.prototype.values=function(){return this.a},e}();e.IdentitySet=a;var s=function(){function e(){this.s={}}return e.prototype.clear=function(){return this.s={},this},e.prototype.has=function(e){return void 0!==this.s[e]},e.prototype.add=function(e){return this.s[e]=e,this},e.prototype.adda=function(e){var t=this;return e.forEach(function(e){return t.add(e)}),this},e.prototype.adds=function(e){var t=this;return e.each(function(e){return t.add(e)}),this},e.prototype.remove=function(e){var t=this.has(e);return delete this.s[e],t},e.prototype.each=function(e){for(var t in this.s)e(this.s[t],t,this)},e.prototype.size=function(){var e=0;for(var t in this.s)e++;return e},e.prototype.empty=function(){return 0===this.size()},e.prototype.values=function(){var e=[];for(var t in this.s)e.push(t);return e},e}();e.StringSet=s;var l=function(e){function t(t){var r=e.call(this,t)||this;return r.a=[],r}return __extends(t,e),t.prototype.goc=function(e,t){return this.has(e)||this.set(e,t?t(e):this.create(e)),this.get(e)},t.prototype.set=function(t,r){return this.has(t)||(e.prototype.set.call(this,t,r),this.a.push(r)),this},t.prototype.remove=function(t){var r=this.get(t);return void 0!==r&&(e.prototype.remove.call(this,t),this.a.splice(this.a.indexOf(r),1)),void 0!==r},t.prototype.size=function(){return this.a.length},t.prototype.values=function(){return this.a},t.prototype.clear=function(){return e.prototype.clear.call(this),this.a=[],this},t}(o);e.EOMap=l;var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.a=[],t}return __extends(t,e),t.prototype.add=function(t){return this.has(t)||(e.prototype.add.call(this,t),this.a.push(t)),this},t.prototype.remove=function(t){var r=e.prototype.remove.call(this,t);return r&&this.a.splice(this.a.indexOf(t),1),r},t.prototype.size=function(){return this.a.length},t.prototype.values=function(){return this.a},t.prototype.clear=function(){return e.prototype.clear.call(this),this.a=[],this},t}(s);e.OStringSet=c,e.goc=t,e.ogoc=r,e.cpush=n,e.cpushs=i}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e){this.workerService=e}return e.prototype.getTree=function(e,t,r){return this.workerService.call("sparqlTreeWorkerService","getTree",[e,t],r)},e}();angular.module("fibra").service("sparqlTreeService",["workerService",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),t.getClassTreeQuery='\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX sf: <http://ldf.fi/functions#>\nSELECT ?subClass ?superClass ?class ?classLabel ?instances {\n  # STARTGRAPH\n    {\n      ?groupId rdfs:subClassOf ?class .\n      FILTER EXISTS {\n        ?id a ?groupId .\n        # CONSTRAINTS\n      }\n      BIND(?groupId AS ?subClass)\n    } UNION {\n      {\n        SELECT ?groupId (COUNT(*) AS ?instances) {\n          ?id a ?groupId .\n        }\n        GROUP BY ?groupId\n      }\n      # CONSTRAINTS\n      BIND (?groupId AS ?class)\n    }\n    OPTIONAL {\n      ?class sf:preferredLanguageLiteral (skos:prefLabel rdfs:label skos:altLabel \'en\' \'\' ?classLabelP) .\n    }\n    FILTER(ISIRI(?class))\n    BIND(COALESCE(?classLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?class),".*/",""),".*#",""),"_"," "),"([A-ZÅÄÖ])"," $1")) AS ?classLabel)\n  # ENDGRAPH\n}\n',e.SparqlTreeService=t;var r=function(){function t(e){this.sparqlService=e}return t.prototype.getTree=function(t,r,n){return this.sparqlService.query(t,r,{timeout:n}).then(function(t){var r={},n={};t.data.results.bindings.forEach(function(t){if(t.classLabel&&(n[t.class.value]=new e.TreeNode(t.class.value,t.classLabel.value)),t.instances&&(n[t.class.value].instances=parseInt(t.instances.value,10)),t.subClass){var i=t.subClass.value;r[i]||(r[i]={}),r[i][t.class.value]=!0}if(t.superClass){var i=t.class.value;r[i]||(r[i]={}),r[i][t.superClass.value]=!0}});var i=[];for(var o in n)if(r[o])for(var a in r[o])n[a].children.push(n[o]);else i.push(n[o]);return i})},t}();angular.module("fibra").service("sparqlTreeWorkerService",["sparqlService",function(){return new(Function.prototype.bind.apply(r,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.SparqlTreeWorkerService=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e){this.workerService=e}return e.prototype.updateQuads=function(e,t,r){return this.workerService.call("sparqlUpdateWorkerService","update",[e,t,r])},e.prototype.updateGraphs=function(e,t,r){return this.workerService.call("sparqlUpdateWorkerService","update",[e,t,r])},e}();angular.module("fibra").service("sparqlUpdateService",["workerService",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.SparqlUpdateService=t;var r=function(){function t(e){this.sparqlService=e}return t.prototype.updateQuads=function(t,r,n){void 0===r&&(r=[]),void 0===n&&(n=[]);var i={},o={},a=[],s=[];return r.forEach(function(t){var r=i[t.graph.value];r||(r=new e.Graph(t.graph),i[t.graph.value]=r,a.push(r)),r.triples.push(t)}),n.forEach(function(t){var r=o[t.graph.value];r||(r=new e.Graph(t.graph),o[t.graph.value]=r,s.push(r)),r.triples.push(t)}),this.updateGraphs(t,a,s)},t.prototype.updateGraphs=function(r,n,i){void 0===n&&(n=[]),void 0===i&&(i=[]);var o=n.map(function(t){return(e.DefaultGraph.instance.equals(t.graph)?"":"GRAPH"+t.graph.toCanonical())+"{"+t.triples.map(function(e){return e.toCanonical()}).join(" . ")+"}"}).join(""),a=i.map(function(t){return(e.DefaultGraph.instance.equals(t.graph)?"":"GRAPH"+t.graph.toCanonical())+"{"+t.triples.map(function(e){return e.toCanonical()}).join(" . ")+"}"}).join("");return this.sparqlService.update(r,t.queryTemplate.replace(/<DELETE>/g,a).replace(/<INSERT>/g,o)).then(function(e){return 204===e.status},function(e){return!1})},t}();angular.module("fibra").service("sparqlUpdateWorkerService",["sparqlService",function(){return new(Function.prototype.bind.apply(r,[null].concat(Array.prototype.slice.apply(arguments))))}]),r.queryTemplate="DELETE{<DELETE>}INSERT{<INSERT>}WHERE {}",e.SparqlUpdateWorkerService=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e){this.sparqlItemService=e,this.items=[]}return e}();angular.module("fibra").controller("AuthorViewComponentController",["sparqlItemService",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.AuthorViewComponentController=t;var r=function(){function e(){this.controller="AuthorViewComponentController",this.templateUrl="components/author-view/author-view.html"}return e}();angular.module("fibra").component("authorView",new r),e.AuthorViewComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=angular.module("fibra");t.service("workerServicePrototypeMappingConfiguration",function(){for(var t={Object:Object.prototype},r=0,n=Object.getOwnPropertyNames(e);r<n.length;r++){var i=n[r];t[i]=e[i].prototype,e[i].__name=i}return t})}(fibra||(fibra={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},fibra;!function(e){"use strict";var t=function(){function t(t,r){this.id=t,this.name=r,this.preferredLanguage="en",this.authorityEndpoints=[],this.archiveEndpoints=[],this.globalDataModelConfiguration=new o,this.instanceNS="http://ldf.fi/fibra/",this.schemaNS="http://ldf.fi/fibra/schema#",this.deleteItemQuery=e.SparqlItemService.deleteItemQuery,this.prefixes=""}return t.prototype.allEndpoints=function(){var e=this.archiveEndpoints.concat(this.authorityEndpoints);return e.push(this.primaryEndpoint),e},t.prototype.remoteEndpoints=function(){return this.archiveEndpoints.concat(this.authorityEndpoints)},t}();e.Configuration=t;var r=function(){function e(e,t,r,n){void 0===t&&(t=null),void 0===r&&(r=null),void 0===n&&(n=null),this.name=e,this.url=t,this.rightsholder=r,this.rightsholderurl=n}return e}();e.Citation=r;var n=function(){function t(t,r,n,i,a){void 0===a&&(a=[]),this.id=t,this.name=r,this.citation=n,this.endpoint=i,this.class="",this.autocompletionTextMatchQueryTemplate=e.SparqlAutocompleteService.defaultMatchQueryTemplate,this.treeQueryTemplate=e.SparqlTreeService.getClassTreeQuery,this.localItemQueryTemplate=e.SparqlItemService.getLocalItemPropertiesQuery,this.remoteItemQueryTemplate=e.SparqlItemService.getRemoteItemPropertiesQuery,this.dataModelConfiguration=new o,this.dataModelConfiguration.setSelectedTypes(a)}return t}();e.EndpointConfiguration=n;var i=function(e){function t(t,r,n,i,o){void 0===o&&(o=i);var a=e.call(this,t,r,n,i)||this;return a.updateEndpoint=o,a}return __extends(t,e),t}(n);e.PrimaryEndpointConfiguration=i;var o=function(){function e(){this.typeConstraints="",this.typeTree=[],this.selectedTypes=[],this.properties=[],this.selectedProperties=[],this.propertyPropertyMap={},this.typeTypeMap={}}return e.prototype.setSelectedTypes=function(e){this.selectedTypes=e,this.updateFilter()},e.prototype.updateFilter=function(){0===this.selectedTypes.length?this.typeConstraints="":this.typeConstraints="FILTER (?groupId IN ("+this.selectedTypes.map(function(e){return e.toCanonical()}).join(", ")+"))"},e}();e.DataModelConfiguration=o;var a=function(){function o(o,a){this.workerService=o,this.$localStorage=a,this.presetAuthorities=[],this.presets=[];var s=new n("emlo","EMLO",new r("Early Modern Letters Online","http://emlo.bodleian.ox.ac.uk/blog/?page_id=907","Cultures of Knowledge","http://www.culturesofknowledge.org/"),new e.NamedNode("http://ldf.fi/emlo/sparql"),[e.CIDOC.Person,e.CIDOC.Place,e.CIDOC.Group]);s.autocompletionTextMatchQueryTemplate=s.autocompletionTextMatchQueryTemplate.replace(/{ # ADDITIONALVARIABLES/g,"?ifpWikipediaPage ?ifpODBNId {").replace(/# ADDITIONALSELECT/g,"\n      UNION {\n      {\n      ?id <http://emlo.bodleian.ox.ac.uk/schema#cofk_union_relationship_type-is_related_to> ?ref .\n      FILTER(REGEX(STR(?ref),'http://..\\\\.wikipedia\\\\.org/wiki/'))\n      BIND(?ref AS ?ifpWikipediaPage)\n      } UNION {\n      ?id <http://emlo.bodleian.ox.ac.uk/schema#cofk_union_relationship_type-is_related_to> ?ref .\n      FILTER(STRSTARTS(STR(?ref),'http://www.oxforddnb.com/view/article/'))\n      BIND(REPLACE(STR(?ref),'http://www.oxforddnb.com/view/article/([^?]*).*','$1') AS ?ifpODBNId)\n      }\n      }"),this.presetAuthorities.push(s);var l=new n("sdfb","SDFB",new r("Six Degrees of Francis Bacon: Reassembling the Early Modern Social Network","http://www.sixdegreesoffrancisbacon.com/about","SDFB Team","http://www.sixdegreesoffrancisbacon.com/team"),new e.NamedNode("http://ldf.fi/sdfb/sparql"),[e.CIDOC.Person,e.CIDOC.Place,e.CIDOC.Group]);l.autocompletionTextMatchQueryTemplate=l.autocompletionTextMatchQueryTemplate.replace(/{ # ADDITIONALVARIABLES/g,"?ifpODBNId {").replace(/# ADDITIONALSELECT/g,"\n      UNION {\n      ?id <http://ldf.fi/sdfb/schema#odbnId> ?ifpODBNId .\n      }\n      "),this.presetAuthorities.push(l);var c=new n("lcnames","LC Names",new r("Library of Congress Name Authority","http://id.loc.gov/authorities/names.html","Library of Congress","https://www.loc.gov/"),new e.NamedNode("http://ldf.fi/lcnames/sparql"),[e.MADS.CorporateName,e.MADS.PersonalName,e.MADS.Geographic]);this.presetAuthorities.push(c);var p=new n("procope","Procope",new r("Procope","","Dan Edelstein et al.","https://dlcl.stanford.edu/people/dan-edelstein"),new e.NamedNode("http://ldf.fi/procope/sparql"),[e.CIDOC.Person,e.CIDOC.Place,e.CIDOC.Group]);p.autocompletionTextMatchQueryTemplate=p.autocompletionTextMatchQueryTemplate.replace(/{ # ADDITIONALVARIABLES/g,"?ifpWikipediaPage {").replace(/# ADDITIONALSELECT/g,"\n      UNION {\n      ?id <http://ldf.fi/procope-schema#wikipediaUrl> ?ref .\n      BIND(IRI(?ref) AS ?ifpWikipediaPage)\n      }\n      "),this.presetAuthorities.push(p);var u='PREFIX skos: <http://www.w3.org/2004/02/skos/core#>\n      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n      PREFIX luc: <http://www.ontotext.com/owlim/lucene#>\n      PREFIX gvp: <http://vocab.getty.edu/ontology#>\n      PREFIX aat: <http://vocab.getty.edu/aat/>\n      PREFIX tgn: <http://vocab.getty.edu/tgn/>\n      SELECT ?groupId ?groupLabel ?id ?prefLabel ?matchedLabel ?sameAs ?altLabel {\n      {\n      SELECT ?id ?matchedLabel {\n      BIND(CONCAT(REPLACE(<QUERY>,"([\\\\+\\\\-\\\\&\\\\|\\\\!\\\\(\\\\)\\\\{\\\\}\\\\[\\\\]\\\\^\\\\\\"\\\\~\\\\*\\\\?\\\\:\\\\/\\\\\\\\])","\\\\$1"),"*") AS ?query)\n      ?id luc:term ?query .\n      # CONSTRAINTS\n      ?id rdfs:label ?matchedLabel .\n      } LIMIT <LIMIT>\n      } UNION {\n      BIND(CONCAT("\\"",REPLACE(<QUERY>,"([\\\\+\\\\-\\\\&\\\\|\\\\!\\\\(\\\\)\\\\{\\\\}\\\\[\\\\]\\\\^\\\\\\"\\\\~\\\\*\\\\?\\\\:\\\\/\\\\\\\\])","\\\\$1"),"\\"") AS ?query)\n      ?id luc:term ?query .\n      # CONSTRAINTS\n      ?id rdfs:label ?matchedLabel .\n      FILTER (LCASE(?matchedLabel)=LCASE(<QUERY>))\n      }\n      ?id skos:inScheme <SCHEME> .\n      FILTER (REGEX(LCASE(?matchedLabel),CONCAT("\\\\b",LCASE(<QUERY>))))\n      ?id a ?groupId .\n      ?groupId rdfs:label ?groupLabel .\n      {\n      ?id gvp:prefLabelGVP [xl:literalForm ?prefLabel] .\n      } UNION {\n      ?id skos:exactMatch|skos:closeMatch ?sameAs .\n      }\n      }',d="PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n      PREFIX gvp: <http://vocab.getty.edu/ontology#>\n      SELECT ?property ?propertyLabel ?object ?objectLabel {\n      VALUES (?id ?oid) { <IDPAIRS> }\n      ?oid ?property ?object .\n      ?property rdfs:label ?propertyLabel .\n      ?object gvp:prefLabelGVP [xl:literalForm ?objectLabel] .\n      }",h="PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n      SELECT (?groupId AS ?class) ?classLabel ?instances {\n      {\n      SELECT ?groupId (COUNT(*) AS ?instances) {\n      ?id a ?groupId .\n      # CONSTRAINTS\n      }\n      GROUP BY ?groupId\n      }\n      ?groupId rdfs:label ?classLabel .\n      }\n      ",f=new n("ulan","ULAN",new r("Getty Union List of Artist Names","http://www.getty.edu/research/tools/vocabularies/ulan/index.html","The Getty Research Institute","http://www.getty.edu/research/"),new e.NamedNode("http://ldf.fi/corsproxy/vocab.getty.edu/sparql"),[e.GETTY.PersonConcept,e.GETTY.GroupConcept]);f.autocompletionTextMatchQueryTemplate=u.replace(/<SCHEME>/g,"ulan:"),f.remoteItemQueryTemplate=d,f.treeQueryTemplate=h,this.presetAuthorities.push(f);var y=new n("tgn","TGN",new r("Getty Thesaurus of Geographic Names","http://www.getty.edu/research/tools/vocabularies/tgn/index.html","The Getty Research Institute","http://www.getty.edu/research/"),new e.NamedNode("http://ldf.fi/corsproxy/vocab.getty.edu/sparql"),[e.GETTY.AdminPlaceConcept,e.GETTY.PhysAdminPlaceConcept]);y.autocompletionTextMatchQueryTemplate=u.replace(/<SCHEME>/g,"tgn:"),y.remoteItemQueryTemplate=d,y.treeQueryTemplate=h,this.presetAuthorities.push(y);var v=new n("viaf","VIAF",new r("Virtual International Authority File","http://viaf.org/viaf/data/","OCLC Research","http://www.oclc.org/research.html"),new e.NamedNode("http://ldf.fi/viaf/sparql"),[e.CIDOC.Person,e.CIDOC.Group,e.CIDOC.Place]);v.autocompletionTextMatchQueryTemplate=v.autocompletionTextMatchQueryTemplate.replace(/# ADDITIONALSELECT/g,'\n      UNION {\n      ?id dcterms:identifier ?rid .\n      FILTER(STRSTARTS(?rid,"LC|n"))\n      BIND(IRI(REPLACE(?rid, "^LC\\\\|n *","http://id.loc.gov/authorities/names/n")) AS ?sameAs)\n      }'),this.presetAuthorities.push(v);var m=new n("geonames","GeoNames",new r("GeoNames","http://www.geonames.org/about.html"),new e.NamedNode("http://ldf.fi/geonames/sparql"));m.autocompletionTextMatchQueryTemplate='PREFIX text: <http://jena.apache.org/text#>\n      PREFIX go: <http://www.geonames.org/ontology#>\n      PREFIX owl: <http://www.w3.org/2002/07/owl#>\n      PREFIX sf: <http://ldf.fi/functions#>\n      PREFIX crm: <http://www.cidoc-crm.org/cidoc-crm/>\n      SELECT (crm:E53_Place AS ?groupId) ("Place"@en AS ?groupLabel) ?id ?prefLabel ?matchedLabel ?altLabel {\n      {\n      SELECT ?id (SUM(?sc) AS ?score) {\n      {\n        SELECT ?id ?sc {\n          BIND(CONCAT("\\"",REPLACE(<QUERY>,"([\\\\+\\\\-\\\\&\\\\|\\\\!\\\\(\\\\)\\\\{\\\\}\\\\[\\\\]\\\\^\\\\\\"\\\\~\\\\*\\\\?\\\\:\\\\/\\\\\\\\])","\\\\$1"),"\\"") AS ?query)\n          (?id ?sc) text:query ?query .\n          ?id go:name|go:alternateName ?matchedLabel\n          FILTER (LCASE(?matchedLabel)=LCASE(<QUERY>))\n        }\n        LIMIT <LIMIT>\n      } UNION {\n        SELECT ?id ?sc {\n          BIND(CONCAT(REPLACE(<QUERY>,"([\\\\+\\\\-\\\\&\\\\|\\\\!\\\\(\\\\)\\\\{\\\\}\\\\[\\\\]\\\\^\\\\\\"\\\\~\\\\*\\\\?\\\\:\\\\/\\\\\\\\])","\\\\$1"),"*") AS ?query)\n          (?id ?sc) text:query ?query .\n        }\n        LIMIT <LIMIT>\n      }\n      }\n      GROUP BY ?id\n      HAVING(BOUND(?id))\n      LIMIT <LIMIT>\n      }\n      ?id go:nanme|go:alternateName ?matchedLabel\n      FILTER (REGEX(LCASE(?matchedLabel),CONCAT("\\\\b",LCASE(<QUERY>))))\n      {\n      ?id sf:preferredLanguageLiteral (go:name go:alternateName \'\' ?prefLabel) .\n      } UNION {\n      ?id go:alternateName ?altLabel .\n      }\n      }\n      ',m.treeQueryTemplate='PREFIX go: <http://www.geonames.org/ontology#>\n      PREFIX crm: <http://www.cidoc-crm.org/cidoc-crm/>\n      SELECT (crm:E53_Place as ?class) ("Place"@en as ?classLabel) (COUNT(*) AS ?instances) {\n      ?s go:name ?o .\n      }',this.presetAuthorities.push(m);var g=new n("dbpedia-la","Latin DBPedia",new r("Latin DBpedia","http://wiki.dbpedia.org/about","DBpedia Association","http://wiki.dbpedia.org/dbpedia-association"),new e.NamedNode("http//ldf.fi/dbpedia/sparql"));this.presetAuthorities.push(g);var b=new n("pleiades","Pleiades",new r("The Pleiades Gazetteer","https://pleiades.stoa.org/home","The Pleiades Community","https://pleiades.stoa.org/credits"),new e.NamedNode("http://ldf.fi/ancore/sparql"),[e.GEOVOCAB.Feature]);this.presetAuthorities.push(b);var S;S=new t("procope","Procope"),S.primaryEndpoint=new i("local","Local",new r("Local"),new e.NamedNode("http://ldf.fi/fibra/sparql"),new e.NamedNode("http://ldf.fi/fibra/sparql")),S.primaryEndpoint.autocompletionTextMatchQueryTemplate=S.primaryEndpoint.autocompletionTextMatchQueryTemplate.replace(/# STARTGRAPH/g,"GRAPH <GRAPH> {").replace(/# ENDGRAPH/g,"}"),S.primaryEndpoint.treeQueryTemplate=S.primaryEndpoint.treeQueryTemplate.replace(/# STARTGRAPH/g,"GRAPH <GRAPH> {").replace(/# ENDGRAPH/g,"}"),S.authorityEndpoints=[f,v,y,m],S.authorityEndpoints.forEach(function(e,t){return e.class="source"+t}),S.archiveEndpoints=[s,l,p],S.archiveEndpoints.forEach(function(e,t){return e.class="source"+(S.authorityEndpoints.length+t)}),this.presets.push(S),S=new t("fbtee","French Book Trade in Enlightenment Europe"),S.primaryEndpoint=new i("local","Local",new r("Local"),new e.NamedNode("http://ldf.fi/fibra/sparql"),new e.NamedNode("http://ldf.fi/fibra/sparql")),S.primaryEndpoint.autocompletionTextMatchQueryTemplate=S.primaryEndpoint.autocompletionTextMatchQueryTemplate.replace(/# STARTGRAPH/g,"GRAPH <GRAPH> {").replace(/# ENDGRAPH/g,"}"),S.primaryEndpoint.treeQueryTemplate=S.primaryEndpoint.treeQueryTemplate.replace(/# STARTGRAPH/g,"GRAPH <GRAPH> {").replace(/# ENDGRAPH/g,"}"),S.authorityEndpoints=[f,v,y,m],S.authorityEndpoints.forEach(function(e,t){return e.class="source"+t});var w=new n("fbtee","FBTEE",new r("The French Book Trade in Enlightenment Europe","http://fbtee.uws.edu.au/main/about-the-project/","FBTEE Project","http://fbtee.uws.edu.au/main/eula/#cites"),new e.NamedNode("http://ldf.fi/fbtee/sparql"),[e.CIDOC.Person,e.CIDOC.Place,e.CIDOC.Group]);S.archiveEndpoints=[w],S.archiveEndpoints.forEach(function(e,t){return e.class="source"+(S.authorityEndpoints.length+t)}),this.presets.push(S),S=new t("aw","Ancient World"),S.primaryEndpoint=new i("local","Local",new r("Local"),new e.NamedNode("http://ldf.fi/fibra/sparql"),new e.NamedNode("http://ldf.fi/fibra/sparql")),S.primaryEndpoint.autocompletionTextMatchQueryTemplate=S.primaryEndpoint.autocompletionTextMatchQueryTemplate.replace(/# STARTGRAPH/g,"GRAPH <GRAPH> {").replace(/# ENDGRAPH/g,"}"),S.primaryEndpoint.treeQueryTemplate=S.primaryEndpoint.treeQueryTemplate.replace(/# STARTGRAPH/g,"GRAPH <GRAPH> {").replace(/# ENDGRAPH/g,"}"),S.authorityEndpoints=[b,g,y,m],S.authorityEndpoints.forEach(function(e,t){return e.class="source"+t}),S.archiveEndpoints=[],S.archiveEndpoints.forEach(function(e,t){return e.class="source"+(S.authorityEndpoints.length+t)}),this.presets.push(S),S=new t("all","All Datasources"),S.primaryEndpoint=new i("local","Local",new r("Local"),new e.NamedNode("http://ldf.fi/fibra/sparql"),new e.NamedNode("http://ldf.fi/fibra/sparql")),S.primaryEndpoint.autocompletionTextMatchQueryTemplate=S.primaryEndpoint.autocompletionTextMatchQueryTemplate.replace(/# STARTGRAPH/g,"GRAPH <GRAPH> {").replace(/# ENDGRAPH/g,"}"),S.primaryEndpoint.treeQueryTemplate=S.primaryEndpoint.treeQueryTemplate.replace(/# STARTGRAPH/g,"GRAPH <GRAPH> {").replace(/# ENDGRAPH/g,"}"),S.authorityEndpoints=[f,c,v,y,m,b],S.authorityEndpoints.forEach(function(e,t){return e.class="source"+t});var I=new n("schoenberg","Schoenberg",new r("The Schoenberg Database of Manuscripts","http://dla.library.upenn.edu/dla/schoenberg/ancillary.html?id=collections/schoenberg/about","SDBM Project","https://sdbm.library.upenn.edu/pages/About##staff"),new e.NamedNode("http://ldf.fi/schoenberg/sparql"),[e.CIDOC.Person,e.CIDOC.Place,e.CIDOC.Group]);S.archiveEndpoints=[l,s,p,w,I],S.archiveEndpoints.forEach(function(e,t){return e.class="source"+(S.authorityEndpoints.length+t)}),this.presets.push(S),S=new t("local","SPARQL endpoint on localhost"),S.primaryEndpoint=new i("local","Local",new r("Local"),new e.NamedNode("http://localhost:3030/fibra/sparql"),new e.NamedNode("http://localhost:3030/fibra/update")),S.primaryEndpoint.treeQueryTemplate='\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX sf: <http://ldf.fi/functions#>\nSELECT ?subClass ?superClass ?class ?classLabel ?instances {\n    # STARTGRAPH\n    {\n      ?groupId rdfs:subClassOf ?class .\n      FILTER EXISTS {\n        ?id a ?groupId .\n        # CONSTRAINTS\n      }\n      BIND(?groupId AS ?subClass)\n    } UNION {\n      {\n        SELECT ?groupId\t(COUNT(*) AS ?instances) {\n          ?id a ?groupId .\n        }\n        GROUP BY ?groupId\n      }\n      # CONSTRAINTS\n      BIND (?groupId AS ?class)\n    }\n    OPTIONAL {\n      ?class skos:prefLabel|rdfs:label|skos:altLabel ?classLabelP .\n      FILTER(LANG(?classLabelP)=\'\' || LANG(?classLabelP)=\'<PREFLANG>\')\n    }\n    FILTER(ISIRI(?class))\n    BIND(COALESCE(?classLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?class),".*/",""),".*#",""),"_"," "),"([A-ZÅÄÖ])"," $1")) AS ?classLabel)\n  # ENDGRAPH\n}\n',S.primaryEndpoint.treeQueryTemplate=S.primaryEndpoint.treeQueryTemplate.replace(/# STARTGRAPH/g,"GRAPH <GRAPH> {").replace(/# ENDGRAPH/g,"}"),S.primaryEndpoint.autocompletionTextMatchQueryTemplate=e.SparqlAutocompleteService.naiveMatchQueryTemplate,S.primaryEndpoint.localItemQueryTemplate=e.SparqlItemService.naiveGetLocalItemPropertiesQuery,this.presets.push(S),S=new t("local","SPARQL endpoint on localhost (with all authorities & archives)"),S.primaryEndpoint=new i("local","Local",new r("Local"),new e.NamedNode("http://localhost:3030/fibra/sparql"),new e.NamedNode("http://localhost:3030/fibra/update")),S.primaryEndpoint.treeQueryTemplate='\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX sf: <http://ldf.fi/functions#>\nSELECT ?subClass ?superClass ?class ?classLabel ?instances {\n    # STARTGRAPH\n    {\n      ?groupId rdfs:subClassOf ?class .\n      FILTER EXISTS {\n        ?id a ?groupId .\n        # CONSTRAINTS\n      }\n      BIND(?groupId AS ?subClass)\n    } UNION {\n      {\n        SELECT ?groupId\t(COUNT(*) AS ?instances) {\n          ?id a ?groupId .\n        }\n        GROUP BY ?groupId\n      }\n      # CONSTRAINTS\n      BIND (?groupId AS ?class)\n    }\n    OPTIONAL {\n      ?class skos:prefLabel|rdfs:label|skos:altLabel ?classLabelP .\n      FILTER(LANG(?classLabelP)=\'\' || LANG(?classLabelP)=\'<PREFLANG>\')\n    }\n    FILTER(ISIRI(?class))\n    BIND(COALESCE(?classLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?class),".*/",""),".*#",""),"_"," "),"([A-ZÅÄÖ])"," $1")) AS ?classLabel)\n  # ENDGRAPH\n}\n',S.primaryEndpoint.treeQueryTemplate=S.primaryEndpoint.treeQueryTemplate.replace(/# STARTGRAPH/g,"GRAPH <GRAPH> {").replace(/# ENDGRAPH/g,"}"),S.primaryEndpoint.autocompletionTextMatchQueryTemplate=e.SparqlAutocompleteService.naiveMatchQueryTemplate,S.primaryEndpoint.localItemQueryTemplate=e.SparqlItemService.naiveGetLocalItemPropertiesQuery,S.authorityEndpoints=[f,c,v,y,m,b],S.authorityEndpoints.forEach(function(e,t){return e.class="source"+t}),S.archiveEndpoints=[l,s,p,w,I],S.archiveEndpoints.forEach(function(e,t){return e.class="source"+(S.authorityEndpoints.length+t)}),this.presets.push(S),this.configuration=a.configuration,this.configuration&&(o.restorePrototypes(this.configuration),this.workerService.callAll("configurationWorkerService","setConfiguration",[this.configuration]))}return o.prototype.setConfiguration=function(t){e.WorkerService.savePrototypes(t),this.$localStorage.configuration=t,this.configuration=t,this.workerService.callAll("configurationWorkerService","setConfiguration",[t])},o}();angular.module("fibra").service("configurationService",["workerService","$localStorage",function(){return new(Function.prototype.bind.apply(a,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.ConfigurationService=a;var s=function(){function e(){}return e.prototype.setConfiguration=function(e){this.configuration=e},e}();angular.module("fibra").service("configurationWorkerService",[function(){return new(Function.prototype.bind.apply(s,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.ConfigurationWorkerService=s}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t="PLACEHOLDER",r="CREATE_TYPE",n="CREATE_ITEMS",i="CREATE_DISPLAY_ITEMS",o="DELETE_ITEMS",a="VERIFY_ITEM",s="ADD_TYPE",l="CLEAR_TYPES",c="DISPLAY_ITEMS",p="HIDE_ITEM",u="CREATE_LOCAL_ITEM",d="ITEM_PROPERTIES",h="SET_ORDERED_TYPES",f={construct:{types:[],userTypes:[],displayTypes:[],items:[],itemIndex:{},localItems:[],verifyItem:null},actionsRunning:0},y={type:"",payload:null},v=function(){function v(e,t,r){this.sparqlItemService=t,this.sparqlTreeService=r,this.callbacks={},this.q=e,this.createState()}return v.prototype.on=function(e,t){var r=this;return void 0===this.callbacks[e]&&(this.callbacks[e]=Array()),this.callbacks[e].push(t),function(){r.callbacks[e].indexOf(t)!==-1&&r.callbacks[e].splice(r.callbacks[e].indexOf(t),1)}},v.prototype.dispatch=function(e){var t=this.callbacks[e].map(function(e){return e()});return this.q.all(t)},v.prototype.createState=function(){this.state=f,this.store||this.createStore()},v.prototype.createStore=function(){this.store=[this.state]},v.prototype.placeHolderAction=function(e){return{type:t,payload:e}},v.prototype.createLocalItem=function(e){return{type:u,payload:e
}},v.prototype.displayItem=function(e,t){return{type:c,payload:{items:[e],coordinates:[t]}}},v.prototype.displayItems=function(e,t){return{type:c,payload:{items:e,coordinates:t}}},v.prototype.hideItem=function(e){return{type:p,payload:e}},v.prototype.itemProperty=function(e,t,r){return{type:d,payload:{item:e,propertiesToAdd:t,propertiesToRemove:r}}},v.prototype.createItem=function(e,t){return{type:n,payload:{items:[e],type:t}}},v.prototype.createItems=function(e,t){return{type:n,payload:{items:e,type:t}}},v.prototype.createDisplayItem=function(e,t){return{type:i,payload:{items:[e],type:t}}},v.prototype.createDisplayItems=function(e,t){return{type:i,payload:{items:e,type:t}}},v.prototype.deleteItem=function(e){return{type:o,payload:[e]}},v.prototype.verifyItem=function(e){return{type:a,payload:e}},v.prototype.addType=function(e){return{type:s,payload:e}},v.prototype.clearTypes=function(){return{type:l,payload:void 0}},v.prototype.setOrderedTypes=function(e){return{type:h,payload:e}},v.prototype.createType=function(e){return{type:r,payload:e}},v.prototype.itemReducer=function(e,t){var r=this;switch(void 0===e&&(e=f),void 0===t&&(t=y),t.type){case c:return t.payload.items.forEach(function(r,n){e.construct.itemIndex[r.value]||(e.construct.items.push(r),e.construct.itemIndex[r.value]=r,t.payload.coordinates&&t.payload.coordinates[n]&&t.payload.coordinates[n][0]&&t.payload.coordinates[n][1]&&(e.construct.itemIndex[r.value].x=t.payload.coordinates[n][0],e.construct.itemIndex[r.value].y=t.payload.coordinates[n][1]))}),this.dispatch("change"),this.q.resolve(e);case p:var s=e.construct.itemIndex[t.payload.value];return s&&(e.construct.items.splice(e.construct.items.indexOf(s),1),delete e.construct.itemIndex[t.payload.value]),this.dispatch("change"),this.q.resolve(e);case u:var l=t.payload;return e.construct.localItems.push(l),this.q.resolve(e);case n:return this.createItemsInternal(t,e).then(function(t){return e});case i:return this.createItemsInternal(t,e).then(function(e){return r.dispatchAction(r.displayItems(e))});case o:return this.q.all(t.payload.map(function(e){return r.sparqlItemService.deleteItem(e)})).then(function(){return r.dispatch("change"),r.state});case a:return this.state.construct.verifyItem=t.payload,this.dispatch("change"),this.q.resolve(this.state);case d:return this.sparqlItemService.alterItem(t.payload.item,t.payload.propertiesToAdd,t.payload.propertiesToRemove).then(function(e){return r.state});default:return this.q.resolve(e)}},v.prototype.constructReducer=function(n,i){var o=this;switch(void 0===n&&(n=f),void 0===i&&(i=y),i.type){case t:return i.payload.then(function(){return n});case s:n.construct.types.push(i.payload);var a=n.construct.userTypes.filter(function(e){return e.id===i.payload.id})[0];return a&&n.construct.userTypes.splice(n.construct.userTypes.indexOf(a),1),this.q.resolve(n);case l:return n.construct.types=[],this.q.resolve(n);case h:return n.construct.displayTypes=i.payload,this.q.resolve(n);case r:var c=new e.PropertyToValues(e.SKOS.prefLabel);return c.values.push(e.DataFactory.instance.literal(i.payload)),this.sparqlItemService.createNewItem([],[c]).then(function(t){var r=new e.TreeNode(t.value,i.payload);return o.state.construct.userTypes.push(r),o.state});default:return this.q.resolve(n)}},v.prototype.createItemsInternal=function(t,r){var n=this,i=t.payload.items,o=t.payload.type?e.DataFactory.instance.namedNode(t.payload.type):e.OWL.Thing;if(i[0]){var a=i.map(function(t){var r=new e.PropertyToValues(e.SKOS.prefLabel),i=new e.PropertyToValues(e.RDF.type);return i.values.push(o),t.value?(r.values.push(e.DataFactory.instance.literal(t.value)),n.sparqlItemService.createNewItem([],[r,i])):n.sparqlItemService.createNewItem([],[i])});return this.q.all(a)}var s=new e.PropertyToValues(e.RDF.type);s.values.push(o);var l=new e.PropertyToValues(e.SKOS.prefLabel);return l.values.push(e.DataFactory.instance.literal("")),this.sparqlItemService.createNewItem([],[s,l]).then(function(e){return[e]})},v.prototype.dispatchAction=function(e){var t=this;return this.state.actionsRunning=this.state.actionsRunning+1,console.log(e.type,this.state.actionsRunning),this.dispatch("action"),this.constructReducer(this.state,e).then(function(r){return t.itemReducer(r,e)}).then(function(e){return t.state.actionsRunning=t.state.actionsRunning-1,e})},v.prototype.getState=function(){return this.state},v.prototype.undo=function(){},v}();angular.module("fibra").service("fibraService",["$q","sparqlItemService","sparqlTreeService",function(){return new(Function.prototype.bind.apply(v,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.FibraService=v}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e,t){this.$localStorage=e,this.$state=t}return e.prototype.loginState=function(){return this.$localStorage.user_email?this.$localStorage.user_email+" (via "+this.$localStorage.login_provider+")":"Not logged in"},e.prototype.isLoggedIn=function(){return null!==this.$localStorage.user_email&&void 0!==this.$localStorage.user_email},e.prototype.isAuthenticated=function(){return!!this.$localStorage.access_token},e.prototype.logout=function(){this.$localStorage.access_token=null,this.$localStorage.login_provider=null,this.$localStorage.user_email=null,this.$state.go("projects")},e}();angular.module("fibra").service("socialAuthService",["$localStorage","$state",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.SocialAuthService=t}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function t(e,t,r){var n=this;this.configurationService=e,this.sparqlTreeService=t,this.$state=r,this.configurations=[],this.statistics={},this.configurations=e.presets,e.presetAuthorities.forEach(function(e){return n.calculateStatistics(e)})}return t.prototype.setConfiguration=function(e){this.configurationService.setConfiguration(e),this.$state.go("select")},t.prototype.calculateStatistics=function(t){var r=this;t.treeQueryTemplate=t.treeQueryTemplate.replace(/# CONSTRAINTS/g,t.dataModelConfiguration.typeConstraints),this.sparqlTreeService.getTree(t.endpoint.value,t.treeQueryTemplate).then(function(n){for(var i=[],o=function(e,t){return 1===t.length?t:[e]},a=0,s=n;a<s.length;a++){var l=s[a];i=i.concat(e.TreeNode.recursivelyMap(l,o))}console.log(t.id,i),r.statistics[t.id]=i})},t}();angular.module("fibra").controller("ConfigureViewComponentController",["configurationService","sparqlTreeService","$state",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.ConfigureViewComponentController=t;var r=function(){function e(){this.controller="ConfigureViewComponentController",this.templateUrl="components/configure-view/configure-view.html"}return e}();angular.module("fibra").component("configureView",new r),e.ConfigureViewComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function t(e,t){this.configurationService=e,this.$state=t}return t.prototype.setProject=function(t){var r;r="set1"===t?this.configurationService.presets[2]:this.configurationService.presets[0],r.graph=e.DataFactory.instance.namedNode("http://ldf.fi/fibra/"+t+"/"),r.primaryEndpoint.localItemQueryTemplate=r.primaryEndpoint.localItemQueryTemplate.replace(/GRAPH <GRAPH>/g,"GRAPH <http://ldf.fi/fibra/"+t+"/>"),r.primaryEndpoint.autocompletionTextMatchQueryTemplate=r.primaryEndpoint.autocompletionTextMatchQueryTemplate.replace(/GRAPH <GRAPH>/g,"GRAPH <http://ldf.fi/fibra/"+t+"/>"),r.primaryEndpoint.treeQueryTemplate=r.primaryEndpoint.treeQueryTemplate.replace(/GRAPH <GRAPH>/g,"GRAPH <http://ldf.fi/fibra/"+t+"/>"),r.deleteItemQuery=r.deleteItemQuery.replace(/GRAPH <GRAPH>/g,"GRAPH <http://ldf.fi/fibra/"+t+"/>"),this.configurationService.setConfiguration(r),this.$state.go("construct")},t}();angular.module("fibra").controller("ProjectsViewComponentController",["configurationService","$state",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.ProjectsViewComponentController=t;var r=function(){function e(){this.controller="ProjectsViewComponentController",this.templateUrl="components/projects-view/projects-view.html"}return e}();angular.module("fibra").component("projectsView",new r),e.ProjectsViewComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=(function(){function e(e,t){this.endpoint=e,this.queryTemplate=t}return e}(),function(){function t(t,r,n,i,o,a,s,l){var c=this;this.configurationService=t,this.sparqlTreeService=r,this.sparqlItemService=n,this.socialAuthService=i,this.$localStorage=o,this.$sessionStorage=a,this.fibraService=s,this.$q=l,this.types=[],this.limitFilter="",this.paletteDisplay=!1,s.on("change",function(){var e=s.getState().construct.displayTypes;return c.limitFilter="",e.forEach(function(e){e&&(c.limitFilter+="<"+e.id+">,")}),0!==c.limitFilter.length&&(c.limitFilter="FILTER (?groupId IN ("+c.limitFilter.substring(0,c.limitFilter.length-1)+"))"),c.$q.resolve("ok")}),this.classTreePromise=r.getTree(this.configurationService.configuration.primaryEndpoint.endpoint.value,this.configurationService.configuration.primaryEndpoint.treeQueryTemplate),this.classTreePromise.then(function(e){c.classTree=e,c.fibraService.dispatchAction(c.fibraService.clearTypes()),c.types=c.fibraService.getState().construct.types;var t=function(e){return c.fibraService.dispatchAction(c.fibraService.addType(e))};c.traverseClassTree(e,function(e){return c.types.indexOf(e)===-1&&0===e.children.length},function(e){return t(e)})}),this.fibraService.on("change",function(){return c.classTreePromise=r.getTree(c.configurationService.configuration.primaryEndpoint.endpoint.value,e.SparqlTreeService.getClassTreeQuery),c.classTreePromise.then(function(e){return c.classTree=e,"ok"})}),this.fibraService.on("action",function(){return c.state=s.getState(),c.$q.resolve("ok")}),this.state=s.getState()}return t.prototype.createItem=function(e){var t=e.additionalInformation.type[0]?e.additionalInformation.type[0].value:"",r=this.types.filter(function(e){return e.id===t})[0],n=this.fibraService.getState().construct.displayTypes;if(!n[0]&&r)this.fibraService.dispatchAction(this.fibraService.setOrderedTypes([r]));else if(!n[1]&&r&&n[0]!==r){var i=n.concat([]);i.push(r),this.fibraService.dispatchAction(this.fibraService.setOrderedTypes(i))}return this.fibraService.dispatchAction(this.fibraService.displayItem(e.ids[0]))},t.prototype.downloadRDF=function(){var e=this.configurationService.configuration.graph.value,t="http://ldf.fi/fibra/sparql?graph="+e,r=new XMLHttpRequest;r.open("GET",t,!0),r.onload=function(e){if(4===r.readyState)if(200===r.status){var t=r.responseText,n=document.createElement("a");n.href="data:application/rdf+xml;charset=utf-8,"+t,n.download="fibra.ttl",document.body.appendChild(n),n.click(),document.body.removeChild(n)}else console.error(r.statusText)},r.send(null)},t.prototype.traverseClassTree=function(e,t,r){var n=function(e){t(e)&&(r(e),e.children.forEach(n))};e.forEach(n)},t}());angular.module("fibra").controller("ConstructViewComponentController",["configurationService","sparqlTreeService","sparqlItemService","socialAuthService","$localStorage","$sessionStorage","fibraService","$q",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.ConstructViewComponentController=t;var r=function(){function e(){this.controller="ConstructViewComponentController",this.templateUrl="components/construct-view/construct-view.html"}return e}();angular.module("fibra").component("constructView",new r),e.ConstructViewComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function t(t,r,n,i,o,a,s,l){var c=this;this.$element=t,this.$compile=r,this.$window=n,this.$scope=i,this.$timeout=o,this.sparqlItemService=a,this.fibraService=s,this.$q=l,this.primaryItems=[],this.secondaryItems=[],this.tertiaryItems=[],this.untypedItems=[],this.removedUntypedItems=[],this.allItems=[],this.radius=8,this.gridOffset=50,this.chargeForce=d3.forceCollide(this.gridOffset/1.5),this.chargeForce2=d3.forceCollide(this.gridOffset/1.5),this.svgBackgroundColor="#EEE",this.lastClickX=0,this.lastClickY=0,this.verifyItem=null,this.sunburst=new e.Sunburst(t,r,i,a,s),this.propertyPopover=new e.PropertyPopover(t,i,s,r),this.fibraService.on("change",function(){return c.verifyItem=c.fibraService.getState().construct.verifyItem,c.queryAndBuild()}),this.itemService=a,this.links=[],this.$scope.layout={choice:"force",links:"hide"},this.$scope.$watch("layout.choice",this.updateExplore.bind(this,!1)),this.$scope.$watch("layout.links",this.updateExplore.bind(this,!1))}return t.prototype.$onChanges=function(e){this.svgSel&&this.updateExplore(!1,!1)},t.prototype.$postLink=function(){var e=this;this.svgSel=d3.select(this.$element[0]).select("svg"),this.svgSel.append("rect").classed("background",!0).style("fill",this.svgBackgroundColor).on("click",function(){e.lastClickX=d3.event.offsetX,e.lastClickY=d3.event.offsetY,e.fibraService.dispatchAction(e.fibraService.createDisplayItem())}),this.svgSel.append("g").attr("class","links"),this.sunburst.addSunburstGroup(this.svgSel),this.forceSim=d3.forceSimulation().force("charge",this.chargeForce).force("charge2",this.chargeForce2).force("link",d3.forceLink().id(function(e){return""+e.index})),this.radius=8,this.tooltip=d3.select("body").append("div").style("position","absolute").style("z-index","20").style("background-color","gray").style("color","white").style("padding","3px").style("border-radius","2px").style("visibility","hidden"),this.edittip=d3.select("body").append("div").attr("id","edittip").style("position","absolute").style("z-index","40").style("background-color","white").style("color","gray").style("border","1px solid gray").style("padding","3px").style("border-radius","2px").style("visibility","hidden"),this.updateSizing(),this.queryAndBuild()},t.prototype.queryAndBuild=function(){var t=this,r=this.sparqlItemService.getItems(this.fibraService.getState().construct.items,!1).then(function(r){console.log("Items in explore",r),t.propertyPopover.hidePopover(),t.lockExisting(t.primaryItems),t.lockExisting(t.secondaryItems),t.lockExisting(t.tertiaryItems);var n=t.fibraService.getState().construct.displayTypes,i=t.filterItemsByType(r,e.OWL.Thing.value);if(t.removedUntypedItems=t.untypedItems.filter(function(e){return i.indexOf(e)===-1}),t.untypedItems=t.mergeNodes(t.untypedItems,t.filterItemsByType(r,e.OWL.Thing.value)),n[0]&&(t.primaryItems=t.mergeNodes(t.primaryItems,t.filterItemsByType(r,n[0].id))),n[1]&&(t.secondaryItems=t.mergeNodes(t.secondaryItems,t.filterItemsByType(r,n[1].id))),n[2]&&(t.tertiaryItems=t.mergeNodes(t.tertiaryItems,t.filterItemsByType(r,n[2].id))),t.allItems=t.primaryItems.concat(t.secondaryItems).concat(t.tertiaryItems).concat(t.untypedItems),t.properties=[],t.primaryItems[0]&&t.primaryItems[0].localProperties)for(var o=0,a=t.primaryItems[0].localProperties;o<a.length;o++){var s=a[o];t.properties.push({key:s.toCanonical(),value:s.label.value})}return t.links=t.mergeLinks(t.links),console.log(t.links),"ok"}).then(function(){return t.updateExplore()});return this.fibraService.dispatchAction(this.fibraService.placeHolderAction(r)),r},t.prototype.lockExisting=function(e){e.forEach(function(e){e.fx=e.gx,e.fy=e.gy})},t.prototype.filterItemsByType=function(e,t){return e.filter(function(e){var r=e.localProperties.concat(e.remoteProperties).filter(function(e){return"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===e.value});return!!r[0]&&r[0].values.map(function(e){return e.value}).indexOf(t)!==-1})},t.prototype.updateSizing=function(){var e=window.innerWidth,t=window.innerHeight;this.exploreWidth=e,this.exploreHeight=t-36,d3.select(this.$element[0]).select("#explorecontainer").style("height",this.exploreHeight+"px"),d3.select(this.$element[0]).select("#exploretable").style("height",t-50+"px"),this.svgSel.style("width",e+"px").style("height",t-36+"px"),this.svgSel.select("rect.background").style("width",e+"px").style("height",t-36+"px");var r=+this.svgSel.style("width").replace("px",""),n=+this.svgSel.style("height").replace("px","");this.forceSim.force("center",d3.forceCenter(r/2,n/2)),this.forceSim.force("xposition",d3.forceX(r/2).strength(.01)),this.forceSim.force("yposition",d3.forceY(n/2).strength(.01))},t.prototype.appendNodes=function(t,r){var n=this;return t.append("g").attr("id",function(e,t){return"node-"+t+"-"+r}).attr("class","node").classed(r,!0).append("circle").classed("node-circle",!0).classed(r,!0).attr("id",function(e,t){return"node-circle-"+t+"-"+r}).attr("r",this.radius+"px").call(d3.drag().on("start",function(e,t){n.linkMode?n.dragline=n.svgSel.append("line").attr("class","dragLine"):(e.fx=e.x,e.fy=e.y)}).on("drag",function(e,t,r){n.linkMode?n.dragline.attr("x1",e.x).attr("y1",e.y).attr("x2",d3.event.x).attr("y2",d3.event.y):(d3.select(r[t]).classed("fixed",!0),e.x=d3.event.x,e.y=d3.event.y,d3.select(r[t]).classed("selected-circle")),n.updateExplore(!1,!1)}).on("end",function(t,r,i){if(n.linkMode){var o=+n.dragline.attr("x2"),a=+n.dragline.attr("y2"),s=!1;d3.selectAll(".node").each(function(r,i){if(Math.abs(o-r.x)<n.radius&&Math.abs(a-r.y)<n.radius){s=!0;var l=new e.PropertyToValues(e.SKOS.related);l.values.push(e.DataFactory.instance.nodeFromNode(t)),n.fibraService.dispatchAction(n.fibraService.itemProperty(r,[l],[])).then(function(e){return n.dragline.remove(),n.queryAndBuild(),e})}}),s||n.dragline.remove()}else d3.select(i[r]).classed("fixed")||(t.fx=void 0,t.fy=void 0)})).on("mouseover",function(e,t){n.highlightLinks(e,t),n.tooltip.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px").style("visibility","visible").text(e.label.value)}).on("mouseout",function(e,t){n.svgSel.selectAll("line").classed("relevant",!1),n.tooltip.style("visibility","hidden")}).on("click",function(e,t,r){n.forceSim.stop();var i=e.selected;n.svgSel.selectAll(".node").each(function(e){e.selected=!1}),e.selected=!i,n.updateExplore(!1),e.selected?n.svgSel.select("g.sunburst-overlay").datum(e).each(n.sunburst.buildSunburst.bind(n)).style("display","block"):n.svgSel.select(".sunburst-overlay").style("display","none"),n.highlightLinks(e,t)})},t.prototype.snapToGrid=function(e,t,r){void 0===r&&(r=!0);var n,i;return r?(n=Math.round(e/this.gridOffset)*this.gridOffset,i=Math.round(t/this.gridOffset)*this.gridOffset):(n=Math.round(e/this.gridOffset)*this.gridOffset-this.gridOffset/2,i=Math.round(t/this.gridOffset)*this.gridOffset-this.gridOffset/2),[n,i]},t.prototype.tickTransformNodes=function(e,t){var r=this;if(void 0===t&&(t=!0),e.attr("transform",function(e,n){var i=e.x,o=e.y;e.x<r.radius&&(i=r.radius),e.y<r.radius&&(o=r.radius);var a=[i,o],s=a[0],l=a[1];return"forcegrid"===r.$scope.layout.choice&&(c=r.snapToGrid(i,o,t),s=c[0],l=c[1]),e.gx=s,e.gy=l,"translate("+s+", "+l+")";var c}),e.filter(function(e){return e.selected}).node()){var n=this.sunburst.buildSunburst,i=this.svgSel,o=function(e,t,r){i.select("g.sunburst-overlay").datum(e).each(n.bind(this))};e.filter(function(e){return e.selected}).each(o.bind(this))}},t.prototype.genericTick=function(e,t,r,n,i){var o=this;void 0===i&&(i=!1);var a=e,s=t,l=r,c=n;i&&(a=a.transition(),s=s.transition(),l=l.transition(),c=c.transition()),this.tickTransformNodes(a,!0),this.tickTransformNodes(s,!1),this.tickTransformNodes(l,!1),this.svgSel.selectAll(".node-circle").classed("selected-circle",function(e){return e.selected}).attr("r",function(e){return o.radius+(e.selected?3:0)+"px"}).style("cursor",this.linkMode?"crosshair":"initial"),this.svgSel.selectAll(".node-circle").classed("labeled",function(e){return!!e.label.value}).classed("verified",function(e){return e.localProperties.filter(function(e){return"http://www.w3.org/2002/07/owl#sameAs"===e.value}).length>0}),c.attr("x1",function(e){return e.source.gx}).attr("y1",function(e){return e.source.gy}).attr("x2",function(e){return e.target.gx}).attr("y2",function(e){return e.target.gy})},t.prototype.updateExplore=function(e,t){var r=this;void 0===e&&(e=!0),void 0===t&&(t=!1);var n=this.svgSel.selectAll("circle.untyped").data(this.untypedItems,function(e){return e.value}),i=this.svgSel.selectAll("circle.primary").data(this.primaryItems,function(e){return e.value}),o=this.svgSel.selectAll("circle.secondary").data(this.secondaryItems,function(e){return e.value});i.exit().remove(),o.exit().remove(),n.exit().remove(),n.enter().each(function(e,t,n){e.fx=r.lastClickX,e.fy=r.lastClickY,e.gx=r.lastClickX,e.gy=r.lastClickY}).each(this.propertyPopover.addPopover.bind(this,this.$scope,this.fibraService.getState().construct.types,this.svgSel));var a=function(e){e.fx=r.fibraService.getState().construct.itemIndex[e.value].x,e.fy=r.fibraService.getState().construct.itemIndex[e.value].y,e.gx=r.fibraService.getState().construct.itemIndex[e.value].x,e.gx=r.fibraService.getState().construct.itemIndex[e.value].y;var t=r.removedUntypedItems.filter(function(t){return t.value===e.value})[0];t&&(e.fx=t.fx,e.fy=t.fy,e.gx=t.gx,e.gy=t.gy)};i.enter().each(a),o.enter().each(a),i=i.merge(this.appendNodes(i.enter(),"primary")),o=o.merge(this.appendNodes(o.enter(),"secondary")),n=n.merge(this.appendNodes(n.enter(),"untyped"));var s=this.svgSel.select("g.links").selectAll("line").data(this.links);s.exit().remove(),s=s.enter().append("line").attr("id",function(e,t){return"link-"+t}).on("mouseover",function(e,t){r.tooltip.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px").style("visibility","visible").text(e.property.label.value)}).on("mouseout",function(e,t){r.tooltip.style("visibility","hidden")}).merge(s).style("visibility","show"===this.$scope.layout.links?"visible":"hidden"),this.sunburst.addSunburstGroup(this.svgSel),this.forceSim.stop();var l=this.genericTick.bind(this,i,o,n,s,!1);this.forceSim.nodes(this.primaryItems.concat(this.secondaryItems).concat(this.untypedItems)).on("tick",l),this.forceSim.force("link").links(this.links);var c=this.forceSim.force("charge"),p=this.forceSim.force("charge2");this.forceSim.force("center"),this.forceSim.force("xposition"),this.forceSim.force("yposition");return c.initialize&&c.initialize(this.primaryItems),p.initialize&&p.initialize(this.secondaryItems),e?this.forceSim.alpha(1).restart():this.genericTick(i,o,n,s,t),this.$q.resolve("ok")},t.prototype.highlightLinks=function(e,t){d3.selectAll("line").classed("relevant",!1);for(var r=0;r<this.links.length;r++){var n=this.links[r].source,i=this.links[r].target;n.index!==t&&i.index!==t||d3.select("#link-"+r).classed("relevant",!0)}},t.prototype.mergeNodes=function(e,t){for(var r=[],n=0;n<e.length;n++)for(var i=0;i<t.length;i++)e[n].toCanonical()===t[i].toCanonical()&&(r.push(e[n]),e[n].label=t[i].label,e[n].localProperties=t[i].localProperties);for(var n=0;n<t.length;n++){for(var o=!1,i=0;i<r.length;i++)r[i].toCanonical()===t[n].toCanonical()&&(o=!0);o||r.push(t[n])}return r},t.prototype.mergeLinks=function(t){for(var r=[],n=this.primaryItems.concat(this.secondaryItems),i=new e.ENodeMap,o=0,a=n;o<a.length;o++){var s=a[o];i.set(s,s);var l=s.localProperties.filter(function(t){return e.OWL.sameAs.equals(t)})[0];if(l&&l.values)for(var c=0,p=l.values;c<p.length;c++){var u=p[c];i.set(u,s)}}for(var d=0,h=n;d<h.length;d++)for(var s=h[d],f=0,y=s.localProperties;f<y.length;f++)for(var v=y[f],m=0,g=v.values;m<g.length;m++){var b=g[m];i.has(b)&&s!==i.get(b)&&n.indexOf(i.get(b))!==-1&&r.push({source:s,target:i.get(b),property:v})}return r},t}();angular.module("fibra").controller("ExploreComponentController",["$element","$compile","$window","$scope","$timeout","sparqlItemService","fibraService","$q",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]);var r=function(){function e(){this.bindings={linkMode:"<"},this.controller="ExploreComponentController",this.templateUrl="components/construct-view/explore.html"}return e}();angular.module("fibra").component("explore",new r),e.ExploreComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e,t,r,n){this.$element=e,this.$scope=t,this.fibraService=r,this.$compile=n,this.propertyPopover=d3.select(e[0]).append("div").classed("property-popover",!0)}return e.prototype.addPopover=function(e,t,r,n,i,o){var a=d3.select(r.node().parentElement.parentElement).select("div.property-popover");a.select("property-popover").remove(),a.style("left",n.fx-3+"px").style("top",n.fy+12+"px");var s=e.$new(!0);s.node=n,s.types=t,s.close=function(){a.style("visibility","hidden")},console.log(s.close),a.node().appendChild(this.$compile('<property-popover node="node" types="types" close="close"></property-popover>')(s)[0]),a.style("visibility","visible")},e.prototype.hidePopover=function(){this.propertyPopover.style("visibility","hidden")},e}();e.PropertyPopover=t;var r=function(){function e(){this.bindings={types:"=",node:"=",close:"="},this.templateUrl="components/construct-view/property-popover-component.html",this.controller="PropertyPopoverComponentController"}return e}();angular.module("fibra").component("propertyPopover",new r),e.PropertyPopoverComponent=r;var n=function(){function t(t,r,n,i){var o=this;this.fibraService=t,this.sparqlItemService=r,this.$scope=n,this.$q=i,this.thingType=e.OWL.Thing.value,this.showTypeCreate=!1,this.typeQuery="",this.typeQueryGS=function(e){return void 0!==e&&(o.typeQuery=e),o.typeQuery},this.getTypes=function(){return o.fibraService.getState().construct.types.concat(o.fibraService.getState().construct.userTypes)}}return t.prototype.$postLink=function(){this.label=this.node.label.value;var e=this.node.localProperties.filter(function(e){return"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===e.value})[0].values[0].value;this.chosenType=this.types.filter(function(t){return t.id===e})[0],this.chosenType&&(this.typeQuery=this.chosenType.label)},t.prototype.typeCreate=function(e){var t=this;e&&!this.types.filter(function(t){return t.label===e})[0]&&this.fibraService.dispatchAction(this.fibraService.createType(e)).then(function(r){var n=r.construct.userTypes.filter(function(t){return t.label===e})[0];return n?t.typeChange(n):t.$q.resolve(r)})},t.prototype.typeEvaluate=function(e){console.log(e,this.getTypes()),e&&!this.getTypes().filter(function(t){return t.label===e})[0]?this.showTypeCreate=!0:this.showTypeCreate=!1},t.prototype.typeChange=function(t){var r=this;this.chosenType=t;var n=this.node.localProperties.filter(function(t){return t.value===e.RDF.type.value})[0],i=new e.PropertyToValues(e.RDF.type),o=new e.NamedNode(t.id);return i.values.push(o),this.showTypeCreate=!1,this.fibraService.dispatchAction(this.fibraService.itemProperty(this.node,[i],[n])).then(function(e){var n=r.fibraService.getState().construct.displayTypes;if(!n[0]&&t)return r.fibraService.dispatchAction(r.fibraService.setOrderedTypes([t]));if(!n[1]&&t&&n[0]!==t){var i=n.concat([]);return i.push(t),r.fibraService.dispatchAction(r.fibraService.setOrderedTypes(i))}})},t.prototype.labelChange=function(){var t=this.node.localProperties.filter(function(t){return t.value===e.SKOS.prefLabel.value})[0],r=new e.PropertyToValues(e.SKOS.prefLabel);r.values.push(e.DataFactory.instance.literal(this.label)),this.fibraService.dispatchAction(this.fibraService.itemProperty(this.node,[r],[t]))},t.prototype.deleteAndClose=function(){var e=this;this.fibraService.dispatchAction(this.fibraService.deleteItem(this.node)).then(function(){e.fibraService.dispatch("change"),e.close()})},t.prototype.closePopover=function(){this.close(),this.fibraService.dispatch("change")},t}();angular.module("fibra").controller("PropertyPopoverComponentController",["fibraService","sparqlItemService","$scope","$q",function(){return new(Function.prototype.bind.apply(n,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.PropertyPopoverComponentController=n}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e,t,r,n,i){var o=this;this.$element=e,this.$compile=t,this.$scope=r,this.sparqlItemService=n,this.fibraService=i,this.sbRadius=200,this.lessRadius=this.sbRadius*this.sbRadius/3-144,this.sbArc=d3.arc().startAngle(function(e){return e.x0}).endAngle(function(e){return e.x1}).innerRadius(function(e){return Math.sqrt(e.y0-o.lessRadius)}).outerRadius(function(e){return Math.sqrt(e.y1-o.lessRadius)}),this.sbPart=d3.partition().size([2*Math.PI,this.sbRadius*this.sbRadius]),this.item_info_tip_displayed=!1,this.sbTooltip=d3.select("body").append("div").style("position","absolute").style("z-index","20").style("background-color","gray").style("color","white").style("padding","3px").style("border-radius","2px").style("visibility","hidden"),this.item_info_tip=d3.select("body").append("div").attr("id","item_info_tip").style("position","absolute").style("z-index","20").style("background-color","white").style("padding","3px").style("visibility","hidden"),this.buildSunburst=this.buildSunburst.bind(this)}return e.prototype.addSunburstGroup=function(e){var t=this;this.sel=e,this.sbGroup&&this.sbGroup.remove(),this.sbGroup=e.append("g").classed("sunburst-overlay",!0),this.sel.on("click",function(){t.item_info_tip_displayed&&(t.item_info_tip.style("visibility","hidden"),t.item_info_tip_displayed=!1)})},e.prototype.buildSunburst=function(e,t,r){var n=this;this.original_data=e,this.sbGroup.attr("transform",function(e){return"translate("+e.gx+","+e.gy+")"});var i=d3.hierarchy(e,function(e){return e.localProperties?e.localProperties.concat(e.remoteProperties):e.values});i.sum(function(e){return void 0===e.values&&void 0===e.localProperties?1:0});var o=(this.sbPart(i),this.sbGroup.selectAll("path").data(i.descendants(),function(e){return e.data}));o.exit().remove(),o.enter().filter(function(e){return e.depth>0}).append("path").classed("sunburst-cell",!0).on("mouseover",function(e,t){n.sbTooltip.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px").style("visibility","visible").text(2===e.depth?e.data.label.value+" (click to add)":e.data.label.value+" (click to add all children)")}).on("mouseout",function(){n.sbTooltip.style("visibility","hidden")}).on("click",function(e,t){2===e.depth?n.fibraService.dispatchAction(n.fibraService.displayItem(e.data)):n.fibraService.dispatchAction(n.fibraService.displayItems(e.children.map(function(e){return e.data}))),n.original_data.selected=!1,n.sbTooltip.style("visibility","hidden"),n.sbGroup.remove()}).merge(o).attr("d",this.sbArc).style("stroke","#fff")},e.prototype.selectItem=function(e){this.selectedItem=e},e}();e.Sunburst=t}(fibra||(fibra={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},fibra;!function(e){"use strict";var t=function(){function e(e,t,r,n){void 0===r&&(r=void 0),void 0===n&&(n=void 0),this.value=e,this.termType=t,this.language=r,this.datatype=n}return e.prototype.toCanonical=function(){switch(this.termType){case"NamedNode":return"<"+this.value+">";case"BlankNode":return"_:"+this.value;case"Literal":return JSON.stringify(this.value)+(this.language?"@"+this.language:m.string.equals(this.datatype)?"":"^^"+this.datatype.toCanonical());case"Variable":return"?"+this.value;case"DefaultGraph":return"";case"UNDEF":return"UNDEF";default:throw"Unknown term type "+this}},e.prototype.equals=function(e){return this.termType===e.termType&&this.value===e.value&&("Literal"!==this.termType||this.language===e.language&&this.datatype===e.datatype)},e}();e.Node=t;var r=function(e){function t(t){return e.call(this,t.value,t.termType,t.language,t.datatype)||this}return __extends(t,e),t}(t);e.NodeFromNode=r;var n=function(e){function t(){return e.call(this,"","DefaultGraph")||this}return __extends(t,e),t.prototype.toCanonical=function(){return""},t.prototype.equals=function(e){return"DefaultGraph"===e.termType},t}(t);n.instance=new n,e.DefaultGraph=n;
var i=function(e){function t(){return e.call(this,"","UNDEF")||this}return __extends(t,e),t.prototype.toCanonical=function(){return""},t.prototype.equals=function(e){return"UNDEF"===e.termType},t}(t);i.instance=new i,e.UNDEF=i;var o=function(e){function t(t){return e.call(this,t,"Variable")||this}return __extends(t,e),t.prototype.toCanonical=function(){return"?"+this.value},t}(t);e.Variable=o;var a=function(e){function t(t){return e.call(this,t,"NamedNode")||this}return __extends(t,e),t.prototype.toCanonical=function(){return"<"+this.value+">"},t}(t);e.NamedNode=a;var s=function(e){function t(t){return e.call(this,t,"BlankNode")||this}return __extends(t,e),t.prototype.toCanonical=function(){return"?"+this.value},t}(t);e.BlankNode=s;var l=function(e){function t(t,r,n){return void 0===r&&(r=""),e.call(this,t,"Literal",r,n?n:""!==r?v.langString:m.string)||this}return __extends(t,e),t}(t);e.Literal=l;var c=function(){function e(e,t,r,n){this.subject=e,this.predicate=t,this.object=r,this.graph=n}return e.prototype.toCanonical=function(){return this.subject.toCanonical()+" "+this.predicate.toCanonical()+" "+this.object.toCanonical()+("DefaultGraph"===this.graph.termType?"":" "+this.graph.toCanonical())},e.prototype.equals=function(e){return this.subject.equals(e.subject)&&this.predicate.equals(e.predicate)&&this.object.equals(e.object)&&this.graph.equals(e.graph)},e}();e.Quad=c;var p=function(){function e(e,t,r){this.subject=e,this.predicate=t,this.object=r,this.graph=n.instance}return e.prototype.toCanonical=function(){return this.subject.toCanonical()+" "+this.predicate.toCanonical()+" "+this.object.toCanonical()},e.prototype.equals=function(e){return this.subject.equals(e.subject)&&this.predicate.equals(e.predicate)&&this.object.equals(e.object)&&this.graph.equals(e.graph)},e}();e.Triple=p;var u=function(){function e(e,t){void 0===t&&(t=[]),this.graph=e,this.triples=t}return e}();e.Graph=u;var d=function(){function e(){this.nextBlankNodeId=0}return e.prototype.nodeFromBinding=function(e){var r=new t(e.value,"literal"===e.type?"Literal":"uri"===e.type?"NamedNode":"BlankNode");return"literal"===e.type&&(r.language=e["xml:lang"]?e["xml:lang"]:"",r.datatype=e.datatype?new a(e.datatype):""!==r.language?v.langString:m.string),r},e.prototype.nodeFromNode=function(e){return"Literal"===e.termType?new l(e.value,e.language,e.datatype):new t(e.value,e.termType)},e.prototype.nodeFromCanonicalRepresentation=function(e){if(0===e.indexOf("<"))return new a(e.substring(1,e.length-1));if(0===e.indexOf("_:"))return new s(e.substring(2));var t=e.substring(1,e.lastIndexOf('"'));return e.lastIndexOf("@")===e.lastIndexOf('"')+1?new l(t,e.substring(e.lastIndexOf("@"))):e.lastIndexOf("^^<")===e.lastIndexOf('"')+1?new l(t,"",new a(e.substring(e.lastIndexOf("^^<"),e.length-1))):new l(t)},e.prototype.namedNode=function(e){return new a(e)},e.prototype.blankNode=function(e){return new s(e?e:"b"+ ++this.nextBlankNodeId)},e.prototype.literal=function(e,t){return"string"==typeof t?new l(e,t):new l(e,void 0,t)},e.prototype.variable=function(e){return new o(e)},e.prototype.defaultGraph=function(){return n.instance},e.prototype.triple=function(e,t,r){return new p(e,t,r)},e.prototype.quad=function(e,t,r,i){return new c(e,t,r,i?i:n.instance)},e}();d.instance=new d,e.DataFactory=d;var h=function(){function e(){}return e}();h.ns="http://hdlab.stanford.edu/fibra/ontology#",h.linked=new a(h.ns+"linked"),e.FibraInternal=h;var f=function(){function e(){}return e}();f.ns="http://www.w3.org/2004/02/skos/core#",f.prefLabel=new a(f.ns+"prefLabel"),f.related=new a(f.ns+"related"),e.SKOS=f;var y=function(){function e(){}return e}();y.ns="http://www.w3.org/2002/07/owl#",y.sameAs=new a(y.ns+"sameAs"),y.Thing=new a(y.ns+"Thing"),e.OWL=y;var v=function(){function e(){}return e}();v.ns="http://www.w3.org/1999/02/22-rdf-syntax-ns#",v.type=new a(v.ns+"type"),v.langString=new a(v.ns+"langString"),e.RDF=v;var m=function(){function e(){}return e}();m.ns="http://www.w3.org/2001/XMLSchema#",m.string=new a(m.ns+"string"),e.XMLSchema=m;var g=function(){function e(){}return e}();g.ns="http://www.cidoc-crm.org/cidoc-crm/",g.Person=new a(g.ns+"E21_Person"),g.Place=new a(g.ns+"E53_Place"),g.Group=new a(g.ns+"E74_Group"),e.CIDOC=g;var b=function(){function e(){}return e}();b.ns="http://vocab.getty.edu/ontology#",b.AdminPlaceConcept=new a(b.ns+"AdminPlaceConcept"),b.PhysicalPlaceConcept=new a(b.ns+"PhysicalPlaceConcept"),b.PhysAdminPlaceConcept=new a(b.ns+"PhysAdminPlaceConcept"),b.PersonConcept=new a(b.ns+"PersonConcept"),b.GroupConcept=new a(b.ns+"GroupConcept"),e.GETTY=b;var S=function(){function e(){}return e}();S.ns="http://www.loc.gov/mads/rdf/v1#",S.CorporateName=new a(S.ns+"CorporateName"),S.PersonalName=new a(S.ns+"PersonalName"),S.NameTitle=new a(S.ns+"NameTitle"),S.Geographic=new a(S.ns+"Geographic"),e.MADS=S;var w=function(){function e(){}return e}();w.ns="http://geovocab.org/spatial#",w.Feature=new a(w.ns+"Feature"),e.GEOVOCAB=w;var I=function(){function t(t,r){void 0===t&&(t=function(){return{}}),void 0===r&&(r=new e.EMap),this.create=t,this.map=r}return t.prototype.goc=function(e,t){return this.has(e)||this.set(e,t?t(e):this.create(e)),this.get(e)},t.prototype.get=function(e){return this.map.get(e.toCanonical())},t.prototype.remove=function(e){return this.map.remove(e.toCanonical())},t.prototype.each=function(e){var t=this;this.map.each(function(r,n,i){return e(r,d.instance.nodeFromCanonicalRepresentation(n),t)})},t.prototype.has=function(e){return this.map.has(e.toCanonical())},t.prototype.set=function(e,t){return this.map.set(e.toCanonical(),t),this},Object.defineProperty(t.prototype,"size",{get:function(){return this.map.size()},enumerable:!0,configurable:!0}),t.prototype.values=function(){return this.map.values()},t.prototype.keys=function(){return this.map.keys().map(function(e){return d.instance.nodeFromCanonicalRepresentation(e)})},t.prototype.entries=function(){return this.map.entries().map(function(e){return{key:d.instance.nodeFromCanonicalRepresentation(e.key),value:e.value}})},t.prototype.clear=function(){return this.map.clear(),this},t}();e.ENodeMap=I;var E=function(t){function r(r){return t.call(this,r,new e.EOMap)||this}return __extends(r,t),r}(I);e.EONodeMap=E;var T=function(){function t(t){void 0===t&&(t=new e.EMap),this.m=new I(void 0,t)}return t.prototype.add=function(e){return this.m.set(e,e),this},t.prototype.adda=function(e){var t=this;return e.forEach(function(e){return t.add(e)}),this},t.prototype.adds=function(e){var t=this;return e.each(function(e){return t.add(e)}),this},t.prototype.has=function(e){return this.m.has(e)},t.prototype.get=function(e){return this.m.get(e)},t.prototype.clear=function(){return this.m.clear(),this},t.prototype.remove=function(e){return this.m.remove(e)},t.prototype.values=function(){return this.m.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.m.size},enumerable:!0,configurable:!0}),t.prototype.each=function(e){var t=this;this.m.each(function(r,n,i){return e(r,r,t)})},t}();e.NodeSet=T;var L=function(t){function r(){return t.call(this,new e.EOMap)||this}return __extends(r,t),r}(T);e.ONodeSet=L}(fibra||(fibra={}));var fibra;!function(e){"use strict"}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(){this.controller="CallbackController",this.template="<div>Please wait...</div>"}return e}();angular.module("fibra").component("callback",new t),e.CallbackComponent=t;var r=function(){function e(e,t,r,n,i){var o={code:r.code,state:e.redirectState?e.redirectState:"projects"};o.code||window.location.search.replace("?","").split("&").forEach(function(e){var t=e.split("=");o[t[0]]=t[1]}),e.requestTime?$.getJSON("https://fibra-auth-gateway.herokuapp.com/authenticate/"+o.code,function(t){i.$apply(function(r){$.get("https://api.github.com/user/emails?access_token="+t.token,function(r){i.$apply(function(i){var a=r.filter(function(e){return e.primary&&e.verified})[0];a&&a.email?(e.login_provider="Github",e.user_email=a.email,e.access_token=t.token,e.requestTime=null,n.location.href=n.location.origin+n.location.pathname+"#!/"+o.state):alert("Authentication failed")})})})}):n.location.href="http://localhost:3000/#!/?"+n.location.href.split("?")[1]}return e}();angular.module("fibra").controller("CallbackController",["$localStorage","$sessionStorage","$stateParams","$window","$scope",function(){return new(Function.prototype.bind.apply(r,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.CallbackController=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(){this.controller="LoginController",this.template='<button ng-click="login()">Login with Github</button>'}return e}();angular.module("fibra").component("login",new t),e.LoginComponent=t;var r=function(){function e(e,t,r,n,i){t.login=function(){r.redirectState=i.redirect_hash.replace("#/",""),r.requestTime=Date.now(),n.location.href="https://github.com/login/oauth/authorize?client_id=6a9ff845a1c35f43a0f2&scope=user:email"}}return e}();angular.module("fibra").controller("LoginController",["$urlService","$scope","$localStorage","$window","$stateParams",function(){return new(Function.prototype.bind.apply(r,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.LoginController=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function t(e,t){this.configurationService=e,this.$state=t}return t.prototype.setData=function(t){var r=this.configurationService.configuration;r.graph=e.DataFactory.instance.namedNode("http://ldf.fi/fibra/"+t+"/"),r.primaryEndpoint.localItemQueryTemplate=r.primaryEndpoint.localItemQueryTemplate.replace(/GRAPH <GRAPH>/g,"GRAPH <http://ldf.fi/fibra/"+t+"/>"),r.primaryEndpoint.autocompletionTextMatchQueryTemplate=r.primaryEndpoint.autocompletionTextMatchQueryTemplate.replace(/GRAPH <GRAPH>/g,"GRAPH <http://ldf.fi/fibra/"+t+"/>"),r.primaryEndpoint.treeQueryTemplate=r.primaryEndpoint.treeQueryTemplate.replace(/GRAPH <GRAPH>/g,"GRAPH <http://ldf.fi/fibra/"+t+"/>"),r.deleteItemQuery=r.deleteItemQuery.replace(/GRAPH <GRAPH>/g,"GRAPH <http://ldf.fi/fibra/"+t+"/>"),this.configurationService.setConfiguration(r),this.$state.go("construct")},t}();angular.module("fibra").controller("SelectViewComponentController",["configurationService","$state",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.SelectViewComponentController=t;var r=function(){function e(){this.controller="SelectViewComponentController",this.templateUrl="components/select-view/select-view.html"}return e}();angular.module("fibra").component("selectView",new r),e.SelectViewComponent=r}(fibra||(fibra={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},fibra;!function(e){"use strict";var t=function(){function e(){}return e}(),r=function(e){function t(t,r){var n=e.call(this)||this;return n.sparqlItemService=t,n.fibraService=r,n.$onChanges=function(e){n.itemId&&n.sparqlItemService.getItem(n.itemId).then(function(e){return n.item=e})},n.addItem=function(){n.fibraService.dispatchAction(n.fibraService.displayItem(n.item))},n}return __extends(t,e),t}(t);angular.module("fibra").controller("SparqlItemComponentController",["sparqlItemService","fibraService",function(){return new(Function.prototype.bind.apply(r,[null].concat(Array.prototype.slice.apply(arguments))))}]);var n=function(){function e(){this.bindings={itemId:"<",onSelect:"&",showRemoteProperties:"@"},this.controller="SparqlItemComponentController",this.templateUrl="components/sparql-item/sparql-item.html"}return e}();angular.module("fibra").component("sparqlItem",new n),e.SparqlItemComponent=n}(fibra||(fibra={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},fibra;!function(e){"use strict";var t=function(e){function t(t,r){var n=e.call(this,t)||this;return r&&(n.label=r),n}return __extends(t,e),t}(e.NodeFromNode);e.NodePlusLabel=t;var r=function(e){function t(t,r,n){void 0===n&&(n=[]);var i=e.call(this,t,r)||this;return i.sourceEndpoints=n,i}return __extends(t,e),t}(t);e.SourcedNodePlusLabel=r;var n=function(e){function t(t){var r=e.call(this,t)||this;return r.values=[],r}return __extends(t,e),t}(t);e.PropertyToValues=n;var i=function(){function e(e){this.source=e,this.properties=[]}return e}();e.SourcePlusProperties=i;var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.localProperties=[],t.remoteProperties=[],t.localInverseProperties=[],t.remoteInverseProperties=[],t}return __extends(t,e),t}(t);e.Item=o;var a=function(){function e(e,t){void 0===t&&(t=0),this.constraintString=e,this.priority=t}return e}();e.SimpleConstraint=a;var s=function(){function e(e){this.workerService=e}return e.UUID=function(){var t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return e.lut[255&t]+e.lut[t>>8&255]+e.lut[t>>16&255]+e.lut[t>>24&255]+"-"+e.lut[255&r]+e.lut[r>>8&255]+"-"+e.lut[r>>16&15|64]+e.lut[r>>24&255]+"-"+e.lut[63&n|128]+e.lut[n>>8&255]+"-"+e.lut[n>>16&255]+e.lut[n>>24&255]+e.lut[255&i]+e.lut[i>>8&255]+e.lut[i>>16&255]+e.lut[i>>24&255]},e.prototype.getItem=function(e,t,r){return void 0===t&&(t=!1),this.workerService.call("sparqlItemWorkerService","getItems",[[e],t],r).then(function(e){return e[0]},null,function(e){return{endpointType:e.endpointType,endpoint:e.endpoint,item:e.items[0]}})},e.prototype.getItems=function(e,t,r){return void 0===t&&(t=!1),this.workerService.call("sparqlItemWorkerService","getItems",[e,t],r)},e.prototype.getAllItems=function(e,t){return void 0===e&&(e=!1),this.workerService.call("sparqlItemWorkerService","getItems",[!1,e],t)},e.prototype.createNewItem=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=[]),this.workerService.call("sparqlItemWorkerService","createNewItem",[e,t])},e.prototype.alterItem=function(e,t,r){return void 0===r&&(r=[]),this.workerService.call("sparqlItemWorkerService","alterItem",[e,t,r])},e.prototype.deleteItem=function(e){return this.workerService.call("sparqlItemWorkerService","deleteItem",[e])},e}();angular.module("fibra").service("sparqlItemService",["workerService",function(){return new(Function.prototype.bind.apply(s,[null].concat(Array.prototype.slice.apply(arguments))))}]),s.naiveGetLocalItemPropertiesQuery='\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX mads: <http://www.loc.gov/mads/rdf/v1#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX owl: <http://www.w3.org/2002/07/owl#>\nSELECT ?id ?itemLabel ?property ?propertyLabel ?object ?objectLabel {\n  GRAPH <GRAPH> {\n    VALUES ?id { <IDS> }\n    ?id skos:prefLabel|mads:authoritativeLabel|rdfs:label ?itemLabel .\n    FILTER(LANG(?itemLabel)=\'\' || LANG(?itemLabel)=\'<PREFLANG>\')\n    ?id ?property ?object .\n    OPTIONAL {\n      ?property skos:prefLabel|rdfs:label ?propertyLabelP .\n      FILTER(LANG(?propertyLabelP)=\'\' || LANG(?propertyLabelP)=\'<PREFLANG>\')\n    }\n    BIND(COALESCE(?propertyLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?property),".*/",""),".*#",""),"_"," "),"([A-ZÅÄÖ])"," $1")) AS ?propertyLabel)\n    OPTIONAL {\n      ?object skos:prefLabel|rdfs:label ?objectLabelP .\n      FILTER(LANG(?objectLabelP)=\'\' || LANG(?objectLabelP)=\'<PREFLANG>\')\n    }\n    BIND (IF(ISIRI(?object),COALESCE(?objectLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?object),".*/",""),".*#",""),"_"," "),"([A-ZÅÄÖ])"," $1")),?object) AS ?objectLabel)\n  }\n}',s.getLocalItemPropertiesQuery='\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX mads: <http://www.loc.gov/mads/rdf/v1#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX owl: <http://www.w3.org/2002/07/owl#>\nPREFIX sf: <http://ldf.fi/functions#>\nSELECT ?id ?itemLabel ?property ?propertyLabel ?object ?objectLabel {\n  GRAPH <GRAPH> {\n    VALUES ?id { <IDS> }\n    { ?id ?property ?object . }\n    UNION\n    { ?object ?property ?id . }\n    ?id sf:preferredLanguageLiteral (skos:prefLabel mads:authoritativeLabel rdfs:label skos:altLabel mads:variantLabel \'<PREFLANG>\' \'\' ?itemLabel) .\n    OPTIONAL {\n      ?property sf:preferredLanguageLiteral (skos:prefLabel mads:authoritativeLabel rdfs:label skos:altLabel mads:variantLabel \'<PREFLANG>\' \'\' ?propertyLabelP)\n    }\n    BIND(COALESCE(?propertyLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?property),".*/",""),".*#",""),"_"," "),"([A-ZÅÄÖ])"," $1")) AS ?propertyLabel)\n    OPTIONAL {\n      ?object sf:preferredLanguageLiteral (skos:prefLabel mads:authoritativeLabel rdfs:label skos:altLabel mads:variantLabel \'<PREFLANG>\' \'\' ?objectLabelP) .\n    }\n    BIND (IF(ISIRI(?object),COALESCE(?objectLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?object),".*/",""),".*#",""),"_"," "),"([A-ZÅÄÖ])"," $1")),?object) AS ?objectLabel)\n  }\n}',s.getRemoteItemPropertiesQuery='\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX mads: <http://www.loc.gov/mads/rdf/v1#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX owl: <http://www.w3.org/2002/07/owl#>\nPREFIX sf: <http://ldf.fi/functions#>\nSELECT ?id ?property ?propertyLabel ?object ?objectLabel {\n  VALUES (?id ?oid) { <IDPAIRS> }\n  ?oid ?property ?object .\n  OPTIONAL {\n    ?property sf:preferredLanguageLiteral (skos:prefLabel mads:authoritativeLabel rdfs:label skos:altLabel mads:variantLabel \'<PREFLANG>\' \'\' ?propertyLabelP)\n  }\n  BIND(COALESCE(?propertyLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?property),".*/",""),".*#",""),"_"," "),"([A-ZÅÄÖ])"," $1")) AS ?propertyLabel)\n  OPTIONAL {\n    ?object sf:preferredLanguageLiteral (skos:prefLabel mads:authoritativeLabel rdfs:label skos:altLabel mads:variantLabel \'<PREFLANG>\' \'\' ?objectLabelP) .\n  }\n  BIND (IF(ISIRI(?object),COALESCE(?objectLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?object),".*/",""),".*#",""),"_"," "),"([A-ZÅÄÖ])"," $1")),?object) AS ?objectLabel)\n}\n',s.deleteItemQuery="\nDELETE {\n  GRAPH <GRAPH> {\n    <ID> ?p ?o .\n    ?s ?p <ID> .\n  }\n}\nWHERE {\n  GRAPH <GRAPH> {\n    { <ID> ?p ?o } UNION { ?s ?p <ID> }\n  }\n}\n",s.lut=function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return e}(),e.SparqlItemService=s;var l=function(){function t(e,t,r,n){this.sparqlService=e,this.$q=t,this.sparqlUpdateWorkerService=r,this.configurationWorkerService=n}return t.processItemResult=function(t,i,o,a,s,l){if(l.property){var c=o.goc(l.property.value).goc(l.object.value,function(){var o=i.goc(l.property.value,function(){var r=new n(e.DataFactory.instance.nodeFromBinding(l.property));return l.propertyLabel&&(r.label=e.DataFactory.instance.nodeFromBinding(l.propertyLabel)),t.push(r),r}),s=new r(e.DataFactory.instance.nodeFromBinding(l.object));return o.values.push(s),e.OWL.sameAs.equals(o)&&a.push(s),s});c.sourceEndpoints.push(s),l.objectLabel&&!c.label&&(c.label=e.DataFactory.instance.nodeFromBinding(l.objectLabel))}},t.prototype.getItems=function(r,n,i){var a=this;void 0===n&&(n=!1);var s=this.configurationWorkerService.configuration.primaryEndpoint.localItemQueryTemplate;r||(s=s.replace(/VALUES \?id { <IDS> }/g,""));var l=r?r:[];s=s.replace(/<IDS>/g,l.map(function(e){return e.toCanonical()}).join("")),s=s.replace(/<PREFLANG>/g,this.configurationWorkerService.configuration.preferredLanguage);var c=new e.EMap(function(t){return new o(e.DataFactory.instance.namedNode(t))}),p=this.$q.defer();return this.sparqlService.query(this.configurationWorkerService.configuration.primaryEndpoint.endpoint.value,s,{timeout:i}).then(function(r){for(var o=new e.EMap(function(){return new e.EMap}),s=new e.EMap(function(){return new e.EMap(function(){return new e.EMap})}),l=new e.ENodeMap(function(){return[]}),u=0,d=r.data.results.bindings;u<d.length;u++){var h=d[u],f=c.goc(h.id.value);h.itemLabel&&(f.label=e.DataFactory.instance.nodeFromBinding(h.itemLabel)),t.processItemResult(f.localProperties,o.goc(h.id.value),s.goc(h.id.value),l.goc(f),a.configurationWorkerService.configuration.primaryEndpoint,h)}if(n){p.notify({endpointType:"primary",endpoint:a.configurationWorkerService.configuration.primaryEndpoint.id,items:c.values()});for(var y="",v=0,m=c.values();v<m.length;v++){var f=m[v];y+="("+f.toCanonical()+f.toCanonical()+")";for(var g=0,b=l.get(f);g<b.length;g++){var S=b[g];y+="("+f.toCanonical()+S.toCanonical()+")"}}a.$q.all(a.configurationWorkerService.configuration.remoteEndpoints().map(function(r){var n=r.remoteItemQueryTemplate;return n=n.replace(/<IDPAIRS>/g,y),n=n.replace(/<PREFLANG>/g,a.configurationWorkerService.configuration.preferredLanguage),a.sparqlService.query(r.endpoint.value,n,{timeout:i}).then(function(e){if(0!==e.data.results.bindings.length){for(var n=0,i=e.data.results.bindings;n<i.length;n++){var a=i[n],u=c.goc(a.id.value);t.processItemResult(u.remoteProperties,o.goc(a.id.value),s.goc(a.id.value),l.goc(u),r,a)}p.notify({endpointType:"remote",endpoint:r.id,items:c.values()})}},function(t){return p.notify({endpointType:"remote",endpoint:r.id,error:e.WorkerWorkerService.stripFunctions(t)})})})).then(function(){return p.resolve(c.values())})}else p.resolve(c.values())}),p.promise},t.prototype.deleteItem=function(e){return this.sparqlService.update(this.configurationWorkerService.configuration.primaryEndpoint.updateEndpoint.value,this.configurationWorkerService.configuration.deleteItemQuery.replace(/<ID>/g,e.toCanonical())).then(function(e){return 204===e.status},function(e){return!1})},t.prototype.alterItem=function(t,r,n){void 0===n&&(n=[]);var i=[],o=[];return r.forEach(function(r){r.label&&i.push(new e.Triple(r,e.SKOS.prefLabel,r.label)),r.values.forEach(function(n){i.push(new e.Triple(t,r,n)),n.label&&i.push(new e.Triple(n,e.SKOS.prefLabel,n.label))})}),n.forEach(function(r){return r.values.forEach(function(n){return o.push(new e.Triple(t,r,n))})}),this.sparqlUpdateWorkerService.updateGraphs(this.configurationWorkerService.configuration.primaryEndpoint.updateEndpoint.value,[new e.Graph(this.configurationWorkerService.configuration.graph,i)],[new e.Graph(this.configurationWorkerService.configuration.graph,o)])},t.prototype.createNewItem=function(t,r){void 0===t&&(t=[]),void 0===r&&(r=[]);var n=this.$q.defer(),i=new e.NamedNode(this.configurationWorkerService.configuration.instanceNS+s.UUID());n.notify(i);var o=[];return t.forEach(function(t){return o.push(new e.Triple(i,e.OWL.sameAs,t))}),r.forEach(function(t){t.label&&o.push(new e.Triple(t,e.SKOS.prefLabel,t.label)),t.values.forEach(function(r){o.push(new e.Triple(i,t,r)),r.label&&o.push(new e.Triple(r,e.SKOS.prefLabel,r.label))})}),this.sparqlUpdateWorkerService.updateGraphs(this.configurationWorkerService.configuration.primaryEndpoint.updateEndpoint.value,[new e.Graph(this.configurationWorkerService.configuration.graph,o)]).then(function(){return n.resolve(i)},n.reject,n.notify),n.promise},t}();angular.module("fibra").service("sparqlItemWorkerService",["sparqlService","$q","sparqlUpdateWorkerService","configurationWorkerService",function(){return new(Function.prototype.bind.apply(l,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.SparqlItemWorkerService=l}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e,t){this.$q=e,this.sparqlAutocompleteService=t,this.error=!1,this.hasMoreResults=!1,this.hide=!1,this.canceller=e.defer()}return e.prototype.onSelectInternal=function(e){this.onSelect(e),this.hide=!0},e.prototype.clear=function(){this.results=null,this.query="",this.currentLimit=parseInt(this.limit,10)},e.prototype.onChange=function(e){var t=this;this.canceller.resolve(),this.canceller=this.$q.defer(),this.queryRunning=!0,this.error=!1,this.sparqlAutocompleteService.autocomplete(e,this.currentLimit+1,void 0!==this.queryRemote,this.constraints,this.canceller.promise).then(function(e){t.queryRunning=!1},function(){t.queryRunning=!1,t.error=!0},function(e){e.error?t.error=!0:t.onResults(e.results)})},e.prototype.$onInit=function(){this.currentLimit=parseInt(this.limit,10)},e.prototype.onResults=function(e){this.results=e,this.results.localMatchingResults.length===this.currentLimit+1&&(this.results.localMatchingResults.splice(this.results.localMatchingResults.length-1,1),this.results.localNonMatchingResults=[],this.results.remoteResults=[])},e}();angular.module("fibra").controller("SparqlAutocompleteComponentController",["$q","sparqlAutocompleteService",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]);var r=function(){function e(){this.bindings={constraints:"<",limit:"@",onSelect:"&",queryRemote:"@"},this.controller="SparqlAutocompleteComponentController",this.templateUrl="components/sparql-autocomplete/sparql-autocomplete.html"}return e}();angular.module("fibra").component("sparqlAutocomplete",new r),e.SparqlAutocompleteComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=fi.seco.sparql,r=function(){function e(){this.localMatchingResults=[],this.localNonMatchingResults=[],this.remoteResults=[]}return e}();e.AutocompletionResults=r;var n=function(){function e(e){this.label=e,this.results=[]}return e}();e.ResultGroup=n;var i=function(){function e(e,t,r,n){this.ids=e,this.datasources=t,this.matchedLabel=r,this.prefLabel=n,this.additionalInformation={}}return e}();e.Result=i;var o=function(){function e(e){this.workerService=e}return e.prototype.autocomplete=function(e,t,r,n,i){return void 0===r&&(r=!1),void 0===n&&(n=""),this.workerService.call("sparqlAutocompleteWorkerService","autocomplete",[e,t,r,n],i)},e}();angular.module("fibra").service("sparqlAutocompleteService",["workerService",function(){return new(Function.prototype.bind.apply(o,[null].concat(Array.prototype.slice.apply(arguments))))}]),o.naiveMatchQueryTemplate='\n  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n  PREFIX skos: <http://www.w3.org/2004/02/skos/core#>\n  PREFIX mads: <http://www.loc.gov/mads/rdf/v1#>\n  PREFIX owl: <http://www.w3.org/2002/07/owl#>\n  PREFIX dcterms: <http://purl.org/dc/terms/>\n  SELECT ?groupId ?groupLabel ?id ?prefLabel ?matchedLabel ?sameAs ?altLabel { # ADDITIONALVARIABLES\n    GRAPH <GRAPH> {\n      {\n        SELECT ?groupId ?id {\n          {\n            ?id skos:prefLabel|rdfs:label|skos:altLabel|mads:authoritativeLabel|mads:variantLabel <QUERY> .\n          } UNION {\n            ?id skos:prefLabel|rdfs:label|skos:altLabel|mads:authoritativeLabel|mads:variantLabel <QUERY>@<PREFLANG> .\n          }\n          ?id a ?groupId .\n        }\n        GROUP BY ?groupId ?id\n        HAVING(BOUND(?id))\n        LIMIT <LIMIT>\n      }\n      ?id skos:prefLabel|rdfs:label|skos:altLabel|mads:authoritativeLabel|mads:variantLabel ?matchedLabel .\n      FILTER (REGEX(LCASE(?matchedLabel),CONCAT("\\\\b",LCASE(<QUERY>))))\n      OPTIONAL {\n        ?groupId skos:prefLabel|rdfs:label|skos:altLabel|mads:authoritativeLabel|mads:variantLabel ?groupLabelP .\n      }\n      BIND(COALESCE(?groupLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?groupId),".*/",""),".*#",""),"_"," "),"([A-ZÅÄÖ])"," $1")) AS ?groupLabel)\n      {\n        ?id  rdfs:label|skos:prefLabel|mads:authoritativeLabel ?prefLabel .\n      } UNION {\n        ?id owl:sameAs ?sameAs .\n      } UNION {\n        ?id skos:altLabel|mads:variantLabel ?altLabel .\n      }\n      # ADDITIONALSELECT\n    }\n  }\n  ',o.defaultMatchQueryTemplate='\nPREFIX text: <http://jena.apache.org/text#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX mads: <http://www.loc.gov/mads/rdf/v1#>\nPREFIX owl: <http://www.w3.org/2002/07/owl#>\nPREFIX sf: <http://ldf.fi/functions#>\nPREFIX fibra: <http://ldf.fi/fibra/schema#>\nPREFIX dcterms: <http://purl.org/dc/terms/>\nSELECT ?groupId ?groupLabel ?id ?prefLabel ?matchedLabel ?sameAs ?altLabel { # ADDITIONALVARIABLES\n  # STARTGRAPH\n    {\n      SELECT ?groupId ?id (SUM(?sc) AS ?score) {\n        {\n          SELECT ?groupId ?id ?sc {\n            BIND(CONCAT("\\"",REPLACE(<QUERY>,"([\\\\+\\\\-\\\\&\\\\|\\\\!\\\\(\\\\)\\\\{\\\\}\\\\[\\\\]\\\\^\\\\\\"\\\\~\\\\*\\\\?\\\\:\\\\/\\\\\\\\])","\\\\$1"),"\\"") AS ?query)\n            (?id ?sc) text:query ?query .\n            ?id skos:prefLabel|rdfs:label|skos:altLabel|mads:authoritativeLabel|mads:variantLabel ?matchedLabel\n            FILTER (LCASE(?matchedLabel)=LCASE(<QUERY>))\n            ?id a ?groupId .\n            # GROUPID\n            # CONSTRAINTS\n          }\n          GROUP BY ?groupId ?id ?sc\n          LIMIT <LIMIT>\n        } UNION {\n          SELECT ?groupId ?id ?sc {\n            BIND(CONCAT(REPLACE(<QUERY>,"([\\\\+\\\\-\\\\&\\\\|\\\\!\\\\(\\\\)\\\\{\\\\}\\\\[\\\\]\\\\^\\\\\\"\\\\~\\\\*\\\\?\\\\:\\\\/\\\\\\\\])","\\\\$1"),"*") AS ?query)\n            (?id ?sc) text:query ?query .\n            ?id a ?groupId .\n            # GROUPID\n            # CONSTRAINTS\n          }\n          GROUP BY ?groupId ?id ?sc\n          LIMIT <LIMIT>\n        }\n      }\n      GROUP BY ?groupId ?id\n      HAVING(BOUND(?id))\n      LIMIT <LIMIT>\n    }\n    ?id skos:prefLabel|rdfs:label|skos:altLabel|mads:authoritativeLabel|mads:variantLabel ?matchedLabel\n    FILTER (REGEX(LCASE(?matchedLabel),CONCAT("\\\\b",LCASE(<QUERY>))))\n    {\n      OPTIONAL {\n        ?groupId sf:preferredLanguageLiteral (skos:prefLabel mads:authoritativeLabel rdfs:label skos:altLabel mads:variantLabel \'<PREFLANG>\' \'\' ?groupLabelP) .\n      }\n      BIND(COALESCE(?groupLabelP,REPLACE(REPLACE(REPLACE(REPLACE(STR(?groupId),".*/",""),".*#",""),"_"," "),"([A-ZÅÄÖ])"," $1")) AS ?groupLabel)\n    } UNION {\n      ?id sf:preferredLanguageLiteral (skos:prefLabel mads:authoritativeLabel rdfs:label skos:altLabel mads:variantLabel \'<PREFLANG>\' \'\' ?prefLabel) .\n    } UNION {\n      ?id owl:sameAs ?sameAs .\n    } UNION {\n      ?id skos:altLabel|mads:variantLabel ?altLabel .\n    }\n    # ADDITIONALSELECT\n  # ENDGRAPH\n}\n',e.SparqlAutocompleteService=o;var a=function(){function t(){this.idToIdSet=new e.EMap(function(){return new e.StringSet}),this.idToGroupIdSet=new e.EMap(function(){return new e.StringSet}),this.ifpVarPlusValueToIdSet=new e.EMap(function(){return new e.EMap(function(){return new e.StringSet})}),this.idToPrefLabelSet=new e.EMap(function(){return new e.ONodeSet}),this.idToMatchedLabelSet=new e.EMap(function(){return new e.ONodeSet}),this.idToAltLabelSet=new e.EMap(function(){return new e.ONodeSet}),this.idToDatasourceSet=new e.EMap(function(){return new e.IdentitySet}),this.seen=new e.StringSet}return t}(),s=function(){function o(e,t,r){this.$q=e,this.sparqlService=t,this.configurationWorkerService=r}return o.processBindings=function(t,r,n){n.results.bindings.forEach(function(i){var o=i.id.value;t.idToIdSet.goc(o).add(o),t.idToDatasourceSet.goc(o).add(r),i.prefLabel&&t.idToPrefLabelSet.goc(o).add(e.DataFactory.instance.nodeFromBinding(i.prefLabel)),i.altLabel&&t.idToAltLabelSet.goc(o).add(e.DataFactory.instance.nodeFromBinding(i.altLabel)),i.matchedLabel&&t.idToMatchedLabelSet.goc(o).add(e.DataFactory.instance.nodeFromBinding(i.matchedLabel)),i.groupId&&(t.idToGroupIdSet.goc(o).add(i.groupId.value),i.groupLabel&&t.idToPrefLabelSet.goc(i.groupId.value).add(e.DataFactory.instance.nodeFromBinding(i.groupLabel))),i.sameAs&&(t.idToIdSet.get(o).add(i.sameAs.value),t.idToIdSet.goc(i.sameAs.value).add(o));for(var a=0,s=n.head.vars;a<s.length;a++){var l=s[a];0!==l.indexOf("ifp")&&"prefLabel"!==l||!i[l]||t.ifpVarPlusValueToIdSet.goc(l.substring(3)).goc(i[l].value).add(o)}})},o.buildResults=function(t,r){var o=[];return t.idToIdSet.each(function(a,s){var l=t.seen.has(s)||a.values().some(function(e){return t.seen.has(e)});if(!l){t.seen.adds(a);var c=new i(a.values().map(function(t){return e.DataFactory.instance.namedNode(t)}),t.idToDatasourceSet.get(s).values(),t.idToMatchedLabelSet.get(s).values()[0],t.idToPrefLabelSet.get(s).values()[0]);
t.idToAltLabelSet.has(s)&&(c.additionalInformation.altLabel=t.idToAltLabelSet.get(s).values()),c.additionalInformation.type=t.idToGroupIdSet.get(s).values().map(function(t){return e.DataFactory.instance.namedNode(t)}),c.additionalInformation.typeLabel=t.idToGroupIdSet.get(s).values().map(function(e){return t.idToPrefLabelSet.get(e).values()[0]}),t.idToGroupIdSet.get(s).each(function(e){var i=r.get(e);i||(i=new n(t.idToPrefLabelSet.get(e).values()[0].value),r.set(e,i),o.push(i)),i.results.push(c)})}}),o},o.unifyResults=function(e){e.ifpVarPlusValueToIdSet.each(function(t){return t.each(function(t){return t.each(function(r){return e.idToIdSet.goc(r).adds(t)})})}),e.idToIdSet.each(function(t,r){return t.each(function(n){var i=e.idToIdSet.get(n);if(t!==i){e.idToIdSet.set(n,t),t.adds(i);var o=e.idToDatasourceSet.get(r),a=e.idToDatasourceSet.get(n);o?(a&&o.adds(a),e.idToDatasourceSet.set(n,o)):a&&e.idToDatasourceSet.set(r,a);var s=e.idToGroupIdSet.get(r),l=e.idToGroupIdSet.get(n);s?(l&&s.adds(l),e.idToGroupIdSet.set(n,s)):l&&e.idToGroupIdSet.set(r,l);var c=e.idToPrefLabelSet.get(r),p=e.idToPrefLabelSet.get(n);c?(p&&c.adds(p),e.idToPrefLabelSet.set(n,c)):p&&e.idToPrefLabelSet.set(r,p),c=e.idToMatchedLabelSet.get(r),p=e.idToMatchedLabelSet.get(n),c?(p&&c.adds(p),e.idToMatchedLabelSet.set(n,c)):p&&e.idToMatchedLabelSet.set(r,p),c=e.idToAltLabelSet.get(r),p=e.idToAltLabelSet.get(n),c?(p&&c.adds(p),e.idToAltLabelSet.set(n,c)):p&&e.idToAltLabelSet.set(r,p)}})})},o.prototype.autocomplete=function(n,i,s,l,c){var p=this;void 0===s&&(s=!1),void 0===l&&(l="");var u=this.$q.defer(),d=new r,h=this.configurationWorkerService.configuration.primaryEndpoint.autocompletionTextMatchQueryTemplate;h=h.replace(/<QUERY>/g,t.SparqlService.stringToSPARQLString(n)),h=h.replace(/<LIMIT>/g,""+i),h=h.replace(/# CONSTRAINTS/g,l+this.configurationWorkerService.configuration.primaryEndpoint.dataModelConfiguration.typeConstraints),h=h.replace(/<PREFLANG>/g,this.configurationWorkerService.configuration.preferredLanguage);var f=new a,y=this.sparqlService.query(this.configurationWorkerService.configuration.primaryEndpoint.endpoint.value,h,{timeout:c}).then(function(t){o.processBindings(f,p.configurationWorkerService.configuration.primaryEndpoint,t.data),d.localMatchingResults=o.buildResults(f,new e.EMap),s?u.notify({endpointType:"primary",endpoint:p.configurationWorkerService.configuration.primaryEndpoint.id,results:d}):u.resolve(d)});if(s){var v=new e.EMap;this.$q.all(this.configurationWorkerService.configuration.remoteEndpoints().map(function(r){return h=r.autocompletionTextMatchQueryTemplate,h=h.replace(/<QUERY>/g,t.SparqlService.stringToSPARQLString(n)),h=h.replace(/<LIMIT>/g,""+i),h=h.replace(/# CONSTRAINTS/g,r.dataModelConfiguration.typeConstraints),h=h.replace(/<PREFLANG>/g,p.configurationWorkerService.configuration.preferredLanguage),p.sparqlService.query(r.endpoint.value,h,{timeout:c}).then(function(e){0!==e.data.results.bindings.length&&y.then(function(){o.processBindings(f,r,e.data),o.unifyResults(f),d.remoteResults=d.remoteResults.concat(o.buildResults(f,v)),u.notify({endpointType:"remote",endpoint:r.id,results:d})})},function(t){return u.notify({endpointType:"remote",endpoint:r.id,error:e.WorkerWorkerService.stripFunctions(t)})})})).then(function(){return u.resolve(d)})}return u.promise},o}();angular.module("fibra").service("sparqlAutocompleteWorkerService",["$q","sparqlService","configurationWorkerService",function(){return new(Function.prototype.bind.apply(s,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.SparqlAutocompleteWorkerService=s}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e,t){this.id=e,this.label=t,this.children=[],this.selected=!0,this.open=!0}return e.recursivelyProcess=function(t,r){r(t),t.children.forEach(function(t){return e.recursivelyProcess(t,r)})},e.filter=function(e,t){for(var r=e.cloneWithoutChildren(),n=0,i=e.children;n<i.length;n++){var o=i[n];t(o)&&r.children.push(o)}return r},e.recursivelyMap=function(t,r){for(var n=[],i=0,o=t.children;i<o.length;i++){var a=o[i];n=n.concat(e.recursivelyMap(a,r))}return r(t,n)},e.prototype.cloneWithoutChildren=function(){var t=new e(this.id,this.label);return t.instances=this.instances,t.matchingInstances=this.matchingInstances,t.selected=this.selected,t.open=this.open,t},e}();e.TreeNode=t;var r=function(){function e(){this.bindings={tree:"<",onSelect:"&"},this.templateUrl="components/tree/tree.html"}return e}();angular.module("fibra").component("tree",new r),e.TreeComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(){this.bindings={tree:"<",onSelect:"&"},this.templateUrl="components/type-select/type-select.html"}return e}();angular.module("fibra").component("typeSelect",new t),e.TypeSelectComponent=t}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e,t,r){this.appName=e,this.workerThreads=t,this.importScripts=r}return e}();e.WorkerServiceConfiguration=t;var r=function(){function e(t,r,n,i,o){var a=this;this.workerServicePrototypeMappingConfiguration=r,this.$q=o,this.currentWorker=0,this.deferreds=[];var s=i.location.protocol+"//"+i.location.host,l=t.importScripts.map(function(e){return 0!==e.indexOf("http")?s+(0!==e.indexOf("/")?i.location.pathname:"")+e:e}),c=i.URL.createObjectURL(new Blob([e.workerTemplate.replace(/<APP_NAME>/g,t.appName).replace(/<IMPORT_SCRIPTS>/g,l.join("','"))],{type:"application/javascript"}));this.workers=[];for(var p=0;p<t.workerThreads;p++)this.workers.push(new Worker(c)),this.workers[p].addEventListener("message",function(e){var t=e.data.event;if("broadcast"===t)n.$broadcast(e.data.name,a.restorePrototypes(e.data.args)),n.$apply();else{var r=a.deferreds[e.data.id];r&&("success"===t?(delete a.deferreds[e.data.id],r.resolve(a.restorePrototypes(e.data.data))):"failure"===t?(delete a.deferreds[e.data.id],r.reject(a.restorePrototypes(e.data.data))):r.notify(a.restorePrototypes(e.data.data)))}})}return e.stripMarks=function(t){if(t&&t.__mark&&"object"==typeof t)if(delete t.__mark,t instanceof Array)t.forEach(function(t){return e.stripMarks(t)});else for(var r in t)t.hasOwnProperty(r)&&e.stripMarks(t[r])},e.stripPrototypes=function(t){if(t&&t.__className&&"object"==typeof t)if(delete t.__className,t instanceof Array)t.forEach(function(t){return e.stripPrototypes(t)});else for(var r in t)t.hasOwnProperty(r)&&e.stripPrototypes(t[r])},e.savePrototypes=function(t){return e.stripPrototypes(t),this.savePrototypesInternal(t),t},e.savePrototypesInternal=function(t){if(t&&!t.__className&&"object"==typeof t)if(t instanceof Array)t.forEach(function(t){return e.savePrototypes(t)});else{if(t.constructor.__name||"Object"!==t.constructor.name){var r=Object.getPrototypeOf(t);e:for(;r!==Object.prototype;){for(var n=0,i=Object.getOwnPropertyNames(r);n<i.length;n++){var o=i[n];if("constructor"!==o&&"function"==typeof t.__proto__[o]){t.__className=t.constructor.__name?t.constructor.__name:t.constructor.name;break e}}r=Object.getPrototypeOf(r)}t.__className||(t.__className="Object")}for(var a in t)t.hasOwnProperty(a)&&e.savePrototypes(t[a])}},e.prototype.$broadcast=function(t,r){this.workers.forEach(function(n){return n.postMessage({name:t,args:e.savePrototypes(r)})})},e.prototype.callAll=function(t,r,n,i){var o=this;void 0===n&&(n=[]);var a=this.$q.defer();this.deferreds.push(a);var s=this.deferreds.length-1,l={id:s,service:t,method:r,args:e.savePrototypes(n)};return i&&i.then(function(){o.workers.forEach(function(e){return e.postMessage({id:s,cancel:!0})}),delete o.deferreds[s]}),this.workers.forEach(function(e){return e.postMessage(l)}),a.promise},e.prototype.call=function(t,r,n,i){var o=this;void 0===n&&(n=[]);var a=this.$q.defer();this.deferreds.push(a);var s=this.deferreds.length-1,l=this.workers[this.currentWorker];return this.currentWorker=(this.currentWorker+1)%this.workers.length,i&&i.then(function(){l.postMessage({id:s,cancel:!0}),delete o.deferreds[s]}),l.postMessage({id:s,service:t,method:r,args:e.savePrototypes(n)}),a.promise},e.prototype.restorePrototypes=function(t){return this.restorePrototypesInternal(t),e.stripMarks(t),t},e.prototype.restorePrototypesInternal=function(e){var t=this;if(e&&!e.__mark&&"object"==typeof e)if(e.__mark=!0,e instanceof Array)e.forEach(function(e){return t.restorePrototypesInternal(e)});else{if(e.__className){var r=this.workerServicePrototypeMappingConfiguration[e.__className];if(!r)throw"Unknown prototype "+e.__className;e.__proto__=r,delete e.__className}for(var n in e)e.hasOwnProperty(n)&&this.restorePrototypesInternal(e[n])}},e}();angular.module("fibra").service("workerService",["workerServiceConfiguration","workerServicePrototypeMappingConfiguration","$rootScope","$window","$q",function(){return new(Function.prototype.bind.apply(r,[null].concat(Array.prototype.slice.apply(arguments))))}]),r.workerTemplate="\n      var window = self\n      self.history = {}\n      self.Node = function () {}\n      var document = {\n        readyState: 'complete',\n        cookie: '',\n        querySelector: function () {},\n        addEventListener: function() {},\n        createElement: function() {\n          return {\n            pathname: '',\n            setAttribute: function(key, value) {}\n          };\n        },\n      };\n      importScripts('<IMPORT_SCRIPTS>')\n      window.angular.module('<APP_NAME>').run(['workerWorkerService', function(workerWorkerService) {\n        self.addEventListener('message', function(e) { workerWorkerService.onMessage(e.data) })\n      }])\n      window.angular.bootstrap(null, ['<APP_NAME>'])\n    ",e.WorkerService=r;var n=function(){function e(e,t,r,n){this.workerServicePrototypeMappingConfiguration=e,this.$injector=t,this.$q=r,this.$rootScope=n,this.cancellers=[]}return e.stripFunctions=function(t){var r={};for(var n in t)"object"==typeof t[n]?r[n]=e.stripFunctions(t[n]):"function"!=typeof t[n]&&(r[n]=t[n]);return r},e.prototype.$broadcast=function(e,t){try{self.postMessage({event:"broadcast",name:e,args:r.savePrototypes(t)})}catch(e){throw console.log(t,e),e}},e.prototype.onMessage=function(t){var n=this;if(void 0===t.id)this.$rootScope.$broadcast(t.name,this.restorePrototypes(t.args)),this.$rootScope.$apply();else if(t.cancel){var i=this.cancellers[t.id];delete this.cancellers[t.id],i&&i.resolve()}else{var o=this.$injector.get(t.service),i=this.$q.defer();this.cancellers[t.id]=i;var a=o[t.method].apply(o,this.restorePrototypes(t.args).concat(i.promise));if(!a||!a.then){var s=this.$q.defer();s.resolve(a),a=s.promise}a.then(function(e){delete n.cancellers[t.id],self.postMessage({event:"success",id:t.id,data:r.savePrototypes(e)})},function(i){delete n.cancellers[t.id],self.postMessage({event:"failure",id:t.id,data:r.savePrototypes(e.stripFunctions(i))})},function(e){return self.postMessage({event:"update",id:t.id,data:r.savePrototypes(e)})})}},e.prototype.restorePrototypes=function(e){return this.restorePrototypesInternal(e),r.stripMarks(e),e},e.prototype.restorePrototypesInternal=function(e){var t=this;if(e&&!e.__mark&&"object"==typeof e)if(e.__mark=!0,e instanceof Array)e.forEach(function(e){return t.restorePrototypesInternal(e)});else{if(e.__className){var r=this.workerServicePrototypeMappingConfiguration[e.__className];if(!r)throw"Unknown prototype "+e.__className;e.__proto__=r,delete e.__className}for(var n in e)e.hasOwnProperty(n)&&this.restorePrototypesInternal(e[n])}},e}();angular.module("fibra").service("workerWorkerService",["workerServicePrototypeMappingConfiguration","$injector","$q","$rootScope",function(){return new(Function.prototype.bind.apply(n,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.WorkerWorkerService=n}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function t(e,t){this.fibraService=e,this.sparqlItemService=t,this.primaryItems=[],this.secondaryItems=[],this.tableTypes=["primary","secondary"],this.primary={properties:[],items:[]},this.secondary={properties:[],items:[]},this.removedProperties=[],this.originalPropertiesMap={},this.fibraService=e}return t.prototype.$onChanges=function(e){this.primary.properties=[],this.secondary.properties=[],this.primary.items=this.primaryItems,this.secondary.items=this.secondaryItems,this.sortProperties()},t.prototype.selectItem=function(t){this.editItem=t;var r=t.localProperties.map(function(t){var r=new e.PropertyToValues(t);return t.values.filter(function(e){return"Literal"===e.termType}).forEach(function(t){var n=e.DataFactory.instance.literal(t.value),i=new e.SourcedNodePlusLabel(n,t.label,t.sourceEndpoints);r.values.push(i)}),r}).filter(function(e){return e.values.length>0});this.originalPropertiesMap[t.value]=r},t.prototype.itemVerified=function(t){return!!t.localProperties.filter(function(t){return t.value===e.OWL.sameAs.value})[0]},t.prototype.saveItem=function(t){var r=this,n=t.localProperties.map(function(t){var r=new e.PropertyToValues(t);return t.values.filter(function(e){return"Literal"===e.termType}).forEach(function(t){var n=e.DataFactory.instance.literal(t.value);r.values.push(n)}),r}).filter(function(e){return e.values.length>0});this.fibraService.dispatchAction(this.fibraService.itemProperty(t,n,this.originalPropertiesMap[t.value])).then(function(){r.fibraService.dispatch("change"),r.editItem=null})},t.prototype.hide=function(e){return this.fibraService.dispatchAction(this.fibraService.hideItem(e)).then(function(){return"ok"})},t.prototype.delete=function(e){return this.fibraService.dispatchAction(this.fibraService.deleteItem(e))},t.prototype.sortProperties=function(){var e=this;["primary","secondary"].forEach(function(t){for(var r=0;r<e[t].items.length;r++)for(var n=0;n<e[t].items[r].localProperties.length;n++){for(var i=!1,o=0;o<e.removedProperties.length;o++)e.removedProperties[o]==e[t].items[r].localProperties[n].label.value&&(i=!0);for(var o=0;o<e[t].properties.length;o++)e[t].properties[o]==e[t].items[r].localProperties[n].label.value&&(i=!0);i||e[t].properties.push(e[t].items[r].localProperties[n].label.value)}})},t.prototype.removeFromProperties=function(e){var t=this;["primary","secondary"].forEach(function(r){for(var n=0;n<t[r].properties.length;n++)t[r].properties[n]==e&&t[r].properties.splice(n,1)}),this.addToRemovedProperties(e)},t.prototype.addToRemovedProperties=function(e){this.removedProperties.push(e)},t.prototype.addFromRemovedProperties=function(e){for(var t=0;t<this.removedProperties.length;t++)this.removedProperties[t]==e&&this.removedProperties.splice(t,1);this.fibraService.dispatch("change")},t.prototype.verify=function(e){this.fibraService.dispatchAction(this.fibraService.verifyItem(e))},t.prototype.downloadcsv=function(){for(var e=this.primary.items,t="data:text/csv;charset=utf-8,",r=0;r<e.length;r++){for(var n=0;n<e[r].localProperties.length;n++)t+=e[r].localProperties[n].values[0].value+",";t+="\n"}var i=encodeURI(t);window.open(i)},t}();angular.module("fibra").controller("ExploreTableComponentController",["fibraService","sparqlItemService",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.ExploreTableComponentController=t;var r=function(){function e(){this.templateUrl="components/construct-view/explore-table-component/explore-table-component.html",this.controller="ExploreTableComponentController",this.bindings={primaryItems:"<",secondaryItems:"<"}}return e}();angular.module("fibra").component("exploreTable",new r),e.ExploreTableComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function e(e){var t=this;this.fibraService=e,this.fibraService=e,this.types=function(){return t.fibraService.getState().construct.types.concat(t.fibraService.getState().construct.userTypes)},this.displayTypes=function(){return t.fibraService.getState().construct.displayTypes}}return e.prototype.primaryClick=function(e){var t=this.displayTypes().concat([]);t[0]=e,this.fibraService.dispatchAction(this.fibraService.setOrderedTypes(t)),this.fibraService.dispatch("change")},e.prototype.secondaryClick=function(e){var t=this.displayTypes().concat([]);t[1]=e,this.fibraService.dispatchAction(this.fibraService.setOrderedTypes(t)),this.fibraService.dispatch("change")},e.prototype.tertiaryClick=function(e){var t=this.displayTypes().concat([]);t[2]=e,this.fibraService.dispatchAction(this.fibraService.setOrderedTypes(t)),this.fibraService.dispatch("change")},e}();angular.module("fibra").controller("ExploreTypeComponentController",["fibraService",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.ExploreTypeComponentController=t;var r=function(){function e(){this.templateUrl="components/construct-view/explore-type-component/explore-type-component.html",this.controller="ExploreTypeComponentController"}return e}();angular.module("fibra").component("exploreType",new r),e.ExploreTypeComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function t(e,t,r){this.fibraService=e,this.$q=t,this.sparqlAutocompleteService=r,this.limitFilter="",this.queryString="",this.relevantTypes=[],this.fibraService=e,this.canceller=t.defer()}return t.prototype.$onChanges=function(e){this.node&&(this.queryString=this.node.label.value,this.node&&this.runQuery())},t.prototype.runQuery=function(){var t=this;this.canceller.resolve(),this.updateResults(new e.AutocompletionResults),this.queryRunning=!0,this.error=!1,this.limitFilter="",this.canceller=this.$q.defer();var r=this.node.localProperties.filter(function(e){return"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===e.value})[0];this.relevantTypes=r?r.values:[],this.relevantTypes.forEach(function(e){e&&(t.limitFilter+="<"+e.value+">,")}),0!==this.limitFilter.length&&(this.limitFilter="FILTER (?groupId IN ("+this.limitFilter.substring(0,this.limitFilter.length-1)+"))"),this.sparqlAutocompleteService.autocomplete(this.queryString,6,!0,this.limitFilter,this.canceller.promise).then(function(e){t.queryRunning=!1,t.updateResults(e)},function(){t.queryRunning=!1,t.error=!0},function(e){e.error?t.error=!0:t.updateResults(e.results)})},t.prototype.updateResults=function(e){var t=this.relevantTypes.map(function(e){return e.label.value});this.matchingResults=e.remoteResults.filter(function(e){return t.indexOf(e.label)!==-1}),console.log(this.matchingResults)},t.prototype.sourcesFromResult=function(e){return" (Sources: "+e.datasources.map(function(e){return e.name}).join(", ")+")"},t.prototype.verify=function(t){var r=this,n=new e.PropertyToValues(e.OWL.sameAs);t.ids.forEach(function(t){var r=new e.NamedNode(t.value);n.values.push(r)}),this.fibraService.dispatchAction(this.fibraService.itemProperty(this.node,[n])).then(function(){r.clear()})},t.prototype.clear=function(){this.fibraService.dispatchAction(this.fibraService.verifyItem(null))},t}();angular.module("fibra").controller("ExploreVerifyComponentController",["fibraService","$q","sparqlAutocompleteService",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.ExploreVerifyComponentController=t;var r=function(){function e(){this.templateUrl="components/construct-view/explore-verify-component/explore-verify-component.html",this.controller="ExploreVerifyComponentController",this.bindings={node:"<"}}return e}();angular.module("fibra").component("exploreVerify",new r),e.ExploreVerifyComponent=r}(fibra||(fibra={}));var fibra;!function(e){"use strict";var t=function(){function t(e,t,r,n,i,o,a){this.fibraService=e,this.configurationService=t,this.$element=r,this.sparqlItemService=n,this.sparqlTreeService=i,this.$scope=o,this.$q=a,this.paletteSearchHeight=40,this.typeColorScale=d3.scaleOrdinal(d3.schemeCategory20c),this.labelFilter="",this.typeItemTree=d3.map(),o.loadCSV=this.loadCSV.bind(this),this.typeItemTree.set("",{label:"No type defined",items:[],expanded:!1}),this.query()}return t.prototype.query=function(){var e=this;return this.typeItemTreePromise=this.sparqlItemService.getAllItems().then(function(t){return e.mergeItems(e.items,t)})},t.prototype.$postLink=function(){var e=this;this.divSel=d3.select(this.$element[0]).select("div.palette"),this.nodeDrag=d3.select(this.$element[0]).select(".palette-node-drag"),this.nodeDrag.style("display","none"),this.nodeDrag.append("circle"),this.divSel.style("height","100%").style("width","100%"),this.tooltip=d3.select("body").append("div").style("position","absolute").style("z-index","20").style("background-color","gray").style("color","white").style("padding","3px").style("border-radius","2px").style("visibility","hidden");var t=function(){return e.query().then(e.build.bind(e)).then(function(){return"Done"})};this.fibraService.on("change",t),this.typeItemTreePromise.then(function(t){e.build.bind(e)(t)})},t.prototype.addItem=function(e,t){var r=this,n=e.typeValue,i=this.fibraService.getState().construct.types.filter(function(e){return e.id===n})[0],o=this.fibraService.getState().construct.displayTypes;if(!o[0]&&i)this.fibraService.dispatchAction(this.fibraService.setOrderedTypes([i]));else if(!o[1]&&i&&o[0]!==i){var a=o.concat([]);a.push(i),this.fibraService.dispatchAction(this.fibraService.setOrderedTypes(a))}return this.fibraService.dispatchAction(this.fibraService.displayItem(e,t)).then(function(e){return r.fibraService.dispatch("change"),e})},t.prototype.createItem=function(t){var r=this,n=e.DataFactory.instance.namedNode(t);this.fibraService.dispatchAction(this.fibraService.createItem(n)).then(function(){r.query().then(function(e){r.build.bind(r)(e)})})},t.prototype.uploadCSV=function(e){this.typeForCreation=e.key,$("#dataModelSelector").click()},t.prototype.loadCSV=function(t){var r=this,n=new FileReader;n.onload=function(){var t=d3.csvParse(n.result),i=t.columns[0];r.fibraService.dispatchAction(r.fibraService.createItems(t.map(function(t){var r=e.DataFactory.instance.namedNode(t[i]);return r}),r.typeForCreation)).then(function(){r.query().then(function(e){r.build.bind(r)(e)})})},n.readAsText(t.files[0]),t.value=null},t.prototype.build=function(e){var t=this;this.updateSizing();var r=e.entries().filter(function(e){return""!==e.key}),n=r.reduce(function(e,t){return e.concat(t.value.items)},[]),i=n.length>300?n.length>2e3?1:2:4,o=this.paletteHeight-25*r.length,a=(Math.sqrt(this.paletteWidth*o/n.length)-i)/2,s=a>8?8:a,l=2*s+i/2,c=2*s+i/2,p=Math.floor(this.paletteWidth/l)-1,u=this.nodeDrag,d=this.addItem.bind(this);this.paletteWidth;this.types=this.divSel.selectAll("div.type").data(r,function(e){return e.key}),this.types.exit().remove();var h=this.types.enter().append("div").classed("type",!0).classed("inverse-icon",!0).text(function(e){return e.value.label});h.append("span").classed("glyphicon",!0).classed("glyphicon-upload",!0).on("click",this.uploadCSV.bind(this)),h.append("span").classed("glyphicon",!0).classed("expand-button",!0).on("click",function(e){e.value.expanded=!e.value.expanded,t.typeItemTreePromise.then(t.build.bind(t))}),h.append("svg").attr("width","100%"),this.types=h.merge(this.types),this.types.selectAll(".expand-button").classed("glyphicon-resize-small",function(e){return e.value.expanded}).classed("glyphicon-resize-full",function(e){return!e.value.expanded}),this.types.selectAll("svg").style("display",function(e){return e.value.expanded?"block":"none"});var f=this.types.select("svg").attr("height",function(e){return(Math.ceil(e.value.items.length/p)+1)*c});this.circles=f.selectAll("circle.item").data(function(e){return e.value.items},function(e){return e.value}),this.circles.exit().remove(),this.circles=this.circles.enter().append("circle").classed("item",!0).attr("r",s).on("mouseover",function(e,r){t.tooltip.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px").style("visibility","visible").text(e.label.value+" ("+e.typeLabel+")")}).on("mouseout",function(e,r){t.tooltip.style("visibility","hidden")}).call(d3.drag().on("start",function(e){var t=d3.select(this);u.style("display","block"),u.select("circle").classed("item",t.classed("item")).attr("r",t.attr("r")).attr("fill",t.attr("fill")).attr("transform","translate(8,8)"),u.style("left",d3.event.sourceEvent.clientX-8).style("top",d3.event.sourceEvent.clientY-8)}).on("drag",function(e){u.style("left",d3.event.sourceEvent.clientX-8).style("top",d3.event.sourceEvent.clientY-8)}).on("end",function(e){var t=d3.select("#explorecontainer").node();d3.event.sourceEvent.clientX>t.getBoundingClientRect().left&&d3.event.sourceEvent.clientX<t.getBoundingClientRect().right&&d3.event.sourceEvent.clientY>t.getBoundingClientRect().top&&d3.event.sourceEvent.clientY<t.getBoundingClientRect().bottom?d(d3.select(this).datum(),[d3.event.sourceEvent.clientX-t.getBoundingClientRect().left,d3.event.sourceEvent.clientY-t.getBoundingClientRect().top]).then(function(){u.style("display","none")}):u.style("display","none")})).merge(this.circles).call(this.update.bind(this)),this.circles.transition().attr("fill",function(e){return t.typeColorScale(e.typeValue)}).attr("transform",function(e,t){return"translate("+(t%p+1)*l+","+(Math.floor(t/p)+1)*c+")"})},t.prototype.update=function(e){var t=this,r=e?e:this.circles;r.classed("displayed",function(e){return!!t.fibraService.getState().construct.itemIndex[e.value]}).classed("filtered",function(e){return t.labelFilter&&!(e.label.value.toUpperCase().indexOf(t.labelFilter.toUpperCase())!==-1)})},t.prototype.updateSizing=function(){this.paletteWidth=Math.round(.15*window.innerWidth),this.paletteHeight=Math.round(window.innerHeight)-this.paletteSearchHeight,this.divSel.style("height",this.paletteHeight+"px")},t.prototype.mergeItems=function(t,r){var n=this;return this.typeItemTree.values().forEach(function(e){e.items=[]}),r.forEach(function(t){var r=t.localProperties.filter(function(t){return t.value===e.RDF.type.value})[0];r&&r.values[0]?(t.typeValue=r.values[0].value,t.typeLabel=r.values[0].label.value,n.typeItemTree.has(t.typeValue)?n.typeItemTree.get(t.typeValue).items.push(t):n.typeItemTree.set(t.typeValue,{label:t.typeLabel,items:[t],expanded:!0})):(t.typeValue="",t.typeLabel="No type defined")}),this.typeItemTree.values().forEach(function(e){e.items.sort(function(e,t){return e.label.value===t.label.value?0:e.label.value>t.label.value?1:-1})}),this.typeItemTree},t}();angular.module("fibra").controller("PaletteComponentController",["fibraService","configurationService","$element","sparqlItemService","sparqlTreeService","$scope","$q",function(){return new(Function.prototype.bind.apply(t,[null].concat(Array.prototype.slice.apply(arguments))))}]),e.PaletteComponentController=t;var r=function(){function e(){this.templateUrl="components/construct-view/palette-component/palette-component.html",this.controller="PaletteComponentController"}return e}();angular.module("fibra").component("palette",new r),e.PaletteComponent=r}(fibra||(fibra={})),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/projects-view/projects-view.html",'\n<div class="container">\n  <h1>Fibra</h1>\n  <h2>New project</h2>\n  <ol>\n    <li><a ui-sref="configure">Configure</a></li>\n    <li>Select</li>\n    <li>Construct</li>\n  </ol>\n  <h2>Existing projects</h2>\n  <ul>\n    <li><a ng-click="$ctrl.setProject(\'set2\')">People two degrees removed from John Locke from SDFB and associated places from EMLO</a>\n      <ul>\n        <li>1,227 Person</li>\n        <li>204 Place</li>\n      </ul>\n    </li>\n    <li><a ng-click="$ctrl.setProject(\'set3\')">People two degrees removed from John Locke from SDFB</a>\n      <ul>\n        <li>1,215 Person</li>\n      </ul>\n    </li>\n    <li><a ng-click="$ctrl.setProject(\'set1\')">The Ancient World (Pleiades &amp; Pelagios)</a>\n      <ul>\n        <li>1,188 Place</li>\n        <li>22,564 Thing</li>\n      </ul>\n    </li>\n  </ul>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/construct-view/construct-view.html",'\n<nav class="navbar navbar-default navbar-static-top palette-relevant" id="menu-bar" ng-class="{\'palette-offset\': $ctrl.paletteDisplay }">\n  <div class="pull-left" id="type-bar">\n    <explore-type></explore-type>\n  </div>\n  <div class="pull-left" id="menu-icons"><span class="btn-group">\n      <button class="btn btn-xs" ng-init="linkMode = false" ng-click="linkMode = !linkMode" ng-class="{\'btn-primary\': linkMode}"><span class="glyphicon glyphicon-link" aria-hidden="true"></span></button></span><span class="btn-group">\n      <button class="btn btn-xs disabled"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span></button>\n      <button class="btn btn-xs disabled"><span class="glyphicon glyphicon-zoom-out" aria-hidden="true"></span></button></span><span class="btn-group">\n      <button class="btn btn-xs disabled"><span class="glyphicon glyphicon-upload" aria-hidden="true"></span></button>\n      <button class="btn btn-xs" ng-click="$ctrl.downloadRDF()"><span class="glyphicon glyphicon-download" aria-hidden="true"></span></button></span></div>\n  <div class="pull-right"><span>{{ $ctrl.loginState() }}</span><a ng-if="$ctrl.loginState() !== \'Not logged in\'" ng-click="$ctrl.socialAuthService.logout()">&nbsp;Log out</a></div>\n  <div class="pull-right"><span class="glyphicon glyphicon-refresh fa-spin" ng-show="$ctrl.state.actionsRunning &gt; 0"></span></div>\n</nav>\n<div class="container-fluid main">\n  <div class="row main no-gutter">\n    <div class="col-md-12">\n      <div class="col-md-12 palette-relevant" id="middle-column" ng-class="{\'palette-offset\': $ctrl.paletteDisplay }">\n        <explore link-mode="linkMode"></explore>\n      </div>\n    </div>\n  </div>\n</div>\n<div id="palette-container" ng-show="$ctrl.paletteDisplay">\n  <palette></palette>\n</div>\n<div id="palette-tab" ng-class="{closed: !$ctrl.paletteDisplay }" ng-click="$ctrl.paletteDisplay = !$ctrl.paletteDisplay"></div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/construct-view/explore.html",'\n<div id="explorecontainer">\n  <svg id="explore"></svg>\n</div>\n<div id="layout-choice">\n  <label>Force\n    <input type="radio" ng-model="layout.choice" value="force"/>\n  </label>\n  <label>Force Grid\n    <input type="radio" ng-model="layout.choice" value="forcegrid"/>\n  </label>\n</div>\n<div id="link-options">\n  <label>Show\n    <input type="radio" ng-model="layout.links" value="show"/>\n  </label>\n  <label>Hide\n    <input type="radio" ng-model="layout.links" value="hide"/>\n  </label>\n</div>\n<div id="tablecontainer">\n  <explore-table primary-items="$ctrl.primaryItems" secondary-items="$ctrl.secondaryItems"></explore-table>\n</div>\n<div id="verifycontainer" ng-show="$ctrl.verifyItem">\n  <explore-verify node="$ctrl.verifyItem"></explore-verify>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/construct-view/property-popover-component.html",'\n<div>\n  <div class="form-group">\n    <label class="control-label" for="typeSelect">Type\n      <button class="btn btn-sm pull-right" type="button" ng-show="$ctrl.showTypeCreate" ng-click="$ctrl.typeCreate($ctrl.typeQueryGS())">Create Type</button>\n      <input class="form-control label-input pull-right" type="text" ng-model="$ctrl.typeQueryGS" ng-model-options="{ getterSetter: true }" uib-typeahead="type.label for type in $ctrl.getTypes() | filter:$viewValue | limitTo:8" ng-change="$ctrl.typeEvaluate($ctrl.typeQueryGS())" typeahead-on-select="$ctrl.typeChange($item, $model, $label, $event)"/>\n    </label>\n  </div>\n  <div class="form-group" ng-show="$ctrl.chosenType.id !== $ctrl.thingType">\n    <label class="control-label" for="labelField">Label\n      <input class="form-control label-input pull-right" type="text" ng-model="$ctrl.label" ng-blur="$ctrl.labelChange()"/>\n    </label>\n  </div>\n  <div class="form-group"><a class="btn btn-sm" ng-click="$ctrl.deleteAndClose()">Cancel</a><a class="btn btn-sm" ng-click="$ctrl.closePopover()" ng-show="$ctrl.label!==\'\'">Save and close</a></div>\n</div>');
}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/configure-view/configure-view.html",'\n<script type="text/ng-template" id="treenode.html">{{node.label}}<span ng-if="node.instances&gt;0">&nbsp;({{node.instances | number}})</span>\n  <ul>\n    <li ng-repeat="node in node.children track by $index" ng-include="\'treenode.html\'"></li>\n  </ul>\n</script>\n<div class="container">\n  <h3>Select configuration</h3>\n  <div class="well" ng-repeat="configuration in $ctrl.configurations">\n    <h4><a ng-click="$ctrl.setConfiguration(configuration)">{{configuration.name}}</a></h4>\n    <div ng-if="configuration.authorityEndpoints.length &gt; 0">\n      <h5>Configured Authorities:</h5>\n      <ul>\n        <li ng-repeat="endpoint in configuration.authorityEndpoints"><a ng-if="endpoint.citation.url" ng-href="{{endpoint.citation.url}}">{{endpoint.citation.name}}</a><span ng-if="!endpoint.citation.url">{{endpoint.citation.name}}</span><span ng-if="endpoint.citation.rightsholder">&nbsp;(<a ng-if="endpoint.citation.rightsholderurl" ng-href="{{endpoint.citation.rightsholderurl}}">{{endpoint.citation.rightsholder}}</a><span ng-if="!endpoint.citation.rightsholderurl">{{endpoint.citation.rightsholder}}</span>)</span>\n          <ul>\n            <li ng-repeat="node in $ctrl.statistics[endpoint.id]" ng-include="\'treenode.html\'"></li>\n          </ul>\n        </li>\n      </ul>\n    </div>\n    <div ng-if="configuration.archiveEndpoints.length &gt; 0">\n      <h5>Configured Archives:</h5>\n      <ul>\n        <li ng-repeat="endpoint in configuration.archiveEndpoints"><a ng-if="endpoint.citation.url" ng-href="{{endpoint.citation.url}}">{{endpoint.citation.name}}</a><span ng-if="!endpoint.citation.url">{{endpoint.citation.name}}</span><span ng-if="endpoint.citation.rightsholder">&nbsp;(<a ng-if="endpoint.citation.rightsholderurl" ng-href="{{endpoint.citation.rightsholderurl}}">{{endpoint.citation.rightsholder}}</a><span ng-if="!endpoint.citation.rightsholderurl">{{endpoint.citation.rightsholder}}</span>)</span>\n          <ul>\n            <li ng-repeat="node in $ctrl.statistics[endpoint.id] track by $index" ng-include="\'treenode.html\'"></li>\n          </ul>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/author-view/author-view.html",'\n<div class="container-fluid">\n  <div class="row no-gutter">\n    <div class="col-md-12">foo</div>\n  </div>\n  <div class="row">\n    <div class="col-md-12">\n      <sparql-autocomplete on-select="$ctrl.createItem(result)"></sparql-autocomplete>\n    </div>\n  </div>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/select-view/select-view.html",'\n<div class="container">\n  <h2>Constrain configuration</h2>\n  <ul>\n    <li><a ng-click="$ctrl.setData(\'set4\')">Unconstrained <br /><img src="http://hdlab.stanford.edu/img/breve_rect.png" height="200"/></a></li>\n    <li>1700-1800 Europe (n people, n+5 places) <br /><img src="http://hdlab.stanford.edu/img/breve_rect.png" height="200"/></li>\n    <li>1700-1800 France (y people, y-10 places) <br /><img src="http://hdlab.stanford.edu/img/breve_rect.png" height="200"/></li>\n  </ul>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/sparql-autocomplete/sparql-autocomplete.html",'\n<script type="text/ng-template" id="sparql-autocomplete-item-popover">\n  <sparql-item item-id="result.ids[0]" show-remote-properties="true"></sparql-item>\n</script>\n<div class="has-feedback">\n  <input class="form-control" ng-model="$ctrl.query" ng-model-options="{ debounce: 500 }" ng-change="$ctrl.onChange($ctrl.query)" ng-focus="$ctrl.hide = false"/><span class="glyphicon glyphicon-refresh fa-spin form-control-feedback" ng-show="$ctrl.queryRunning"></span><span class="danger glyphicon glyphicon-alert form-control-feedback" ng-show="$ctrl.error"></span><span class="glyphicon glyphicon-remove form-control-feedback" ng-show="$ctrl.results" ng-click="$ctrl.clear()" style="pointer-events: auto;"></span>\n</div>\n<div ng-if="!$ctrl.hide">\n  <div ng-repeat="resultGroup in $ctrl.results.localMatchingResults track by $index">\n    <h4>{{ resultGroup.label }}</h4>\n    <ul>\n      <li ng-repeat="result in resultGroup.results track by $index" ng-click="$ctrl.onSelectInternal({result:result})">{{result.matchedLabel.value}}<span ng-if="result.matchedLabel.value !== result.prefLabel.value">-&gt; {{result.prefLabel.value}}</span><span ng-if="result.additionalInformation[\'altLabel\']">&nbsp;(<span ng-repeat="altLabel in result.additionalInformation[\'altLabel\'] | limitTo:5">{{$last ? altLabel.value : altLabel.value+\', \'}}</span><span ng-if="result.additionalInformation[\'altLabel\'].length&gt;5">, &hellip;</span>)</span>&nbsp;[<span ng-repeat="datasource in result.datasources track by $index">{{$last ? datasource.id : datasource.id+\', \'}}</span>]</li>\n    </ul>\n  </div>\n</div>\n<div ng-if="!$ctrl.hide &amp;&amp; $ctrl.results.remoteResults &amp;&amp; $ctrl.results.remoteResults.length != 0">\n  <h3>Further results</h3>\n  <div ng-repeat="resultGroup in $ctrl.results.remoteResults track by $index">\n    <h4>{{ resultGroup.label }}</h4>\n    <ul>\n      <li ng-repeat="result in resultGroup.results track by $index" ng-click="$ctrl.onSelectInternal({result:result})">{{result.matchedLabel.value}}<span ng-if="result.matchedLabel.value !== result.prefLabel.value">-&gt; {{result.prefLabel.value}}</span><span ng-if="result.additionalInformation[\'altLabel\']">&nbsp;(<span ng-repeat="altLabel in result.additionalInformation[\'altLabel\'] | limitTo:5">{{$last ? altLabel.value : altLabel.value+\', \'}}</span><span ng-if="result.additionalInformation[\'altLabel\'].length&gt;5">, &hellip;</span>)</span>&nbsp;[<span ng-repeat="datasource in result.datasources track by $index">{{$last ? datasource.id : datasource.id+\', \'}}</span>]</li>\n    </ul>\n  </div>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/sparql-item/sparql-item.html",'\n<script type="text/ng-template" id="sparql-item-popover">\n  <sparql-item endpoint="$ctrl.endpoint" item-id="value" show-remote-properties="true"></sparql-item>\n</script>\n<h4>{{$ctrl.item.label.value}}</h4><a ng-click="$ctrl.addItem()">+</a>\n<table class="table table-striped">\n  <tr ng-repeat="property in $ctrl.item.localProperties">\n    <th>{{property.label ? property.label.value : property.value}}</th>\n    <td><span ng-repeat="value in property.values" ng-click="$ctrl.onSelect({value: value})" uib-popover-template="\'sparql-item-popover\'" popover-trigger="mouseenter" popover-placement="right">{{value.label ? value.label.value : value.value}}<i class="glyphicon glyphicon-triangle-top" ng-repeat="endpoint in value.sourceEndpoints" ng-class="endpoint.class"></i>{{ $last ? \'\' : \', \' }}</span></td>\n  </tr>\n</table><i class="glyphicon glyphicon-chevron-down" ng-click="$ctrl.showRemoteProperties=!$ctrl.showRemoteProperties"></i>\n<table class="table table-striped" ng-show="$ctrl.showRemoteProperties">\n  <tr ng-repeat="property in $ctrl.item.remoteProperties">\n    <th>{{property.label ? property.label.value : property.value}}</th>\n    <td><span ng-repeat="value in property.values" ng-click="$ctrl.onSelect({value: value})" uib-popover-template="\'sparql-item-popover\'" popover-trigger="mouseenter" popover-placement="right">{{value.label ? value.label.value : value.value}}<i class="glyphicon glyphicon-triangle-top" ng-repeat="endpoint in value.sourceEndpoints" ng-class="endpoint.class"></i>{{ $last ? \'\' : \', \' }}</span></td>\n  </tr>\n</table>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/tree/tree.html",'\n<script type="text/ng-template" id="treenode.html">\n  <div class="checkbox">\n    <label>\n      <input type="checkbox" ng-model="node.selected" ng-change="$ctrl.onSelect({treeNode:node})"/>{{node.label}}\n    </label><span class="pull-left">{{node.matchingInstances != node.matchingInstances ? node.matchingInstances+\'/\'+node.instances : node.instances}}</span>\n  </div>\n  <ul>\n    <li ng-repeat="node in node.children" ng-include="\'treenode.html\'" ng-class="{selected:node.selected}"></li>\n  </ul>\n</script>\n<ul>\n  <li ng-repeat="node in $ctrl.tree" ng-include="\'treenode.html\'" ng-class="{selected:node.selected}"></li>\n</ul>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/type-select/type-select.html",'\n<script type="text/ng-template" id="type-pill.html">\n  <div class="checkbox">\n    <label>\n      <input type="checkbox" ng-model="node.selected" ng-change="$ctrl.onSelect({treeNode:node})"/>{{node.label}}\n    </label><span class="pull-left">{{node.matchingInstances != node.matchingInstances ? node.matchingInstances+\'/\'+node.instances : node.instances}}</span>\n  </div>\n  <ul>\n    <li ng-repeat="node in node.children" ng-include="\'tree-pill.html\'" ng-class="{selected:node.selected}"></li>\n  </ul>\n</script>\n<ul>\n  <li ng-repeat="node in $ctrl.tree" ng-include="\'type-pill.html\'" ng-class="{selected:node.selected}"></li>\n</ul>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/construct-view/explore-table-component/explore-table-component.html",'\n<uib-tabset>\n  <uib-tab ng-repeat="t in $ctrl.tableTypes" index="$index" heading="{{$ctrl.fibraService.getState().construct.displayTypes[$index] ? $ctrl.fibraService.getState().construct.displayTypes[$index].label : t }}">\n    <div class="widthcontainer"><a ng-click="$ctrl.downloadcsv()">Download</a>\n      <table class="exploretable table table-striped" style="table-layout: fixed;">\n        <tr>\n          <th>Label</th>\n          <th ng-repeat="p in $ctrl[t].properties" ng-click="$ctrl.removeFromProperties(p)">{{ p }}</th>\n          <th>Actions</th>\n        </tr>\n        <tr ng-repeat="item in $ctrl[t].items">\n          <td ng-click="$ctrl.selectItem(item)">{{ item.label.value }}</td>\n          <td ng-repeat="p in $ctrl[t].properties" ng-if="item === $ctrl.editItem">\n            <input type="text" ng-repeat="e in $ctrl.editItem.localProperties" ng-if="e.label.value == p &amp;&amp; e.values[0].termType === \'Literal\'" ng-model="e.values[0].value"/><small ng-repeat="e in item.localProperties" ng-if="e.label.value == p &amp;&amp; e.values[0].termType !== \'Literal\'">{{e.values[0].label.value}}</small>\n          </td>\n          <td ng-repeat="p in $ctrl[t].properties" ng-click="$ctrl.selectItem(item)" ng-if="item !== $ctrl.editItem"><small ng-repeat="e in item.localProperties" ng-if="e.label.value == p">\n              <p ng-repeat="i in e.values">{{i.label.value}}</p></small></td>\n          <td><a ng-click="$ctrl.hide(item)">Hide</a><a ng-click="$ctrl.verify(item)" ng-if="!$ctrl.itemVerified(item)">&nbsp;Verify</a><a ng-click="$ctrl.delete(item)">&nbsp;Delete</a><a ng-click="$ctrl.saveItem($ctrl.editItem)" ng-if="item === $ctrl.editItem">&nbsp;Save</a></td>\n        </tr>\n      </table>\n      <div>Hidden Properties (click to show)\n        <p ng-repeat="x in $ctrl.removedProperties" ng-click="$ctrl.addFromRemovedProperties(x)">{{ x }}</p>\n      </div>\n    </div>\n  </uib-tab>\n</uib-tabset>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/construct-view/explore-type-component/explore-type-component.html",'\n<div class="btn-group" uib-dropdown="uib-dropdown">\n  <button class="btn btn-primary btn-xs" id="single-button" type="button" uib-dropdown-toggle="uib-dropdown-toggle" ng-disabled="disabled">{{ $ctrl.displayTypes()[0] ? $ctrl.displayTypes()[0].label : "Primary Nodes" }}&nbsp;<span class="caret"></span></button>\n  <ul class="dropdown-menu" uib-dropdown-menu="uib-dropdown-menu" role="menu" aria-labelledby="single-button">\n    <li role="menuitem" ng-repeat="type in $ctrl.types()"><a ng-click="$ctrl.primaryClick(type)">{{type.label}} ({{type.instances}})</a></li>\n  </ul>\n</div>\n<div class="btn-group" uib-dropdown="uib-dropdown">\n  <button class="btn btn-primary btn-xs" id="single-button" type="button" uib-dropdown-toggle="uib-dropdown-toggle" ng-disabled="!$ctrl.displayTypes()[0] || $ctrl.types().length &lt; 2">{{ $ctrl.displayTypes()[1] ? $ctrl.displayTypes()[1].label : "Secondary Nodes" }}&nbsp;<span class="caret"></span></button>\n  <ul class="dropdown-menu" uib-dropdown-menu="uib-dropdown-menu" role="menu" aria-labelledby="single-button">\n    <li role="menuitem" ng-repeat="type in $ctrl.types()"><a ng-click="$ctrl.secondaryClick(type)">{{type.label}} ({{type.instances}})</a></li>\n  </ul>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/construct-view/explore-verify-component/explore-verify-component.html",'\n<div class="verify-container">\n  <div class="verify-header">Verify\n    <div class="verify-cancel pull-left" ng-click="$ctrl.clear()">X</div><span class="glyphicon glyphicon-refresh fa-spin form-control-feedback" ng-show="$ctrl.queryRunning"></span>\n  </div>\n  <div class="verify-input">\n    <input type="text" placeholder="search term" ng-model="$ctrl.queryString"/>\n    <button class="btn btn-sm btn-primary" ng-click="$ctrl.runQuery()">Search</button>\n  </div>\n  <div class="verify-content">\n    <ul class="verify-result-group" ng-repeat="grp in $ctrl.matchingResults">\n      <div class="verify-result-group-header">{{grp.label}}</div>\n      <div class="verify-result" ng-repeat="rslt in grp.results" ng-click="$ctrl.verify(rslt)">\n        <button class="btn btn-sm" ng-click="$ctrl.verify(rslt)">Verify</button><span>{{ rslt.prefLabel.value }}</span><span>{{ $ctrl.sourcesFromResult(rslt) }}</span>\n      </div>\n    </ul>\n  </div>\n</div>')}])}(),function(e){try{e=angular.module("fibra")}catch(t){e=angular.module("fibra",[])}e.run(["$templateCache",function(e){e.put("components/construct-view/palette-component/palette-component.html",'\n<div class="inner-palette-container">\n  <div class="palette"></div>\n  <svg class="palette-node-drag"></svg>\n  <input class="palette-filter" type="text" placeholder="filter by label" ng-model="$ctrl.labelFilter" ng-change="$ctrl.update()"/><span ng-click="$ctrl.createItem($ctrl.labelFilter)"><span class="glyphicon glyphicon-plus inverse-icon"></span></span>\n  <input type="file" id="dataModelSelector" style="display:none;" onchange="angular.element(this).scope().loadCSV(this)"/>\n</div>')}])}();