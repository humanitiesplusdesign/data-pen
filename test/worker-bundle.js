webpackJsonp([1],{0:function(e,r){e.exports=angular},553:function(e,r,n){"use strict";var t=n(0),i=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r.default=e,r}(t),o=n(554),a=n(556),u=n(199),c=n(29),s=n(557),l=n(69);n(71),n(68),n(150),n(200);var d=i.module("fibra",["fi.seco.sparql","http-auth-interceptor","fibra.services.serialization-service","fibra.services.sparql-statistics-service"]);d.config(["$provide",function(e){e.service("fibraSparqlService",u.FibraSparqlService),e.service("projectWorkerService",a.ProjectWorkerService),e.service("stateWorkerService",o.StateWorkerService),e.service("workerWorkerService",o.WorkerWorkerService),e.service("sparqlItemWorkerService",c.SparqlItemWorkerService),e.service("sparqlUpdateWorkerService",s.SparqlUpdateWorkerService),e.service("sparqlAutocompleteWorkerService",l.SparqlAutocompleteWorkerService)}]),d.run(["$rootScope","workerWorkerService",function(e,r){e.$on("event:auth-loginRequired",function(e){return r.$broadcast("event:auth-loginRequired",e)})}]);var f={};d.config(["$httpProvider",function(e){e.interceptors.push(function(){return{request:function(e){return f[e.url]&&(e.headers.Authorization=f[e.url]),e}}})}]),d.run(["$rootScope","authService","$http",function(e,r,n){e.$on("main:auth-loginAuthInfo",function(e,n){f=n,r.loginConfirmed()})}])},554:function(e,r,n){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0}),r.StateWorkerService=r.WorkerWorkerService=void 0;var i=n(1),o=t(i),a=n(2),u=t(a),c=n(0),s=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r.default=e,r}(c);n(555);var l=n(68),d=r.WorkerWorkerService=function(){function e(r,n,t,i){(0,o.default)(this,e),this.serializationService=r,this.$injector=n,this.$q=t,this.$rootScope=i,this.cancellers=[]}return e.$inject=["serializationService","$injector","$q","$rootScope"],(0,u.default)(e,[{key:"$broadcast",value:function(e,r){try{self.postMessage({event:"broadcast",name:e,args:r})}catch(e){throw console.log(r,e),e}}},{key:"onMessage",value:function(e){var r=this;if(void 0===e.id)this.$rootScope.$broadcast(e.name,this.serializationService.restorePrototypes(e.args)),this.$rootScope.$apply();else if(e.cancel){var n=this.cancellers[e.id];delete this.cancellers[e.id],n&&n.resolve()}else{var t=this.$injector.get(e.service),i=this.$q.defer();this.cancellers[e.id]=i;var o=t[e.method].apply(t,this.serializationService.restorePrototypes(e.args).concat(i.promise));if(!o||!o.then){var a=this.$q.defer();a.resolve(o),o=a.promise}o.then(function(n){delete r.cancellers[e.id],self.postMessage({event:"success",id:e.id,data:n})},function(n){if(delete r.cancellers[e.id],n instanceof Error)throw self.postMessage({event:"failure",id:e.id,data:{name:n.name,message:n.message,stack:n.stack}}),n;self.postMessage({event:"failure",id:e.id,data:l.SerializationService.stripFunctions(n)})},function(r){return self.postMessage({event:"update",id:e.id,data:r})})}}}]),e}(),f=r.StateWorkerService=function(){function e(){(0,o.default)(this,e)}return(0,u.default)(e,[{key:"setState",value:function(e){this.state=e}}]),e}();s.module("fibra.services.worker-service",["fibra.services.serialization-service"]).config(["$provide",function(e){e.service("stateWorkerService",f),e.service("workerWorkerService",d)}])},555:function(e,r,n){"use strict";var t=n(91),i=n(70),o=n(92),a=n(93),u=n(26),c=n(7),s=n(27),l=n(21),d=n(29),f=n(89),p=n(0),v=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r.default=e,r}(p),h=n(55);v.module("fibra.services.worker-service-prototype-mapping-configuration",[]).config(["$provide",function(e){e.service("workerServicePrototypeMappingConfiguration",function(){var e={Project:t.Project,CNode:c.CNode,NamedNode:c.NamedNode,Citable:s.Citable,FMap:l.FMap,Class:u.Class,Property:u.Property,PrimaryEndpointConfiguration:i.PrimaryEndpointConfiguration,RemoteEndpointConfiguration:o.RemoteEndpointConfiguration,CitableSource:s.CitableSource,ProjectSourceInfo:h.ProjectSourceInfo,Schema:a.Schema,ONodeSet:c.ONodeSet,StringSet:l.StringSet,NodeMap:c.NodeMap,DataModel:u.DataModel,PropertyAndValue:d.PropertyAndValue,Item:d.Item,PropertyToValues:d.PropertyToValues,FullRichNodeFromNode:f.FullRichNodeFromNode};for(var r in e)e[r].__name=r;e.Object=Object;var n={};for(var p in e)n[p]=e[p].prototype;return n})}])},556:function(e,r,n){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0}),r.ProjectWorkerService=void 0;var i=n(1),o=t(i),a=n(2),u=t(a),c=n(0),s=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r.default=e,r}(c),l=n(27),d=n(91),f=n(35),p=n(70),v=n(92),h=n(93),g=n(21),y=n(7),S=n(26),m=r.ProjectWorkerService=function(){function e(r,n,t){(0,o.default)(this,e),this.fibraSparqlService=r,this.serializationService=n,this.$q=t}return e.$inject=["fibraSparqlService","serializationService","$q"],(0,u.default)(e,[{key:"loadPrimaryEndpointConfiguration",value:function(e,r){return this.runSingleQuery(e,p.PrimaryEndpointConfiguration.listPrimaryEndpointConfigurationsQuery,r,new p.PrimaryEndpointConfiguration(r,e))}},{key:"listPrimaryEndpointConfigurations",value:function(e){return this.runListQuery(e,p.PrimaryEndpointConfiguration.listPrimaryEndpointConfigurationsQuery,function(r){return new p.PrimaryEndpointConfiguration(r,e)})}},{key:"loadRemoteEndpointConfiguration",value:function(e,r){return this.runSingleQuery(e,v.RemoteEndpointConfiguration.listRemoteEndpointConfigurationsQuery,r,new v.RemoteEndpointConfiguration(r,e))}},{key:"listArchiveEndpointConfigurations",value:function(e){return this.runListQuery(e,v.RemoteEndpointConfiguration.listRemoteEndpointConfigurationsQuery.replace(/# TYPELIMIT/g,"?id a fibra:ArchiveEndpointConfiguration"),function(r){return new v.RemoteEndpointConfiguration(r,e)})}},{key:"listAuthorityEndpointConfigurations",value:function(e){return this.runListQuery(e,v.RemoteEndpointConfiguration.listRemoteEndpointConfigurationsQuery.replace(/# TYPELIMIT/g,"?id a fibra:AuthorityEndpointConfiguration"),function(r){return new v.RemoteEndpointConfiguration(r,e)})}},{key:"listProjects",value:function(e){return this.runListQuery(e,d.Project.listProjectsQuery,function(r){return new d.Project(r,e)})}},{key:"listSchemas",value:function(e){return this.runListQuery(e,h.Schema.listSchemasQuery,function(r){return new h.Schema(r,e)})}},{key:"loadSchema",value:function(e,r){return this.runSingleQuery(e,h.Schema.listSchemasQuery,r,new h.Schema(r,e))}},{key:"loadDataModel",value:function(e,r){var n=this,t=new S.DataModel,i=new g.EMap(function(e){var r=new S.Class(y.DataFactory.namedNode(e));return t.classMap.set(e,r),r}),o=new g.EMap(function(e){var r=new S.Property(y.DataFactory.namedNode(e));return t.propertyMap.set(e,r),r}),a={bindingConverters:{superClasses:function(e){return i.goc(e.value)},subClasses:function(e){return i.goc(e.value)},types:function(e){return i.goc(e.value)},labels:function(e){return y.DataFactory.nodeFromBinding(e)},descriptions:function(e){return y.DataFactory.nodeFromBinding(e)}},bindingHandlers:{types:function(e,r,n){return e[r].add(n)},labels:function(e,r,n){return e[r].add(n)},descriptions:function(e,r,n){return e[r].add(n)},superClasses:function(e,r,n){return e[r].add(n)},subClasses:function(e,r,n){return e[r].add(n)}}},u={bindingConverters:{superProperties:function(e){return o.goc(e.value)},subProperties:function(e){return o.goc(e.value)},inverseProperty:function(e){return o.goc(e.value)},types:function(e){return i.goc(e.value)},domains:function(e){return i.goc(e.value)},ranges:function(e){return i.goc(e.value)},labels:function(e){return y.DataFactory.nodeFromBinding(e)},descriptions:function(e){return y.DataFactory.nodeFromBinding(e)}},bindingHandlers:{superProperties:function(e,r,n){return e[r].add(n)},subProperties:function(e,r,n){return e[r].add(n)},types:function(e,r,n){return e[r].add(n)},domains:function(e,r,n){return e[r].add(n)},ranges:function(e,r,n){return e[r].add(n)},labels:function(e,r,n){return e[r].add(n)},descriptions:function(e,r,n){return e[r].add(n)}}},c=[];return e.forEach(function(e){r.forEach(function(e){e.schemaEndpoint&&e.classQuery&&(c.push(n.fibraSparqlService.query(e.schemaEndpoint,e.classQuery).then(function(e){var r=new f.UniqueObjectTracker;e.results.bindings.forEach(function(e){return f.SparqlService.bindingsToObject(e,i.goc(e.id.value),a,e.id.value,r)})})),c.push(n.fibraSparqlService.query(e.schemaEndpoint,e.propertyQuery).then(function(e){var r=new f.UniqueObjectTracker;e.results.bindings.forEach(function(e){return f.SparqlService.bindingsToObject(e,o.goc(e.id.value),u,e.id.value,r)})})))}),c.push(n.fibraSparqlService.query(e.endpoint,e.classQuery).then(function(e){var r=new f.UniqueObjectTracker;e.results.bindings.forEach(function(e){return f.SparqlService.bindingsToObject(e,i.goc(e.id.value),a,e.id.value,r)})})),c.push(n.fibraSparqlService.query(e.endpoint,e.propertyQuery).then(function(e){var r=new f.UniqueObjectTracker;e.results.bindings.forEach(function(e){return f.SparqlService.bindingsToObject(e,o.goc(e.id.value),u,e.id.value,r)})}))}),this.$q.all(c).then(function(){return i.values().forEach(function(e){e.superClasses.values().filter(function(r){return!r.subClasses.find(function(r){return r===e})}).forEach(function(r){return r.subClasses.add(e)}),e.subClasses.values().filter(function(r){return!r.superClasses.find(function(r){return r===e})}).forEach(function(r){return r.superClasses.add(e)})}),i.values().forEach(function(e){e.superClasses.empty()&&t.rootClasses.push(e)}),o.values().forEach(function(e){e.inverseProperty&&(e.inverseProperty.inverseProperty=e),e.superProperties.values().filter(function(r){return!r.subProperties.find(function(r){return r===e})}).forEach(function(r){return r.subProperties.add(e)}),e.subProperties.values().filter(function(r){return!r.superProperties.find(function(r){return r===e})}).forEach(function(r){return r.superProperties.add(e)}),e.domains.each(function(r){return r.properties.add(e)}),e.ranges.each(function(r){return r.inverseProperties.add(e)})}),o.values().forEach(function(e){e.superProperties.empty()&&t.rootProperties.push(e)}),t})}},{key:"loadProject",value:function(e,r,n){var t=this,i=this.runSingleQuery(e,d.Project.listProjectsQuery,r,new d.Project(r,e));return n?i.then(function(e){var r=[];return r.push(t.$q.all(e.schemas.map(function(e){return t.loadSchema(e.source,e.id)})).then(function(r){return e.schemas=r})),r.push(t.$q.all(e.archiveEndpoints.map(function(e){return t.loadRemoteEndpointConfiguration(e.source,e.id)})).then(function(r){return e.archiveEndpoints=r})),r.push(t.$q.all(e.authorityEndpoints.map(function(e){return t.loadRemoteEndpointConfiguration(e.source,e.id)})).then(function(r){return e.authorityEndpoints=r})),t.$q.all(r).then(function(){return t.loadDataModel(e.schemas,e.archiveEndpoints.concat(e.authorityEndpoints)).then(function(r){return e.dataModel=r}).then(function(){return e})})}):i}},{key:"runSingleQuery",value:function(e,r,n,t){return this.runQuery(e,r,n,function(){return t}).then(function(e){return e[0]})}},{key:"runListQuery",value:function(e,r,n){return this.runQuery(e,r,null,n)}},{key:"runQuery",value:function(r,n,t,i){var o=this;return n=r.graph?n.replace(/# STARTGRAPH/g,"GRAPH <"+r.graph+"> {").replace(/# ENDGRAPH/g,"}"):n.replace(/.*# STARTGRAPH\n/g,"").replace(/.*# ENDGRAPH\n/g,""),t&&(n=n.replace(/# VALUE/g,"VALUES ?id { <"+t+"> }").replace(/<ID>/g,"<"+t+">")),this.fibraSparqlService.query(r.sparqlEndpoint,n).then(function(n){var t=new g.EMap(i),a={bindingTypes:{rightsHolders:"uniqueArray",sourceClassSettings:"single",layouts:"single",schemas:"uniqueArray",authorityEndpoints:"uniqueArray",archiveEndpoints:"uniqueArray"},bindingConverters:{dateCreated:function(e){return new Date(e.value)},types:function(e){return y.DataFactory.nodeFromBinding(e)},labels:function(e){return y.DataFactory.nodeFromBinding(e)},descriptions:function(e){return y.DataFactory.nodeFromBinding(e)},schemas:function(e){return new h.Schema(e.value,r)},authorityEndpoints:function(e){return new v.RemoteEndpointConfiguration(e.value,r)},archiveEndpoints:function(e){return new v.RemoteEndpointConfiguration(e.value,r)},rightsHolders_labels:function(e){return y.DataFactory.nodeFromBinding(e)},rightsHolders_descriptions:function(e){return y.DataFactory.nodeFromBinding(e)},rightsHolders:function(e){return new l.Citable(e.value,r)},compatibleSchemas:function(e){return y.DataFactory.nodeFromBinding(e)},sourceClassSettings:function(e){return o.serializationService.fromJson(e.value)},layouts:function(e){return o.serializationService.fromJson(e.value)}},bindingHandlers:{types:function(e,r,n){return e[r].add(n)},labels:function(e,r,n){return e[r].add(n)},descriptions:function(e,r,n){return e[r].add(n)}}},u=new f.UniqueObjectTracker;return n.results.bindings.forEach(function(e){return f.SparqlService.bindingsToObject(e,t.goc(e.id.value),a,e.id.value,u)}),t.values().forEach(function(r){return e.orderCitables(r.rightsHolders)}),t.values()})}}],[{key:"orderCitables",value:function(e){e.sort(function(e,r){return(e.order?e.order:Number.MAX_VALUE)-(r.order?r.order:Number.MAX_VALUE)}),e.forEach(function(e){return delete e.order})}}]),e}();s.module("fibra.services.project-service",["fibra.services.fibra-sparql-service"]).config(["$provide",function(e){e.service("projectWorkerService",m)}])},557:function(e,r,n){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0}),r.SparqlUpdateWorkerService=r.SparqlUpdateService=void 0;var i=n(1),o=t(i),a=n(2),u=t(a),c=n(7);r.SparqlUpdateService=function(){function e(r){(0,o.default)(this,e),this.workerService=r}return e.$inject=["workerService"],(0,u.default)(e,[{key:"updateQuads",value:function(e,r,n){return this.workerService.call("sparqlUpdateWorkerService","updateQuads",[e,r,n])}},{key:"updateGraphs",value:function(e,r,n){return this.workerService.call("sparqlUpdateWorkerService","updateGraphs",[e,r,n])}}]),e}();(r.SparqlUpdateWorkerService=function(){function e(r){(0,o.default)(this,e),this.fibraSparqlService=r}return e.$inject=["fibraSparqlService"],(0,u.default)(e,[{key:"updateQuads",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],t={},i={},o=[],a=[];return r.forEach(function(e){var r=t[e.graph.value];r||(r=new c.Graph(e.graph),t[e.graph.value]=r,o.push(r)),r.triples.push(c.DataFactory.triple(e.subject,e.predicate,e.object))}),n.forEach(function(e){var r=i[e.graph.value];r||(r=new c.Graph(e.graph),i[e.graph.value]=r,a.push(r)),r.triples.push(c.DataFactory.triple(e.subject,e.predicate,e.object))}),this.updateGraphs(e,o,a)}},{key:"updateGraphs",value:function(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=n.map(function(e){return(c.DefaultGraph.instance.equals(e.graph)?"":"GRAPH"+e.graph.toCanonical())+"{"+e.triples.map(function(e){return e.toCanonical()}).join(" . ")+"}"}).join(""),o=t.map(function(e){return(c.DefaultGraph.instance.equals(e.graph)?"":"GRAPH"+e.graph.toCanonical())+"{"+e.triples.map(function(e){return e.toCanonical()}).join(" . ")+"}"}).join("");return this.fibraSparqlService.update(r,e.queryTemplate.replace(/<DELETE>/g,o).replace(/<INSERT>/g,i)).then(function(e){return!0},function(e){return!1})}}]),e}()).queryTemplate="DELETE{<DELETE>}INSERT{<INSERT>}WHERE {}"}},[553]);