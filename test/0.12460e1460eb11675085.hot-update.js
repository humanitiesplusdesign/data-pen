webpackHotUpdate(0,{

/***/ "./app/components/construct-view/palette-component/palette-component.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_d3__ = __webpack_require__(\"./app/bower_components/d3/d3.js\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_d3___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_d3__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__models_rdf__ = __webpack_require__(\"./app/models/rdf.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__actions_types__ = __webpack_require__(\"./app/actions/types.ts\");\n/* unused harmony export PaletteComponentController */\n/* unused harmony export PaletteComponent */\n\n\n\n\n\n\nvar PaletteComponentController = function () {\n    function PaletteComponentController(fibraService, $element, sparqlItemService, sparqlTreeService, $q, $ngRedux, FileSaver) {\n        this.fibraService = fibraService;\n        this.$element = $element;\n        this.sparqlItemService = sparqlItemService;\n        this.sparqlTreeService = sparqlTreeService;\n        this.$q = $q;\n        this.$ngRedux = $ngRedux;\n        this.FileSaver = FileSaver;\n        this.paletteSearchHeight = 40;\n        this.typeColorScale = __WEBPACK_IMPORTED_MODULE_0_d3__[\"scaleOrdinal\"](__WEBPACK_IMPORTED_MODULE_0_d3__[\"schemeCategory20c\"]);\n        this.labelFilter = '';\n        this.typeItemTree = __WEBPACK_IMPORTED_MODULE_0_d3__[\"map\"]();\n        this.unsubscribe = $ngRedux.connect(this.mapStateToThis, __WEBPACK_IMPORTED_MODULE_3__actions_types__)(this);\n        this.typeItemTree.set('', {\n            label: 'No type defined',\n            items: [],\n            expanded: false\n        });\n        this.query();\n    }\n    PaletteComponentController.prototype.$onDestroy = function () {\n        this.unsubscribe();\n    };\n    PaletteComponentController.prototype.query = function () {\n        var _this = this;\n        return this.typeItemTreePromise = this.sparqlItemService.getAllItems().then(function (items) {\n            return _this.mergeItems(_this.items, items);\n        });\n    };\n    PaletteComponentController.prototype.$postLink = function () {\n        var _this = this;\n        this.divSel = __WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"](this.$element[0]).select('div.palette');\n        this.nodeDrag = __WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"](this.$element[0]).select('.palette-node-drag');\n        this.nodeDrag.style('display', 'none');\n        this.nodeDrag.append('circle');\n        this.divSel.style('height', '100%').style('width', '100%');\n        this.tooltip = __WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"]('body').append('div').style('position', 'absolute').style('z-index', '20').style('background-color', 'gray').style('color', 'white').style('padding', '3px').style('border-radius', '2px').style('visibility', 'hidden');\n        var onChangeFunction = function () {\n            return _this.query().then(_this.build.bind(_this)).then(function () {\n                return 'Done';\n            });\n        };\n        this.fibraService.on('change', onChangeFunction);\n        this.typeItemTreePromise.then(function (itemTree) {\n            _this.build.bind(_this)(itemTree);\n        });\n    };\n    PaletteComponentController.prototype.addItem = function (item, coordinates) {\n        var _this = this;\n        var itemTypeKey = item.typeValue;\n        var itemType = this.types.types.filter(function (t) {\n            return t.id === itemTypeKey;\n        })[0];\n        var chosenTypes = this.types.displayTypes;\n        if (!chosenTypes[0] && itemType) {\n            this.setOrderedTypes([itemType]);\n        } else if (!chosenTypes[1] && itemType && chosenTypes[0] !== itemType) {\n            var newTypes = chosenTypes.concat([]);\n            newTypes.push(itemType);\n            this.setOrderedTypes(newTypes);\n        }\n        return this.fibraService.dispatchAction(this.displayItem(item, coordinates)).then(function (state) {\n            _this.fibraService.dispatch('change');\n            return state;\n        });\n    };\n    PaletteComponentController.prototype.createItemLocal = function (label) {\n        var _this = this;\n        var node = __WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"b\" /* DataFactory */].instance.namedNode(label);\n        this.fibraService.dispatchAction(this.createItem(node)).then(function () {\n            _this.query().then(function (items) {\n                _this.build.bind(_this)(items);\n            });\n        });\n    };\n    PaletteComponentController.prototype.downloadCSV = function (datum) {\n        var blob = new Blob([__WEBPACK_IMPORTED_MODULE_0_d3__[\"csvFormat\"](datum.value.items.map(function (d) {\n            var sameAs = d.localProperties.filter(function (p) {\n                return p.value === __WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"d\" /* OWL */].sameAs.value;\n            })[0];\n            var prefLabel = d.localProperties.filter(function (p) {\n                return p.value === __WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"a\" /* SKOS */].prefLabel.value;\n            })[0];\n            return _a = {}, _a[__WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"a\" /* SKOS */].prefLabel.value] = prefLabel ? prefLabel.values[0].value.value : '', _a.FibraId = d.value, _a.Match = sameAs ? sameAs.values[0].value.value : '', _a;\n            var _a;\n        }), [__WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"a\" /* SKOS */].prefLabel.value, 'FibraId', 'Match'])], { type: 'application/csv;charset=utf-8' });\n        var filename = datum.value.label + '.csv';\n        this.FileSaver.saveAs(blob, filename);\n    };\n    PaletteComponentController.prototype.build = function (itemTree) {\n        var _this = this;\n        this.updateSizing();\n        console.log(itemTree.entries());\n        var itemTreeFiltered = itemTree.entries().filter(function (d) {\n            return d.key !== '';\n        });\n        var items = itemTreeFiltered.reduce(function (a, b) {\n            return a.concat(b.value.items);\n        }, []);\n        var padding = items.length > 300 ? items.length > 2000 ? 1 : 2 : 4;\n        var paletteHeightLessTypes = this.paletteHeight - itemTreeFiltered.length * 25;\n        var rawRadius = (Math.sqrt(this.paletteWidth * paletteHeightLessTypes / items.length) - padding) / 2;\n        var radius = rawRadius > 8 ? 8 : rawRadius;\n        var xOffset = radius * 2 + padding / 2;\n        var yOffset = radius * 2 + padding / 2;\n        var xDots = Math.floor(this.paletteWidth / xOffset) - 1;\n        // Bring the node drag SVG and the addItem function local\n        var nodeDrag = this.nodeDrag;\n        var addItem = this.addItem.bind(this);\n        var paletteWidth = this.paletteWidth;\n        this.typesD3 = this.divSel.selectAll('div.type').data(itemTreeFiltered, function (d) {\n            return d.key;\n        });\n        this.typesD3.exit().remove();\n        var typesDivsEnter = this.typesD3.enter().append('div').classed('type', true).classed('inverse-icon', true).text(function (d) {\n            return d.value.label;\n        });\n        typesDivsEnter.append('span').classed('glyphicon', true).classed('glyphicon-download', true).on('click', function (d) {\n            return _this.downloadCSV(d);\n        });\n        typesDivsEnter.append('span').classed('glyphicon', true).classed('expand-button', true).on('click', function (d) {\n            d.value.expanded = !d.value.expanded;\n            _this.typeItemTreePromise.then(_this.build.bind(_this));\n        });\n        typesDivsEnter.append('svg').attr('width', '100%');\n        this.typesD3 = typesDivsEnter.merge(this.typesD3);\n        this.typesD3.selectAll('.expand-button').classed('glyphicon-resize-small', function (d) {\n            return d.value.expanded;\n        }).classed('glyphicon-resize-full', function (d) {\n            return !d.value.expanded;\n        });\n        this.typesD3.selectAll('svg').style('display', function (d) {\n            return d.value.expanded ? 'block' : 'none';\n        });\n        var typeSvgs = this.typesD3.select('svg').attr('height', function (d) {\n            return (Math.ceil(d.value.items.length / xDots) + 1) * yOffset;\n        });\n        this.circles = typeSvgs.selectAll('circle.item').data(function (d) {\n            return d.value.items;\n        }, function (d) {\n            return d.value;\n        });\n        this.circles.exit().remove();\n        this.circles = this.circles.enter().append('circle').classed('item', true).attr('r', radius).on('mouseover', function (d, i) {\n            _this.tooltip.style('top', __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].pageY - 10 + 'px').style('left', __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].pageX + 10 + 'px').style('visibility', 'visible').text(d.label + ' (' + d.typeLabel + ')');\n        }).on('mouseout', function (d, i) {\n            _this.tooltip.style('visibility', 'hidden');\n        }).call(__WEBPACK_IMPORTED_MODULE_0_d3__[\"drag\"]().on('start', function (d) {\n            var thisCircle = __WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"](this);\n            nodeDrag.style('display', 'block');\n            nodeDrag.select('circle').classed('item', thisCircle.classed('item')).attr('r', thisCircle.attr('r')).attr('fill', thisCircle.attr('fill')).attr('transform', 'translate(8,8)');\n            nodeDrag.style('left', __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientX - 8).style('top', __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientY - 8);\n        }).on('drag', function (d) {\n            nodeDrag.style('left', __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientX - 8).style('top', __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientY - 8);\n        }).on('end', function (d) {\n            // If the cursor is on the canvas, display\n            var exploreContainer = __WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"]('#explorecontainer').node();\n            if (__WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientX > exploreContainer.getBoundingClientRect().left && __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientX < exploreContainer.getBoundingClientRect().right && __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientY > exploreContainer.getBoundingClientRect().top && __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientY < exploreContainer.getBoundingClientRect().bottom) {\n                addItem(__WEBPACK_IMPORTED_MODULE_0_d3__[\"select\"](this).datum(), [__WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientX - exploreContainer.getBoundingClientRect().left, __WEBPACK_IMPORTED_MODULE_0_d3__[\"event\"].sourceEvent.clientY - exploreContainer.getBoundingClientRect().top]).then(function () {\n                    nodeDrag.style('display', 'none');\n                });\n            } else {\n                nodeDrag.style('display', 'none');\n            }\n        })).merge(this.circles).call(this.update.bind(this));\n        this.circles.transition().attr('fill', function (d) {\n            return _this.typeColorScale(d.typeValue);\n        }).attr('transform', function (d, i) {\n            return 'translate(' + (i % xDots + 1) * xOffset + ',' + (Math.floor(i / xDots) + 1) * yOffset + ')';\n        });\n    };\n    PaletteComponentController.prototype.update = function (circles) {\n        var _this = this;\n        var c = circles ? circles : this.circles;\n        c.classed('displayed', function (d) {\n            return _this.fibraService.getState().construct.itemIndex[d.value] ? true : false;\n        }).classed('filtered', function (d) {\n            return _this.labelFilter && !(d.label.toUpperCase().indexOf(_this.labelFilter.toUpperCase()) !== -1);\n        });\n    };\n    PaletteComponentController.prototype.mapTypesToThis = function (state) {\n        return {\n            types: state.types\n        };\n    };\n    PaletteComponentController.prototype.mapItemsToThis = function (state) {\n        return {\n            items: state.items\n        };\n    };\n    PaletteComponentController.prototype.updateSizing = function () {\n        this.paletteWidth = Math.round(window.innerWidth * 0.15); // this.svgSel.node().clientWidth\n        this.paletteHeight = Math.round(window.innerHeight) - this.paletteSearchHeight;\n        this.divSel.style('height', this.paletteHeight + 'px');\n    };\n    PaletteComponentController.prototype.mergeItems = function (oldItems, newItems) {\n        var _this = this;\n        // Wipe old items (bad, but temporary)\n        this.typeItemTree.values().forEach(function (v) {\n            v.items = [];\n        });\n        newItems.forEach(function (item) {\n            var typeProp = item.localProperties.filter(function (p) {\n                return p.value === __WEBPACK_IMPORTED_MODULE_1__models_rdf__[\"c\" /* RDF */].type.value;\n            })[0];\n            if (typeProp && typeProp.values[0]) {\n                item.typeValue = typeProp.values[0].value.value;\n                item.typeLabel = typeProp.values[0].value.label;\n                // Add type to the type map\n                if (!_this.typeItemTree.has(item.typeValue)) {\n                    _this.typeItemTree.set(item.typeValue, {\n                        label: item.typeLabel,\n                        items: [item],\n                        expanded: true\n                    });\n                } else {\n                    _this.typeItemTree.get(item.typeValue).items.push(item);\n                }\n            } else {\n                item.typeValue = '';\n                item.typeLabel = 'No type defined';\n            }\n        });\n        // Sort by label\n        this.typeItemTree.values().forEach(function (v) {\n            v.items.sort(function (a, b) {\n                return a.label === b.label ? 0 : a.label > b.label ? 1 : -1;\n            });\n        });\n        return this.typeItemTree;\n    };\n    return PaletteComponentController;\n}();\n\nvar PaletteComponent = function () {\n    function PaletteComponent() {\n        this.template = __webpack_require__(\"./app/components/construct-view/palette-component/palette-component.pug\")();\n        this.controller = PaletteComponentController;\n    }\n    return PaletteComponent;\n}();\n\n__WEBPACK_IMPORTED_MODULE_2_angular__[\"module\"]('fibra.components.palette', ['fibra.services']).component('palette', new PaletteComponent());//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9wYWxldHRlLWNvbXBvbmVudC9wYWxldHRlLWNvbXBvbmVudC50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9wYWxldHRlLWNvbXBvbmVudC9wYWxldHRlLWNvbXBvbmVudC50cz83M2FiIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmltcG9ydCAqIGFzIGQzIGZyb20gJ2QzJztcbmltcG9ydCB7IERhdGFGYWN0b3J5LCBTS09TLCBPV0wsIFJERiB9IGZyb20gJy4uLy4uLy4uL21vZGVscy9yZGYnO1xuaW1wb3J0ICogYXMgYW5ndWxhciBmcm9tICdhbmd1bGFyJztcbmltcG9ydCAqIGFzIFR5cGVBY3Rpb25zIGZyb20gJy4uLy4uLy4uL2FjdGlvbnMvdHlwZXMnO1xudmFyIFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBQYWxldHRlQ29tcG9uZW50Q29udHJvbGxlcihmaWJyYVNlcnZpY2UsICRlbGVtZW50LCBzcGFycWxJdGVtU2VydmljZSwgc3BhcnFsVHJlZVNlcnZpY2UsICRxLCAkbmdSZWR1eCwgRmlsZVNhdmVyKSB7XG4gICAgICAgIHRoaXMuZmlicmFTZXJ2aWNlID0gZmlicmFTZXJ2aWNlO1xuICAgICAgICB0aGlzLiRlbGVtZW50ID0gJGVsZW1lbnQ7XG4gICAgICAgIHRoaXMuc3BhcnFsSXRlbVNlcnZpY2UgPSBzcGFycWxJdGVtU2VydmljZTtcbiAgICAgICAgdGhpcy5zcGFycWxUcmVlU2VydmljZSA9IHNwYXJxbFRyZWVTZXJ2aWNlO1xuICAgICAgICB0aGlzLiRxID0gJHE7XG4gICAgICAgIHRoaXMuJG5nUmVkdXggPSAkbmdSZWR1eDtcbiAgICAgICAgdGhpcy5GaWxlU2F2ZXIgPSBGaWxlU2F2ZXI7XG4gICAgICAgIHRoaXMucGFsZXR0ZVNlYXJjaEhlaWdodCA9IDQwO1xuICAgICAgICB0aGlzLnR5cGVDb2xvclNjYWxlID0gZDMuc2NhbGVPcmRpbmFsKGQzLnNjaGVtZUNhdGVnb3J5MjBjKTtcbiAgICAgICAgdGhpcy5sYWJlbEZpbHRlciA9ICcnO1xuICAgICAgICB0aGlzLnR5cGVJdGVtVHJlZSA9IGQzLm1hcCgpO1xuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlID0gJG5nUmVkdXguY29ubmVjdCh0aGlzLm1hcFN0YXRlVG9UaGlzLCBUeXBlQWN0aW9ucykodGhpcyk7XG4gICAgICAgIHRoaXMudHlwZUl0ZW1UcmVlLnNldCgnJywge1xuICAgICAgICAgICAgbGFiZWw6ICdObyB0eXBlIGRlZmluZWQnLFxuICAgICAgICAgICAgaXRlbXM6IFtdLFxuICAgICAgICAgICAgZXhwYW5kZWQ6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnF1ZXJ5KCk7XG4gICAgfVxuICAgIFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS4kb25EZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlKCk7XG4gICAgfTtcbiAgICBQYWxldHRlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUucXVlcnkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHJldHVybiB0aGlzLnR5cGVJdGVtVHJlZVByb21pc2UgPSB0aGlzLnNwYXJxbEl0ZW1TZXJ2aWNlLmdldEFsbEl0ZW1zKCkudGhlbihmdW5jdGlvbiAoaXRlbXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5tZXJnZUl0ZW1zKF90aGlzLml0ZW1zLCBpdGVtcyk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgUGFsZXR0ZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLiRwb3N0TGluayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5kaXZTZWwgPSBkMy5zZWxlY3QodGhpcy4kZWxlbWVudFswXSkuc2VsZWN0KCdkaXYucGFsZXR0ZScpO1xuICAgICAgICB0aGlzLm5vZGVEcmFnID0gZDMuc2VsZWN0KHRoaXMuJGVsZW1lbnRbMF0pLnNlbGVjdCgnLnBhbGV0dGUtbm9kZS1kcmFnJyk7XG4gICAgICAgIHRoaXMubm9kZURyYWcuc3R5bGUoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgICB0aGlzLm5vZGVEcmFnLmFwcGVuZCgnY2lyY2xlJyk7XG4gICAgICAgIHRoaXMuZGl2U2VsXG4gICAgICAgICAgICAuc3R5bGUoJ2hlaWdodCcsICcxMDAlJylcbiAgICAgICAgICAgIC5zdHlsZSgnd2lkdGgnLCAnMTAwJScpO1xuICAgICAgICB0aGlzLnRvb2x0aXAgPSBkMy5zZWxlY3QoJ2JvZHknKS5hcHBlbmQoJ2RpdicpXG4gICAgICAgICAgICAuc3R5bGUoJ3Bvc2l0aW9uJywgJ2Fic29sdXRlJylcbiAgICAgICAgICAgIC5zdHlsZSgnei1pbmRleCcsICcyMCcpXG4gICAgICAgICAgICAuc3R5bGUoJ2JhY2tncm91bmQtY29sb3InLCAnZ3JheScpXG4gICAgICAgICAgICAuc3R5bGUoJ2NvbG9yJywgJ3doaXRlJylcbiAgICAgICAgICAgIC5zdHlsZSgncGFkZGluZycsICczcHgnKVxuICAgICAgICAgICAgLnN0eWxlKCdib3JkZXItcmFkaXVzJywgJzJweCcpXG4gICAgICAgICAgICAuc3R5bGUoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgICAgIHZhciBvbkNoYW5nZUZ1bmN0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzLnF1ZXJ5KCkudGhlbihfdGhpcy5idWlsZC5iaW5kKF90aGlzKSkudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiAnRG9uZSc7IH0pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmZpYnJhU2VydmljZS5vbignY2hhbmdlJywgb25DaGFuZ2VGdW5jdGlvbik7XG4gICAgICAgIHRoaXMudHlwZUl0ZW1UcmVlUHJvbWlzZS50aGVuKGZ1bmN0aW9uIChpdGVtVHJlZSkge1xuICAgICAgICAgICAgX3RoaXMuYnVpbGQuYmluZChfdGhpcykoaXRlbVRyZWUpO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5hZGRJdGVtID0gZnVuY3Rpb24gKGl0ZW0sIGNvb3JkaW5hdGVzKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBpdGVtVHlwZUtleSA9IGl0ZW0udHlwZVZhbHVlO1xuICAgICAgICB2YXIgaXRlbVR5cGUgPSB0aGlzLnR5cGVzLnR5cGVzLmZpbHRlcihmdW5jdGlvbiAodCkgeyByZXR1cm4gdC5pZCA9PT0gaXRlbVR5cGVLZXk7IH0pWzBdO1xuICAgICAgICB2YXIgY2hvc2VuVHlwZXMgPSB0aGlzLnR5cGVzLmRpc3BsYXlUeXBlcztcbiAgICAgICAgaWYgKCFjaG9zZW5UeXBlc1swXSAmJiBpdGVtVHlwZSkge1xuICAgICAgICAgICAgdGhpcy5zZXRPcmRlcmVkVHlwZXMoW2l0ZW1UeXBlXSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIWNob3NlblR5cGVzWzFdICYmIGl0ZW1UeXBlICYmIChjaG9zZW5UeXBlc1swXSAhPT0gaXRlbVR5cGUpKSB7XG4gICAgICAgICAgICB2YXIgbmV3VHlwZXMgPSBjaG9zZW5UeXBlcy5jb25jYXQoW10pO1xuICAgICAgICAgICAgbmV3VHlwZXMucHVzaChpdGVtVHlwZSk7XG4gICAgICAgICAgICB0aGlzLnNldE9yZGVyZWRUeXBlcyhuZXdUeXBlcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuZmlicmFTZXJ2aWNlLmRpc3BhdGNoQWN0aW9uKHRoaXMuZGlzcGxheUl0ZW0oaXRlbSwgY29vcmRpbmF0ZXMpKS50aGVuKGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICAgICAgX3RoaXMuZmlicmFTZXJ2aWNlLmRpc3BhdGNoKCdjaGFuZ2UnKTtcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBQYWxldHRlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuY3JlYXRlSXRlbUxvY2FsID0gZnVuY3Rpb24gKGxhYmVsKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBub2RlID0gRGF0YUZhY3RvcnkuaW5zdGFuY2UubmFtZWROb2RlKGxhYmVsKTtcbiAgICAgICAgdGhpcy5maWJyYVNlcnZpY2UuZGlzcGF0Y2hBY3Rpb24odGhpcy5jcmVhdGVJdGVtKG5vZGUpKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF90aGlzLnF1ZXJ5KCkudGhlbihmdW5jdGlvbiAoaXRlbXMpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5idWlsZC5iaW5kKF90aGlzKShpdGVtcyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBQYWxldHRlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUuZG93bmxvYWRDU1YgPSBmdW5jdGlvbiAoZGF0dW0pIHtcbiAgICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbZDMuY3N2Rm9ybWF0KGRhdHVtLnZhbHVlLml0ZW1zLm1hcChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgIHZhciBzYW1lQXMgPSBkLmxvY2FsUHJvcGVydGllcy5maWx0ZXIoZnVuY3Rpb24gKHApIHsgcmV0dXJuIHAudmFsdWUgPT09IE9XTC5zYW1lQXMudmFsdWU7IH0pWzBdO1xuICAgICAgICAgICAgICAgIHZhciBwcmVmTGFiZWwgPSBkLmxvY2FsUHJvcGVydGllcy5maWx0ZXIoZnVuY3Rpb24gKHApIHsgcmV0dXJuIHAudmFsdWUgPT09IFNLT1MucHJlZkxhYmVsLnZhbHVlOyB9KVswXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gX2EgPSB7fSxcbiAgICAgICAgICAgICAgICAgICAgX2FbU0tPUy5wcmVmTGFiZWwudmFsdWVdID0gcHJlZkxhYmVsID8gcHJlZkxhYmVsLnZhbHVlc1swXS52YWx1ZS52YWx1ZSA6ICcnLFxuICAgICAgICAgICAgICAgICAgICBfYS5GaWJyYUlkID0gZC52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgX2EuTWF0Y2ggPSBzYW1lQXMgPyBzYW1lQXMudmFsdWVzWzBdLnZhbHVlLnZhbHVlIDogJycsXG4gICAgICAgICAgICAgICAgICAgIF9hO1xuICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIH0pLCBbU0tPUy5wcmVmTGFiZWwudmFsdWUsICdGaWJyYUlkJywgJ01hdGNoJ10pXSwgeyB0eXBlOiAnYXBwbGljYXRpb24vY3N2O2NoYXJzZXQ9dXRmLTgnIH0pO1xuICAgICAgICB2YXIgZmlsZW5hbWUgPSBkYXR1bS52YWx1ZS5sYWJlbCArICcuY3N2JztcbiAgICAgICAgdGhpcy5GaWxlU2F2ZXIuc2F2ZUFzKGJsb2IsIGZpbGVuYW1lKTtcbiAgICB9O1xuICAgIFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS5idWlsZCA9IGZ1bmN0aW9uIChpdGVtVHJlZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLnVwZGF0ZVNpemluZygpO1xuICAgICAgICBjb25zb2xlLmxvZyhpdGVtVHJlZS5lbnRyaWVzKCkpO1xuICAgICAgICB2YXIgaXRlbVRyZWVGaWx0ZXJlZCA9IGl0ZW1UcmVlLmVudHJpZXMoKS5maWx0ZXIoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQua2V5ICE9PSAnJzsgfSk7XG4gICAgICAgIHZhciBpdGVtcyA9IGl0ZW1UcmVlRmlsdGVyZWQucmVkdWNlKGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICByZXR1cm4gYS5jb25jYXQoYi52YWx1ZS5pdGVtcyk7XG4gICAgICAgIH0sIFtdKTtcbiAgICAgICAgdmFyIHBhZGRpbmcgPSBpdGVtcy5sZW5ndGggPiAzMDAgPyBpdGVtcy5sZW5ndGggPiAyMDAwID8gMSA6IDIgOiA0O1xuICAgICAgICB2YXIgcGFsZXR0ZUhlaWdodExlc3NUeXBlcyA9IHRoaXMucGFsZXR0ZUhlaWdodCAtIChpdGVtVHJlZUZpbHRlcmVkLmxlbmd0aCAqIDI1KTtcbiAgICAgICAgdmFyIHJhd1JhZGl1cyA9IChNYXRoLnNxcnQodGhpcy5wYWxldHRlV2lkdGggKiBwYWxldHRlSGVpZ2h0TGVzc1R5cGVzIC8gaXRlbXMubGVuZ3RoKSAtIHBhZGRpbmcpIC8gMjtcbiAgICAgICAgdmFyIHJhZGl1cyA9IHJhd1JhZGl1cyA+IDggPyA4IDogcmF3UmFkaXVzO1xuICAgICAgICB2YXIgeE9mZnNldCA9IHJhZGl1cyAqIDIgKyBwYWRkaW5nIC8gMjtcbiAgICAgICAgdmFyIHlPZmZzZXQgPSByYWRpdXMgKiAyICsgcGFkZGluZyAvIDI7XG4gICAgICAgIHZhciB4RG90cyA9IE1hdGguZmxvb3IoKHRoaXMucGFsZXR0ZVdpZHRoKSAvIHhPZmZzZXQpIC0gMTtcbiAgICAgICAgLy8gQnJpbmcgdGhlIG5vZGUgZHJhZyBTVkcgYW5kIHRoZSBhZGRJdGVtIGZ1bmN0aW9uIGxvY2FsXG4gICAgICAgIHZhciBub2RlRHJhZyA9IHRoaXMubm9kZURyYWc7XG4gICAgICAgIHZhciBhZGRJdGVtID0gdGhpcy5hZGRJdGVtLmJpbmQodGhpcyk7XG4gICAgICAgIHZhciBwYWxldHRlV2lkdGggPSB0aGlzLnBhbGV0dGVXaWR0aDtcbiAgICAgICAgdGhpcy50eXBlc0QzID0gdGhpcy5kaXZTZWxcbiAgICAgICAgICAgIC5zZWxlY3RBbGwoJ2Rpdi50eXBlJylcbiAgICAgICAgICAgIC5kYXRhKGl0ZW1UcmVlRmlsdGVyZWQsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmtleTsgfSk7XG4gICAgICAgIHRoaXMudHlwZXNEMy5leGl0KCkucmVtb3ZlKCk7XG4gICAgICAgIHZhciB0eXBlc0RpdnNFbnRlciA9IHRoaXMudHlwZXNEMy5lbnRlcigpXG4gICAgICAgICAgICAuYXBwZW5kKCdkaXYnKVxuICAgICAgICAgICAgLmNsYXNzZWQoJ3R5cGUnLCB0cnVlKVxuICAgICAgICAgICAgLmNsYXNzZWQoJ2ludmVyc2UtaWNvbicsIHRydWUpXG4gICAgICAgICAgICAudGV4dChmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC52YWx1ZS5sYWJlbDsgfSk7XG4gICAgICAgIHR5cGVzRGl2c0VudGVyXG4gICAgICAgICAgICAuYXBwZW5kKCdzcGFuJylcbiAgICAgICAgICAgIC5jbGFzc2VkKCdnbHlwaGljb24nLCB0cnVlKVxuICAgICAgICAgICAgLmNsYXNzZWQoJ2dseXBoaWNvbi1kb3dubG9hZCcsIHRydWUpXG4gICAgICAgICAgICAub24oJ2NsaWNrJywgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIF90aGlzLmRvd25sb2FkQ1NWKGQpOyB9KTtcbiAgICAgICAgdHlwZXNEaXZzRW50ZXJcbiAgICAgICAgICAgIC5hcHBlbmQoJ3NwYW4nKVxuICAgICAgICAgICAgLmNsYXNzZWQoJ2dseXBoaWNvbicsIHRydWUpXG4gICAgICAgICAgICAuY2xhc3NlZCgnZXhwYW5kLWJ1dHRvbicsIHRydWUpXG4gICAgICAgICAgICAub24oJ2NsaWNrJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIGQudmFsdWUuZXhwYW5kZWQgPSAhZC52YWx1ZS5leHBhbmRlZDtcbiAgICAgICAgICAgIF90aGlzLnR5cGVJdGVtVHJlZVByb21pc2UudGhlbihfdGhpcy5idWlsZC5iaW5kKF90aGlzKSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0eXBlc0RpdnNFbnRlclxuICAgICAgICAgICAgLmFwcGVuZCgnc3ZnJylcbiAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsICcxMDAlJyk7XG4gICAgICAgIHRoaXMudHlwZXNEMyA9IHR5cGVzRGl2c0VudGVyXG4gICAgICAgICAgICAubWVyZ2UodGhpcy50eXBlc0QzKTtcbiAgICAgICAgdGhpcy50eXBlc0QzLnNlbGVjdEFsbCgnLmV4cGFuZC1idXR0b24nKVxuICAgICAgICAgICAgLmNsYXNzZWQoJ2dseXBoaWNvbi1yZXNpemUtc21hbGwnLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC52YWx1ZS5leHBhbmRlZDsgfSlcbiAgICAgICAgICAgIC5jbGFzc2VkKCdnbHlwaGljb24tcmVzaXplLWZ1bGwnLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gIWQudmFsdWUuZXhwYW5kZWQ7IH0pO1xuICAgICAgICB0aGlzLnR5cGVzRDMuc2VsZWN0QWxsKCdzdmcnKVxuICAgICAgICAgICAgLnN0eWxlKCdkaXNwbGF5JywgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudmFsdWUuZXhwYW5kZWQgPyAnYmxvY2snIDogJ25vbmUnOyB9KTtcbiAgICAgICAgdmFyIHR5cGVTdmdzID0gdGhpcy50eXBlc0QzLnNlbGVjdCgnc3ZnJylcbiAgICAgICAgICAgIC5hdHRyKCdoZWlnaHQnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuIChNYXRoLmNlaWwoZC52YWx1ZS5pdGVtcy5sZW5ndGggLyB4RG90cykgKyAxKSAqIHlPZmZzZXQ7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmNpcmNsZXMgPSB0eXBlU3Znc1xuICAgICAgICAgICAgLnNlbGVjdEFsbCgnY2lyY2xlLml0ZW0nKVxuICAgICAgICAgICAgLmRhdGEoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudmFsdWUuaXRlbXM7IH0sIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnZhbHVlOyB9KTtcbiAgICAgICAgdGhpcy5jaXJjbGVzLmV4aXQoKS5yZW1vdmUoKTtcbiAgICAgICAgdGhpcy5jaXJjbGVzID0gdGhpcy5jaXJjbGVzLmVudGVyKClcbiAgICAgICAgICAgIC5hcHBlbmQoJ2NpcmNsZScpXG4gICAgICAgICAgICAuY2xhc3NlZCgnaXRlbScsIHRydWUpXG4gICAgICAgICAgICAuYXR0cigncicsIHJhZGl1cylcbiAgICAgICAgICAgIC5vbignbW91c2VvdmVyJywgZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgICAgIF90aGlzLnRvb2x0aXAuc3R5bGUoJ3RvcCcsIChkMy5ldmVudC5wYWdlWSAtIDEwKSArICdweCcpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdsZWZ0JywgKGQzLmV2ZW50LnBhZ2VYICsgMTApICsgJ3B4JylcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpXG4gICAgICAgICAgICAgICAgLnRleHQoZC5sYWJlbCArICcgKCcgKyBkLnR5cGVMYWJlbCArICcpJyk7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAub24oJ21vdXNlb3V0JywgZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgICAgIF90aGlzLnRvb2x0aXAuc3R5bGUoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAuY2FsbChkMy5kcmFnKClcbiAgICAgICAgICAgIC5vbignc3RhcnQnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgdmFyIHRoaXNDaXJjbGUgPSBkMy5zZWxlY3QodGhpcyk7XG4gICAgICAgICAgICBub2RlRHJhZ1xuICAgICAgICAgICAgICAgIC5zdHlsZSgnZGlzcGxheScsICdibG9jaycpO1xuICAgICAgICAgICAgbm9kZURyYWcuc2VsZWN0KCdjaXJjbGUnKVxuICAgICAgICAgICAgICAgIC5jbGFzc2VkKCdpdGVtJywgdGhpc0NpcmNsZS5jbGFzc2VkKCdpdGVtJykpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3InLCB0aGlzQ2lyY2xlLmF0dHIoJ3InKSlcbiAgICAgICAgICAgICAgICAuYXR0cignZmlsbCcsIHRoaXNDaXJjbGUuYXR0cignZmlsbCcpKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDgsOCknKTtcbiAgICAgICAgICAgIG5vZGVEcmFnXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdsZWZ0JywgZDMuZXZlbnQuc291cmNlRXZlbnQuY2xpZW50WCAtIDgpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCd0b3AnLCBkMy5ldmVudC5zb3VyY2VFdmVudC5jbGllbnRZIC0gOCk7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAub24oJ2RyYWcnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgbm9kZURyYWdcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2xlZnQnLCBkMy5ldmVudC5zb3VyY2VFdmVudC5jbGllbnRYIC0gOClcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ3RvcCcsIGQzLmV2ZW50LnNvdXJjZUV2ZW50LmNsaWVudFkgLSA4KTtcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC5vbignZW5kJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIC8vIElmIHRoZSBjdXJzb3IgaXMgb24gdGhlIGNhbnZhcywgZGlzcGxheVxuICAgICAgICAgICAgdmFyIGV4cGxvcmVDb250YWluZXIgPSBkMy5zZWxlY3QoJyNleHBsb3JlY29udGFpbmVyJykubm9kZSgpO1xuICAgICAgICAgICAgaWYgKGQzLmV2ZW50LnNvdXJjZUV2ZW50LmNsaWVudFggPiBleHBsb3JlQ29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQgJiZcbiAgICAgICAgICAgICAgICBkMy5ldmVudC5zb3VyY2VFdmVudC5jbGllbnRYIDwgZXhwbG9yZUNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5yaWdodCAmJlxuICAgICAgICAgICAgICAgIGQzLmV2ZW50LnNvdXJjZUV2ZW50LmNsaWVudFkgPiBleHBsb3JlQ29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCAmJlxuICAgICAgICAgICAgICAgIGQzLmV2ZW50LnNvdXJjZUV2ZW50LmNsaWVudFkgPCBleHBsb3JlQ29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmJvdHRvbSkge1xuICAgICAgICAgICAgICAgIGFkZEl0ZW0oZDMuc2VsZWN0KHRoaXMpLmRhdHVtKCksIFtcbiAgICAgICAgICAgICAgICAgICAgZDMuZXZlbnQuc291cmNlRXZlbnQuY2xpZW50WCAtIGV4cGxvcmVDb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCxcbiAgICAgICAgICAgICAgICAgICAgZDMuZXZlbnQuc291cmNlRXZlbnQuY2xpZW50WSAtIGV4cGxvcmVDb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wXG4gICAgICAgICAgICAgICAgXSkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGVEcmFnLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG5vZGVEcmFnLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpXG4gICAgICAgICAgICAubWVyZ2UodGhpcy5jaXJjbGVzKVxuICAgICAgICAgICAgLmNhbGwodGhpcy51cGRhdGUuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMuY2lyY2xlc1xuICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgLmF0dHIoJ2ZpbGwnLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gX3RoaXMudHlwZUNvbG9yU2NhbGUoZC50eXBlVmFsdWUpOyB9KVxuICAgICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uIChkLCBpKSB7IHJldHVybiAndHJhbnNsYXRlKCcgKyAoKGkgJSB4RG90cykgKyAxKSAqIHhPZmZzZXQgKyAnLCcgKyAoTWF0aC5mbG9vcihpIC8geERvdHMpICsgMSkgKiB5T2Zmc2V0ICsgJyknOyB9KTtcbiAgICB9O1xuICAgIFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoY2lyY2xlcykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgYyA9IGNpcmNsZXMgPyBjaXJjbGVzIDogdGhpcy5jaXJjbGVzO1xuICAgICAgICBjLmNsYXNzZWQoJ2Rpc3BsYXllZCcsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBfdGhpcy5maWJyYVNlcnZpY2UuZ2V0U3RhdGUoKS5jb25zdHJ1Y3QuaXRlbUluZGV4W2QudmFsdWVdID8gdHJ1ZSA6IGZhbHNlOyB9KVxuICAgICAgICAgICAgLmNsYXNzZWQoJ2ZpbHRlcmVkJywgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIF90aGlzLmxhYmVsRmlsdGVyICYmICEoZC5sYWJlbC50b1VwcGVyQ2FzZSgpLmluZGV4T2YoX3RoaXMubGFiZWxGaWx0ZXIudG9VcHBlckNhc2UoKSkgIT09IC0xKTsgfSk7XG4gICAgfTtcbiAgICBQYWxldHRlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUubWFwVHlwZXNUb1RoaXMgPSBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGVzOiBzdGF0ZS50eXBlc1xuICAgICAgICB9O1xuICAgIH07XG4gICAgUGFsZXR0ZUNvbXBvbmVudENvbnRyb2xsZXIucHJvdG90eXBlLm1hcEl0ZW1zVG9UaGlzID0gZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpdGVtczogc3RhdGUuaXRlbXNcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyLnByb3RvdHlwZS51cGRhdGVTaXppbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucGFsZXR0ZVdpZHRoID0gTWF0aC5yb3VuZCh3aW5kb3cuaW5uZXJXaWR0aCAqIDAuMTUpOyAvLyB0aGlzLnN2Z1NlbC5ub2RlKCkuY2xpZW50V2lkdGhcbiAgICAgICAgdGhpcy5wYWxldHRlSGVpZ2h0ID0gTWF0aC5yb3VuZCh3aW5kb3cuaW5uZXJIZWlnaHQpIC0gdGhpcy5wYWxldHRlU2VhcmNoSGVpZ2h0O1xuICAgICAgICB0aGlzLmRpdlNlbC5zdHlsZSgnaGVpZ2h0JywgdGhpcy5wYWxldHRlSGVpZ2h0ICsgJ3B4Jyk7XG4gICAgfTtcbiAgICBQYWxldHRlQ29tcG9uZW50Q29udHJvbGxlci5wcm90b3R5cGUubWVyZ2VJdGVtcyA9IGZ1bmN0aW9uIChvbGRJdGVtcywgbmV3SXRlbXMpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgLy8gV2lwZSBvbGQgaXRlbXMgKGJhZCwgYnV0IHRlbXBvcmFyeSlcbiAgICAgICAgdGhpcy50eXBlSXRlbVRyZWUudmFsdWVzKCkuZm9yRWFjaChmdW5jdGlvbiAodikge1xuICAgICAgICAgICAgdi5pdGVtcyA9IFtdO1xuICAgICAgICB9KTtcbiAgICAgICAgbmV3SXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgdmFyIHR5cGVQcm9wID0gaXRlbS5sb2NhbFByb3BlcnRpZXMuZmlsdGVyKGZ1bmN0aW9uIChwKSB7IHJldHVybiBwLnZhbHVlID09PSBSREYudHlwZS52YWx1ZTsgfSlbMF07XG4gICAgICAgICAgICBpZiAodHlwZVByb3AgJiYgdHlwZVByb3AudmFsdWVzWzBdKSB7XG4gICAgICAgICAgICAgICAgaXRlbS50eXBlVmFsdWUgPSB0eXBlUHJvcC52YWx1ZXNbMF0udmFsdWUudmFsdWU7XG4gICAgICAgICAgICAgICAgaXRlbS50eXBlTGFiZWwgPSB0eXBlUHJvcC52YWx1ZXNbMF0udmFsdWUubGFiZWw7XG4gICAgICAgICAgICAgICAgLy8gQWRkIHR5cGUgdG8gdGhlIHR5cGUgbWFwXG4gICAgICAgICAgICAgICAgaWYgKCFfdGhpcy50eXBlSXRlbVRyZWUuaGFzKGl0ZW0udHlwZVZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy50eXBlSXRlbVRyZWUuc2V0KGl0ZW0udHlwZVZhbHVlLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogaXRlbS50eXBlTGFiZWwsXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtczogW2l0ZW1dLFxuICAgICAgICAgICAgICAgICAgICAgICAgZXhwYW5kZWQ6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy50eXBlSXRlbVRyZWUuZ2V0KGl0ZW0udHlwZVZhbHVlKS5pdGVtcy5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGl0ZW0udHlwZVZhbHVlID0gJyc7XG4gICAgICAgICAgICAgICAgaXRlbS50eXBlTGFiZWwgPSAnTm8gdHlwZSBkZWZpbmVkJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIFNvcnQgYnkgbGFiZWxcbiAgICAgICAgdGhpcy50eXBlSXRlbVRyZWUudmFsdWVzKCkuZm9yRWFjaChmdW5jdGlvbiAodikge1xuICAgICAgICAgICAgdi5pdGVtcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBhLmxhYmVsID09PSBiLmxhYmVsID8gMCA6IGEubGFiZWwgPiBiLmxhYmVsID8gMSA6IC0xOyB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnR5cGVJdGVtVHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBQYWxldHRlQ29tcG9uZW50Q29udHJvbGxlcjtcbn0oKSk7XG5leHBvcnQgeyBQYWxldHRlQ29tcG9uZW50Q29udHJvbGxlciB9O1xudmFyIFBhbGV0dGVDb21wb25lbnQgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFBhbGV0dGVDb21wb25lbnQoKSB7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSByZXF1aXJlKCcuL3BhbGV0dGUtY29tcG9uZW50LnB1ZycpKCk7XG4gICAgICAgIHRoaXMuY29udHJvbGxlciA9IFBhbGV0dGVDb21wb25lbnRDb250cm9sbGVyO1xuICAgIH1cbiAgICByZXR1cm4gUGFsZXR0ZUNvbXBvbmVudDtcbn0oKSk7XG5leHBvcnQgeyBQYWxldHRlQ29tcG9uZW50IH07XG5hbmd1bGFyLm1vZHVsZSgnZmlicmEuY29tcG9uZW50cy5wYWxldHRlJywgWydmaWJyYS5zZXJ2aWNlcyddKVxuICAgIC5jb21wb25lbnQoJ3BhbGV0dGUnLCBuZXcgUGFsZXR0ZUNvbXBvbmVudCgpKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBhcHAvY29tcG9uZW50cy9jb25zdHJ1Y3Qtdmlldy9wYWxldHRlLWNvbXBvbmVudC9wYWxldHRlLWNvbXBvbmVudC50cyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFRQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFJQTtBQUFBO0FBQ0E7QUFJQTtBQUFBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBRUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBS0E7QUFJQTtBQUVBO0FBQ0E7QUFHQTtBQUNBO0FBRUE7QUFLQTtBQUdBO0FBRUE7QUFHQTtBQUVBO0FBQ0E7QUFDQTtBQUlBO0FBSUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBR0E7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),

/***/ "./app/components/index.ts":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_angular___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_angular__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__projects_view_projects_view_component__ = __webpack_require__(\"./app/components/projects-view/projects-view-component.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__citable_citable_component__ = __webpack_require__(\"./app/components/citable/citable-component.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__social_auth_callback_component__ = __webpack_require__(\"./app/components/social-auth/callback-component.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__social_auth_login_component__ = __webpack_require__(\"./app/components/social-auth/login-component.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__construct_view_construct_view_component__ = __webpack_require__(\"./app/components/construct-view/construct-view-component.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__construct_view_explore_component__ = __webpack_require__(\"./app/components/construct-view/explore-component.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__construct_view_property_popover__ = __webpack_require__(\"./app/components/construct-view/property-popover.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__construct_view_palette_component_palette_component__ = __webpack_require__(\"./app/components/construct-view/palette-component/palette-component.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_9__construct_view_explore_verify_component_explore_verify_component__ = __webpack_require__(\"./app/components/construct-view/explore-verify-component/explore-verify-component.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_10__construct_view_explore_table_component_explore_table_component__ = __webpack_require__(\"./app/components/construct-view/explore-table-component/explore-table-component.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_11__construct_view_explore_type_component_explore_type_component__ = __webpack_require__(\"./app/components/construct-view/explore-type-component/explore-type-component.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_12__configure_view_configure_view_component__ = __webpack_require__(\"./app/components/configure-view/configure-view-component.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_13__citable_editor_citable_editor_component__ = __webpack_require__(\"./app/components/citable-editor/citable-editor-component.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_14__edit_primary_endpoint_configuration_view_edit_primary_endpoint_configuration_view_component__ = __webpack_require__(\"./app/components/edit-primary-endpoint-configuration-view/edit-primary-endpoint-configuration-view-component.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_15__edit_remote_endpoint_configuration_view_edit_remote_endpoint_configuration_view_component__ = __webpack_require__(\"./app/components/edit-remote-endpoint-configuration-view/edit-remote-endpoint-configuration-view-component.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_16__edit_schema_view_edit_schema_view_component__ = __webpack_require__(\"./app/components/edit-schema-view/edit-schema-view-component.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_17__project_source_configurations_view_project_source_configurations_view_component__ = __webpack_require__(\"./app/components/project-source-configurations-view/project-source-configurations-view-component.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_18__project_sources_view_project_sources_view_component__ = __webpack_require__(\"./app/components/project-sources-view/project-sources-view-component.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_19__type_select_type_select_component__ = __webpack_require__(\"./app/components/type-select/type-select-component.ts\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_20__upload_upload_component__ = __webpack_require__(\"./app/components/upload/upload-component.ts\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n__WEBPACK_IMPORTED_MODULE_0_angular__[\"module\"]('fibra.components', ['fibra.components.construct-view', 'fibra.components.explore', 'fibra.components.property-popover', 'fibra.components.palette', 'fibra.components.verify', 'fibra.components.explore-table', 'fibra.components.explore-type', 'fibra.components.projects-view', 'fibra.components.citable', 'fibra.components.callback', 'fibra.components.login', 'fibra.components.configure', 'fibra.components.citable-editor', 'fibra.components.edit-primary-endpoint-configuration', 'fibra.components.edit-remote-endpoint-configuration', 'fibra.components.edit-schema-view', 'fibra.components.project-source-configurations-view', 'fibra.components.project-sources-view', 'fibra.components.type-select', 'fibra.components.upload']);//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvY29tcG9uZW50cy9pbmRleC50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hcHAvY29tcG9uZW50cy9pbmRleC50cz8zMWZkIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmltcG9ydCAqIGFzIGFuZ3VsYXIgZnJvbSAnYW5ndWxhcic7XG5pbXBvcnQgJy4vcHJvamVjdHMtdmlldy9wcm9qZWN0cy12aWV3LWNvbXBvbmVudCc7XG5pbXBvcnQgJy4vY2l0YWJsZS9jaXRhYmxlLWNvbXBvbmVudCc7XG5pbXBvcnQgJy4vc29jaWFsLWF1dGgvY2FsbGJhY2stY29tcG9uZW50JztcbmltcG9ydCAnLi9zb2NpYWwtYXV0aC9sb2dpbi1jb21wb25lbnQnO1xuaW1wb3J0ICcuL2NvbnN0cnVjdC12aWV3L2NvbnN0cnVjdC12aWV3LWNvbXBvbmVudCc7XG5pbXBvcnQgJy4vY29uc3RydWN0LXZpZXcvZXhwbG9yZS1jb21wb25lbnQnO1xuaW1wb3J0ICcuL2NvbnN0cnVjdC12aWV3L3Byb3BlcnR5LXBvcG92ZXInO1xuaW1wb3J0ICcuL2NvbnN0cnVjdC12aWV3L3BhbGV0dGUtY29tcG9uZW50L3BhbGV0dGUtY29tcG9uZW50JztcbmltcG9ydCAnLi9jb25zdHJ1Y3Qtdmlldy9leHBsb3JlLXZlcmlmeS1jb21wb25lbnQvZXhwbG9yZS12ZXJpZnktY29tcG9uZW50JztcbmltcG9ydCAnLi9jb25zdHJ1Y3Qtdmlldy9leHBsb3JlLXRhYmxlLWNvbXBvbmVudC9leHBsb3JlLXRhYmxlLWNvbXBvbmVudCc7XG5pbXBvcnQgJy4vY29uc3RydWN0LXZpZXcvZXhwbG9yZS10eXBlLWNvbXBvbmVudC9leHBsb3JlLXR5cGUtY29tcG9uZW50JztcbmltcG9ydCAnLi9jb25maWd1cmUtdmlldy9jb25maWd1cmUtdmlldy1jb21wb25lbnQnO1xuaW1wb3J0ICcuL2NpdGFibGUtZWRpdG9yL2NpdGFibGUtZWRpdG9yLWNvbXBvbmVudCc7XG5pbXBvcnQgJy4vZWRpdC1wcmltYXJ5LWVuZHBvaW50LWNvbmZpZ3VyYXRpb24tdmlldy9lZGl0LXByaW1hcnktZW5kcG9pbnQtY29uZmlndXJhdGlvbi12aWV3LWNvbXBvbmVudCc7XG5pbXBvcnQgJy4vZWRpdC1yZW1vdGUtZW5kcG9pbnQtY29uZmlndXJhdGlvbi12aWV3L2VkaXQtcmVtb3RlLWVuZHBvaW50LWNvbmZpZ3VyYXRpb24tdmlldy1jb21wb25lbnQnO1xuaW1wb3J0ICcuL2VkaXQtc2NoZW1hLXZpZXcvZWRpdC1zY2hlbWEtdmlldy1jb21wb25lbnQnO1xuaW1wb3J0ICcuL3Byb2plY3Qtc291cmNlLWNvbmZpZ3VyYXRpb25zLXZpZXcvcHJvamVjdC1zb3VyY2UtY29uZmlndXJhdGlvbnMtdmlldy1jb21wb25lbnQnO1xuaW1wb3J0ICcuL3Byb2plY3Qtc291cmNlcy12aWV3L3Byb2plY3Qtc291cmNlcy12aWV3LWNvbXBvbmVudCc7XG5pbXBvcnQgJy4vdHlwZS1zZWxlY3QvdHlwZS1zZWxlY3QtY29tcG9uZW50JztcbmltcG9ydCAnLi91cGxvYWQvdXBsb2FkLWNvbXBvbmVudCc7XG5hbmd1bGFyLm1vZHVsZSgnZmlicmEuY29tcG9uZW50cycsIFtcbiAgICAnZmlicmEuY29tcG9uZW50cy5jb25zdHJ1Y3QtdmlldycsXG4gICAgJ2ZpYnJhLmNvbXBvbmVudHMuZXhwbG9yZScsXG4gICAgJ2ZpYnJhLmNvbXBvbmVudHMucHJvcGVydHktcG9wb3ZlcicsXG4gICAgJ2ZpYnJhLmNvbXBvbmVudHMucGFsZXR0ZScsXG4gICAgJ2ZpYnJhLmNvbXBvbmVudHMudmVyaWZ5JyxcbiAgICAnZmlicmEuY29tcG9uZW50cy5leHBsb3JlLXRhYmxlJyxcbiAgICAnZmlicmEuY29tcG9uZW50cy5leHBsb3JlLXR5cGUnLFxuICAgICdmaWJyYS5jb21wb25lbnRzLnByb2plY3RzLXZpZXcnLFxuICAgICdmaWJyYS5jb21wb25lbnRzLmNpdGFibGUnLFxuICAgICdmaWJyYS5jb21wb25lbnRzLmNhbGxiYWNrJyxcbiAgICAnZmlicmEuY29tcG9uZW50cy5sb2dpbicsXG4gICAgJ2ZpYnJhLmNvbXBvbmVudHMuY29uZmlndXJlJyxcbiAgICAnZmlicmEuY29tcG9uZW50cy5jaXRhYmxlLWVkaXRvcicsXG4gICAgJ2ZpYnJhLmNvbXBvbmVudHMuZWRpdC1wcmltYXJ5LWVuZHBvaW50LWNvbmZpZ3VyYXRpb24nLFxuICAgICdmaWJyYS5jb21wb25lbnRzLmVkaXQtcmVtb3RlLWVuZHBvaW50LWNvbmZpZ3VyYXRpb24nLFxuICAgICdmaWJyYS5jb21wb25lbnRzLmVkaXQtc2NoZW1hLXZpZXcnLFxuICAgICdmaWJyYS5jb21wb25lbnRzLnByb2plY3Qtc291cmNlLWNvbmZpZ3VyYXRpb25zLXZpZXcnLFxuICAgICdmaWJyYS5jb21wb25lbnRzLnByb2plY3Qtc291cmNlcy12aWV3JyxcbiAgICAnZmlicmEuY29tcG9uZW50cy50eXBlLXNlbGVjdCcsXG4gICAgJ2ZpYnJhLmNvbXBvbmVudHMudXBsb2FkJ1xuXSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL2NvbXBvbmVudHMvaW5kZXgudHMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ })

})